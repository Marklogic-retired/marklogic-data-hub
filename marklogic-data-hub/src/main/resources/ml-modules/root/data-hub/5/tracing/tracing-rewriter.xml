<!--
  ~ Copyright 2012-2019 MarkLogic Corporation
  ~
  ~  Licensed under the Apache License, Version 2.0 (the "License");
  ~  you may not use this file except in compliance with the License.
  ~  You may obtain a copy of the License at
  ~
  ~     http://www.apache.org/licenses/LICENSE-2.0
  ~
  ~  Unless required by applicable law or agreed to in writing, software
  ~  distributed under the License is distributed on an "AS IS" BASIS,
  ~  WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
  ~  See the License for the specific language governing permissions and
  ~  limitations under the License.
  ~
  -->
<rewriter xmlns="http://marklogic.com/xdmp/rewriter">
    <!-- XDBC -->
      <match-path  any-of="/eval /invoke /spawn /insert">
       <dispatch xdbc="true">$0</dispatch>
      </match-path>
    <!-- XDBC -->

    <match-path matches="^/?$">
      <dispatch>/trace-ui/index.html</dispatch>
    </match-path>

    <match-path matches="^/?$|^/content/([^/]+)/?$">
        <dispatch>/trace-ui/index.html</dispatch>
    </match-path>

    <match-path matches="^/.*\.(ico|js|css|ttf|eot|woff|woff2|svg)$">
        <add-query-param name="uri">$0</add-query-param>
        <add-query-param name="extension">$1</add-query-param>
        <dispatch>/data-hub/4/tracing/trace-ui.xqy</dispatch>
    </match-path>

    <match-path matches="^/assets/.+$">
        <add-query-param name="uri">$0</add-query-param>
        <dispatch>/data-hub/4/tracing/trace-ui.xqy</dispatch>
    </match-path>

    <!-- REST Client API endpoints -->
    <match-path matches="^/(v1|LATEST)">

        <!-- DHF -->
        <match-path matches="^/(v1|LATEST)/internal/hubcollector/?$">
            <match-method any-of="GET">
                <match-query-param name="database">
                    <set-database checked="true">$0</set-database>
                </match-query-param>
                <dispatch>/data-hub/4/endpoints/collector.xqy</dispatch>
            </match-method>
        </match-path>
        <!-- DHF -->

        <match-path matches="^/(v1|LATEST)/alert/rules/?$">
            <match-query-param name="txid">
                <set-transaction>$0</set-transaction>
                <set-transaction-mode>query</set-transaction-mode>
            </match-query-param>
            <match-query-param name="database">
                <set-database checked="true">$0</set-database>
            </match-query-param>
            <match-accept any-of="application/json application/xml text/json text/xml */*">
                <dispatch>/MarkLogic/rest-api/endpoints/rules-list.xqy</dispatch>
            </match-accept>
            <match-header name="accept">
                <dispatch>/MarkLogic/rest-api/endpoints/unacceptable-type.xqy</dispatch>
            </match-header>
            <dispatch>/MarkLogic/rest-api/endpoints/rules-list.xqy</dispatch>
        </match-path>

        <match-path matches="^/(v1|LATEST)/alert/rules/([^/]+)$">
            <add-query-param name="rule-name">$2</add-query-param>
            <match-query-param name="database">
                <set-database checked="true">$0</set-database>
            </match-query-param>
            <match-method any-of="POST">
                <match-content-type any-of="application/x-www-form-urlencoded">
                    <match-query-param name="txid">
                        <set-transaction>$0</set-transaction>
                        <set-transaction-mode>query</set-transaction-mode>
                    </match-query-param>
                    <dispatch>/MarkLogic/rest-api/endpoints/rules-item-query.xqy</dispatch>
                </match-content-type>
            </match-method>
            <match-method any-of="GET HEAD">
                <match-query-param name="txid">
                    <set-transaction>$0</set-transaction>
                    <set-transaction-mode>query</set-transaction-mode>
                </match-query-param>
                <match-accept any-of="application/json application/xml text/json text/xml */*">
                    <dispatch>/MarkLogic/rest-api/endpoints/rules-item-query.xqy</dispatch>
                </match-accept>
                <match-header name="accept">
                    <dispatch>/MarkLogic/rest-api/endpoints/unacceptable-type.xqy</dispatch>
                </match-header>
                <dispatch>/MarkLogic/rest-api/endpoints/rules-item-query.xqy</dispatch>
            </match-method>
            <match-method any-of="POST PUT DELETE">
                <match-query-param name="txid">
                    <set-transaction>$0</set-transaction>
                    <set-transaction-mode>update</set-transaction-mode>
                </match-query-param>
                <match-accept any-of="application/json application/xml text/json text/xml */*">
                    <dispatch>/MarkLogic/rest-api/endpoints/rules-item-update.xqy</dispatch>
                </match-accept>
                <match-header name="accept">
                    <dispatch>/MarkLogic/rest-api/endpoints/unacceptable-type.xqy</dispatch>
                </match-header>
                <dispatch>/MarkLogic/rest-api/endpoints/rules-item-update.xqy</dispatch>
            </match-method>
        </match-path>

        <match-path matches="^/(v1|LATEST)/alert/match/?$">
            <match-query-param name="txid">
                <set-transaction>$0</set-transaction>
                <set-transaction-mode>query</set-transaction-mode>
            </match-query-param>
            <match-query-param name="database">
                <set-database checked="true">$0</set-database>
            </match-query-param>
            <match-accept any-of="application/json application/xml text/json text/xml */*">
                <dispatch>/MarkLogic/rest-api/endpoints/rules-match.xqy</dispatch>
            </match-accept>
            <match-header name="accept">
                <dispatch>/MarkLogic/rest-api/endpoints/unacceptable-type.xqy</dispatch>
            </match-header>
            <dispatch>/MarkLogic/rest-api/endpoints/rules-match.xqy</dispatch>
        </match-path>

        <match-path matches="^/(v1|LATEST)/config/indexes/?$">
            <match-accept any-of="application/json application/xml text/json text/xml */*">
                <dispatch>/MarkLogic/rest-api/endpoints/config-indexes.xqy</dispatch>
            </match-accept>
            <match-header name="accept">
                <dispatch>/MarkLogic/rest-api/endpoints/unacceptable-type.xqy</dispatch>
            </match-header>
            <dispatch>/MarkLogic/rest-api/endpoints/config-indexes.xqy</dispatch>
        </match-path>

        <match-path matches="^/(v1|LATEST)/config/indexes/([^/]+)/?$">
            <add-query-param name="named-option">$2</add-query-param>
            <match-accept any-of="application/json application/xml text/json text/xml text/html */*">
                <dispatch>/MarkLogic/rest-api/endpoints/config-indexes.xqy</dispatch>
            </match-accept>
            <match-header name="accept">
                <dispatch>/MarkLogic/rest-api/endpoints/unacceptable-type.xqy</dispatch>
            </match-header>
            <dispatch>/MarkLogic/rest-api/endpoints/config-indexes.xqy</dispatch>
        </match-path>

        <match-path matches="^/(v1|LATEST)/config/namespaces/?$">
            <match-accept any-of="application/json application/xml text/json text/xml */*">
                <dispatch>/MarkLogic/rest-api/endpoints/config-namespace-list.xqy</dispatch>
            </match-accept>
            <match-header name="accept">
                <dispatch>/MarkLogic/rest-api/endpoints/unacceptable-type.xqy</dispatch>
            </match-header>
            <dispatch>/MarkLogic/rest-api/endpoints/config-namespace-list.xqy</dispatch>
        </match-path>

        <match-path matches="^/(v1|LATEST)/config/namespaces/([^/]+)/?$">
            <add-query-param name="prefix">$2</add-query-param>
            <match-accept any-of="application/json application/xml text/json text/xml */*">
                <dispatch>/MarkLogic/rest-api/endpoints/config-namespace-item.xqy</dispatch>
            </match-accept>
            <match-header name="accept">
                <dispatch>/MarkLogic/rest-api/endpoints/unacceptable-type.xqy</dispatch>
            </match-header>
            <dispatch>/MarkLogic/rest-api/endpoints/config-namespace-item.xqy</dispatch>
        </match-path>

        <match-path matches="^/(v1|LATEST)/config/properties/?$">
            <match-accept any-of="application/json application/xml text/json text/xml */*">
                <dispatch>/MarkLogic/rest-api/endpoints/config-properties.xqy</dispatch>
            </match-accept>
            <match-header name="accept">
                <dispatch>/MarkLogic/rest-api/endpoints/unacceptable-type.xqy</dispatch>
            </match-header>
            <dispatch>/MarkLogic/rest-api/endpoints/config-properties.xqy</dispatch>
        </match-path>

        <match-path matches="^/(v1|LATEST)/config/properties/([^/]+)/?$">
            <add-query-param name="property">$2</add-query-param>
            <match-accept any-of="application/json application/xml text/json text/xml */*">
                <dispatch>/MarkLogic/rest-api/endpoints/config-properties.xqy</dispatch>
            </match-accept>
            <match-header name="accept">
                <dispatch>/MarkLogic/rest-api/endpoints/unacceptable-type.xqy</dispatch>
            </match-header>
            <dispatch>/MarkLogic/rest-api/endpoints/config-properties.xqy</dispatch>
        </match-path>

        <match-path matches="^/(v1|LATEST)/config/query/?$">
            <match-accept any-of="application/json application/xml text/json text/xml */*">
                <dispatch>/MarkLogic/rest-api/endpoints/config-query-list.xqy</dispatch>
            </match-accept>
            <match-header name="accept">
                <dispatch>/MarkLogic/rest-api/endpoints/unacceptable-type.xqy</dispatch>
            </match-header>
            <dispatch>/MarkLogic/rest-api/endpoints/config-query-list.xqy</dispatch>
        </match-path>

        <match-path matches="^/(v1|LATEST)/config/query/([^/]+)/?$">
            <add-query-param name="named-option">$2</add-query-param>
            <match-accept any-of="application/json application/xml text/json text/xml */*">
                <dispatch>/MarkLogic/rest-api/endpoints/config-query.xqy</dispatch>
            </match-accept>
            <match-header name="accept">
                <dispatch>/MarkLogic/rest-api/endpoints/unacceptable-type.xqy</dispatch>
            </match-header>
            <dispatch>/MarkLogic/rest-api/endpoints/config-query.xqy</dispatch>
        </match-path>

        <match-path matches="^/(v1|LATEST)/config/query/([^/]+)/([^/]+)/?$">
            <add-query-param name="named-option">$2</add-query-param>
            <add-query-param name="child-name">$3</add-query-param>
            <match-accept any-of="application/json application/xml text/json text/xml */*">
                <dispatch>/MarkLogic/rest-api/endpoints/config-query-child.xqy</dispatch>
            </match-accept>
            <match-header name="accept">
                <dispatch>/MarkLogic/rest-api/endpoints/unacceptable-type.xqy</dispatch>
            </match-header>
            <dispatch>/MarkLogic/rest-api/endpoints/config-query-child.xqy</dispatch>
        </match-path>

        <match-path matches="^/(v1|LATEST)/config/resources/?$">
            <match-accept any-of="application/json application/xml text/json text/xml */*">
                <dispatch>/MarkLogic/rest-api/endpoints/resource-list-query.xqy</dispatch>
            </match-accept>
            <match-header name="accept">
                <dispatch>/MarkLogic/rest-api/endpoints/unacceptable-type.xqy</dispatch>
            </match-header>
            <dispatch>/MarkLogic/rest-api/endpoints/resource-list-query.xqy</dispatch>
        </match-path>

        <match-path matches="^/(v1|LATEST)/config/resources/([^/]+)/?$">
            <add-query-param name="name">$2</add-query-param>
            <match-method any-of="GET HEAD">
                <match-query-param name="txid">
                    <set-transaction>$0</set-transaction>
                    <set-transaction-mode>query</set-transaction-mode>
                </match-query-param>
                <match-accept any-of="application/javascript application/xquery application/vnd.marklogic-javascript application/vnd.marklogic-xdmp */*">
                    <dispatch>/MarkLogic/rest-api/endpoints/resource-item-query.xqy</dispatch>
                </match-accept>
                <match-header name="accept">
                    <dispatch>/MarkLogic/rest-api/endpoints/unacceptable-type.xqy</dispatch>
                </match-header>
                <dispatch>/MarkLogic/rest-api/endpoints/resource-item-query.xqy</dispatch>
            </match-method>
            <match-method any-of="PUT DELETE">
                <match-query-param name="txid">
                    <set-transaction>$0</set-transaction>
                    <set-transaction-mode>update</set-transaction-mode>
                </match-query-param>
                <dispatch>/MarkLogic/rest-api/endpoints/resource-item-update.xqy</dispatch>
            </match-method>
        </match-path>

        <match-path matches="^/(v1|LATEST)/config/transforms/?$">
            <match-accept any-of="application/json application/xml text/json text/xml */*">
                <dispatch>/MarkLogic/rest-api/endpoints/transform-list-default.xqy</dispatch>
            </match-accept>
            <match-header name="accept">
                <dispatch>/MarkLogic/rest-api/endpoints/unacceptable-type.xqy</dispatch>
            </match-header>
            <dispatch>/MarkLogic/rest-api/endpoints/transform-list-default.xqy</dispatch>
        </match-path>

        <match-path matches="^/(v1|LATEST)/config/transforms/([^/]+)$">
            <add-query-param name="name">$2</add-query-param>
            <match-method any-of="GET">
                <match-accept any-of="application/javascript application/xquery application/xslt+xml application/vnd.marklogic-javascript application/vnd.marklogic-xdmp */*">
                    <dispatch>/MarkLogic/rest-api/endpoints/transform-item-default.xqy</dispatch>
                </match-accept>
                <match-header name="accept">
                    <dispatch>/MarkLogic/rest-api/endpoints/unacceptable-type.xqy</dispatch>
                </match-header>
            </match-method>
            <dispatch>/MarkLogic/rest-api/endpoints/transform-item-default.xqy</dispatch>
        </match-path>

        <match-path matches="^/(v1|LATEST)/internal/forestinfo$">
            <match-query-param name="database">
                <set-database checked="true">$0</set-database>
            </match-query-param>
            <dispatch>/MarkLogic/rest-api/endpoints/forest-info.xqy</dispatch>
        </match-path>

        <match-path matches="^/(v1|LATEST)/documents/?$">
            <match-query-param name="database">
                <set-database checked="true">$0</set-database>
            </match-query-param>
            <match-method any-of="GET">
                <match-query-param name="txid">
                    <set-transaction>$0</set-transaction>
                    <set-transaction-mode>query</set-transaction-mode>
                </match-query-param>
                <match-query-param name="timestamp">
                    <set-transaction-timestamp>$0</set-transaction-timestamp>
                </match-query-param>
                <match-header name="if-match">
                    <dispatch>/data-hub/5/rest-api/endpoints/document-item-query.xqy</dispatch>
                </match-header>
                <match-header name="if-none-match">
                    <dispatch>/data-hub/5/rest-api/endpoints/document-item-query.xqy</dispatch>
                </match-header>
                <match-header name="accept" matches="^multipart/mixed">
                    <dispatch>/data-hub/5/rest-api/endpoints/document-item-query.xqy</dispatch>
                </match-header>
                <match-query-param name="category" repeated="true">
                  <dispatch>/data-hub/5/rest-api/endpoints/document-item-query.xqy</dispatch>
                </match-query-param>
                <match-query-param name="format">
                  <dispatch>/data-hub/5/rest-api/endpoints/document-item-query.xqy</dispatch>
                </match-query-param>
                <match-query-param name="transform">
                  <dispatch>/data-hub/5/rest-api/endpoints/document-item-query.xqy</dispatch>
                </match-query-param>
                <match-header name="range">
                  <dispatch>/data-hub/5/rest-api/endpoints/document-item-query.xqy</dispatch>
                </match-header>
                <dispatch>/data-hub/5/rest-api/endpoints/document-item-query-get.xqy</dispatch>
            </match-method>
            <match-method any-of="HEAD">
                <match-query-param name="txid">
                    <set-transaction>$0</set-transaction>
                    <set-transaction-mode>query</set-transaction-mode>
                </match-query-param>
                <match-query-param name="timestamp">
                    <set-transaction-timestamp>$0</set-transaction-timestamp>
                </match-query-param>
                <match-header name="if-match">
                    <dispatch>/data-hub/5/rest-api/endpoints/document-item-query.xqy</dispatch>
                </match-header>
                <match-header name="if-none-match">
                    <dispatch>/data-hub/5/rest-api/endpoints/document-item-query.xqy</dispatch>
                </match-header>
                <match-header name="accept" matches="^multipart/mixed">
                    <dispatch>/data-hub/5/rest-api/endpoints/document-item-query.xqy</dispatch>
                </match-header>
                <match-query-param name="category" repeated="true">
                    <dispatch>/data-hub/5/rest-api/endpoints/document-item-query.xqy</dispatch>
                </match-query-param>
                <match-query-param name="format">
                    <dispatch>/data-hub/5/rest-api/endpoints/document-item-query.xqy</dispatch>
                </match-query-param>
                <match-query-param name="transform">
                    <dispatch>/data-hub/5/rest-api/endpoints/document-item-query.xqy</dispatch>
                </match-query-param>
                <match-header name="range">
                    <dispatch>/data-hub/5/rest-api/endpoints/document-item-query.xqy</dispatch>
                </match-header>
                <dispatch>/data-hub/5/rest-api/endpoints/document-item-query-head.xqy</dispatch>
            </match-method>
            <match-method any-of="OPTIONS">
                <match-query-param name="txid">
                    <set-transaction>$0</set-transaction>
                    <set-transaction-mode>query</set-transaction-mode>
                </match-query-param>
                <match-query-param name="timestamp">
                    <set-transaction-timestamp>$0</set-transaction-timestamp>
                </match-query-param>
                <dispatch>/data-hub/5/rest-api/endpoints/document-item-query.xqy</dispatch>
            </match-method>
            <match-method any-of="PUT">
                <match-query-param name="txid">
                    <set-transaction>$0</set-transaction>
                    <set-transaction-mode>update</set-transaction-mode>
                </match-query-param>
                <match-header name="content-type" matches="^multipart/mixed">
                    <dispatch>/data-hub/5/rest-api/endpoints/document-item-update.xqy</dispatch>
                </match-header>
                <match-header name="if-match">
                    <dispatch>/data-hub/5/rest-api/endpoints/document-item-update.xqy</dispatch>
                </match-header>
                <match-query-param name="category" repeated="true">
                    <dispatch>/data-hub/5/rest-api/endpoints/document-item-update.xqy</dispatch>
                </match-query-param>
                <match-query-param name="extract">
                  <dispatch>/data-hub/5/rest-api/endpoints/document-item-update.xqy</dispatch>
                </match-query-param>
                <match-query-param name="format">
                    <dispatch>/data-hub/5/rest-api/endpoints/document-item-update.xqy</dispatch>
                </match-query-param>
                <match-query-param name="repair">
                    <dispatch>/data-hub/5/rest-api/endpoints/document-item-update.xqy</dispatch>
                </match-query-param>
                <match-query-param name="temporal-collection">
                    <dispatch>/data-hub/5/rest-api/endpoints/document-item-update.xqy</dispatch>
                </match-query-param>
                <match-query-param name="transform">
                    <dispatch>/data-hub/5/rest-api/endpoints/document-item-update.xqy</dispatch>
                </match-query-param>
                <dispatch>/data-hub/5/rest-api/endpoints/document-item-update-put.xqy</dispatch>
            </match-method>
            <match-method any-of="DELETE">
                <match-query-param name="txid">
                  <set-transaction>$0</set-transaction>
                  <set-transaction-mode>update</set-transaction-mode>
                </match-query-param>
                <match-header name="if-match">
                    <dispatch>/data-hub/5/rest-api/endpoints/document-item-update.xqy</dispatch>
                </match-header>
                <match-query-param name="temporal-collection">
                    <dispatch>/data-hub/5/rest-api/endpoints/document-item-update.xqy</dispatch>
                </match-query-param>
                <match-query-param name="category" repeated="true">
                  <dispatch>/data-hub/5/rest-api/endpoints/document-item-update.xqy</dispatch>
                </match-query-param>
                <dispatch>/data-hub/5/rest-api/endpoints/document-item-update-delete.xqy</dispatch>
             </match-method>
            <match-method any-of="POST">
                <match-query-param name="txid">
                    <set-transaction>$0</set-transaction>
                    <set-transaction-mode>update</set-transaction-mode>
                </match-query-param>
                <match-content-type any-of="application/x-www-form-urlencoded">
                    <dispatch>/data-hub/5/rest-api/endpoints/document-item-query.xqy</dispatch>
                </match-content-type>
                <match-query-param name="extension">
                    <match-header name="content-type" matches="^multipart/mixed">
                        <dispatch>/data-hub/5/rest-api/endpoints/document-item-update.xqy</dispatch>
                    </match-header>
                    <match-query-param name="category" repeated="true">
                        <dispatch>/data-hub/5/rest-api/endpoints/document-item-update.xqy</dispatch>
                    </match-query-param>
                    <match-query-param name="extract">
                        <dispatch>/data-hub/5/rest-api/endpoints/document-item-update.xqy</dispatch>
                    </match-query-param>
                    <match-query-param name="format">
                        <dispatch>/data-hub/5/rest-api/endpoints/document-item-update.xqy</dispatch>
                    </match-query-param>
                    <match-query-param name="repair">
                        <dispatch>/data-hub/5/rest-api/endpoints/document-item-update.xqy</dispatch>
                    </match-query-param>
                    <match-query-param name="temporal-collection">
                        <dispatch>/data-hub/5/rest-api/endpoints/document-item-update.xqy</dispatch>
                    </match-query-param>
                    <match-query-param name="transform">
                        <dispatch>/data-hub/5/rest-api/endpoints/document-item-update.xqy</dispatch>
                    </match-query-param>
                    <dispatch>/data-hub/5/rest-api/endpoints/document-item-create-post.xqy</dispatch>
                </match-query-param>
                <dispatch>/data-hub/5/rest-api/endpoints/document-item-update.xqy</dispatch>
            </match-method>
            <match-method any-of="PATCH">
                <match-query-param name="txid">
                    <set-transaction>$0</set-transaction>
                    <set-transaction-mode>update</set-transaction-mode>
                </match-query-param>
                <dispatch>/data-hub/5/rest-api/endpoints/document-item-update.xqy</dispatch>
            </match-method>
        </match-path>

        <match-path matches="^/(v1|LATEST)/documents/protection/?$">
            <match-query-param name="database">
                <set-database checked="true">$0</set-database>
            </match-query-param>
            <match-method any-of="POST">
                <match-query-param name="txid">
                    <set-transaction>$0</set-transaction>
                    <set-transaction-mode>update</set-transaction-mode>
                </match-query-param>
                <dispatch>/data-hub/5/rest-api/endpoints/document-item-protection.xqy</dispatch>
            </match-method>
        </match-path>

        <match-path matches="^/(v1|LATEST)/ext/?">
            <match-path matches="^/(v1|LATEST)/ext/?(.+)$">
                <add-query-param name="path">$2</add-query-param>
            </match-path>
            <dispatch>/MarkLogic/rest-api/endpoints/extlib.xqy</dispatch>
        </match-path>

        <match-path matches="^/(v1|LATEST)/graphs/sparql/?$">
            <match-query-param name="database">
                <set-database checked="true">$0</set-database>
            </match-query-param>
            <match-method any-of="HEAD PUT DELETE OPTIONS">
                <dispatch>/MarkLogic/rest-api/endpoints/sparql-query.xqy</dispatch>
            </match-method>
            <match-method any-of="GET">
                <match-query-param name="txid">
                    <set-transaction>$0</set-transaction>
                    <set-transaction-mode>query</set-transaction-mode>
                </match-query-param>
                <match-query-param name="query">
                    <match-query-param name="timestamp">
                        <set-transaction-timestamp>$0</set-transaction-timestamp>
                    </match-query-param>
                </match-query-param>
                <dispatch>/MarkLogic/rest-api/endpoints/sparql-query.xqy</dispatch>
            </match-method>
            <match-method any-of="POST">
                <match-query-param name="txid">
                    <set-transaction>$0</set-transaction>
                    <set-transaction-mode>update</set-transaction-mode>
                </match-query-param>
                <match-content-type any-of="application/x-www-form-urlencoded">
                    <match-query-param name="query">
                        <match-query-param name="timestamp">
                            <set-transaction-timestamp>$0</set-transaction-timestamp>
                        </match-query-param>
                    </match-query-param>
                    <dispatch>/MarkLogic/rest-api/endpoints/sparql-query.xqy</dispatch>
                </match-content-type>
                <match-content-type any-of="text/plain application/sparql-query application/json application/xml">
                    <match-query-param name="timestamp">
                        <set-transaction-timestamp>$0</set-transaction-timestamp>
                    </match-query-param>
                    <dispatch>/MarkLogic/rest-api/endpoints/sparql-query.xqy</dispatch>
                </match-content-type>
                <match-content-type any-of="application/sparql-update">
                    <dispatch>/MarkLogic/rest-api/endpoints/sparql-query.xqy</dispatch>
                </match-content-type>
            </match-method>
        </match-path>

        <match-path matches="^/(v1|LATEST)/graphs/things/?$">
            <match-query-param name="txid">
                <set-transaction>$0</set-transaction>
                <set-transaction-mode>query</set-transaction-mode>
            </match-query-param>
            <match-query-param name="database">
                <set-database checked="true">$0</set-database>
            </match-query-param>
            <dispatch>/MarkLogic/rest-api/endpoints/graph-explore.xqy</dispatch>
        </match-path>

        <match-path matches="^/(v1|LATEST)/graphs/?$">
            <match-query-param name="database">
                <set-database checked="true">$0</set-database>
            </match-query-param>
            <match-method any-of="GET HEAD OPTIONS">
                <match-query-param name="txid">
                    <set-transaction>$0</set-transaction>
                    <set-transaction-mode>query</set-transaction-mode>
                </match-query-param>
                <match-query-param name="timestamp">
                    <set-transaction-timestamp>$0</set-transaction-timestamp>
                </match-query-param>
                <dispatch>/MarkLogic/rest-api/endpoints/graphstore-query.xqy</dispatch>
            </match-method>
            <match-method any-of="PUT POST DELETE">
                <match-query-param name="txid">
                    <set-transaction>$0</set-transaction>
                    <set-transaction-mode>update</set-transaction-mode>
                </match-query-param>
                <dispatch>/MarkLogic/rest-api/endpoints/graphstore-update.xqy</dispatch>
            </match-method>
        </match-path>

        <match-path matches="^/([^/]+/)?ping/?$">
            <dispatch>/MarkLogic/rest-api/endpoints/ping.xqy</dispatch>
        </match-path>

        <match-path matches="^/(v1|LATEST)/search(/)?$">
            <match-query-param name="database">
                <set-database checked="true">$0</set-database>
            </match-query-param>
            <match-method any-of="DELETE">
                <match-query-param name="txid">
                    <set-transaction>$0</set-transaction>
                    <set-transaction-mode>update</set-transaction-mode>
                </match-query-param>
                <match-accept any-of="application/json application/xml text/json text/xml */*">
                    <dispatch>/data-hub/5/rest-api/endpoints/search-list-update.xqy</dispatch>
                </match-accept>
                <match-header name="accept">
                    <dispatch>/data-hub/5/rest-api/endpoints/unacceptable-type.xqy</dispatch>
                </match-header>
                <dispatch>/data-hub/5/rest-api/endpoints/search-list-update.xqy</dispatch>
            </match-method>
            <match-query-param name="txid">
                <set-transaction>$0</set-transaction>
                <set-transaction-mode>query</set-transaction-mode>
            </match-query-param>
            <match-query-param name="timestamp">
                <set-transaction-timestamp>$0</set-transaction-timestamp>
            </match-query-param>
            <match-accept any-of="application/json application/xml text/json text/xml multipart/mixed */*">
                <dispatch>/data-hub/5/rest-api/endpoints/search-list-query.xqy</dispatch>
            </match-accept>
            <match-header name="accept">
                <dispatch>/data-hub/5/rest-api/endpoints/unacceptable-type.xqy</dispatch>
            </match-header>
            <dispatch>/data-hub/5/rest-api/endpoints/search-list-query.xqy</dispatch>
        </match-path>

        <match-path matches="^/(v1|LATEST)/suggest/?$">
            <match-query-param name="txid">
                <set-transaction>$0</set-transaction>
                <set-transaction-mode>query</set-transaction-mode>
            </match-query-param>
            <match-query-param name="database">
                <set-database checked="true">$0</set-database>
            </match-query-param>
            <match-accept any-of="application/json application/xml text/json text/xml */*">
                <dispatch>/MarkLogic/rest-api/endpoints/suggest.xqy</dispatch>
            </match-accept>
            <match-header name="accept">
                <dispatch>/MarkLogic/rest-api/endpoints/unacceptable-type.xqy</dispatch>
            </match-header>
            <dispatch>/MarkLogic/rest-api/endpoints/suggest.xqy</dispatch>
        </match-path>

        <match-path matches="^/(v1|LATEST)/qbe/?$">
            <match-query-param name="txid">
                <set-transaction>$0</set-transaction>
                <set-transaction-mode>query</set-transaction-mode>
            </match-query-param>
            <match-query-param name="database">
                <set-database checked="true">$0</set-database>
            </match-query-param>
            <match-query-param name="timestamp">
                <set-transaction-timestamp>$0</set-transaction-timestamp>
            </match-query-param>
            <match-accept any-of="application/json application/xml text/json text/xml multipart/mixed */*">
                <dispatch>/MarkLogic/rest-api/endpoints/qbe-list.xqy</dispatch>
            </match-accept>
            <match-header name="accept">
                <dispatch>/MarkLogic/rest-api/endpoints/unacceptable-type.xqy</dispatch>
            </match-header>
            <dispatch>/MarkLogic/rest-api/endpoints/qbe-list.xqy</dispatch>
        </match-path>

        <match-path matches="^/(v1|LATEST)/resources/([^/]+)/?$">
            <match-query-param name="database">
                <set-database checked="true">$0</set-database>
            </match-query-param>
            <add-query-param name="name">$2</add-query-param>
            <match-method any-of="GET HEAD POST">
                <match-query-param name="txid">
                    <set-transaction>$0</set-transaction>
                    <set-transaction-mode>query</set-transaction-mode>
                </match-query-param>
                <dispatch>/data-hub/5/rest-api/endpoints/resource-service-query.xqy</dispatch>
            </match-method>
            <match-method any-of="PUT DELETE">
                <match-query-param name="txid">
                    <set-transaction>$0</set-transaction>
                    <set-transaction-mode>update</set-transaction-mode>
                </match-query-param>
                <dispatch>/data-hub/5/rest-api/endpoints/resource-service-update.xqy</dispatch>
            </match-method>
        </match-path>

        <match-path matches="^/(v1|LATEST)/temporal/collections/([^/]+)/?$">
            <add-query-param name="collection">$2</add-query-param>
            <match-query-param name="database">
                <set-database checked="true">$0</set-database>
            </match-query-param>
            <dispatch>/MarkLogic/rest-api/endpoints/temporal-collection-item-query.xqy</dispatch>
        </match-path>

        <match-path matches="^/(v1|LATEST)/transactions/?$">
            <match-query-param name="database">
                <set-database checked="true">$0</set-database>
            </match-query-param>
            <match-method any-of="GET">
                <match-accept any-of="application/json application/xml text/json text/xml */*">
                    <dispatch>/MarkLogic/rest-api/endpoints/transaction-item-default.xqy</dispatch>
                </match-accept>
                <match-header name="accept">
                    <dispatch>/MarkLogic/rest-api/endpoints/unacceptable-type.xqy</dispatch>
                </match-header>
            </match-method>
            <dispatch>/MarkLogic/rest-api/endpoints/transaction-item-default.xqy</dispatch>
        </match-path>

        <match-path matches="^/(v1|LATEST)/transactions/(.+)$">
            <add-query-param name="txid">$2</add-query-param>
            <match-query-param name="database">
                <set-database checked="true">$0</set-database>
            </match-query-param>
            <match-method any-of="GET">
                <match-accept any-of="application/json application/xml text/json text/xml */*">
                    <dispatch>/MarkLogic/rest-api/endpoints/transaction-item-default.xqy</dispatch>
                </match-accept>
                <match-header name="accept">
                    <dispatch>/MarkLogic/rest-api/endpoints/unacceptable-type.xqy</dispatch>
                </match-header>
            </match-method>
            <dispatch>/MarkLogic/rest-api/endpoints/transaction-item-default.xqy</dispatch>
        </match-path>

        <match-path matches="^/(v1|LATEST)/internal/uris$">
            <match-query-param name="txid">
                <set-transaction>$0</set-transaction>
                <set-transaction-mode>query</set-transaction-mode>
            </match-query-param>
            <match-query-param name="database">
                <set-database checked="true">$0</set-database>
            </match-query-param>
            <match-query-param name="timestamp">
                <set-transaction-timestamp>$0</set-transaction-timestamp>
            </match-query-param>
            <match-accept any-of="text/uri-list */*">
                <dispatch>/MarkLogic/rest-api/endpoints/internal-uris.xqy</dispatch>
            </match-accept>
            <match-header name="accept">
                <dispatch>/MarkLogic/rest-api/endpoints/unacceptable-type.xqy</dispatch>
            </match-header>
            <dispatch>/MarkLogic/rest-api/endpoints/internal-uris.xqy</dispatch>
        </match-path>

        <match-path matches="^/(v1|LATEST)/values/?$">
            <match-query-param name="txid">
                <set-transaction>$0</set-transaction>
                <set-transaction-mode>query</set-transaction-mode>
            </match-query-param>
            <match-query-param name="database">
                <set-database checked="true">$0</set-database>
            </match-query-param>
            <match-query-param name="timestamp">
                <set-transaction-timestamp>$0</set-transaction-timestamp>
            </match-query-param>
            <match-accept any-of="application/json application/xml text/json text/xml */*">
                <dispatch>/MarkLogic/rest-api/endpoints/values.xqy</dispatch>
            </match-accept>
            <match-header name="accept">
                <dispatch>/MarkLogic/rest-api/endpoints/unacceptable-type.xqy</dispatch>
            </match-header>
            <dispatch>/MarkLogic/rest-api/endpoints/values.xqy</dispatch>
        </match-path>

        <match-path matches="^/(v1|LATEST)/values/([^/]+)/?$">
            <add-query-param name="name">$2</add-query-param>
            <match-query-param name="txid">
                <set-transaction>$0</set-transaction>
                <set-transaction-mode>query</set-transaction-mode>
            </match-query-param>
            <match-query-param name="database">
                <set-database checked="true">$0</set-database>
            </match-query-param>
            <match-query-param name="timestamp">
                <set-transaction-timestamp>$0</set-transaction-timestamp>
            </match-query-param>
            <match-accept any-of="application/json application/xml text/json text/xml */*">
                <dispatch>/MarkLogic/rest-api/endpoints/values.xqy</dispatch>
            </match-accept>
            <match-header name="accept">
                <dispatch>/MarkLogic/rest-api/endpoints/unacceptable-type.xqy</dispatch>
            </match-header>
            <dispatch>/MarkLogic/rest-api/endpoints/values.xqy</dispatch>
        </match-path>

        <match-path matches="^/(v1|LATEST)/eval">
            <match-query-param name="javascript">
                <error code="REST-INVALIDPARAM"
                    data1="javascript. The x-www-form-urlencoded payload must specify the JavaScript to eval."/>
            </match-query-param>
            <match-query-param name="xquery">
                <error code="REST-INVALIDPARAM"
                    data1="xquery. The x-www-form-urlencoded payload must specify the XQuery to eval."/>
            </match-query-param>
            <match-query-param name="database">
                <set-database checked="true">$0</set-database>
            </match-query-param>
            <match-query-param name="txid">
                <set-transaction>$0</set-transaction>
                <set-transaction-mode>update</set-transaction-mode>
            </match-query-param>
            <dispatch xdbc="true">/eval</dispatch>
        </match-path>

        <match-path matches="^/(v1|LATEST)/invoke">
            <match-query-param name="module">
                <error code="REST-INVALIDPARAM"
                    data1="module. The x-www-form-urlencoded payload must specify the module to invoke."/>
            </match-query-param>
            <match-query-param name="database">
                <set-database checked="true">$0</set-database>
            </match-query-param>
            <match-query-param name="txid">
                <set-transaction>$0</set-transaction>
                <set-transaction-mode>update</set-transaction-mode>
            </match-query-param>
            <dispatch xdbc="true">/invoke</dispatch>
        </match-path>

        <match-path matches="^/(v1|LATEST)/rows/?$">
            <match-query-param name="database">
                <set-database checked="true">$0</set-database>
            </match-query-param>
            <match-query-param name="txid">
                <set-transaction>$0</set-transaction>
                <set-transaction-mode>query</set-transaction-mode>
            </match-query-param>
            <match-query-param name="timestamp">
                <set-transaction-timestamp>$0</set-transaction-timestamp>
            </match-query-param>
            <dispatch>/MarkLogic/rest-api/endpoints/rows-list.sjs</dispatch>
        </match-path>

        <match-path matches="^/(v1|LATEST)/internal/apply-transform/?$">
            <match-query-param name="database">
                <set-database checked="true">$0</set-database>
            </match-query-param>
            <match-method any-of="POST">
                <match-query-param name="txid">
                    <set-transaction>$0</set-transaction>
                    <set-transaction-mode>update</set-transaction-mode>
                </match-query-param>
                <match-content-type any-of="text/uri-list">
                    <match-accept any-of="text/uri-list */*">
                        <dispatch>/data-hub/5/rest-api/endpoints/apply-transform.xqy</dispatch>
                    </match-accept>
                    <match-header name="accept">
                        <dispatch>/MarkLogic/rest-api/endpoints/unacceptable-type.xqy</dispatch>
                    </match-header>
                    <dispatch>/MarkLogic/rest-api/endpoints/apply-transform.xqy</dispatch>
                </match-content-type>
            </match-method>
            <dispatch>/data-hub/5/rest-api/endpoints/apply-transform-bad-request.xqy</dispatch>
        </match-path>

        <match-path matches="^/(v1|LATEST)/internal/extract-via-template$">
            <match-query-param name="txid">
                <set-transaction>$0</set-transaction>
                <set-transaction-mode>query</set-transaction-mode>
            </match-query-param>
            <match-query-param name="database">
                <set-database checked="true">$0</set-database>
            </match-query-param>
            <match-query-param name="timestamp">
                <set-transaction-timestamp>$0</set-transaction-timestamp>
            </match-query-param>
            <match-accept any-of="text/json application/json */*">
                <dispatch>/MarkLogic/rest-api/endpoints/internal-extract-via-template.xqy</dispatch>
            </match-accept>
            <match-header name="accept">
                <dispatch>/MarkLogic/rest-api/endpoints/unacceptable-type.xqy</dispatch>
            </match-header>
            <dispatch>/MarkLogic/rest-api/endpoints/internal-extract-via-template.xqy</dispatch>
        </match-path>
    </match-path>

    <match-path matches="^/hub">
        <match-path matches="^/hub/traces">
            <match-path matches="^/hub/traces/?$">
                <dispatch>/data-hub/4/tracing/get-traces.xqy</dispatch>
            </match-path>
            <match-path matches="^/hub/traces/ids">
                <dispatch>/data-hub/4/tracing/get-ids.xqy</dispatch>
            </match-path>
            <match-path matches="^/hub/traces/search">
                <dispatch>/data-hub/4/tracing/search.xqy</dispatch>
            </match-path>
            <match-path matches="^/hub/traces/(\d+)">
                <add-query-param name="id">$1</add-query-param>
                <dispatch>/data-hub/4/tracing/get-trace.xqy</dispatch>
            </match-path>
        </match-path>
    </match-path>
</rewriter>

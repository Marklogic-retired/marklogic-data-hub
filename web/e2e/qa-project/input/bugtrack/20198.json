{"id":20198, "kind":"Bug", "createdAt":"2012-12-05T11:54:16.775392-08:00", "status":"Will not fix", "title":"Unfound SYSTEM entities inserts \";\" in XML file.", "category":"xdmp", "severity":"Minor", "priority":{"level":"5", "title":""}, "submittedBy":{"username":"cbiow", "name":"Christopher Biow", "email":"chris.biow@marklogic.com"}, "assignTo":{"username":"nobody", "name":"nobody nobody", "email":"nobody@marklogic.com"}, "description":"Strongly recommend we disable SYSTEM entity processing in MarkLogic. Currently, it allows an attacker who can provide XML and then retrieve it to read any locally readable file, such as /etc/passwd. It could also serve as a Denial of Service vulnerability if pointed at /dev/zero.\r\n\r\nAlthough this is a standard XML parser feature, it's a security vulnerability in an XML server. Our consultants are reasonably familiar with the practices needed to avoid XQuery injection, but XML injection is more subtle and not generally understood.\r\n\r\nConfirmed on Linux and Windows. Tested for backtick attack on Linux, which does not result in command-line execution. Related to Bug 11139 (Billion Laughs chained entity expansion DoS attack).", "samplequery":"xquery version \"1.0-ml\";\r\nxdmp:document-load(\"/tmp/xxe.xml\", \r\n    <options xmlns=\"xdmp:document-load\">\r\n      <uri>/tmp/xxe.xml</uri>\r\n      <repair>none</repair>\r\n      <permissions>{xdmp:default-permissions()}</permissions>\r\n    </options>)", "sampledata":"[cbiow@van-prod2 ~]$ cat /tmp/xxe.xml \r\n<?xml version=\"1.0\" encoding=\"ISO-8859-1\"?>\r\n <!DOCTYPE foo [  \r\n  <!ELEMENT foo ANY >\r\n  <!ENTITY xxe SYSTEM \"/etc/passwd\" >]><foo>&xxe;</foo>", "version":"6.0-2", "tofixin":"N/A", "fixedin":"N/A", "platform":"all", "memory":"", "processors":"", "note":"", "subscribers":[{"username":"cbiow", "name":"Christopher Biow", "email":"chris.biow@marklogic.com"}, {"username":"jsnelson", "name":"John Snelson", "email":"jsnelson@marklogic.com"}], "attachments":[], "relationships":[{"type":"", "to":""}], "clones":[23998], "cloneOf":"", "support":{"headline":"", "supportDescription":"", "publishStatus":"Not Ready", "tickets":[], "customerImpact":{"level":"N/A", "title":""}, "workaround":""}, "tags":["xdmp", "cbiow"], "changeHistory":[{"time":"2012-12-05T11:54:16.775392-08:00", "updatedBy":{"username":"cbiow", "name":"Christopher Biow", "email":"chris.biow@marklogic.com"}, "change":{"assignTo":{"from":{"username":"cbiow", "name":"Christopher Biow", "email":"chris.biow@marklogic.com"}, "to":{"username":"jsnelson", "name":"John Snelson", "email":"jsnelson@marklogic.com"}}}, "files":[], "show":true}, {"time":"2012-12-05T12:16:22.249243-08:00", "updatedBy":{"username":"jsnelson", "name":"John Snelson", "email":"jsnelson@marklogic.com"}, "change":{}, "files":[], "show":true, "comment":"I don't think this is a bug if it works through xdmp:document-load(), since permission to use that function is permission to access the local file system.\r\n\r\nIf this works when loading via XCC then I think this is a bug."}, {"time":"2012-12-08T23:06:32.614408-08:00", "updatedBy":{"username":"gvaidees", "name":"Ganesh Vaideeswaran", "email":"Ganesh.Vaideeswaran@marklogic.com"}, "change":{}, "files":[], "show":true, "comment":"If this is a bug, we would have to back and forward port to all current releases. "}, {"time":"2012-12-08T23:06:32.614408-08:00", "updatedBy":{"username":"gvaidees", "name":"Ganesh Vaideeswaran", "email":"Ganesh.Vaideeswaran@marklogic.com"}, "change":{"tofixin":{"from":"", "to":"6.0-4"}}, "files":[], "show":true}, {"time":"2012-12-09T17:05:38.361488-08:00", "updatedBy":{"username":"cbiow", "name":"Christopher Biow", "email":"chris.biow@marklogic.com"}, "change":{}, "files":[], "show":true, "comment":"Agreed that if external reference does not occur in XCC or occurs client-side, this would not be a security bug. Trying it out on XCC with client and server on the same system, the file is not being read, but we appear to have a functional bug, resulting in reduction of the entity reference to a semicolon:\r\n\r\nC:\\Projects\\MarkXCC.Java-6.0-2>java com.marklogic.xcc.examples.ContentLoader xdb c://admin:admin_password@localhost:8006 \"C:\\Temp\\xxe.xml\"\r\nLoaded 1 files (155 bytes) in 0.050s (3,100 bytes/second)\r\n\r\nNow, in QC, running doc(\"C:\\Temp\\xxe.xml\") returns:\r\n<?xml version=\"1.0\" encoding=\"UTF-8\"?>\r\n<foo>;</foo>\r\n\r\nWhatever the resolution of the external entity, it should not result in a semicolon, since the referenced file contains the text \"hello world\" as in the prior example.\r\n\r\nI've reduced the bug severity to P4-minor, since I cannot fine a remote means to inject a server-side file read, and we now just have the anomaly of the semicolon."}, {"time":"2013-05-20T08:38:01.621207-07:00", "updatedBy":{"username":"rhu", "name":"Ron Hu", "email":"ron.hu@marklogic.com"}, "change":{}, "files":[], "show":true, "comment":"suggest to push out this bug."}, {"time":"2013-06-24T18:08:50.060432-07:00", "updatedBy":{"username":"rhu", "name":"Ron Hu", "email":"ron.hu@marklogic.com"}, "change":{"tofixin":{"from":"6.0-4", "to":"6.0-5"}}, "files":[], "show":true}, {"time":"2014-03-18T18:04:56.315441-07:00", "updatedBy":{"username":"gvaidees", "name":"Ganesh Vaideeswaran", "email":"Ganesh.Vaideeswaran@marklogic.com"}, "change":{}, "files":[], "show":true, "comment":"After 6.0-5 ship: Moving to 6.0-6"}, {"time":"2014-03-18T18:04:56.315441-07:00", "updatedBy":{"username":"gvaidees", "name":"Ganesh Vaideeswaran", "email":"Ganesh.Vaideeswaran@marklogic.com"}, "change":{"tofixin":{"from":"6.0-5", "to":"6.0-6"}}, "files":[], "show":true}, {"time":"2015-05-27T21:06:25.620505-07:00", "updatedBy":{"username":"gvaidees", "name":"Ganesh Vaideeswaran", "email":"Ganesh.Vaideeswaran@marklogic.com"}, "change":{"status":{"from":"Verify", "to":"Will not fix"}, "assignTo":{"from":{"username":"gvaidees", "name":"Ganesh Vaideeswaran", "email":"Ganesh.Vaideeswaran@marklogic.com"}, "to":{"username":"nobody", "name":"nobody nobody", "email":"nobody@marklogic.com"}}}, "files":[], "show":true, "comment":"Not requested by support"}, {"time":"2015-05-27T21:06:25.620505-07:00", "updatedBy":{"username":"gvaidees", "name":"Ganesh Vaideeswaran", "email":"Ganesh.Vaideeswaran@marklogic.com"}, "change":{"assignTo":{"from":{"username":"gvaidees", "name":"Ganesh Vaideeswaran", "email":"Ganesh.Vaideeswaran@marklogic.com"}, "to":{"username":"nobody", "name":"nobody nobody", "email":"nobody@marklogic.com"}}}, "files":[], "show":true}], "updatedAt":"2015-05-27T21:06:25.620505-07:00", "renderDescriptionAs":"normal", "renderSampleQueryAs":"normal", "renderSampleDataAs":"normal"}
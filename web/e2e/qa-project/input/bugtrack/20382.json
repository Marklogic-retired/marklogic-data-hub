{"id":20382, "kind":"Bug", "createdAt":"2013-01-04T02:49:38.827562-08:00", "status":"Closed", "title":"Order by resulting in server restart", "category":"XQuery", "severity":"Critical", "priority":{"level":"5", "title":""}, "submittedBy":{"username":"dchander", "name":"Dinesh Chander", "email":"dinesh.chander@globallogic.com"}, "assignTo":{"username":"nobody", "name":"nobody nobody", "email":"nobody@marklogic.com"}, "description":"Reported by user in case #12298. Issue can be reproduced with all ML versions.\r\n--------------------------------------------------------------------------------------------------------------\r\n\r\nAttached are two zip files:\r\n1.) ReproducibleTestCase.zip - With default database settings, run the Set_1 & Set_2 files to load the documents. These are the documents provided by the user. Once the documents are loaded, run the search (Query.txt) via CQ/QC. Running the query would restart the server.\r\n2.) SimplifiedReproducibleTestCase.zip - This zip file contains the simplified versions of the above files. Running the query will again restart the server.", "samplequery":"Attached zip files contain the sample data and query.", "sampledata":"", "version":"5.0-4.2", "tofixin":"5.0-5", "fixedin":"5.0-5", "platform":"all", "memory":"", "processors":"", "note":"", "subscribers":[{"username":"dchander", "name":"Dinesh Chander", "email":"dinesh.chander@globallogic.com"}, {"username":"mary", "name":"Mary Holstege", "email":"mary@cerisent.com"}, {"username":"ksaxena", "name":"Kapil Saxena", "email":"kapil.saxena@marklogic.com"}, {"username":"rhu", "name":"Ron Hu", "email":"ron.hu@marklogic.com"}, {"username":"rpolasani", "name":"Raghu Polasani", "email":"raghu.polasani@marklogic.com"}], "attachments":[{"name":"Reproducible test case", "uri":"root/support/bugtracking/attachments/20379/ReproducibleTestCase.zip"}, {"name":"Simplified test case", "uri":"root/support/bugtracking/attachments/20379/SimplifiedReproducibleTestCase.zip"}], "relationships":[{"type":"", "to":""}], "clones":[], "cloneOf":20379, "support":{"headline":"Server restarting when executing order by clause", "supportDescription":"Under some rare circumstances, an order by clause that references a path expression that sometimes has no hits may cause a server restart when executed.", "publishStatus":"Publish", "tickets":[], "customerImpact":{"level":"Low", "title":"Minimal business impact or reasonable workaround is available"}, "workaround":""}, "tags":["XQuery", "dchander"], "changeHistory":[{"time":"2013-01-04T10:03:37.630819-08:00", "updatedBy":{"username":"rpelton", "name":"Rick Pelton", "email":"rick.pelton@marklogic.com"}, "change":{"assignTo":{"from":{"username":"rpelton", "name":"Rick Pelton", "email":"rick.pelton@marklogic.com"}, "to":{"username":"rhu", "name":"Ron Hu", "email":"ron.hu@marklogic.com"}}}, "files":[], "show":true}, {"time":"2013-01-04T10:03:37.630819-08:00", "updatedBy":{"username":"rpelton", "name":"Rick Pelton", "email":"rick.pelton@marklogic.com"}, "change":{"tofixin":{"from":"", "to":"5.0-5"}}, "files":[], "show":true}, {"time":"2013-01-07T12:51:35.865162-08:00", "updatedBy":{"username":"rhu", "name":"Ron Hu", "email":"ron.hu@marklogic.com"}, "change":{"status":{"from":"", "to":"Verify"}, "assignTo":{"from":{"username":"rhu", "name":"Ron Hu", "email":"ron.hu@marklogic.com"}, "to":{"username":"mary", "name":"Mary Holstege", "email":"mary@cerisent.com"}}}, "files":[], "show":true}, {"time":"2013-01-07T12:51:35.865162-08:00", "updatedBy":{"username":"rhu", "name":"Ron Hu", "email":"ron.hu@marklogic.com"}, "change":{"assignTo":{"from":{"username":"rhu", "name":"Ron Hu", "email":"ron.hu@marklogic.com"}, "to":{"username":"mary", "name":"Mary Holstege", "email":"mary@cerisent.com"}}}, "files":[], "show":true}, {"time":"2013-01-10T10:24:26.926733-08:00", "updatedBy":{"username":"mary", "name":"Mary Holstege", "email":"mary@cerisent.com"}, "change":{}, "files":[], "show":true, "svn":{"repository":"/project/engsvn", "revision":"127344", "paths":["xdmp/branches/b5_0/src/ValueInference.cpp"], "affectedBugs":[]}, "comment":"Bug:20382 check for specv.empty before using specv[0]"}, {"time":"2013-01-10T10:35:24.973855-08:00", "updatedBy":{"username":"mary", "name":"Mary Holstege", "email":"mary@cerisent.com"}, "change":{"status":{"from":"", "to":"Test"}, "assignTo":{"from":{"username":"mary", "name":"Mary Holstege", "email":"mary@cerisent.com"}, "to":{"username":"rpolasani", "name":"Raghu Polasani", "email":"raghu.polasani@marklogic.com"}}}, "files":[], "show":true, "comment":"Fixed 5.0-20130111"}, {"time":"2013-01-10T10:35:24.973855-08:00", "updatedBy":{"username":"mary", "name":"Mary Holstege", "email":"mary@cerisent.com"}, "change":{"assignTo":{"from":{"username":"mary", "name":"Mary Holstege", "email":"mary@cerisent.com"}, "to":{"username":"rpolasani", "name":"Raghu Polasani", "email":"raghu.polasani@marklogic.com"}}}, "files":[], "show":true}, {"time":"2013-01-17T03:18:06.72435-08:00", "updatedBy":{"username":"rpolasani", "name":"Raghu Polasani", "email":"raghu.polasani@marklogic.com"}, "change":{"assignTo":{"from":{"username":"rpolasani", "name":"Raghu Polasani", "email":"raghu.polasani@marklogic.com"}, "to":{"username":"ksaxena", "name":"Kapil Saxena", "email":"kapil.saxena@marklogic.com"}}}, "files":[], "show":true}, {"time":"2013-01-22T02:08:23.144377-08:00", "updatedBy":{"username":"ksaxena", "name":"Kapil Saxena", "email":"kapil.saxena@marklogic.com"}, "change":{"status":{"from":"", "to":"Ship"}, "assignTo":{"from":{"username":"ksaxena", "name":"Kapil Saxena", "email":"kapil.saxena@marklogic.com"}, "to":{"username":"nobody", "name":"nobody nobody", "email":"nobody@marklogic.com"}}}, "files":[], "show":true, "comment":"Verified in ML 5.0-20130122 and now it is not restarting server.\r\n\r\nHere's the ErrorLog output while query execution:\r\n\r\n2013-01-22 01:53:52.285 Debug: InMemoryStand /var/opt/MarkLogic/Forests/App-Services/0000000b, disk=5MB, memory=217MB, list=170MB, tree=42MB, rangeIndex=6MB, reverseIndex=6MB\r\n2013-01-22 01:53:53.051 Info: App-Services: at 11:15: local:extract-cashflow((\"c5a0b578-0d59-45ca-81c5-13946932c2ff-1-31-31-31\", \"41ecbbf9-3dd9-48bb-a2fe-1c4c443609ff-1-31-31-31\"))\r\n2013-01-22 01:53:53.052 Info: App-Services: at 11:15: Analyzing path: fn:doc(\"c5a0b578-0d59-45ca-81c5-13946932c2ff-1-31-31-31\")\r\n2013-01-22 01:53:53.052 Info: App-Services: at 11:15: Step 1 is searchable: fn:doc(\"c5a0b578-0d59-45ca-81c5-13946932c2ff-1-31-31-31\")\r\n2013-01-22 01:53:53.052 Info: App-Services: at 11:15: Path is fully searchable.\r\n2013-01-22 01:53:53.052 Info: App-Services: at 11:15: Gathering constraints.\r\n2013-01-22 01:53:53.052 Info: App-Services: at 11:15: Step 1 contributed 1 constraint: fn:doc(\"c5a0b578-0d59-45ca-81c5-13946932c2ff-1-31-31-31\")\r\n2013-01-22 01:53:53.052 Info: App-Services: at 11:15: Executing search.\r\n2013-01-22 01:53:53.052 Info: App-Services: at 11:15: Selected 1 fragment to filter\r\n2013-01-22 01:53:53.053 Info: App-Services: at 12:137: local:extract-cashflow((\"c5a0b578-0d59-45ca-81c5-13946932c2ff-1-31-31-31\", \"41ecbbf9-3dd9-48bb-a2fe-1c4c443609ff-1-31-31-31\"))\r\n2013-01-22 01:53:53.053 Info: App-Services: at 12:137: Analyzing path: xdmp:document-properties(\"c5a0b578-0d59-45ca-81c5-13946932c2ff-1-31-31-31\")/descendant::docLinks/link[linkname = \"sam.trade.entity.link\"]/uri\r\n2013-01-22 01:53:53.053 Info: App-Services: at 12:137: Step 1 is searchable: xdmp:document-properties(\"c5a0b578-0d59-45ca-81c5-13946932c2ff-1-31-31-31\")\r\n2013-01-22 01:53:53.053 Info: App-Services: at 12:137: Step 2 is searchable: descendant::docLinks\r\n2013-01-22 01:53:53.053 Info: App-Services: at 12:137: Step 3 is searchable: link[linkname = \"sam.trade.entity.link\"]\r\n2013-01-22 01:53:53.082 Info: App-Services: at 12:137: Step 4 is searchable: uri\r\n2013-01-22 01:53:53.107 Info: App-Services: at 12:137: Path is fully searchable.\r\n2013-01-22 01:53:53.132 Info: App-Services: at 12:137: Gathering constraints.\r\n2013-01-22 01:53:53.157 Info: App-Services: at 12:57: Step 1 contributed 1 constraint: xdmp:document-properties(\"c5a0b578-0d59-45ca-81c5-13946932c2ff-1-31-31-31\")\r\n2013-01-22 01:53:53.182 Info: App-Services: at 12:89: Step 2 contributed 1 constraint: descendant::docLinks\r\n2013-01-22 01:53:53.349 Info: App-Services: at 12:103: Comparison contributed hash value constraint: linkname = \"sam.trade.entity.link\"\r\n2013-01-22 01:53:53.649 Info: App-Services: at 12:98: Step 3 predicate 1 contributed 1 constraint: linkname = \"sam.trade.entity.link\"\r\n2013-01-22 01:53:53.674 Info: App-Services: at 12:103: Comparison contributed hash value constraint: linkname = \"sam.trade.entity.link\"\r\n2013-01-22 01:53:53.699 Info: App-Services: at 12:98: Step 3 predicate 1 contributed 1 constraint: linkname = \"sam.trade.entity.link\"\r\n2013-01-22 01:53:53.724 Info: App-Services: at 12:98: Step 3 contributed 2 constraints: link[linkname = \"sam.trade.entity.link\"]\r\n2013-01-22 01:53:53.750 Info: App-Services: at 12:137: Step 4 contributed 1 constraint: uri\r\n2013-01-22 01:53:53.775 Info: App-Services: at 12:137: Executing search.\r\n2013-01-22 01:53:53.800 Info: App-Services: at 12:137: Selected 1 fragment to filter\r\n2013-01-22 01:53:53.825 Info: App-Services: at 12:28: local:extract-cashflow((\"c5a0b578-0d59-45ca-81c5-13946932c2ff-1-31-31-31\", \"41ecbbf9-3dd9-48bb-a2fe-1c4c443609ff-1-31-31-31\"))\r\n2013-01-22 01:53:53.850 Info: App-Services: at 12:28: Analyzing path for search: fn:doc()\r\n2013-01-22 01:53:53.875 Info: App-Services: at 12:28: Step 1 is searchable: fn:doc()\r\n2013-01-22 01:53:53.900 Info: App-Services: at 12:28: Path is fully searchable.\r\n2013-01-22 01:53:53.925 Info: App-Services: at 12:28: Gathering constraints.\r\n2013-01-22 01:53:53.951 Info: App-Services: at 12:28: Search query contributed 1 constraint: cts:document-query(\"663a0c8f-6fe6-4e0e-9c7f-3221dc357e9f-3-31-31-31\")\r\n2013-01-22 01:53:53.976 Info: App-Services: at 12:28: Executing search.\r\n2013-01-22 01:53:54.001 Info: App-Services: at 12:28: Selected 1 fragment to filter.\r\n2013-01-22 01:53:54.027 Info: App-Services: at 11:15: local:extract-cashflow((\"c5a0b578-0d59-45ca-81c5-13946932c2ff-1-31-31-31\", \"41ecbbf9-3dd9-48bb-a2fe-1c4c443609ff-1-31-31-31\"))\r\n2013-01-22 01:53:54.059 Info: App-Services: at 11:15: Analyzing path: fn:doc(\"41ecbbf9-3dd9-48bb-a2fe-1c4c443609ff-1-31-31-31\")\r\n2013-01-22 01:53:54.085 Info: App-Services: at 11:15: Step 1 is searchable: fn:doc(\"41ecbbf9-3dd9-48bb-a2fe-1c4c443609ff-1-31-31-31\")\r\n2013-01-22 01:53:54.110 Info: App-Services: at 11:15: Path is fully searchable.\r\n2013-01-22 01:53:54.135 Info: App-Services: at 11:15: Gathering constraints.\r\n2013-01-22 01:53:54.160 Info: App-Services: at 11:15: Step 1 contributed 1 constraint: fn:doc(\"41ecbbf9-3dd9-48bb-a2fe-1c4c443609ff-1-31-31-31\")\r\n2013-01-22 01:53:54.185 Info: App-Services: at 11:15: Executing search.\r\n2013-01-22 01:53:54.210 Info: App-Services: at 11:15: Selected 1 fragment to filter\r\n2013-01-22 01:53:54.236 Info: App-Services: at 12:137: local:extract-cashflow((\"c5a0b578-0d59-45ca-81c5-13946932c2ff-1-31-31-31\", \"41ecbbf9-3dd9-48bb-a2fe-1c4c443609ff-1-31-31-31\"))\r\n2013-01-22 01:53:54.269 Info: App-Services: at 12:137: Analyzing path: xdmp:document-properties(\"41ecbbf9-3dd9-48bb-a2fe-1c4c443609ff-1-31-31-31\")/descendant::docLinks/link[linkname = \"sam.trade.entity.link\"]/uri\r\n2013-01-22 01:53:54.302 Info: App-Services: at 12:137: Step 1 is searchable: xdmp:document-properties(\"41ecbbf9-3dd9-48bb-a2fe-1c4c443609ff-1-31-31-31\")\r\n2013-01-22 01:53:54.336 Info: App-Services: at 12:137: Step 2 is searchable: descendant::docLinks\r\n2013-01-22 01:53:54.369 Info: App-Services: at 12:137: Step 3 is searchable: link[linkname = \"sam.trade.entity.link\"]\r\n2013-01-22 01:53:54.403 Info: App-Services: at 12:137: Step 4 is searchable: uri\r\n2013-01-22 01:53:54.436 Info: App-Services: at 12:137: Path is fully searchable.\r\n2013-01-22 01:53:54.470 Info: App-Services: at 12:137: Gathering constraints.\r\n2013-01-22 01:53:54.503 Info: App-Services: at 12:57: Step 1 contributed 1 constraint: xdmp:document-properties(\"41ecbbf9-3dd9-48bb-a2fe-1c4c443609ff-1-31-31-31\")\r\n2013-01-22 01:53:54.528 Info: App-Services: at 12:89: Step 2 contributed 1 constraint: descendant::docLinks\r\n2013-01-22 01:53:54.562 Info: App-Services: at 12:103: Comparison contributed hash value constraint: linkname = \"sam.trade.entity.link\"\r\n2013-01-22 01:53:54.595 Info: App-Services: at 12:98: Step 3 predicate 1 contributed 1 constraint: linkname = \"sam.trade.entity.link\"\r\n2013-01-22 01:53:54.620 Info: App-Services: at 12:103: Comparison contributed hash value constraint: linkname = \"sam.trade.entity.link\"\r\n2013-01-22 01:53:54.645 Info: App-Services: at 12:98: Step 3 predicate 1 contributed 1 constraint: linkname = \"sam.trade.entity.link\"\r\n2013-01-22 01:53:54.670 Info: App-Services: at 12:98: Step 3 contributed 2 constraints: link[linkname = \"sam.trade.entity.link\"]\r\n2013-01-22 01:53:54.696 Info: App-Services: at 12:137: Step 4 contributed 1 constraint: uri\r\n2013-01-22 01:53:54.721 Info: App-Services: at 12:137: Executing search.\r\n2013-01-22 01:53:54.746 Info: App-Services: at 12:137: Selected 1 fragment to filter\r\n2013-01-22 01:53:54.771 Info: App-Services: at 12:28: local:extract-cashflow((\"c5a0b578-0d59-45ca-81c5-13946932c2ff-1-31-31-31\", \"41ecbbf9-3dd9-48bb-a2fe-1c4c443609ff-1-31-31-31\"))\r\n2013-01-22 01:53:54.796 Info: App-Services: at 12:28: Analyzing path for search: fn:doc()\r\n2013-01-22 01:53:54.821 Info: App-Services: at 12:28: Step 1 is searchable: fn:doc()\r\n2013-01-22 01:53:54.846 Info: App-Services: at 12:28: Path is fully searchable.\r\n2013-01-22 01:53:54.871 Info: App-Services: at 12:28: Gathering constraints.\r\n2013-01-22 01:53:54.897 Info: App-Services: at 12:28: Search query contributed 1 constraint: cts:document-query(\"663a0c8f-6fe6-4e0e-9c7f-3221dc357e9f-3-31-31-31\")\r\n2013-01-22 01:53:54.922 Info: App-Services: at 12:28: Executing search.\r\n2013-01-22 01:53:54.947 Info: App-Services: at 12:28: Selected 1 fragment to filter."}, {"time":"2013-01-22T02:08:23.144377-08:00", "updatedBy":{"username":"ksaxena", "name":"Kapil Saxena", "email":"kapil.saxena@marklogic.com"}, "change":{"assignTo":{"from":{"username":"ksaxena", "name":"Kapil Saxena", "email":"kapil.saxena@marklogic.com"}, "to":{"username":"nobody", "name":"nobody nobody", "email":"nobody@marklogic.com"}}}, "files":[], "show":true}, {"time":"2013-02-25T16:46:27.235177-08:00", "updatedBy":{"username":"rpelton", "name":"Rick Pelton", "email":"rick.pelton@marklogic.com"}, "change":{"status":{"from":"", "to":"Closed"}, "assignTo":{"from":{"username":"rpelton", "name":"Rick Pelton", "email":"rick.pelton@marklogic.com"}, "to":{"username":"nobody", "name":"nobody nobody", "email":"nobody@marklogic.com"}}}, "files":[], "show":true}], "updatedAt":"2013-02-25T16:46:27.235177-08:00", "fixedAt":"2013-01-10T10:35:24.973855-08:00", "fixedBy":{"username":"mary", "name":"Mary Holstege", "email":"mary@cerisent.com"}, "shippedAt":"2013-01-22T02:08:23.144377-08:00", "shippedBy":{"username":"ksaxena", "name":"Kapil Saxena", "email":"kapil.saxena@marklogic.com"}, "closedAt":"2013-02-25T16:46:27.235177-08:00", "closedBy":{"username":"rpelton", "name":"Rick Pelton", "email":"rick.pelton@marklogic.com"}, "renderDescriptionAs":"normal", "renderSampleQueryAs":"normal"}
{"id":20938, "kind":"Bug", "createdAt":"2013-02-26T11:00:51.627983-08:00", "status":"Closed", "title":"REGR: 7.0 builder unit-test failure", "category":"xdmp", "severity":"Minor", "priority":{"level":"5", "title":""}, "submittedBy":{"username":"ayuwono", "name":"Aries Yuwono", "email":"ayuwono@marklogic.com"}, "assignTo":{"username":"nobody", "name":"nobody nobody", "email":"nobody@marklogic.com"}, "description":"7.0 builder unit-test failure\r\n\r\n<h:result-text><results notice=\"empty if all tests ran successfully\"><report group=\"builder\"><setup/><tests><error:code xmlns:error=\"http://marklogic.com/xdmp/error\">BUILD-INVALIDOPTS</error:code><error:name xmlns:error=\"http://marklogic.com/xdmp/error\">err:FOER0000</error:name><error:xquery-version xmlns:error=\"http://marklogic.com/xdmp/error\">1.0-ml</error:xquery-version><error:message xmlns:error=\"http://marklogic.com/xdmp/error\">Invalid options XML</error:message><error:format-string xmlns:error=\"http://marklogic.com/xdmp/error\">BUILD-INVALIDOPTS: (err:FOER0000) Invalid options XML: unable to compile</error:format-string><error:retryable xmlns:error=\"http://marklogic.com/xdmp/error\">false</error:retryable><error:expr xmlns:error=\"http://marklogic.com/xdmp/error\"> </error:expr><error:data xmlns:error=\"http://marklogic.com/xdmp/error\">\r\n\t<error:datum>unable to compile</error:datum>\r\n      </error:data><error:stack xmlns:error=\"http://marklogic.com/xdmp/error\">\r\n\t<error:frame>\r\n\t  <error:uri>/appbuilder/lib/compile.xqy</error:uri>\r\n\t  <error:line>623</error:line>\r\n\t  <error:column>34</error:column>\r\n\t  <error:operation>comp:validate(<options xmlns=\"http://marklogic.com/appservices/search\"><fragment-scope>documents</fragment-scope><constraint name=\"awar...</options>, attribute{fn:QName(\"\", \"db-name\")}{\"New-Database-Name\"}, fn:false())</error:operation>\r\n\t  <error:variables>\r\n\t    <error:variable>\r\n\t      <error:name xmlns=\"http://marklogic.com/appservices/compile\">options</error:name>\r\n\t      <error:value><options xmlns=\"http://marklogic.com/appservices/search\"><fragment-scope>documents</fragment-scope><constraint name=\"awar...</options></error:value>\r\n\t    </error:variable>\r\n\t    <error:variable>\r\n\t      <error:name xmlns=\"http://marklogic.com/appservices/compile\">db-name</error:name>\r\n\t      <error:value>\"New-Database-Name\"</error:value>\r\n\t    </error:variable>\r\n\t    <error:variable>\r\n\t      <error:name xmlns=\"http://marklogic.com/appservices/compile\">strict</error:name>\r\n\t      <error:value>fn:false()</error:value>\r\n\t    </error:variable>\r\n\t    <error:variable>\r\n\t      <error:name xmlns=\"http://marklogic.com/appservices/compile\">check</error:name>\r\n\t      <error:value><search:report id=\"SEARCH-SCHEMAINVALID\" xmlns:search=\"http://marklogic.com/appservices/search\"><error:format-string xmlns:error=\"http://marklogic.com/xdmp/erro...</search:report></error:value>\r\n\t    </error:variable>\r\n\t  </error:variables>\r\n\t  <error:xquery-version>1.0-ml</error:xquery-version>\r\n\t</error:frame>\r\n\t<error:frame>\r\n\t  <error:uri>/appbuilder/lib/compile.xqy</error:uri>\r\n\t  <error:line>407</error:line>\r\n\t  <error:column>21</error:column>\r\n\t  <error:operation>comp:intro-options(<project name=\"My Oscars Application\" template=\"oscars\" db-name=\"New-Database-Name\" app-server=\"\" version=\"3.0\" data-location=\"http://developer.marklogic.com/download/appservices/appbuilder/t...\" id=\"-1\">&#10;    <!-- Copyright 2002-2013 MarkLogic Corporation.  All Ri...</project>, fn:false())</error:operation>\r\n\t  <error:variables>\r\n\t    <error:variable>\r\n\t      <error:name xmlns=\"http://marklogic.com/appservices/compile\">projectxml</error:name>\r\n\t      <error:value><project name=\"My Oscars Application\" template=\"oscars\" db-name=\"New-Database-Name\" app-server=\"\" version=\"3.0\" data-location=\"http://developer.marklogic.com/download/appservices/appbuilder/t...\" id=\"-1\">&#10;    <!-- Copyright 2002-2013 MarkLogic Corporation.  All Ri...</project></error:value>\r\n\t    </error:variable>\r\n\t    <error:variable>\r\n\t      <error:name xmlns=\"http://marklogic.com/appservices/compile\">strict</error:name>\r\n\t      <error:value>fn:false()</error:value>\r\n\t    </error:variable>\r\n\t    <error:variable>\r\n\t      <error:name xmlns=\"http://marklogic.com/appservices/compile\">intro-opts</error:name>\r\n\t      <error:value><search:options xmlns:search=\"http://marklogic.com/appservices/search\"><search:fragment-scope>documents</search:fragment-scope><search:...</search:options></error:value>\r\n\t    </error:variable>\r\n\t    <error:variable>\r\n\t      <error:name xmlns=\"http://marklogic.com/appservices/compile\">intro-opts</error:name>\r\n\t      <error:value><options xmlns=\"http://marklogic.com/appservices/search\"><fragment-scope>documents</fragment-scope><constraint name=\"awar...</options></error:value>\r\n\t    </error:variable>\r\n\t  </error:variables>\r\n\t  <error:xquery-version>1.0-ml</error:xquery-version>\r\n\t</error:frame>\r\n\t<error:frame>\r\n\t  <error:uri>/appbuilder/lib/compile.xqy</error:uri>\r\n\t  <error:line>341</error:line>\r\n\t  <error:column>53</error:column>\r\n\t  <error:operation>comp:global-variables(<project name=\"My Oscars Application\" template=\"oscars\" db-name=\"New-Database-Name\" app-server=\"\" version=\"3.0\" data-location=\"http://developer.marklogic.com/download/appservices/appbuilder/t...\" id=\"-1\">&#10;    <!-- Copyright 2002-2013 MarkLogic Corporation.  All Ri...</project>, fn:false())</error:operation>\r\n\t  <error:variables>\r\n\t    <error:variable>\r\n\t      <error:name xmlns=\"http://marklogic.com/appservices/compile\">projectxml</error:name>\r\n\t      <error:value><project name=\"My Oscars Application\" template=\"oscars\" db-name=\"New-Database-Name\" app-server=\"\" version=\"3.0\" data-location=\"http://developer.marklogic.com/download/appservices/appbuilder/t...\" id=\"-1\">&#10;    <!-- Copyright 2002-2013 MarkLogic Corporation.  All Ri...</project></error:value>\r\n\t    </error:variable>\r\n\t    <error:variable>\r\n\t      <error:name xmlns=\"http://marklogic.com/appservices/compile\">strict</error:name>\r\n\t      <error:value>fn:false()</error:value>\r\n\t    </error:variable>\r\n\t  </error:variables>\r\n\t  <error:xquery-version>1.0-ml</error:xquery-version>\r\n\t</error:frame>\r\n\t<error:frame>\r\n\t  <error:uri>/appbuilder/lib/compile.xqy</error:uri>\r\n\t  <error:line>275</error:line>\r\n\t  <error:column>25</error:column>\r\n\t  <error:operation>comp:compile-lib(\"page\", <project name=\"My Oscars Application\" template=\"oscars\" db-name=\"New-Database-Name\" app-server=\"\" version=\"3.0\" data-location=\"http://developer.marklogic.com/download/appservices/appbuilder/t...\" id=\"-1\">&#10;    <!-- Copyright 2002-2013 MarkLogic Corporation.  All Ri...</project>, fn:false())</error:operation>\r\n\t  <error:variables>\r\n\t    <error:variable>\r\n\t      <error:name xmlns=\"http://marklogic.com/appservices/compile\">startpage</error:name>\r\n\t      <error:value>\"page\"</error:value>\r\n\t    </error:variable>\r\n\t    <error:variable>\r\n\t      <error:name xmlns=\"http://marklogic.com/appservices/compile\">projectxml</error:name>\r\n\t      <error:value><project name=\"My Oscars Application\" template=\"oscars\" db-name=\"New-Database-Name\" app-server=\"\" version=\"3.0\" data-location=\"http://developer.marklogic.com/download/appservices/appbuilder/t...\" id=\"-1\">&#10;    <!-- Copyright 2002-2013 MarkLogic Corporation.  All Ri...</project></error:value>\r\n\t    </error:variable>\r\n\t    <error:variable>\r\n\t      <error:name xmlns=\"http://marklogic.com/appservices/compile\">strict</error:name>\r\n\t      <error:value>fn:false()</error:value>\r\n\t    </error:variable>\r\n\t    <error:variable>\r\n\t      <error:name xmlns=\"http://marklogic.com/appservices/compile\">start</error:name>\r\n\t      <error:value>\"xquery version '1.0-ml';(: Generated on 2013-02-26 by the MarkLo...\"</error:value>\r\n\t    </error:variable>\r\n\t    <error:variable>\r\n\t      <error:name xmlns=\"http://marklogic.com/appservices/compile\">assemble</error:name>\r\n\t      <error:value>\"\"</error:value>\r\n\t    </error:variable>\r\n\t  </error:variables>\r\n\t  <error:xquery-version>1.0-ml</error:xquery-version>\r\n\t</error:frame>\r\n\t<error:frame>\r\n\t  <error:uri>/appbuilder/lib/compile.xqy</error:uri>\r\n\t  <error:line>134</error:line>\r\n\t  <error:column>23</error:column>\r\n\t  <error:operation>comp:do-compile(<project name=\"My Oscars Application\" template=\"oscars\" db-name=\"New-Database-Name\" app-server=\"\" version=\"3.0\" data-location=\"http://developer.marklogic.com/download/appservices/appbuilder/t...\" id=\"-1\">&#10;    <!-- Copyright 2002-2013 MarkLogic Corporation.  All Ri...</project>, \"page\", fn:false())</error:operation>\r\n\t  <error:variables>\r\n\t    <error:variable>\r\n\t      <error:name xmlns=\"http://marklogic.com/appservices/compile\">projectxml</error:name>\r\n\t      <error:value><project name=\"My Oscars Application\" template=\"oscars\" db-name=\"New-Database-Name\" app-server=\"\" version=\"3.0\" data-location=\"http://developer.marklogic.com/download/appservices/appbuilder/t...\" id=\"-1\">&#10;    <!-- Copyright 2002-2013 MarkLogic Corporation.  All Ri...</project></error:value>\r\n\t    </error:variable>\r\n\t    <error:variable>\r\n\t      <error:name xmlns=\"http://marklogic.com/appservices/compile\">startpage</error:name>\r\n\t      <error:value>\"page\"</error:value>\r\n\t    </error:variable>\r\n\t    <error:variable>\r\n\t      <error:name xmlns=\"http://marklogic.com/appservices/compile\">strict</error:name>\r\n\t      <error:value>fn:false()</error:value>\r\n\t    </error:variable>\r\n\t    <error:variable>\r\n\t      <error:name xmlns=\"http://marklogic.com/appservices/compile\">clear</error:name>\r\n\t      <error:value>()</error:value>\r\n\t    </error:variable>\r\n\t  </error:variables>\r\n\t  <error:xquery-version>1.0-ml</error:xquery-version>\r\n\t</error:frame>\r\n\t<error:frame>\r\n\t  <error:uri>/test/appservices/builder-unittest/compiler-unittest.xqy</error:uri>\r\n\t  <error:line>156</error:line>\r\n\t  <error:column>16</error:column>\r\n\t  <error:operation>unit:testCompileSample()</error:operation>\r\n\t  <error:variables>\r\n\t    <error:variable>\r\n\t      <error:name xmlns=\"http://marklogic.com/appservices/builder-unittest/compiler\">doc</error:name>\r\n\t      <error:value>document{<project name=\"My Oscars Application\" template=\"oscars\" db-name=\"New-Database-Name\" app-server=\"\" version=\"3.0\" data-location=\"http://developer.marklogic.com/download/appservices/appbuilder/t...\" id=\"-1\">&#10;    <!-- Copyright 2002-2013 MarkLogic Corporation.  All Ri...</project>}</error:value>\r\n\t    </error:variable>\r\n\t  </error:variables>\r\n\t  <error:xquery-version>1.0-ml</error:xquery-version>\r\n\t</error:frame>\r\n\t<error:frame>\r\n\t  <error:uri>/test/appservices/builder-unittest/compiler-unittest.xqy</error:uri>\r\n\t  <error:line>193</error:line>\r\n\t  <error:column>4</error:column>\r\n\t  <error:operation>unit:runAllTests()</error:operation>\r\n\t  <error:xquery-version>1.0-ml</error:xquery-version>\r\n\t</error:frame>\r\n\t<error:frame>\r\n\t  <error:line>3</error:line>\r\n\t  <error:column>24</error:column>\r\n\t  <error:operation>xdmp:eval(\"xquery version &quot;1.0-ml&quot;; import module namespace unit ...\", (), <options xmlns=\"xdmp:eval\"><database>14506496594526104387</database><isolation>different-tr...</options>)</error:operation>\r\n\t  <error:xquery-version>1.0-ml</error:xquery-version>\r\n\t</error:frame>\r\n\t<error:frame>\r\n\t  <error:uri>/test/appservices/driver-utils.xqy</error:uri>\r\n\t  <error:line>266</error:line>\r\n\t  <error:column>16</error:column>\r\n\t  <error:operation>util:runGroupTests((<test root=\"/\" group=\"builder\" ns=\"http://marklogic.com/appservices/builder-unittest/build-schema\" module=\"/test/appservices/builder-unittest/build-schema-unittest.xqy\"><data directory=\"/opt/MarkLogic/Apps//test/appservices/builder-u...</test>, <test root=\"/\" group=\"builder\" ns=\"http://marklogic.com/appservices/builder-unittest/data\" module=\"/test/appservices/builder-unittest/data-unittest.xqy\"><data directory=\"/opt/MarkLogic/Apps//test/appservices/builder-u...</test>, <test root=\"/\" group=\"builder\" ns=\"http://marklogic.com/appservices/builder-unittest/quickstart\" module=\"/test/appservices/builder-unittest/quickstart-unittest.xqy\"><data directory=\"/opt/MarkLogic/Apps//test/appservices/builder-u...</test>, ...), xs:unsignedLong(\"14506496594526104387\"))</error:operation>\r\n\t  <error:variables>\r\n\t    <error:variable>\r\n\t      <error:name xmlns=\"http://marklogic.com/appservices/test/util\">tests</error:name>\r\n\t      <error:value>(<test root=\"/\" group=\"builder\" ns=\"http://marklogic.com/appservices/builder-unittest/build-schema\" module=\"/test/appservices/builder-unittest/build-schema-unittest.xqy\"><data directory=\"/opt/MarkLogic/Apps//test/appservices/builder-u...</test>, <test root=\"/\" group=\"builder\" ns=\"http://marklogic.com/appservices/builder-unittest/data\" module=\"/test/appservices/builder-unittest/data-unittest.xqy\"><data directory=\"/opt/MarkLogic/Apps//test/appservices/builder-u...</test>, <test root=\"/\" group=\"builder\" ns=\"http://marklogic.com/appservices/builder-unittest/quickstart\" module=\"/test/appservices/builder-unittest/quickstart-unittest.xqy\"><data directory=\"/opt/MarkLogic/Apps//test/appservices/builder-u...</test>, ...)</error:value>\r\n\t    </error:variable>\r\n\t    <error:variable>\r\n\t      <error:name xmlns=\"http://marklogic.com/appservices/test/util\">db-id</error:name>\r\n\t      <error:value>xs:unsignedLong(\"14506496594526104387\")</error:value>\r\n\t    </error:variable>\r\n\t    <error:variable>\r\n\t      <error:name xmlns=\"http://marklogic.com/appservices/test/util\">test</error:name>\r\n\t      <error:value><test root=\"/\" group=\"builder\" ns=\"http://marklogic.com/appservices/builder-unittest/compiler\" module=\"/test/appservices/builder-unittest/compiler-unittest.xqy\"><data directory=\"/opt/MarkLogic/Apps//test/appservices/builder-u...</test></error:value>\r\n\t    </error:variable>\r\n\t  </error:variables>\r\n\t  <error:xquery-version>1.0-ml</error:xquery-version>\r\n\t</error:frame>\r\n\t<error:frame>\r\n\t  <error:uri>/test/appservices/qa-unit-driver.xqy</error:uri>\r\n\t  <error:line>33</error:line>\r\n\t  <error:column>17</error:column>\r\n\t  <error:operation>xdmp:invoke(\"test/appservices/qa-unit-driver.xqy\", (fn:QName(\"\", \"group\"), \"builder\"))</error:operation>\r\n\t  <error:variables>\r\n\t    <error:variable>\r\n\t      <error:name>db-id</error:name>\r\n\t      <error:value>xs:unsignedLong(\"0\")</error:value>\r\n\t    </error:variable>\r\n\t    <error:variable>\r\n\t      <error:name>setup</error:name>\r\n\t      <error:value>()</error:value>\r\n\t    </error:variable>\r\n\t    <error:variable>\r\n\t      <error:name>setup</error:name>\r\n\t      <error:value>()</error:value>\r\n\t    </error:variable>\r\n\t    <error:variable>\r\n\t      <error:name>db-id</error:name>\r\n\t      <error:value>xs:unsignedLong(\"14506496594526104387\")</error:value>\r\n\t    </error:variable>\r\n\t    <error:variable>\r\n\t      <error:name>load</error:name>\r\n\t      <error:value>(<data>Loaded data at  /opt/MarkLogic/Apps//test/appservices/builder-un...</data>, <data>Loaded data at  /opt/MarkLogic/Apps//test/appservices/builder-un...</data>, <data>Loaded data at  /opt/MarkLogic/Apps//test/appservices/builder-un...</data>, ...)</error:value>\r\n\t    </error:variable>\r\n\t  </error:variables>\r\n\t  <error:xquery-version>1.0-ml</error:xquery-version>\r\n\t</error:frame>\r\n\t<error:frame>\r\n\t  <error:line>5</error:line>\r\n\t  <error:column>5</error:column>\r\n\t  <error:xquery-version>1.0-ml</error:xquery-version>\r\n\t</error:frame>\r\n      </error:stack></tests><teardown/></report></results></h:result-text>\r\n  <h:expected-result><results notice=\"empty if all tests ran successfully\"/></h:expected-result>", "samplequery":"", "sampledata":"", "version":"7.0-nightly", "tofixin":"7.0-ea1", "fixedin":"7.0-ea1", "platform":"all", "memory":"", "processors":"", "note":"", "subscribers":[{"username":"ayuwono", "name":"Aries Yuwono", "email":"ayuwono@marklogic.com"}, {"username":"gghai", "name":"Gaurav Ghai", "email":"Gaurav.ghai@marklogic.com"}, {"username":"ctaylor", "name":"Christophe Taylor", "email":"christophe.taylor@marklogic.com"}, {"username":"cgreer", "name":"Charles Greer", "email":"charles.greer@marklogic.com"}, {"username":"jfuller", "name":"Jim Fuller", "email":"jim.fuller@marklogic.com"}], "attachments":[], "relationships":[{"type":"", "to":""}], "clones":[], "cloneOf":"", "support":{"headline":"", "supportDescription":"", "publishStatus":"Never Publish", "tickets":[], "customerImpact":{"level":"N/A", "title":""}, "workaround":""}, "tags":["xdmp", "ayuwono"], "changeHistory":[{"time":"2013-02-26T11:00:51.627983-08:00", "updatedBy":{"username":"ayuwono", "name":"Aries Yuwono", "email":"ayuwono@marklogic.com"}, "change":{"assignTo":{"from":{"username":"ayuwono", "name":"Aries Yuwono", "email":"ayuwono@marklogic.com"}, "to":{"username":"jfuller", "name":"Jim Fuller", "email":"jim.fuller@marklogic.com"}}}, "files":[], "show":true}, {"time":"2013-02-28T13:26:10.289245-08:00", "updatedBy":{"username":"jfuller", "name":"Jim Fuller", "email":"jim.fuller@marklogic.com"}, "change":{}, "files":[], "show":true, "comment":"my analysis;\r\n\r\nthe builder test suite compiler unit test is failing ...specifically unit:testCompileSample() when it attempts to take appbuilder project.xml and compiles it with comp:do-compile().\r\n\r\nthis ends up throwing a BUILD-INVALIDOPTS is due to invoke of comp:validate (shown below) -> which only ever executes the search:check-options\r\n\r\ndeclare function comp:validate(\r\n    $options as element(search:options),\r\n    $db-name as xs:string,\r\n    $strict as xs:boolean)\r\nas empty-sequence()\r\n{\r\n       let $check := \r\n           if ($strict) then check:validate-options($options,$db-name)\r\n           else search:check-options($options)\r\n       return\r\n           if ($check)\r\n           then (xdmp:log($check),error((),\"BUILD-INVALIDOPTS\", \"unable to compile\"))\r\n           else ()\r\n};\r\n\r\nthis test started failing at the beginning of next month, when Christophe added the following to project.xml (for appbuilders project).\r\n\r\n        <constraint name=\"centroid\" type=\"geospatial\">\r\n\t\t\t<fragment-scope></fragment-scope>\r\n\t\t\t<label>Centroid</label>\r\n\t\t\t<front-page>false</front-page>\r\n\t\t\t<side-bar>false</side-bar>\r\n\t\t\t<datatype collation=\"\">xs:</datatype>\r\n\t\t\t<qnames type=\"element/attribute\" elem-ns=\"http://where.yahooapis.com/v1/schema.rng\" elem=\"centroid\" attr-ns=\"\" attr=\"\" field=\"\"></qnames>\r\n\t\t\t<collection-prefix></collection-prefix>\r\n\t\t\t<facet enabled=\"true\">\r\n\t\t\t\t<options order=\"frequency-order\" direction=\"descending\" limit=\"10000\"></options>\r\n\t\t\t</facet>\r\n\t\t\t<term-options case=\"\" punct=\"punctuation-insensitive\" wild=\"\" stem=\"\" diacritic=\"\"></term-options>\r\n\t\t\t<absolute-buckets use=\"false\">\r\n\t\t\t\t<bucket anchor=\"\" lt=\"\" ge=\"\" name=\"\"></bucket>\r\n\t\t\t</absolute-buckets>\r\n\t\t\t<relative-buckets use=\"false\">\r\n\t\t\t\t<bucket anchor=\"\" lt=\"\" ge=\"\" name=\"\"></bucket>\r\n\t\t\t</relative-buckets>\r\n\t\t\t<geotype>geospatial-element-pair-index</geotype>\r\n\t\t\t<parentlocalname>centroid</parentlocalname>\r\n\t\t\t<parentnamespaceuri>http://where.yahooapis.com/v1/schema.rng</parentnamespaceuri>\r\n\t\t\t<latitudelocalname>latitude</latitudelocalname>\r\n\t\t\t<latitudenamespaceuri>http://where.yahooapis.com/v1/schema.rng</latitudenamespaceuri>\r\n\t\t\t<longitudelocalname>longitude</longitudelocalname>\r\n\t\t\t<longitudenamespaceuri>http://where.yahooapis.com/v1/schema.rng</longitudenamespaceuri>\r\n\t\t\t<localname></localname>\r\n\t\t\t<namespaceuri></namespaceuri>\r\n\t\t</constraint>\r\n\r\n\r\n I am going to pass this along to Christope for further comment ... adding this constraint probably means that we need to upgrade the validate service as well for this kind of XML."}, {"time":"2013-02-28T13:26:10.289245-08:00", "updatedBy":{"username":"jfuller", "name":"Jim Fuller", "email":"jim.fuller@marklogic.com"}, "change":{"assignTo":{"from":{"username":"jfuller", "name":"Jim Fuller", "email":"jim.fuller@marklogic.com"}, "to":{"username":"ctaylor", "name":"Christophe Taylor", "email":"christophe.taylor@marklogic.com"}}}, "files":[], "show":true}, {"time":"2013-03-01T13:56:55.610452-08:00", "updatedBy":{"username":"ctaylor", "name":"Christophe Taylor", "email":"christophe.taylor@marklogic.com"}, "change":{}, "files":[], "show":true, "comment":"this addition was to fix a bug with the oscars example app not supporting geo out of the box, so there needed to be a default geo constraint thrown in.\r\n\r\nHere's the original bug:\r\nBug 20044 -  Inconsistent Maps widget behavior with oscar and non oscar deployment"}, {"time":"2013-03-01T13:58:13.47127-08:00", "updatedBy":{"username":"ctaylor", "name":"Christophe Taylor", "email":"christophe.taylor@marklogic.com"}, "change":{}, "files":[], "show":true, "comment":"this addition was to fix a bug with the oscars example app not supporting geo out of the box, so there needed to be a default geo constraint thrown in.\r\n\r\nHere's the original bug:\r\nBug 20044 -  Inconsistent Maps widget behavior with oscar and non oscar deployment"}, {"time":"2013-03-01T13:58:13.47127-08:00", "updatedBy":{"username":"ctaylor", "name":"Christophe Taylor", "email":"christophe.taylor@marklogic.com"}, "change":{"assignTo":{"from":{"username":"ctaylor", "name":"Christophe Taylor", "email":"christophe.taylor@marklogic.com"}, "to":{"username":"jfuller", "name":"Jim Fuller", "email":"jim.fuller@marklogic.com"}}}, "files":[], "show":true}, {"time":"2013-03-01T14:14:34.363877-08:00", "updatedBy":{"username":"ctaylor", "name":"Christophe Taylor", "email":"christophe.taylor@marklogic.com"}, "change":{"assignTo":{"from":{"username":"ctaylor", "name":"Christophe Taylor", "email":"christophe.taylor@marklogic.com"}, "to":{"username":"cgreer", "name":"Charles Greer", "email":"charles.greer@marklogic.com"}}}, "files":[], "show":true}, {"time":"2013-03-02T16:22:03.944002-08:00", "updatedBy":{"username":"cgreer", "name":"Charles Greer", "email":"charles.greer@marklogic.com"}, "change":{}, "files":[], "show":true, "comment":"I've figured out a fix to this bug.  For some reason, although @facet is option on <range/>, it is a required attribute on <custom/>.  I can think of several rationales for custom/@facet to be required, since the default of 'facet=true' seems less appropriate for custom.\r\n\r\nThe transforms for appbuilder for some reason strip out the @facet attribute from constraint children when making options.  I cannot understand why this could be the case, but that's what I see here at Apps/appbuilder/lib/compile.xqy\r\n\r\n return\r\n                element search:constraint {\r\n                    $c/@*,\r\n                    for $emt in $c/*\r\n                    return element { name($emt) } {\r\n                    $emt/@* except $emt/@facet, $emt/node()} }\r\n            }\r\n\r\nSo either we need to change the schema to allow no attribute on custom, or modify application code to change what it does explicitly, for some unknown reason.\r\n\r\nI'd like input on whether this schema change seems appropriate.\r\n\r\n\r\nCharles\r\n\r\n"}, {"time":"2013-03-02T16:22:03.944002-08:00", "updatedBy":{"username":"cgreer", "name":"Charles Greer", "email":"charles.greer@marklogic.com"}, "change":{"status":{"from":"", "to":"Fix"}, "assignTo":{"from":{"username":"cgreer", "name":"Charles Greer", "email":"charles.greer@marklogic.com"}, "to":{"username":"cgreer", "name":"Charles Greer", "email":"charles.greer@marklogic.com"}}}, "files":[], "show":true}, {"time":"2013-03-03T14:56:23.141146-08:00", "updatedBy":{"username":"cgreer", "name":"Charles Greer", "email":"charles.greer@marklogic.com"}, "change":{}, "files":[], "show":true, "svn":{"repository":"/project/engsvn", "revision":"134660", "paths":["xdmp/branches/b6_0/src/Apps/appbuilder/lib/compile.xqy"], "affectedBugs":[]}, "comment":"bug:20938 appbuilder unit test failure"}, {"time":"2013-03-03T15:00:01.056466-08:00", "updatedBy":{"username":"cgreer", "name":"Charles Greer", "email":"charles.greer@marklogic.com"}, "change":{}, "files":[], "show":true, "svn":{"repository":"/project/engsvn", "revision":"134661", "paths":["xdmp/trunk/src/Apps/appbuilder/lib/compile.xqy"], "affectedBugs":[]}, "comment":"bug:20938 unit test failures"}, {"time":"2013-03-03T15:00:58.359245-08:00", "updatedBy":{"username":"cgreer", "name":"Charles Greer", "email":"charles.greer@marklogic.com"}, "change":{}, "files":[], "show":true, "svn":{"repository":"/project/engsvn", "revision":"134662", "paths":["xdmp/branches/b7_0-ea1/src/Apps/appbuilder/lib/compile.xqy"], "affectedBugs":[]}, "comment":"bug:20938 appbuilder unit test failure"}, {"time":"2013-03-03T15:01:35.190278-08:00", "updatedBy":{"username":"cgreer", "name":"Charles Greer", "email":"charles.greer@marklogic.com"}, "change":{"status":{"from":"", "to":"Test"}, "assignTo":{"from":{"username":"cgreer", "name":"Charles Greer", "email":"charles.greer@marklogic.com"}, "to":{"username":"ayuwono", "name":"Aries Yuwono", "email":"ayuwono@marklogic.com"}}}, "files":[], "show":true, "comment":"Found the block missing logic for custom constraints and checked in.  Unit tests now pass."}, {"time":"2013-03-03T15:01:35.190278-08:00", "updatedBy":{"username":"cgreer", "name":"Charles Greer", "email":"charles.greer@marklogic.com"}, "change":{"assignTo":{"from":{"username":"cgreer", "name":"Charles Greer", "email":"charles.greer@marklogic.com"}, "to":{"username":"ayuwono", "name":"Aries Yuwono", "email":"ayuwono@marklogic.com"}}}, "files":[], "show":true}, {"time":"2013-03-03T20:05:45.047064-08:00", "updatedBy":{"username":"cgreer", "name":"Charles Greer", "email":"charles.greer@marklogic.com"}, "change":{"status":{"from":"", "to":"Fix"}, "assignTo":{"from":{"username":"cgreer", "name":"Charles Greer", "email":"charles.greer@marklogic.com"}, "to":{"username":"cgreer", "name":"Charles Greer", "email":"charles.greer@marklogic.com"}}}, "files":[], "show":true, "comment":"Taking this back to make sure I've done it right in all the branches\r\n"}, {"time":"2013-03-03T20:05:45.047064-08:00", "updatedBy":{"username":"cgreer", "name":"Charles Greer", "email":"charles.greer@marklogic.com"}, "change":{"assignTo":{"from":{"username":"cgreer", "name":"Charles Greer", "email":"charles.greer@marklogic.com"}, "to":{"username":"cgreer", "name":"Charles Greer", "email":"charles.greer@marklogic.com"}}}, "files":[], "show":true}, {"time":"2013-03-04T09:16:43.379965-08:00", "updatedBy":{"username":"cgreer", "name":"Charles Greer", "email":"charles.greer@marklogic.com"}, "change":{}, "files":[], "show":true, "svn":{"repository":"/project/engsvn", "revision":"134790", "paths":["xdmp/branches/b7_0-ea1/src/Apps/appbuilder/lib/compile.xqy"], "affectedBugs":[]}, "comment":"bug:20938 unit test failure"}, {"time":"2013-03-04T09:17:18.42387-08:00", "updatedBy":{"username":"cgreer", "name":"Charles Greer", "email":"charles.greer@marklogic.com"}, "change":{}, "files":[], "show":true, "svn":{"repository":"/project/engsvn", "revision":"134791", "paths":["xdmp/trunk/src/Apps/appbuilder/lib/compile.xqy"], "affectedBugs":[]}, "comment":"bug:20938 unit test failure"}, {"time":"2013-03-04T09:17:40.48197-08:00", "updatedBy":{"username":"cgreer", "name":"Charles Greer", "email":"charles.greer@marklogic.com"}, "change":{}, "files":[], "show":true, "svn":{"repository":"/project/engsvn", "revision":"134792", "paths":["xdmp/branches/b6_0/src/Apps/appbuilder/lib/compile.xqy"], "affectedBugs":[]}, "comment":"bug:20938 unit test failure"}, {"time":"2013-03-04T13:40:42.088715-08:00", "updatedBy":{"username":"cgreer", "name":"Charles Greer", "email":"charles.greer@marklogic.com"}, "change":{}, "files":[], "show":true, "comment":"On to you for the next round of fixes."}, {"time":"2013-03-04T13:40:42.088715-08:00", "updatedBy":{"username":"cgreer", "name":"Charles Greer", "email":"charles.greer@marklogic.com"}, "change":{"assignTo":{"from":{"username":"cgreer", "name":"Charles Greer", "email":"charles.greer@marklogic.com"}, "to":{"username":"jfuller", "name":"Jim Fuller", "email":"jim.fuller@marklogic.com"}}}, "files":[], "show":true}, {"time":"2013-03-05T04:27:43.251255-08:00", "updatedBy":{"username":"jfuller", "name":"Jim Fuller", "email":"jim.fuller@marklogic.com"}, "change":{}, "files":[], "show":true, "comment":"fresh build and new data layer (as CI confirms) that this is now building properly in trunk.\r\n\r\nI will manage pushing this to EA branch"}, {"time":"2013-03-05T09:04:21.667982-08:00", "updatedBy":{"username":"jfuller", "name":"Jim Fuller", "email":"jim.fuller@marklogic.com"}, "change":{"status":{"from":"", "to":"Test"}, "assignTo":{"from":{"username":"jfuller", "name":"Jim Fuller", "email":"jim.fuller@marklogic.com"}, "to":{"username":"jfuller", "name":"Jim Fuller", "email":"jim.fuller@marklogic.com"}}}, "files":[], "show":true, "comment":"to test just run builder unit test in EA1 branch which should pass"}, {"time":"2013-03-05T09:06:22.618939-08:00", "updatedBy":{"username":"jfuller", "name":"Jim Fuller", "email":"jim.fuller@marklogic.com"}, "change":{"assignTo":{"from":{"username":"jfuller", "name":"Jim Fuller", "email":"jim.fuller@marklogic.com"}, "to":{"username":"ayuwono", "name":"Aries Yuwono", "email":"ayuwono@marklogic.com"}}}, "files":[], "show":true}, {"time":"2013-03-06T13:34:09.376969-08:00", "updatedBy":{"username":"ayuwono", "name":"Aries Yuwono", "email":"ayuwono@marklogic.com"}, "change":{"status":{"from":"", "to":"Ship"}, "assignTo":{"from":{"username":"ayuwono", "name":"Aries Yuwono", "email":"ayuwono@marklogic.com"}, "to":{"username":"nobody", "name":"nobody nobody", "email":"nobody@marklogic.com"}}}, "files":[], "show":true, "comment":"Verified passed"}, {"time":"2013-03-06T13:34:09.376969-08:00", "updatedBy":{"username":"ayuwono", "name":"Aries Yuwono", "email":"ayuwono@marklogic.com"}, "change":{"assignTo":{"from":{"username":"ayuwono", "name":"Aries Yuwono", "email":"ayuwono@marklogic.com"}, "to":{"username":"nobody", "name":"nobody nobody", "email":"nobody@marklogic.com"}}}, "files":[], "show":true}], "updatedAt":"2013-03-06T13:34:09.376969-08:00", "fixedAt":"2013-03-05T09:04:21.667982-08:00", "fixedBy":{"username":"jfuller", "name":"Jim Fuller", "email":"jim.fuller@marklogic.com"}, "shippedAt":"2013-03-06T13:34:09.376969-08:00", "shippedBy":{"username":"ayuwono", "name":"Aries Yuwono", "email":"ayuwono@marklogic.com"}, "renderDescriptionAs":"normal"}
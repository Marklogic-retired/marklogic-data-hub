{"id":20052, "kind":"Bug", "createdAt":"2012-11-09T14:25:13.265843-08:00", "status":"Will not fix", "title":"changing  max-matches from 1 to 10 causes 15-18% performance penalty", "category":"MarkLogic REST API", "severity":"Performance", "priority":{"level":"5", "title":""}, "submittedBy":{"username":"msarma", "name":"Meghalim Sarma", "email":"msarma@marklogic.com"}, "assignTo":{"username":"nobody", "name":"nobody nobody", "email":"nobody@marklogic.com"}, "description":"During 6.0-2, we logged this bug http://bugtrack.marklogic.com/20003 about 15-18% performance degradation in REST API.  Based on further investigation, we found that the degradation was due to the fact that max-matches option was changed from 1 to 10 (as a fix to bug 19645). \r\n\r\nwith max-matches set to 2, performance seemed at per with baseline. So, we decided to  bring max-matches down to 2 from 1 which seemed like a reasonable way to fix bug 19645 without causing performance penalty.\r\n\r\nWe should still investigate why changing  max-matches from 1 to 10 causes 15-18% performance penalty. Logging this bug to have this in our plate.\r\n", "samplequery":"", "sampledata":"", "version":"6.0-nightly", "tofixin":"7.0-ea2", "fixedin":"N/A", "platform":"all", "memory":"", "processors":"", "note":"", "subscribers":[{"username":"msarma", "name":"Meghalim Sarma", "email":"msarma@marklogic.com"}, {"username":"gvaidees", "name":"Ganesh Vaideeswaran", "email":"Ganesh.Vaideeswaran@marklogic.com"}, {"username":"ehennum", "name":"Erik Hennum", "email":"erik.hennum@marklogic.com"}], "attachments":[], "relationships":[{"type":"", "to":""}], "clones":[], "cloneOf":"", "support":{"headline":"", "supportDescription":"", "publishStatus":"Not Ready", "tickets":[], "customerImpact":{"level":"N/A", "title":""}, "workaround":""}, "tags":["MarkLogic REST API", "msarma"], "changeHistory":[{"time":"2012-11-09T14:25:13.265843-08:00", "updatedBy":{"username":"msarma", "name":"Meghalim Sarma", "email":"msarma@marklogic.com"}, "change":{"assignTo":{"from":{"username":"msarma", "name":"Meghalim Sarma", "email":"msarma@marklogic.com"}, "to":{"username":"gvaidees", "name":"Ganesh Vaideeswaran", "email":"Ganesh.Vaideeswaran@marklogic.com"}}}, "files":[], "show":true}, {"time":"2013-01-28T13:58:41.489186-08:00", "updatedBy":{"username":"gvaidees", "name":"Ganesh Vaideeswaran", "email":"Ganesh.Vaideeswaran@marklogic.com"}, "change":{"assignTo":{"from":{"username":"gvaidees", "name":"Ganesh Vaideeswaran", "email":"Ganesh.Vaideeswaran@marklogic.com"}, "to":{"username":"ehennum", "name":"Erik Hennum", "email":"erik.hennum@marklogic.com"}}}, "files":[], "show":true}, {"time":"2013-02-15T09:30:21.452714-08:00", "updatedBy":{"username":"ehennum", "name":"Erik Hennum", "email":"erik.hennum@marklogic.com"}, "change":{"tofixin":{"from":"7.0-ea1", "to":"7.0-ea2"}}, "files":[], "show":true}, {"time":"2013-04-18T09:33:11.605582-07:00", "updatedBy":{"username":"cwhitney", "name":"Colleen  Whitney", "email":"colleen.whitney@marklogic.com"}, "change":{}, "files":[], "show":true, "comment":"I don't think this is a bug, or that we should spend a lot of time trying to address it.\r\n\r\nGenerating snippets usually accounts for the largest portion of the time taken in returning search results (take a look at the reported metrics to verify this for yourself).  On XML documents, the time taken to snippet is primarily taken in walking the document to find matches (look at highlight if you profile).  The amount of time this takes will vary significantly, depending on the query term, its frequency and location in the document, and the size and structure of the document.  We stop walking the document as soon as we have enough matches, so if there are fewer matches to look for, it takes significantly less time.  If you go from the default (3 matches)  to 10, in the worst case you're going to more than triple the amount of time taken the walk the document, which as noted is the most expensive part of the operation.\r\n\r\nWe generate a snippet for each of the results in the set.  So if you triple the walk time for each of 10 results in the worst case, you can do the math.   The default is 3, and that's what we do our performance testing on.\r\n\r\nSo to summarize, I don't think the change in performance should be surprising, or treated as a bug. \r\n"}, {"time":"2013-04-29T12:24:52.556154-07:00", "updatedBy":{"username":"ehennum", "name":"Erik Hennum", "email":"erik.hennum@marklogic.com"}, "change":{"status":{"from":"", "to":"Will not fix"}, "assignTo":{"from":{"username":"ehennum", "name":"Erik Hennum", "email":"erik.hennum@marklogic.com"}, "to":{"username":"nobody", "name":"nobody nobody", "email":"nobody@marklogic.com"}}}, "files":[], "show":true, "comment":"Based on Colleen's guidance, this code has already been optimized -- it's just one of the most expensive operations in the Search API, so the performance penalty with more snippets is expected.\r\n "}, {"time":"2013-04-29T12:24:52.556154-07:00", "updatedBy":{"username":"ehennum", "name":"Erik Hennum", "email":"erik.hennum@marklogic.com"}, "change":{"assignTo":{"from":{"username":"ehennum", "name":"Erik Hennum", "email":"erik.hennum@marklogic.com"}, "to":{"username":"nobody", "name":"nobody nobody", "email":"nobody@marklogic.com"}}}, "files":[], "show":true}], "updatedAt":"2013-04-29T12:24:52.556154-07:00", "renderDescriptionAs":"normal"}
{"id":20127, "kind":"Bug", "createdAt":"2012-11-18T07:08:53.173016-08:00", "status":"Closed", "title":"show unclosed stands in forest status", "category":"xdmp", "severity":"Major", "priority":{"level":"5", "title":""}, "submittedBy":{"username":"cjl", "name":"Christopher Lindblad", "email":"cjl@cerisent.com"}, "assignTo":{"username":"nobody", "name":"nobody nobody", "email":"nobody@marklogic.com"}, "description":"included a list of unclosed \"obsolete\" stands in forest status\r\ninclude reference stack traces if \"Stack Trace\" trace event is enabled", "samplequery":"", "sampledata":"", "version":"5.0-1", "tofixin":"5.0-5", "fixedin":"5.0-5", "platform":"all", "memory":"", "processors":"", "note":"", "subscribers":[{"username":"cjl", "name":"Christopher Lindblad", "email":"cjl@cerisent.com"}, {"username":"rpolasani", "name":"Raghu Polasani", "email":"raghu.polasani@marklogic.com"}, {"username":"svempati", "name":"Sundeep Vempati", "email":"sundeep.vempati@marklogic.com"}, {"username":"jsolis", "name":"Julio Solis", "email":"Julio.Solis@marklogic.com"}], "attachments":[], "relationships":[{"type":"", "to":""}], "clones":[20176], "cloneOf":20110, "support":{"headline":"forest-status should show unclosed stands", "supportDescription":"Stands made obsolete by merges but unclosed because they are still in use should be included in the forest-status output.", "publishStatus":"Publish", "tickets":[], "customerImpact":{"level":"N/A", "title":""}, "workaround":""}, "tags":["xdmp", "cjl"], "changeHistory":[{"time":"2012-11-18T07:08:53.173016-08:00", "updatedBy":{"username":"cjl", "name":"Christopher Lindblad", "email":"cjl@cerisent.com"}, "change":{"assignTo":{"from":{"username":"cjl", "name":"Christopher Lindblad", "email":"cjl@cerisent.com"}, "to":{"username":"cjl", "name":"Christopher Lindblad", "email":"cjl@cerisent.com"}}}, "files":[], "show":true}, {"time":"2012-11-19T06:28:01.890322-08:00", "updatedBy":{"username":"cjl", "name":"Christopher Lindblad", "email":"cjl@cerisent.com"}, "change":{}, "files":[], "show":true, "svn":{"repository":"/project/engsvn", "revision":"120661", "paths":["xdmp/trunk/src/Makefile.linux", "xdmp/trunk/src/InMemoryRangeIndexes.cpp", "xdmp/trunk/src/OnDiskReverseIndexImpl.h", "xdmp/trunk/src/services/Stacktrace.h", "xdmp/trunk/src/services/Stacktrace.cpp", "xdmp/trunk/src/Server.h", "xdmp/trunk/src/KeyIndex.h", "xdmp/trunk/src/Server.cpp", "xdmp/trunk/src/services/Handle.h", "xdmp/trunk/src/services/Handle.cpp", "xdmp/trunk/src/services/Makefile.macosx", "xdmp/trunk/src/ReverseIndex.h", "xdmp/trunk/src/PostingIterator.h", "xdmp/trunk/src/PostingIterator.cpp", "xdmp/trunk/src/StandQuery.cpp", "xdmp/trunk/src/List.cpp", "xdmp/trunk/src/List.h", "xdmp/trunk/src/services/Thread.cpp", "xdmp/trunk/src/GeospatialBuiltins.cpp", "xdmp/trunk/src/VM.h", "xdmp/trunk/src/InMemoryReverseIndex.cpp", "xdmp/trunk/src/RangeIndexes.cpp", "xdmp/trunk/src/services/Makefile.solaris", "xdmp/trunk/src/StandQuery.h", "xdmp/trunk/src/Aggregate.cpp", "xdmp/trunk/src/OnDiskRangeIndexes.cpp", "xdmp/trunk/src/InMemoryReverseIndexImpl.h", "xdmp/trunk/src/Stand.h", "xdmp/trunk/src/StatusBuiltins.cpp", "xdmp/trunk/src/KeyIndex.cpp", "xdmp/trunk/src/OnDiskReverseIndex.cpp", "xdmp/trunk/src/services/Makefile.winnt", "xdmp/trunk/src/OnDiskRangeIndexes.h", "xdmp/trunk/src/Forest.h", "xdmp/trunk/src/ReverseIndexImpl.h", "xdmp/trunk/src/Config/forest-status.xsd", "xdmp/trunk/src/StandManager.h", "xdmp/trunk/src/Forest.cpp", "xdmp/trunk/src/OnDiskReverseIndex.h", "xdmp/trunk/src/AssignmentStrategy.cpp", "xdmp/trunk/src/StandManager.cpp", "xdmp/trunk/src/Query.h", "xdmp/trunk/src/Orderer.cpp", "xdmp/trunk/src/Query.cpp", "xdmp/trunk/src/RangeIndexesImpl.h", "xdmp/trunk/src/ServerConfig.cpp", "xdmp/trunk/src/ForestQuery.cpp", "xdmp/trunk/src/Orderer.h", "xdmp/trunk/src/Stand.cpp", "xdmp/trunk/src/Tree.cpp", "xdmp/trunk/src/Tree.h", "xdmp/trunk/src/RangeIndexes.h", "xdmp/trunk/src/ReverseIndex.cpp"], "affectedBugs":[]}, "comment":"bug:20110"}, {"time":"2012-11-19T06:51:10.114094-08:00", "updatedBy":{"username":"cjl", "name":"Christopher Lindblad", "email":"cjl@cerisent.com"}, "change":{}, "files":[], "show":true, "svn":{"repository":"/project/engsvn", "revision":"120662", "paths":["xdmp/trunk/src/services/Stacktrace.cpp"], "affectedBugs":[]}, "comment":"bug:20110"}, {"time":"2012-11-19T07:44:25.319076-08:00", "updatedBy":{"username":"cjl", "name":"Christopher Lindblad", "email":"cjl@cerisent.com"}, "change":{}, "files":[], "show":true, "svn":{"repository":"/project/engsvn", "revision":"120665", "paths":["xdmp/trunk/src/Stand.cpp"], "affectedBugs":[]}, "comment":"bug:20110"}, {"time":"2012-11-19T08:04:54.366373-08:00", "updatedBy":{"username":"cjl", "name":"Christopher Lindblad", "email":"cjl@cerisent.com"}, "change":{}, "files":[], "show":true, "svn":{"repository":"/project/engsvn", "revision":"120666", "paths":["xdmp/trunk/src/List.cpp"], "affectedBugs":[]}, "comment":"bug:20110"}, {"time":"2012-11-19T08:17:38.654361-08:00", "updatedBy":{"username":"cjl", "name":"Christopher Lindblad", "email":"cjl@cerisent.com"}, "change":{}, "files":[], "show":true, "svn":{"repository":"/project/engsvn", "revision":"120672", "paths":["xdmp/trunk/src/services/Stacktrace.cpp"], "affectedBugs":[]}, "comment":"bug:20110"}, {"time":"2012-11-19T13:40:58.580468-08:00", "updatedBy":{"username":"cjl", "name":"Christopher Lindblad", "email":"cjl@cerisent.com"}, "change":{}, "files":[], "show":true, "svn":{"repository":"/project/engsvn", "revision":"120730", "paths":["xdmp/trunk/src/services/Stacktrace.cpp", "xdmp/trunk/src/ServerConfig.cpp"], "affectedBugs":[]}, "comment":"bug:20110"}, {"time":"2012-11-19T13:42:49.579903-08:00", "updatedBy":{"username":"cjl", "name":"Christopher Lindblad", "email":"cjl@cerisent.com"}, "change":{}, "files":[], "show":true, "svn":{"repository":"/project/engsvn", "revision":"120731", "paths":["xdmp/trunk/src/XQueryInterpreter.cpp", "xdmp/trunk/src/Server.cpp", "xdmp/trunk/src/StandManager.h", "xdmp/trunk/src/StandManager.cpp", "xdmp/trunk/src/XSLT.cpp"], "affectedBugs":[]}, "comment":"bug:20110"}, {"time":"2012-11-19T14:19:37.456464-08:00", "updatedBy":{"username":"cjl", "name":"Christopher Lindblad", "email":"cjl@cerisent.com"}, "change":{}, "files":[], "show":true, "svn":{"repository":"/project/engsvn", "revision":"120734", "paths":["xdmp/trunk/src/services/Stacktrace.cpp"], "affectedBugs":[]}, "comment":"bug:20110"}, {"time":"2012-11-19T15:26:25.764492-08:00", "updatedBy":{"username":"cjl", "name":"Christopher Lindblad", "email":"cjl@cerisent.com"}, "change":{}, "files":[], "show":true, "svn":{"repository":"/project/engsvn", "revision":"120741", "paths":["xdmp/trunk/src/Orderer.cpp", "xdmp/trunk/src/Orderer.h", "xdmp/trunk/src/List.cpp"], "affectedBugs":[]}, "comment":"bug:20110"}, {"time":"2012-11-20T11:33:03.083607-08:00", "updatedBy":{"username":"cjl", "name":"Christopher Lindblad", "email":"cjl@cerisent.com"}, "change":{}, "files":[], "show":true, "svn":{"repository":"/project/engsvn", "revision":"120850", "paths":["xdmp/trunk/src/InMemoryRangeIndexes.cpp", "xdmp/trunk/src/KeyIndex.h", "xdmp/trunk/src/services/Handle.cpp", "xdmp/trunk/src/PostingIterator.h", "xdmp/trunk/src/PostingIterator.cpp", "xdmp/trunk/src/StandQuery.cpp", "xdmp/trunk/src/List.cpp", "xdmp/trunk/src/List.h", "xdmp/trunk/src/GeospatialBuiltins.cpp", "xdmp/trunk/src/RangeIndexes.cpp", "xdmp/trunk/src/StandQuery.h", "xdmp/trunk/src/OnDiskRangeIndexes.cpp", "xdmp/trunk/src/RangeIndexes.h", "xdmp/trunk/src/KeyIndex.cpp", "xdmp/trunk/src/Config/forest-status.xsd", "xdmp/trunk/src/Forest.cpp", "xdmp/trunk/src/StandManager.cpp", "xdmp/trunk/src/Query.h", "xdmp/trunk/src/Query.cpp", "xdmp/trunk/src/RangeIndexesImpl.h", "xdmp/trunk/src/ForestQuery.cpp", "xdmp/trunk/src/services/Handle.h", "xdmp/trunk/src/Stand.cpp", "xdmp/trunk/src/StatusBuiltins.cpp"], "affectedBugs":[]}, "comment":"bug:20110"}, {"time":"2012-11-20T20:32:35.857801-08:00", "updatedBy":{"username":"cjl", "name":"Christopher Lindblad", "email":"cjl@cerisent.com"}, "change":{"status":{"from":"", "to":"Fix"}, "assignTo":{"from":{"username":"cjl", "name":"Christopher Lindblad", "email":"cjl@cerisent.com"}, "to":{"username":"cjl", "name":"Christopher Lindblad", "email":"cjl@cerisent.com"}}}, "files":[], "show":true}, {"time":"2012-11-20T20:32:35.857801-08:00", "updatedBy":{"username":"cjl", "name":"Christopher Lindblad", "email":"cjl@cerisent.com"}, "change":{"tofixin":{"from":"", "to":"5.0-5"}}, "files":[], "show":true}, {"time":"2012-11-24T07:43:18.257086-08:00", "updatedBy":{"username":"cjl", "name":"Christopher Lindblad", "email":"cjl@cerisent.com"}, "change":{}, "files":[], "show":true, "svn":{"repository":"/project/engsvn", "revision":"121276", "paths":["xdmp/branches/b5_0/src/List.h", "xdmp/branches/b5_0/src/Config/forest-status.xsd", "xdmp/branches/b5_0/src/Server.h", "xdmp/branches/b5_0/src/services/Handle.h", "xdmp/branches/b5_0/src/Stand.cpp", "xdmp/branches/b5_0/src/KeyIndex.cpp", "xdmp/branches/b5_0/src/ReverseIndexImpl.h", "xdmp/branches/b5_0/src/KeyIndex.h", "xdmp/branches/b5_0/src/StandQuery.h", "xdmp/branches/b5_0/src/XDQPServer.cpp", "xdmp/branches/b5_0/src/RangeIndexesImpl.h", "xdmp/branches/b5_0/src/OnDiskReverseIndex.cpp", "xdmp/branches/b5_0/src/Forest.h", "xdmp/branches/b5_0/src/Orderer.cpp", "xdmp/branches/b5_0/src/XSLT.cpp", "xdmp/branches/b5_0/src/OnDiskReverseIndex.h", "xdmp/branches/b5_0/src/services/Stacktrace.cpp", "xdmp/branches/b5_0/src/PostingIterator.cpp", "xdmp/branches/b5_0/src/StandManager.h", "xdmp/branches/b5_0/src/ReverseIndex.cpp", "xdmp/branches/b5_0/src/Orderer.h", "xdmp/branches/b5_0/src/List.cpp", "xdmp/branches/b5_0/src/ReverseIndex.h", "xdmp/branches/b5_0/src/OnDiskReverseIndexImpl.h", "xdmp/branches/b5_0/src/InMemoryRangeIndexes.cpp", "xdmp/branches/b5_0/src/GeospatialBuiltins.cpp", "xdmp/branches/b5_0/src/services/Thread.cpp", "xdmp/branches/b5_0/src/OnDiskRangeIndexes.cpp", "xdmp/branches/b5_0/src/Query.h", "xdmp/branches/b5_0/src/Makefile.linux", "xdmp/branches/b5_0/src/Tree.h", "xdmp/branches/b5_0/src/StandQuery.cpp", "xdmp/branches/b5_0/src/StandManager.cpp", "xdmp/branches/b5_0/src/services/Stacktrace.h", "xdmp/branches/b5_0/src/Stand.h", "xdmp/branches/b5_0/src/RangeIndexes.cpp", "xdmp/branches/b5_0/src/services/Makefile.macosx", "xdmp/branches/b5_0/src/StatusBuiltins.cpp", "xdmp/branches/b5_0/src/services/Handle.cpp", "xdmp/branches/b5_0/src/InMemoryReverseIndexImpl.h", "xdmp/branches/b5_0/src/RangeIndexes.h", "xdmp/branches/b5_0/src/XQueryInterpreter.cpp", "xdmp/branches/b5_0/src/PostingIterator.h", "xdmp/branches/b5_0/src/services/Makefile.solaris", "xdmp/branches/b5_0/src/ServerConfig.cpp", "xdmp/branches/b5_0/src/OnDiskRangeIndexes.h", "xdmp/branches/b5_0/src/Tree.cpp", "xdmp/branches/b5_0/src/services/Makefile.winnt", "xdmp/branches/b5_0/src/Server.cpp", "xdmp/branches/b5_0/src/Forest.cpp", "xdmp/branches/b5_0/src/ForestQuery.cpp", "xdmp/branches/b5_0/src/Query.cpp", "xdmp/branches/b5_0/src/InMemoryReverseIndex.cpp"], "affectedBugs":[]}, "comment":"bug:20127"}, {"time":"2012-11-25T07:56:55.478164-08:00", "updatedBy":{"username":"cjl", "name":"Christopher Lindblad", "email":"cjl@cerisent.com"}, "change":{"status":{"from":"", "to":"Test"}, "assignTo":{"from":{"username":"cjl", "name":"Christopher Lindblad", "email":"cjl@cerisent.com"}, "to":{"username":"rpolasani", "name":"Raghu Polasani", "email":"raghu.polasani@marklogic.com"}}}, "files":[], "show":true, "comment":"fixed in 5.0-20121125"}, {"time":"2012-11-25T07:56:55.478164-08:00", "updatedBy":{"username":"cjl", "name":"Christopher Lindblad", "email":"cjl@cerisent.com"}, "change":{"assignTo":{"from":{"username":"cjl", "name":"Christopher Lindblad", "email":"cjl@cerisent.com"}, "to":{"username":"rpolasani", "name":"Raghu Polasani", "email":"raghu.polasani@marklogic.com"}}}, "files":[], "show":true}, {"time":"2012-11-27T17:42:15.998024-08:00", "updatedBy":{"username":"rpolasani", "name":"Raghu Polasani", "email":"raghu.polasani@marklogic.com"}, "change":{"assignTo":{"from":{"username":"rpolasani", "name":"Raghu Polasani", "email":"raghu.polasani@marklogic.com"}, "to":{"username":"svempati", "name":"Sundeep Vempati", "email":"sundeep.vempati@marklogic.com"}}}, "files":[], "show":true}, {"time":"2013-01-22T16:39:30.457533-08:00", "updatedBy":{"username":"svempati", "name":"Sundeep Vempati", "email":"sundeep.vempati@marklogic.com"}, "change":{"assignTo":{"from":{"username":"svempati", "name":"Sundeep Vempati", "email":"sundeep.vempati@marklogic.com"}, "to":{"username":"jsolis", "name":"Julio Solis", "email":"Julio.Solis@marklogic.com"}}}, "files":[], "show":true}, {"time":"2013-01-23T14:16:07.608673-08:00", "updatedBy":{"username":"jsolis", "name":"Julio Solis", "email":"Julio.Solis@marklogic.com"}, "change":{"status":{"from":"", "to":"Verify"}, "assignTo":{"from":{"username":"jsolis", "name":"Julio Solis", "email":"Julio.Solis@marklogic.com"}, "to":{"username":"jsolis", "name":"Julio Solis", "email":"Julio.Solis@marklogic.com"}}}, "files":[], "show":true, "comment":"Hi Chris. I do not see a <unclosed-stands/> element from forest-status. I am using today's 5.0 build:  MarkLogic-5.0-20130123.x86_64. Is there anything I'm missing ?\r\nThanks."}, {"time":"2013-01-24T12:46:09.93571-08:00", "updatedBy":{"username":"dsokolsky", "name":"Danny Sokolsky", "email":"dsokolsky@marklogic.com"}, "change":{"status":{"from":"", "to":"Fix"}, "assignTo":{"from":{"username":"dsokolsky", "name":"Danny Sokolsky", "email":"dsokolsky@marklogic.com"}, "to":{"username":"cjl", "name":"Christopher Lindblad", "email":"cjl@cerisent.com"}}}, "files":[], "show":true, "comment":"Chris, looks like Julio bounced this back to you."}, {"time":"2013-01-24T12:46:09.93571-08:00", "updatedBy":{"username":"dsokolsky", "name":"Danny Sokolsky", "email":"dsokolsky@marklogic.com"}, "change":{"assignTo":{"from":{"username":"dsokolsky", "name":"Danny Sokolsky", "email":"dsokolsky@marklogic.com"}, "to":{"username":"cjl", "name":"Christopher Lindblad", "email":"cjl@cerisent.com"}}}, "files":[], "show":true}, {"time":"2013-01-24T15:45:59.683653-08:00", "updatedBy":{"username":"cjl", "name":"Christopher Lindblad", "email":"cjl@cerisent.com"}, "change":{"status":{"from":"", "to":"Test"}, "assignTo":{"from":{"username":"cjl", "name":"Christopher Lindblad", "email":"cjl@cerisent.com"}, "to":{"username":"jsolis", "name":"Julio Solis", "email":"Julio.Solis@marklogic.com"}}}, "files":[], "show":true, "comment":"If there are no unclosed stands there is no unclosed stands element in the forest-status output.\r\nAn unclosed stand is a stand that has been replaced by a merge but is still in use by something.\r\nOn the filesystem the stand directory of an unclosed stand has the \"Obsolete\" marker.\r\nTo create this situation, I suggest creating a small forest with one document in it.\r\nThen start a request on the task server running against it that just accesses the document and then sleeps for a a minute or so.\r\nThen while the request is running, force a  merge on the forest.\r\nSince the forest is so small, the merge should finish in just a few seconds.\r\nWhen the merge completes, it will replace the old stand on the forest with a new one.\r\nThe old stand will still be being in use by the sleeping request, so it shows up as an unclosed stand in the forest status until the request finally finishes."}, {"time":"2013-01-24T15:45:59.683653-08:00", "updatedBy":{"username":"cjl", "name":"Christopher Lindblad", "email":"cjl@cerisent.com"}, "change":{"assignTo":{"from":{"username":"cjl", "name":"Christopher Lindblad", "email":"cjl@cerisent.com"}, "to":{"username":"jsolis", "name":"Julio Solis", "email":"Julio.Solis@marklogic.com"}}}, "files":[], "show":true}, {"time":"2013-01-30T11:32:53.157363-08:00", "updatedBy":{"username":"jsolis", "name":"Julio Solis", "email":"Julio.Solis@marklogic.com"}, "change":{"status":{"from":"", "to":"Verify"}, "assignTo":{"from":{"username":"jsolis", "name":"Julio Solis", "email":"Julio.Solis@marklogic.com"}, "to":{"username":"jsolis", "name":"Julio Solis", "email":"Julio.Solis@marklogic.com"}}}, "files":[], "show":true, "comment":"Thanks for the explanation. I have recreated this situation and confirmed an unclosed stand is present in forest-status. Verified on build MarkLogic-5.0-20130129.x86_64. Checking in new test case bug20127.xml into regression."}, {"time":"2013-02-04T10:17:46.605841-08:00", "updatedBy":{"username":"jsolis", "name":"Julio Solis", "email":"Julio.Solis@marklogic.com"}, "change":{"status":{"from":"", "to":"Test"}, "assignTo":{"from":{"username":"jsolis", "name":"Julio Solis", "email":"Julio.Solis@marklogic.com"}, "to":{"username":"jsolis", "name":"Julio Solis", "email":"Julio.Solis@marklogic.com"}}}, "files":[], "show":true, "comment":"Correction. Status should be 'test'."}, {"time":"2013-02-04T10:18:16.462575-08:00", "updatedBy":{"username":"jsolis", "name":"Julio Solis", "email":"Julio.Solis@marklogic.com"}, "change":{"status":{"from":"", "to":"Ship"}, "assignTo":{"from":{"username":"jsolis", "name":"Julio Solis", "email":"Julio.Solis@marklogic.com"}, "to":{"username":"nobody", "name":"nobody nobody", "email":"nobody@marklogic.com"}}}, "files":[], "show":true}, {"time":"2013-02-25T21:32:47.938122-08:00", "updatedBy":{"username":"rpelton", "name":"Rick Pelton", "email":"rick.pelton@marklogic.com"}, "change":{"status":{"from":"", "to":"Closed"}, "assignTo":{"from":{"username":"rpelton", "name":"Rick Pelton", "email":"rick.pelton@marklogic.com"}, "to":{"username":"nobody", "name":"nobody nobody", "email":"nobody@marklogic.com"}}}, "files":[], "show":true}], "updatedAt":"2013-02-25T21:32:47.938122-08:00", "fixedAt":"2013-02-04T10:17:46.605841-08:00", "fixedBy":{"username":"jsolis", "name":"Julio Solis", "email":"Julio.Solis@marklogic.com"}, "shippedAt":"2013-02-04T10:18:16.462575-08:00", "shippedBy":{"username":"jsolis", "name":"Julio Solis", "email":"Julio.Solis@marklogic.com"}, "closedAt":"2013-02-25T21:32:47.938122-08:00", "closedBy":{"username":"rpelton", "name":"Rick Pelton", "email":"rick.pelton@marklogic.com"}, "renderDescriptionAs":"normal"}
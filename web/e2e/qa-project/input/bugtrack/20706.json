{"id":20706, "kind":"RFE", "createdAt":"2013-02-04T23:00:25.288838-08:00", "status":"Will not fix", "title":"Request-text element not showing complete query string", "category":"xdmp", "severity":"Major", "priority":{"level":"5", "title":""}, "submittedBy":{"username":"dchander", "name":"Dinesh Chander", "email":"dinesh.chander@globallogic.com"}, "assignTo":{"username":"nobody", "name":"nobody nobody", "email":"nobody@marklogic.com"}, "description":"Reported by user in case #12468\r\n\r\nUser has migrated their application from 3.2 to 6.0-2 and has reported that in 3.2 they used to get the entire query (e.g. /default.xqy?http.method=DELETE&http.uri=http://atom.highwire.org/mnras/...) from the status page of the app server but with ML 6.0 (actually even on ML4 and 5) they are getting only \"/default.xqy\" i.e. the query paramters are missing.", "samplequery":"", "sampledata":"I found one difference in the output of xdmp:request-status. The output seems to have changed after ML 3.2 as I can see consistent output in ML4, ML5 and ML6. The difference is with the field \"request-text\" in the output. With ML3, it is returning full query parameters (e.g. /cq/eval.xqy?iefix.txt) but starting ML4 it is not returning the query parameters. \r\nI can see that the Admin UI (appserver-status.xqy) still uses the same code where it is trying to truncate query to a maximum of 37 characters while rendering and hence feel that it may be a bug that post ML3 xdmp:request-status is not returning the full query parameters.", "version":"6.0-2.2", "tofixin":"N/A", "fixedin":"N/A", "platform":"all", "memory":"", "processors":"", "note":"", "subscribers":[{"username":"dchander", "name":"Dinesh Chander", "email":"dinesh.chander@globallogic.com"}, {"username":"cgreer", "name":"Charles Greer", "email":"charles.greer@marklogic.com"}, {"username":"fxue", "name":"Fei Xue", "email":"Fei.Xue@marklogic.com"}, {"username":"gvaidees", "name":"Ganesh Vaideeswaran", "email":"Ganesh.Vaideeswaran@marklogic.com"}, {"username":"rhu", "name":"Ron Hu", "email":"ron.hu@marklogic.com"}], "attachments":[], "includeInTaskList":false, "proceduralTasks":{"Requirements Task":[], "Functional Specification Task":[], "Test Specification Task":[], "Test Automation Task":[], "Documentation Task":[]}, "subTasks":[], "tags":["xdmp", "dchander"], "changeHistory":[{"time":"2013-02-04T23:00:25.288838-08:00", "updatedBy":{"username":"dchander", "name":"Dinesh Chander", "email":"dinesh.chander@globallogic.com"}, "change":{"assignTo":{"from":{"username":"dchander", "name":"Dinesh Chander", "email":"dinesh.chander@globallogic.com"}, "to":{"username":"fxue", "name":"Fei Xue", "email":"Fei.Xue@marklogic.com"}}}, "files":[], "show":true}, {"time":"2013-02-12T10:52:49.371585-08:00", "updatedBy":{"username":"gvaidees", "name":"Ganesh Vaideeswaran", "email":"Ganesh.Vaideeswaran@marklogic.com"}, "change":{"tofixin":{"from":"", "to":"6.0-3"}}, "files":[], "show":true}, {"time":"2013-02-25T10:47:54.837654-08:00", "updatedBy":{"username":"rpelton", "name":"Rick Pelton", "email":"rick.pelton@marklogic.com"}, "change":{}, "files":[], "show":true, "comment":"support would like this fixed.\r\n\r\nDo we know why this changed?"}, {"time":"2013-02-25T11:06:29.924392-08:00", "updatedBy":{"username":"fxue", "name":"Fei Xue", "email":"Fei.Xue@marklogic.com"}, "change":{}, "files":[], "show":true, "comment":"I think this might be caused by a fix on 09/03/08, 4 years ago.\r\nIt references bug 6059 “Status builtins have dropped the / from the request-text element”\r\n\r\nAFAIK it truncates the requestText in a certain way that might have also left out the useful information. "}, {"time":"2013-02-25T17:23:48.238057-08:00", "updatedBy":{"username":"fxue", "name":"Fei Xue", "email":"Fei.Xue@marklogic.com"}, "change":{}, "files":[], "show":true, "comment":"Easy way to reproduce this bug: run\r\nxdmp:request-status(xdmp:host(), xdmp:server(), xdmp:request())\r\nwe get in the request-text field  <request-text>/qconsole/endpoints/evaler.xqy</request-text>\r\nthus missing the query parameter."}, {"time":"2013-02-25T17:45:56.656694-08:00", "updatedBy":{"username":"fxue", "name":"Fei Xue", "email":"Fei.Xue@marklogic.com"}, "change":{"assignTo":{"from":{"username":"fxue", "name":"Fei Xue", "email":"Fei.Xue@marklogic.com"}, "to":{"username":"gvaidees", "name":"Ganesh Vaideeswaran", "email":"Ganesh.Vaideeswaran@marklogic.com"}}}, "files":[], "show":true}, {"time":"2013-02-28T21:18:19.358991-08:00", "updatedBy":{"username":"gvaidees", "name":"Ganesh Vaideeswaran", "email":"Ganesh.Vaideeswaran@marklogic.com"}, "change":{}, "files":[], "show":true, "comment":"Christophe,\r\n\r\nCan you please talk to Charles and see why check options is failing for sample oscar app?\r\n\r\nonce you deploy an oscar app, you should be get to view the options called \"all\" and then pass it through check options.\r\n\r\nCharles, Hope you can help Christophe with this tomorrow"}, {"time":"2013-03-01T11:55:34.466834-08:00", "updatedBy":{"username":"gvaidees", "name":"Ganesh Vaideeswaran", "email":"Ganesh.Vaideeswaran@marklogic.com"}, "change":{}, "files":[], "show":true, "comment":"Ignore my last comment."}, {"time":"2013-03-01T13:41:55.643276-08:00", "updatedBy":{"username":"fxue", "name":"Fei Xue", "email":"Fei.Xue@marklogic.com"}, "change":{}, "files":[], "show":true, "comment":"The following sentence in appserver-status.xqy\r\n   let $rq := clean-string-seq(tokenize($r,\"\\?\")),\r\n       $t := $rq[1]\r\n\r\nseems to be breaking down the request text before a question mark thus not returning the parameters."}, {"time":"2013-03-05T11:55:10.358973-08:00", "updatedBy":{"username":"gvaidees", "name":"Ganesh Vaideeswaran", "email":"Ganesh.Vaideeswaran@marklogic.com"}, "change":{}, "files":[], "show":true, "comment":"Fei,\r\n\r\nI looked at AppServer-status.xqy in 3.0-2 branch and the code looks the same - \r\n\r\n/project/engsvn/xdmp/branches/b3_0-1/src/Admin/appserver-status.xqy\r\n\r\nSo, I am not sure if this is the issue. I think something changed with the bult-in. Can you please check with Mary. If not, I can check with her later during the week.\r\n\r\nThanks."}, {"time":"2013-03-05T14:02:07.394172-08:00", "updatedBy":{"username":"mary", "name":"Mary Holstege", "email":"mary@cerisent.com"}, "change":{}, "files":[], "show":true, "comment":"I do not believe this is a bug. The request-text in the status is the translated path (for filesystem modules) and the resolved path (for database modules). Neither of these includes query parameters, nor can they. There are all kinds of bug fixes related to getting that resolution to occur properly, and the change to status is very, very old, and IIRC it was documented as a change at the time."}, {"time":"2013-03-05T14:47:26.916503-08:00", "updatedBy":{"username":"gvaidees", "name":"Ganesh Vaideeswaran", "email":"Ganesh.Vaideeswaran@marklogic.com"}, "change":{}, "files":[], "show":true, "comment":"As per Mary's assessment, sending to Rick to dispose this appropriately"}, {"time":"2013-03-05T14:47:26.916503-08:00", "updatedBy":{"username":"gvaidees", "name":"Ganesh Vaideeswaran", "email":"Ganesh.Vaideeswaran@marklogic.com"}, "change":{"assignTo":{"from":{"username":"gvaidees", "name":"Ganesh Vaideeswaran", "email":"Ganesh.Vaideeswaran@marklogic.com"}, "to":{"username":"rpelton", "name":"Rick Pelton", "email":"rick.pelton@marklogic.com"}}}, "files":[], "show":true}, {"time":"2013-03-15T11:45:54.682001-07:00", "updatedBy":{"username":"rpelton", "name":"Rick Pelton", "email":"rick.pelton@marklogic.com"}, "change":{}, "files":[], "show":true, "comment":"setting to will not fix per Mary's comment.\r\n"}, {"time":"2013-03-15T11:45:54.682001-07:00", "updatedBy":{"username":"rpelton", "name":"Rick Pelton", "email":"rick.pelton@marklogic.com"}, "change":{"status":{"from":"", "to":"Will not fix"}, "assignTo":{"from":{"username":"rpelton", "name":"Rick Pelton", "email":"rick.pelton@marklogic.com"}, "to":{"username":"nobody", "name":"nobody nobody", "email":"nobody@marklogic.com"}}}, "files":[], "show":true}, {"time":"2013-03-21T16:46:16.707802-07:00", "updatedBy":{"username":"rpelton", "name":"Rick Pelton", "email":"rick.pelton@marklogic.com"}, "change":{}, "files":[], "show":true, "comment":"Although the current behavior has existed for 4.5 years - refer to the fix for bug http://bugtrack/6059 comment on September 03, 2008 - the behavior feature that was removed does contain valuable information that is no longer available.  According the 9/3/2008 comment, it is not clear that the loss of request text parameters was intentional\r\n\r\nChanging type to RFE; status to verify; and to fix in to 6.0-4. We should triage as to whether the fix should be moved out to 7.0 or not. \r\n \r\n\r\n"}, {"time":"2013-03-21T16:46:16.707802-07:00", "updatedBy":{"username":"rpelton", "name":"Rick Pelton", "email":"rick.pelton@marklogic.com"}, "change":{"status":{"from":"", "to":"Verify"}, "assignTo":{"from":{"username":"rpelton", "name":"Rick Pelton", "email":"rick.pelton@marklogic.com"}, "to":{"username":"nobody", "name":"nobody nobody", "email":"nobody@marklogic.com"}}}, "files":[], "show":true}, {"time":"2013-03-21T16:46:16.707802-07:00", "updatedBy":{"username":"rpelton", "name":"Rick Pelton", "email":"rick.pelton@marklogic.com"}, "change":{"tofixin":{"from":"6.0-3", "to":"6.0-4"}}, "files":[], "show":true}, {"time":"2013-03-21T17:02:04.402202-07:00", "updatedBy":{"username":"rpelton", "name":"Rick Pelton", "email":"rick.pelton@marklogic.com"}, "change":{}, "files":[], "show":true, "comment":"To fix this, we may want to just create a new request-status element similar to \"request-rewritten-text\" (perhaps something like \"request-orig-text\") and have the Admin UI refer to the new element.  We would not know if there are any application level dependencies on the current behavior."}, {"time":"2013-05-12T21:27:00.240578-07:00", "updatedBy":{"username":"gvaidees", "name":"Ganesh Vaideeswaran", "email":"Ganesh.Vaideeswaran@marklogic.com"}, "change":{"assignTo":{"from":{"username":"gvaidees", "name":"Ganesh Vaideeswaran", "email":"Ganesh.Vaideeswaran@marklogic.com"}, "to":{"username":"rhu", "name":"Ron Hu", "email":"ron.hu@marklogic.com"}}}, "files":[], "show":true}, {"time":"2013-05-13T12:54:20.059534-07:00", "updatedBy":{"username":"rhu", "name":"Ron Hu", "email":"ron.hu@marklogic.com"}, "change":{}, "files":[], "show":true, "comment":"Fei,\r\nYou looked at this bug before."}, {"time":"2013-05-13T12:54:20.059534-07:00", "updatedBy":{"username":"rhu", "name":"Ron Hu", "email":"ron.hu@marklogic.com"}, "change":{"assignTo":{"from":{"username":"rhu", "name":"Ron Hu", "email":"ron.hu@marklogic.com"}, "to":{"username":"fxue", "name":"Fei Xue", "email":"Fei.Xue@marklogic.com"}}}, "files":[], "show":true}, {"time":"2013-06-24T13:52:34.612451-07:00", "updatedBy":{"username":"dsokolsky", "name":"Danny Sokolsky", "email":"dsokolsky@marklogic.com"}, "change":{}, "files":[], "show":true, "comment":"Not going to do this for 6.  There is a clone to look at it for 7."}, {"time":"2013-06-24T13:52:34.612451-07:00", "updatedBy":{"username":"dsokolsky", "name":"Danny Sokolsky", "email":"dsokolsky@marklogic.com"}, "change":{"status":{"from":null, "to":"Closed"}, "assignTo":{"from":{"username":"dsokolsky", "name":"Danny Sokolsky", "email":"dsokolsky@marklogic.com"}, "to":{"username":"nobody", "name":"nobody nobody", "email":"nobody@marklogic.com"}}}, "files":[], "show":true}, {"time":"2014-02-07T13:44:52.612714-08:00", "updatedBy":{"username":"rpelton", "name":"Rick Pelton", "email":"rick.pelton@marklogic.com"}, "change":{"status":{"from":"", "to":"Will not fix"}, "assignTo":{"from":{"username":"rpelton", "name":"Rick Pelton", "email":"rick.pelton@marklogic.com"}, "to":{"username":"nobody", "name":"nobody nobody", "email":"nobody@marklogic.com"}}}, "files":[], "show":true, "comment":"changing status to will not fix in v6 (as that was the decision) - it is fixed in v7.0-2. "}, {"time":"2014-02-07T13:44:52.612714-08:00", "updatedBy":{"username":"rpelton", "name":"Rick Pelton", "email":"rick.pelton@marklogic.com"}, "change":{"tofixin":{"from":"6.0-4", "to":"N/A"}}, "files":[], "show":true}], "updatedAt":"2014-02-07T13:44:52.612714-08:00", "closedAt":"2013-06-24T13:52:34.612451-07:00", "closedBy":{"username":"dsokolsky", "name":"Danny Sokolsky", "email":"dsokolsky@marklogic.com"}}
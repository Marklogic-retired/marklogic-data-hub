{"id":20124, "kind":"Task", "createdAt":"2012-11-20T08:03:54.779495-08:00", "status":"Closed", "title":"fn:resolve-uri behaves incorrectly in XSLT context", "category":"XSLT", "severity":"Major", "priority":{"level":"2", "title":"Not required for product release"}, "days":null, "period":{"startDate":null, "endDate":null}, "submittedBy":{"username":"nwalsh", "name":"Norman Walsh", "email":"norman.walsh@marklogic.com"}, "assignTo":{"username":"nobody", "name":"nobody nobody", "email":"nobody@marklogic.com"}, "description":"Running the test described below/attached results in:\r\n\r\nXDMP-RELURIBASEARG: fn:resolve-uri(\"generate-tests-utils.xsl\", \"/generate-xspec-tests.xsl\") -- Relative URI base argument to resolve-uri\r\nin /generate-xspec-tests.xsl, at 47:1 [XSLT]\r\nfn:context-item() = fn:doc(\"/generate-common-tests.xsl\")/x:description\r\nfn:position() = 1\r\nin /generate-xspec-tests.xsl, at 41:0 [XSLT]\r\nin /generate-xspec-tests.xsl, at 15:0 [XSLT]\r\nin /generate-xspec-tests.xsl, at 32:0,\r\nin xdmp:xslt-invoke(\"/generate-xspec-tests.xsl\", document{<x:description stylesheet=\"escape-for-regex.xslt\" xmlns:functx=\"http://www.functx.com\" xmlns:x=\"http://www.jenitennison.com/xslt/xspec\"/>}) [XSLT]\r\nin /rtest.xqy, at 14:2 [1.0-ml]\r\n$xspec = <x:description stylesheet=\"escape-for-regex.xslt\" xmlns:functx=\"http://www.functx.com\" xmlns:x=\"http://www.jenitennison.com/xslt/xspec\"/>\r\n\r\nBut /generate-xspec-tests.xsl isn't relative and fn:resolve-uri(\"generate-tests-utils.xsl\", \"/generate-xspec-tests.xsl\") works just fine in Query Console.\r\n", "samplequery":"Put all of the files in the attached ZIP into the root of an http appserver then load /rtest.xqy in that server.\r\n", "sampledata":"", "version":"6.0-1", "tofixin":"8.0-1", "fixedin":"8.0-1", "platform":"all", "memory":"", "processors":"", "note":"", "subscribers":[{"username":"nwalsh", "name":"Norman Walsh", "email":"norman.walsh@marklogic.com"}, {"username":"dsokolsky", "name":"Danny Sokolsky", "email":"dsokolsky@marklogic.com"}, {"username":"mary", "name":"Mary Holstege", "email":"mary@cerisent.com"}, {"username":"lratcliff", "name":"Larry Ratcliff", "email":"lratcliff@marklogic.com"}, {"username":"jjames", "name":"John James", "email":"John.James@marklogic.com"}], "attachments":[{"name":"The test case.", "uri":"root/support/bugtracking/attachments/20124/rtest.zip"}, {"name":"Description of the xdmp:version attribute and its impact", "uri":"root/support/bugtracking/attachments/20124/xdmp_dialect.txt"}], "includeInTaskList":false, "proceduralTasks":{"Requirements Task":[], "Functional Specification Task":[], "Test Specification Task":[], "Test Automation Task":[], "Documentation Task":[]}, "subTasks":[], "tags":["XSLT", "nwalsh"], "changeHistory":[{"time":"2012-11-20T08:08:36.91677-08:00", "updatedBy":{"username":"nwalsh", "name":"Norman Walsh", "email":"norman.walsh@marklogic.com"}, "change":{"status":{"from":"", "to":"Will not fix"}, "assignTo":{"from":{"username":"nwalsh", "name":"Norman Walsh", "email":"norman.walsh@marklogic.com"}, "to":{"username":"nobody", "name":"nobody nobody", "email":"nobody@marklogic.com"}}}, "files":[], "show":true, "comment":"Broken as designed, says Mary. *grumble*"}, {"time":"2012-11-20T08:19:28.738667-08:00", "updatedBy":{"username":"nwalsh", "name":"Norman Walsh", "email":"norman.walsh@marklogic.com"}, "change":{}, "files":[], "show":true, "comment":"The problem here is that XSLT processes expressions in \"1.0\" strict mode. Not unreasonable, but the fact is that many public stylesheets expect URIs that begin with a naked \"/' (as opposed to a scheme: and a \"/\"), to be treated as absolute.\r\n\r\nCertainly from the point of view of what the URI spec says about making URIs absolute, it's not a problem.\r\n\r\nI humbly propose that we add an extension to our XSLT processing to enable \"1.0-ml\" processing. Mary suggested I re-open the bug to that effect.\r\n\r\nI'd be happy with an @xdmp:version attribute on the top-level stylesheet element or a new option to the invoke/eval functions.\r\n\r\nAnything, really. It's blocking my progress on unit tests for V7.\r\n"}, {"time":"2012-11-20T08:19:28.738667-08:00", "updatedBy":{"username":"nwalsh", "name":"Norman Walsh", "email":"norman.walsh@marklogic.com"}, "change":{"status":{"from":"", "to":"New"}, "assignTo":{"from":{"username":"nwalsh", "name":"Norman Walsh", "email":"norman.walsh@marklogic.com"}, "to":{"username":"mary", "name":"Mary Holstege", "email":"mary@cerisent.com"}}}, "files":[], "show":true}, {"time":"2012-11-20T08:19:28.738667-08:00", "updatedBy":{"username":"nwalsh", "name":"Norman Walsh", "email":"norman.walsh@marklogic.com"}, "change":{"assignTo":{"from":{"username":"nwalsh", "name":"Norman Walsh", "email":"norman.walsh@marklogic.com"}, "to":{"username":"mary", "name":"Mary Holstege", "email":"mary@cerisent.com"}}}, "files":[], "show":true}, {"time":"2012-11-21T14:31:42.174883-08:00", "updatedBy":{"username":"gvaidees", "name":"Ganesh Vaideeswaran", "email":"Ganesh.Vaideeswaran@marklogic.com"}, "change":{"tofixin":{"from":"", "to":"6.0-3"}}, "files":[], "show":true}, {"time":"2012-11-21T14:32:37.918672-08:00", "updatedBy":{"username":"gvaidees", "name":"Ganesh Vaideeswaran", "email":"Ganesh.Vaideeswaran@marklogic.com"}, "change":{"status":{"from":"", "to":"Verify"}, "assignTo":{"from":{"username":"gvaidees", "name":"Ganesh Vaideeswaran", "email":"Ganesh.Vaideeswaran@marklogic.com"}, "to":{"username":"mary", "name":"Mary Holstege", "email":"mary@cerisent.com"}}}, "files":[], "show":true}, {"time":"2012-11-26T09:57:53.531428-08:00", "updatedBy":{"username":"dsokolsky", "name":"Danny Sokolsky", "email":"dsokolsky@marklogic.com"}, "change":{}, "files":[], "show":true, "comment":"I don't think we should do this.  We have another function, xdmp:resolve-uri, that does this, and if you don't want it to behave in conformance, then you should use that."}, {"time":"2012-11-27T11:48:43.6092-08:00", "updatedBy":{"username":"dsokolsky", "name":"Danny Sokolsky", "email":"dsokolsky@marklogic.com"}, "change":{}, "files":[], "show":true, "comment":"Norm, does the xdmp function unblock your unit test issue?"}, {"time":"2013-02-01T10:29:32.940976-08:00", "updatedBy":{"username":"rhu", "name":"Ron Hu", "email":"ron.hu@marklogic.com"}, "change":{}, "files":[], "show":true, "comment":"Based on Norm's comment on 11/20/2012, this is really an RFE.  change to 7.0-1."}, {"time":"2013-02-01T10:29:32.940976-08:00", "updatedBy":{"username":"rhu", "name":"Ron Hu", "email":"ron.hu@marklogic.com"}, "change":{"tofixin":{"from":"6.0-3", "to":"7.0-1"}}, "files":[], "show":true}, {"time":"2013-02-01T10:33:48.711621-08:00", "updatedBy":{"username":"dsokolsky", "name":"Danny Sokolsky", "email":"dsokolsky@marklogic.com"}, "change":{}, "files":[], "show":true, "comment":"I recommend we close this, as I don't think we should make an fn function behave against spec in an xslt context."}, {"time":"2013-05-20T09:01:44.120438-07:00", "updatedBy":{"username":"mary", "name":"Mary Holstege", "email":"mary@cerisent.com"}, "change":{}, "files":[], "show":true, "comment":"Recommend we push off to 8.0-1, and take the time to design out how we want to control ML XQuery/XPath versions in XSLT context."}, {"time":"2013-05-20T12:46:35.020496-07:00", "updatedBy":{"username":"nwalsh", "name":"Norman Walsh", "email":"norman.walsh@marklogic.com"}, "change":{}, "files":[], "show":true, "comment":"I won't stand the way of pushing it off to 8.0-1, though that seems awfully far away.\r\n\r\nThe xdmp function helps only in a very academic sense. Rewriting open source stylesheets to use xdmp: on our platform and fn: everywhere else is certainly doable, it just looks sort of lame.\r\n"}, {"time":"2013-05-20T14:03:50.529482-07:00", "updatedBy":{"username":"dsokolsky", "name":"Danny Sokolsky", "email":"dsokolsky@marklogic.com"}, "change":{}, "files":[], "show":true, "comment":"And I think the real issue here is to allow 1.0-ml equivalent for xslt."}, {"time":"2013-06-24T07:42:35.637315-07:00", "updatedBy":{"username":"mary", "name":"Mary Holstege", "email":"mary@cerisent.com"}, "change":{"tofixin":{"from":"7.0-1", "to":"8.0-1"}}, "files":[], "show":true}, {"time":"2014-10-11T09:50:04.597353-07:00", "updatedBy":{"username":"mary", "name":"Mary Holstege", "email":"mary@cerisent.com"}, "change":{"status":{"from":"Verify", "to":"Fix"}, "assignTo":{"from":{"username":"mary", "name":"Mary Holstege", "email":"mary@cerisent.com"}, "to":{"username":"mary", "name":"Mary Holstege", "email":"mary@cerisent.com"}}}, "files":[], "show":true, "comment":"The real issue here is to allow xquery-1.0ml in XSLT context"}, {"time":"2014-10-13T08:38:58.772865-07:00", "updatedBy":{"username":"mary", "name":"Mary Holstege", "email":"mary@cerisent.com"}, "change":{}, "files":[], "show":true, "svn":{"repository":"/project/engsvn", "revision":"180616", "paths":["xdmp/trunk/test/server/input/xslt/dialect5.xslt", "xdmp/trunk/test/server/input/xslt/t2.out", "xdmp/trunk/test/server/input/xslt/dialect6.out", "xdmp/trunk/test/server/input/xslt/dialect6.xslt", "xdmp/trunk/test/server/input/xslt/t1.out", "xdmp/trunk/test/server/input/xslt/dialect4.xslt", "xdmp/trunk/test/server/input/xslt/dialect2.xslt", "xdmp/trunk/test/server/input/xslt/dialect.out", "xdmp/trunk/test/server/input/xslt/dialect3.xslt", "xdmp/trunk/test/server/input/xslt/dialect3.out", "xdmp/trunk/test/server/input/xslt/dialect5.out", "xdmp/trunk/test/server/input/xslt/dialect4.out", "xdmp/trunk/test/server/input/xslt/dialect.xslt", "xdmp/trunk/test/server/input/xslt/hello2.out", "xdmp/trunk/test/server/input/xslt/dialect2.out", "xdmp/trunk/test/server/xslt.txt"], "affectedBugs":[]}, "comment":"Bug:20124 test cases for xdmp:dialect"}, {"time":"2014-10-13T08:52:42.586382-07:00", "updatedBy":{"username":"mary", "name":"Mary Holstege", "email":"mary@cerisent.com"}, "change":{}, "files":[], "show":true, "svn":{"repository":"/project/engsvn", "revision":"180618", "paths":["xdmp/trunk/src/XPathParser.cpp", "xdmp/trunk/src/XSLTParser.cpp", "xdmp/trunk/src/TypeInference.cpp", "xdmp/trunk/src/FunctionBuiltins.cpp", "xdmp/trunk/src/XPathParser.h", "xdmp/trunk/src/XSLT.h", "xdmp/trunk/src/XSLT.cpp"], "affectedBugs":[]}, "comment":"Bug:20124 xdmp:dialect attribute"}, {"time":"2014-10-16T10:42:51.72658-07:00", "updatedBy":{"username":"mary", "name":"Mary Holstege", "email":"mary@cerisent.com"}, "change":{}, "files":[], "show":true, "comment":"Added xdmp:dialect attribute.  It affects XPaths in select, match, attribute value templates, or sequence types (in \"as\" attributes).  It can be set to \"1.0-ml\", \"1.0\", \"3.0\", and \"3.1\". Anything else defaults to the standard XSLT XPath handling.  \"1.0\" differs from this in the set of functions available. The others (1.0-ml, 3.0, 3.1) vary slightly in terms of which extensions to XQuery 1.0 and which builtin functions they support.\r\n"}, {"time":"2014-11-03T16:21:39.862034-08:00", "updatedBy":{"username":"dgorbet", "name":"David Gorbet", "email":"David.Gorbet@marklogic.com"}, "change":{}, "files":[], "show":true, "comment":"Re-categorizing as task so that this continues to show up on our list of remaining work items. So Mary, I see you committed some stuff here. Is this now resolved?"}, {"time":"2014-11-26T09:17:30.08887-08:00", "updatedBy":{"username":"mary", "name":"Mary Holstege", "email":"mary@cerisent.com"}, "change":{"status":{"from":"Fix", "to":"Test"}, "assignTo":{"from":{"username":"mary", "name":"Mary Holstege", "email":"mary@cerisent.com"}, "to":{"username":"lratcliff", "name":"Larry Ratcliff", "email":"lratcliff@marklogic.com"}}}, "files":[], "show":true, "comment":"Fixed in 8.0-20141014 via introduction of xdmp:dialect attribute.\r\n\r\nDon't believe exhaustive testing is required here. Unit tests probably sufficient."}, {"time":"2014-11-26T09:17:30.08887-08:00", "updatedBy":{"username":"mary", "name":"Mary Holstege", "email":"mary@cerisent.com"}, "change":{"assignTo":{"from":{"username":"mary", "name":"Mary Holstege", "email":"mary@cerisent.com"}, "to":{"username":"lratcliff", "name":"Larry Ratcliff", "email":"lratcliff@marklogic.com"}}}, "files":[], "show":true}, {"time":"2014-12-08T13:33:30.706575-08:00", "updatedBy":{"username":"lratcliff", "name":"Larry Ratcliff", "email":"lratcliff@marklogic.com"}, "change":{"assignTo":{"from":{"username":"lratcliff", "name":"Larry Ratcliff", "email":"lratcliff@marklogic.com"}, "to":{"username":"jjames", "name":"John James", "email":"John.James@marklogic.com"}}}, "files":[], "show":true}, {"time":"2014-12-16T10:22:25.186482-08:00", "updatedBy":{"username":"jjames", "name":"John James", "email":"John.James@marklogic.com"}, "change":{"status":{"from":null, "to":"Ship"}, "assignTo":{"from":{"username":"jjames", "name":"John James", "email":"John.James@marklogic.com"}, "to":{"username":"nobody", "name":"nobody nobody", "email":"nobody@marklogic.com"}}}, "files":[], "show":true, "comment":"Confirmed in 20141215. Tests added to xsltbugs.xml\r\n"}], "updatedAt":"2014-12-16T10:22:25.186482-08:00", "fixedAt":"2014-11-26T09:17:30.08887-08:00", "fixedBy":{"username":"mary", "name":"Mary Holstege", "email":"mary@cerisent.com"}, "shippedAt":"2014-12-16T10:22:25.186482-08:00", "shippedBy":{"username":"jjames", "name":"John James", "email":"John.James@marklogic.com"}}
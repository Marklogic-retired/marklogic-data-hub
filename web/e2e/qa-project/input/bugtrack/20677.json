{"id":20677, "kind":"Bug", "createdAt":"2013-01-21T02:21:26.563201-08:00", "status":"Closed", "title":"score random always returns scores of zero for some queries", "category":"xdmp", "severity":"Major", "priority":{"level":"5", "title":""}, "submittedBy":{"username":"ableasdale", "name":"Alex Bleasdale", "email":"alex.bleasdale@marklogic.com"}, "assignTo":{"username":"nobody", "name":"nobody nobody", "email":"nobody@marklogic.com"}, "description":"A simple cts:search containing a cts:and-query with an empty sequence and with \"score-random\" set performs the query and matches documents but applies a cts:score of zero to each result returned.  \r\n\r\nThis was not the case with prior (major) releases of the server - such as MarkLogic 5 - where scores were provided as the outcome to such a query.\r\n\r\nPlease see the sample query to see the change. \r\n\r\nSupport case reference: https://help.marklogic.com/staff/Tickets/Ticket/View/12393", "samplequery":"Given an installation of MarkLogic 6 with just the defaults set:\r\n\r\n(: Load sample data:\r\nfor $i in xdmp:document-get(\"http://www.nlm.nih.gov/databases/dtd/medsamp2013.xml\")/MedlineCitationSet/MedlineCitation\r\nreturn xdmp:document-insert($i/PMID/string(), $i)\r\n:)\r\n\r\n(: Execute this Query :)\r\nfor $doc in cts:search(doc(), cts:and-query(()), (\"unfiltered\", \"score-random\"))[1 to 20]\r\nreturn concat(\"Uri: \", xdmp:node-uri($doc), \" score: \", cts:score($doc))\r\n\r\nResults from 5.0-4.1:\r\nUri: 11694165 score: 2107964173\r\nUri: 11916658 score: 2096025144\r\nUri: 15611661 score: 2044070272\r\nUri: 12219757 score: 2033032551\r\nUri: 11600211 score: 1992657273\r\nUri: 14316043 score: 1989465641\r\nUri: 12742519 score: 1984132008\r\nUri: 18941263 score: 1891276690\r\nUri: 11562649 score: 1874618498\r\nUri: 18243949 score: 1830981914\r\nUri: 12192682 score: 1825961066\r\nUri: 21007460 score: 1785108764\r\nUri: 13634534 score: 1782567199\r\nUri: 11876201 score: 1772315961\r\nUri: 14817685 score: 1767918311\r\nUri: 15968009 score: 1721813086\r\nUri: 11543891 score: 1719553532\r\nUri: 11406024 score: 1701781055\r\nUri: 11583040 score: 1693688430\r\nUri: 11620107 score: 1677474597\r\n\r\nResults from 6.0-2.1:\r\nUri: 9861576 score: 0\r\nUri: 10188493 score: 0\r\nUri: 11909345 score: 0\r\nUri: 11748851 score: 0\r\nUri: 11748856 score: 0\r\nUri: 21002435 score: 0\r\nUri: 21007460 score: 0\r\nUri: 12159900 score: 0\r\nUri: 9110943 score: 0\r\nUri: 17712873 score: 0\r\nUri: 9626910 score: 0\r\nUri: 11583040 score: 0\r\nUri: 9627170 score: 0\r\nUri: 11885531 score: 0\r\nUri: 12038483 score: 0\r\nUri: 12599353 score: 0\r\nUri: 12599354 score: 0\r\nUri: 14729922 score: 0\r\nUri: 20405411 score: 0\r\nUri: 8219565 score: 0\r\n", "sampledata":"", "version":"7.0-nightly", "tofixin":"7.0-1", "fixedin":"7.0-1", "platform":"all", "memory":"", "processors":"", "note":"", "subscribers":[{"username":"ableasdale", "name":"Alex Bleasdale", "email":"alex.bleasdale@marklogic.com"}, {"username":"iagrawal", "name":"Isha Agrawal", "email":"iagrawal@marklogic.com"}, {"username":"mary", "name":"Mary Holstege", "email":"mary@cerisent.com"}, {"username":"rpolasani", "name":"Raghu Polasani", "email":"raghu.polasani@marklogic.com"}], "attachments":[], "relationships":[{"type":"", "to":""}], "clones":[], "cloneOf":20530, "support":{"headline":"score random always returns scores of zero for some queries", "supportDescription":"A simple cts:search containing a cts:and-query with an empty sequence and with \"score-random\" set performs the query and matches documents but applies a cts:score of zero to each result returned.  ", "publishStatus":"Publish", "tickets":[], "customerImpact":{"level":"Medium", "title":"Requires significant or unnatural effort to work around issue or to prevent significant business impact"}, "workaround":""}, "tags":["xdmp", "ableasdale"], "changeHistory":[{"time":"2013-01-21T02:21:26.563201-08:00", "updatedBy":{"username":"ableasdale", "name":"Alex Bleasdale", "email":"alex.bleasdale@marklogic.com"}, "change":{"assignTo":{"from":{"username":"ableasdale", "name":"Alex Bleasdale", "email":"alex.bleasdale@marklogic.com"}, "to":{"username":"mary", "name":"Mary Holstege", "email":"mary@cerisent.com"}}}, "files":[], "show":true}, {"time":"2013-01-31T15:33:14.582802-08:00", "updatedBy":{"username":"mary", "name":"Mary Holstege", "email":"mary@cerisent.com"}, "change":{"tofixin":{"from":"", "to":"7.0-ea1"}}, "files":[], "show":true}, {"time":"2013-01-31T16:15:25.544875-08:00", "updatedBy":{"username":"mary", "name":"Mary Holstege", "email":"mary@cerisent.com"}, "change":{}, "files":[], "show":true, "svn":{"repository":"/project/engsvn", "revision":"130202", "paths":["xdmp/trunk/src/SearchBuiltins.cpp"], "affectedBugs":[]}, "comment":"Bug:20677 don't switch score-random 0-weight query to score-zero"}, {"time":"2013-01-31T16:15:52.728814-08:00", "updatedBy":{"username":"mary", "name":"Mary Holstege", "email":"mary@cerisent.com"}, "change":{"status":{"from":"", "to":"Test"}, "assignTo":{"from":{"username":"mary", "name":"Mary Holstege", "email":"mary@cerisent.com"}, "to":{"username":"rpolasani", "name":"Raghu Polasani", "email":"raghu.polasani@marklogic.com"}}}, "files":[], "show":true, "comment":"Fixed 7.0-20130201"}, {"time":"2013-01-31T16:15:52.728814-08:00", "updatedBy":{"username":"mary", "name":"Mary Holstege", "email":"mary@cerisent.com"}, "change":{"assignTo":{"from":{"username":"mary", "name":"Mary Holstege", "email":"mary@cerisent.com"}, "to":{"username":"rpolasani", "name":"Raghu Polasani", "email":"raghu.polasani@marklogic.com"}}}, "files":[], "show":true}, {"time":"2013-03-02T10:58:18.488039-08:00", "updatedBy":{"username":"rpolasani", "name":"Raghu Polasani", "email":"raghu.polasani@marklogic.com"}, "change":{}, "files":[], "show":true, "comment":"Isha, when you automate the test, make sure there are no deleted fragments after inserting the documents and before you run the query. You can do that by forcing a merge after inserting the documents. Otherwise you might see inconsistent scores in regression."}, {"time":"2013-03-02T10:58:18.488039-08:00", "updatedBy":{"username":"rpolasani", "name":"Raghu Polasani", "email":"raghu.polasani@marklogic.com"}, "change":{"assignTo":{"from":{"username":"rpolasani", "name":"Raghu Polasani", "email":"raghu.polasani@marklogic.com"}, "to":{"username":"iagrawal", "name":"Isha Agrawal", "email":"iagrawal@marklogic.com"}}}, "files":[], "show":true}, {"time":"2013-04-18T02:59:30.535138-07:00", "updatedBy":{"username":"iagrawal", "name":"Isha Agrawal", "email":"iagrawal@marklogic.com"}, "change":{"status":{"from":"", "to":"Ship"}, "assignTo":{"from":{"username":"iagrawal", "name":"Isha Agrawal", "email":"iagrawal@marklogic.com"}, "to":{"username":"nobody", "name":"nobody nobody", "email":"nobody@marklogic.com"}}}, "files":[], "show":true, "comment":"Verified on ML 20130417. Added test bug20530.xml to nightly regression."}, {"time":"2013-04-18T02:59:30.535138-07:00", "updatedBy":{"username":"iagrawal", "name":"Isha Agrawal", "email":"iagrawal@marklogic.com"}, "change":{"assignTo":{"from":{"username":"iagrawal", "name":"Isha Agrawal", "email":"iagrawal@marklogic.com"}, "to":{"username":"nobody", "name":"nobody nobody", "email":"nobody@marklogic.com"}}}, "files":[], "show":true}], "updatedAt":"2013-04-18T02:59:30.535138-07:00", "fixedAt":"2013-01-31T16:15:52.728814-08:00", "fixedBy":{"username":"mary", "name":"Mary Holstege", "email":"mary@cerisent.com"}, "shippedAt":"2013-04-18T02:59:30.535138-07:00", "shippedBy":{"username":"iagrawal", "name":"Isha Agrawal", "email":"iagrawal@marklogic.com"}, "renderDescriptionAs":"normal", "renderSampleQueryAs":"normal"}
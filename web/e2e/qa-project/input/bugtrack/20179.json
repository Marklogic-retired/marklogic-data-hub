{"id":20179, "kind":"Bug", "createdAt":"2012-12-03T06:34:02.090506-08:00", "status":"Closed", "title":"xdmp:multipart-decode() fails with XDMP:DOCNONSBIND error when namespace for xsi:type is not declared", "category":"xdmp", "severity":"Major", "priority":{"level":"5", "title":""}, "submittedBy":{"username":"mhelmstetter", "name":"Mark Helmstetter", "email":"mark.helmstetter@marklogic.com"}, "assignTo":{"username":"nobody", "name":"nobody nobody", "email":"nobody@marklogic.com"}, "description":"This is similar to the old/fixed bug 9079. xdmp:multipart-decode() will fail when a document contains an xsi:type attribute which contains a namespace prefix that's not declared. This impacts FlexRep which uses multipart encode/decode, causing these documents to fail to replicate.\r\n\r\nSee test case below.", "samplequery":"import module namespace flexrep=\"http://marklogic.com/xdmp/flexible-replication\" at \"MarkLogic/flexrep.xqy\";\r\nlet $filtered := <foo xsi:type=\"xxx:FooType\"></foo>\r\nlet $seperator := fn:concat(\"flexrep-\", xdmp:random())\r\nlet $encoded := flexrep:multipart-encode($seperator, $filtered)\r\nlet $raw := xdmp:multipart-decode($seperator, $encoded)\r\nreturn $raw", "sampledata":"", "version":"5.0-4", "tofixin":"5.0-5", "fixedin":"5.0-5", "platform":"all", "memory":"", "processors":"", "note":"", "subscribers":[{"username":"mhelmstetter", "name":"Mark Helmstetter", "email":"mark.helmstetter@marklogic.com"}, {"username":"hwu", "name":"Haitao Wu", "email":"haitao.wu@marklogic.com"}, {"username":"rpolasani", "name":"Raghu Polasani", "email":"raghu.polasani@marklogic.com"}], "attachments":[], "relationships":[{"type":"", "to":""}], "clones":[20180, 20181], "cloneOf":"", "support":{"headline":"FlexRep fails to replicate a document when it contains an xsi:type attribute which has a namespace prefix that's not declared", "supportDescription":"xdmp:multipart-decode() fails with XDMP:DOCNONSBIND error when namespace for xsi:type is not declared (for example  <foo xsi:type=\"xxx:FooType\"></foo>).  This condition will cause Flexrep to fail to replicate.", "publishStatus":"Publish", "tickets":[], "customerImpact":{"level":"N/A", "title":""}, "workaround":""}, "tags":["xdmp", "mhelmstetter"], "changeHistory":[{"time":"2012-12-03T07:46:23.468496-08:00", "updatedBy":{"username":"cjl", "name":"Christopher Lindblad", "email":"cjl@cerisent.com"}, "change":{"status":{"from":"", "to":"Fix"}, "assignTo":{"from":{"username":"cjl", "name":"Christopher Lindblad", "email":"cjl@cerisent.com"}, "to":{"username":"hwu", "name":"Haitao Wu", "email":"haitao.wu@marklogic.com"}}}, "files":[], "show":true}, {"time":"2012-12-03T07:46:23.468496-08:00", "updatedBy":{"username":"cjl", "name":"Christopher Lindblad", "email":"cjl@cerisent.com"}, "change":{"assignTo":{"from":{"username":"cjl", "name":"Christopher Lindblad", "email":"cjl@cerisent.com"}, "to":{"username":"hwu", "name":"Haitao Wu", "email":"haitao.wu@marklogic.com"}}}, "files":[], "show":true}, {"time":"2012-12-03T07:46:23.468496-08:00", "updatedBy":{"username":"cjl", "name":"Christopher Lindblad", "email":"cjl@cerisent.com"}, "change":{"tofixin":{"from":"", "to":"5.0-5"}}, "files":[], "show":true}, {"time":"2012-12-24T14:23:21.662852-08:00", "updatedBy":{"username":"hwu", "name":"Haitao Wu", "email":"haitao.wu@marklogic.com"}, "change":{}, "files":[], "show":true, "comment":"The StringParserInput used by multipart-decode current sets repair=false.  If I set repair=true, it will \"reuse\" the fix implemented for Bug 9079 in SVN R24631 and the test case passes.  I am wondering if this could cause any \"backward compatibility\" issues though.  Another option would be to expose \"repair or not\" as a configuration for flexrep (and apparently set its default to false). "}, {"time":"2013-01-07T15:13:36.139916-08:00", "updatedBy":{"username":"hwu", "name":"Haitao Wu", "email":"haitao.wu@marklogic.com"}, "change":{}, "files":[], "show":true, "comment":"talked to Wayne. He thinks it's okay to use repair=true as default and there is no need to expose this as a user configuration."}, {"time":"2013-01-07T15:35:34.326822-08:00", "updatedBy":{"username":"hwu", "name":"Haitao Wu", "email":"haitao.wu@marklogic.com"}, "change":{}, "files":[], "show":true, "svn":{"repository":"/project/engsvn", "revision":"126997", "paths":["xdmp/branches/b5_0/src/Extension.cpp"], "affectedBugs":[]}, "comment":"bug:20179 xdmp:multipart-decode() fails with XDMP:DOCNONSBIND error when namespace for xsi:type is not declared"}, {"time":"2013-01-07T15:48:16.896501-08:00", "updatedBy":{"username":"hwu", "name":"Haitao Wu", "email":"haitao.wu@marklogic.com"}, "change":{"status":{"from":"", "to":"Test"}, "assignTo":{"from":{"username":"hwu", "name":"Haitao Wu", "email":"haitao.wu@marklogic.com"}, "to":{"username":"rpolasani", "name":"Raghu Polasani", "email":"raghu.polasani@marklogic.com"}}}, "files":[], "show":true}, {"time":"2013-01-07T15:48:16.896501-08:00", "updatedBy":{"username":"hwu", "name":"Haitao Wu", "email":"haitao.wu@marklogic.com"}, "change":{"assignTo":{"from":{"username":"hwu", "name":"Haitao Wu", "email":"haitao.wu@marklogic.com"}, "to":{"username":"rpolasani", "name":"Raghu Polasani", "email":"raghu.polasani@marklogic.com"}}}, "files":[], "show":true}, {"time":"2013-01-10T15:35:46.561914-08:00", "updatedBy":{"username":"msrinivasan", "name":"Mahalakshmi Srinivasan", "email":"mahalakshmi.srinivasan@marklogic.com"}, "change":{"status":{"from":"", "to":"Ship"}, "assignTo":{"from":{"username":"msrinivasan", "name":"Mahalakshmi Srinivasan", "email":"mahalakshmi.srinivasan@marklogic.com"}, "to":{"username":"nobody", "name":"nobody nobody", "email":"nobody@marklogic.com"}}}, "files":[], "show":true, "comment":"Verified on build 5.0-20130110"}, {"time":"2013-02-25T17:07:59.912146-08:00", "updatedBy":{"username":"rpelton", "name":"Rick Pelton", "email":"rick.pelton@marklogic.com"}, "change":{"status":{"from":"", "to":"Closed"}, "assignTo":{"from":{"username":"rpelton", "name":"Rick Pelton", "email":"rick.pelton@marklogic.com"}, "to":{"username":"nobody", "name":"nobody nobody", "email":"nobody@marklogic.com"}}}, "files":[], "show":true}], "updatedAt":"2013-02-25T17:07:59.912146-08:00", "fixedAt":"2013-01-07T15:48:16.896501-08:00", "fixedBy":{"username":"hwu", "name":"Haitao Wu", "email":"haitao.wu@marklogic.com"}, "shippedAt":"2013-01-10T15:35:46.561914-08:00", "shippedBy":{"username":"msrinivasan", "name":"Mahalakshmi Srinivasan", "email":"mahalakshmi.srinivasan@marklogic.com"}, "closedAt":"2013-02-25T17:07:59.912146-08:00", "closedBy":{"username":"rpelton", "name":"Rick Pelton", "email":"rick.pelton@marklogic.com"}, "renderDescriptionAs":"normal", "renderSampleQueryAs":"normal"}
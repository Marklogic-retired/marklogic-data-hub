{"id":20141, "kind":"Bug", "createdAt":"2012-11-25T15:39:06.320199-08:00", "status":"Closed", "title":"JNLNOTOPN causing server to restart.", "category":"xdmp", "severity":"Major", "priority":{"level":"5", "title":""}, "submittedBy":{"username":"jchen", "name":"Jane Chen", "email":"jane.chen@marklogic.com"}, "assignTo":{"username":"nobody", "name":"nobody nobody", "email":"nobody@marklogic.com"}, "description":"Testing mlcp ingestion of CPoX data on a 10 node SGI cluster\r\n4 Forests per node, fast data directory on ssd\r\nSeparate client\r\n \r\nmlcp.sh import -host r01n12-bond0 -port 10001 -username admin -password admin -input_file_path /dev/shm/cpox2 -input_file_type documents -input_compressed true -document_type xml -archive_metadata_optional true -output_uri_prefix \"/pages/30/\" -mode local -fastload true -thread_count  64 -batch_size 10 -transaction_size 1 \r\n\r\nThe following errors are found in the server ErrorLog:\r\n\r\n2012-11-25 14:25:43.261 Debug: Retrying RecoveryManager::record 59 because XDMP-JNLNOTOPN: Journal not open: /ml_ssd/Forests/sgidb2-r01n17-bond0-2/Journals/Journal2-19700102000000-100809-102270-13538728646895110 (endFSN=100774, hdrEndingFSN=102270)\r\n2012-11-25 14:25:45.286 Debug: Retrying RecoveryManager::record 60 because XDMP-JNLNOTOPN: Journal not open: /ml_ssd/Forests/sgidb2-r01n17-bond0-2/Journals/Journal2-19700102000000-100809-102270-13538728646895110 (endFSN=100774, hdrEndingFSN=102270)\r\n2012-11-25 14:25:47.786 Debug: Retrying RecoveryManager::record 61 because XDMP-JNLNOTOPN: Journal not open: /ml_ssd/Forests/sgidb2-r01n17-bond0-2/Journals/Journal2-19700102000000-100809-102270-13538728646895110 (endFSN=100774, hdrEndingFSN=102270)\r\n2012-11-25 14:25:49.502 Debug: Retrying RecoveryManager::record 62 because XDMP-JNLNOTOPN: Journal not open: /ml_ssd/Forests/sgidb2-r01n17-bond0-2/Journals/Journal2-19700102000000-100809-102270-13538728646895110 (endFSN=100774, hdrEndingFSN=102270)\r\n2012-11-25 14:25:51.422 Debug: Retrying RecoveryManager::record 63 because XDMP-JNLNOTOPN: Journal not open: /ml_ssd/Forests/sgidb2-r01n17-bond0-2/Journals/Journal2-19700102000000-100809-102270-13538728646895110 (endFSN=100774, hdrEndingFSN=102270)\r\n2012-11-25 14:25:53.856 Debug: Retrying RecoveryManager::record 64 because XDMP-JNLNOTOPN: Journal not open: /ml_ssd/Forests/sgidb2-r01n17-bond0-2/Journals/Journal2-19700102000000-100809-102270-13538728646895110 (endFSN=100774, hdrEndingFSN=102270)\r\n2012-11-25 14:25:56.082 Alert: RecoveryManager::record: XDMP-JNLNOTOPN: Journal not open: /ml_ssd/Forests/sgidb2-r01n17-bond0-2/Journals/Journal2-19700102000000-100809-102270-13538728646895110 (endFSN=100774, hdrEndingFSN=102270)\r\n2012-11-25 14:25:56.313 Notice: Starting MarkLogic Server 6.0-20121115 x86_64 in /opt/MarkLogic with data in /var/opt/MarkLogic\r\n\r\nThis happens during a merge.  The client gets \"Premature EOF\" and \"Connection Refused\" exception and eventually errors out.  See bug 20120.  The complete log with Jounral Headers trace events is attached.", "samplequery":"", "sampledata":"", "version":"6.0-nightly", "tofixin":"6.0-4", "fixedin":"N/A", "platform":"all", "memory":"", "processors":"", "note":"", "subscribers":[{"username":"jchen", "name":"Jane Chen", "email":"jane.chen@marklogic.com"}, {"username":"wfeick", "name":"Wayne Feick", "email":"wfeick@marklogic.com"}, {"username":"atsoi", "name":"Arthur Tsoi", "email":"arthur.tsoi@marklogic.com"}], "attachments":[{"name":"Server log demonstrating the JNLNOTOPN problem.", "uri":"root/support/bugtracking/attachments/20141/ErrorLog.txt"}], "relationships":[{"type":"", "to":""}], "clones":[22880], "cloneOf":"", "support":{"headline":"", "supportDescription":"", "publishStatus":"Not Ready", "tickets":[], "customerImpact":{"level":"N/A", "title":""}, "workaround":""}, "tags":["xdmp", "jchen"], "changeHistory":[{"time":"2012-11-26T13:18:06.616596-08:00", "updatedBy":{"username":"jchen", "name":"Jane Chen", "email":"jane.chen@marklogic.com"}, "change":{}, "files":[], "show":true, "comment":"This only happens when the forests are configured to have fast data directory on SSD.  It stops from happening after I changed the fast data directory to be on the same disk as data directory."}, {"time":"2012-11-27T17:46:47.247493-08:00", "updatedBy":{"username":"dsokolsky", "name":"Danny Sokolsky", "email":"dsokolsky@marklogic.com"}, "change":{"status":{"from":"", "to":"Verify"}, "assignTo":{"from":{"username":"dsokolsky", "name":"Danny Sokolsky", "email":"dsokolsky@marklogic.com"}, "to":{"username":"wfeick", "name":"Wayne Feick", "email":"wfeick@marklogic.com"}}}, "files":[], "show":true}, {"time":"2012-11-27T17:46:47.247493-08:00", "updatedBy":{"username":"dsokolsky", "name":"Danny Sokolsky", "email":"dsokolsky@marklogic.com"}, "change":{"assignTo":{"from":{"username":"dsokolsky", "name":"Danny Sokolsky", "email":"dsokolsky@marklogic.com"}, "to":{"username":"wfeick", "name":"Wayne Feick", "email":"wfeick@marklogic.com"}}}, "files":[], "show":true}, {"time":"2012-11-27T17:46:47.247493-08:00", "updatedBy":{"username":"dsokolsky", "name":"Danny Sokolsky", "email":"dsokolsky@marklogic.com"}, "change":{"tofixin":{"from":"", "to":"6.0-3"}}, "files":[], "show":true}, {"time":"2012-11-27T17:52:48.264634-08:00", "updatedBy":{"username":"wfeick", "name":"Wayne Feick", "email":"wfeick@marklogic.com"}, "change":{"assignTo":{"from":{"username":"wfeick", "name":"Wayne Feick", "email":"wfeick@marklogic.com"}, "to":{"username":"atsoi", "name":"Arthur Tsoi", "email":"arthur.tsoi@marklogic.com"}}}, "files":[], "show":true}, {"time":"2013-02-27T13:39:48.231089-08:00", "updatedBy":{"username":"rhu", "name":"Ron Hu", "email":"ron.hu@marklogic.com"}, "change":{"tofixin":{"from":"6.0-3", "to":"6.0-4"}}, "files":[], "show":true}, {"time":"2013-05-21T13:04:51.76903-07:00", "updatedBy":{"username":"wfeick", "name":"Wayne Feick", "email":"wfeick@marklogic.com"}, "change":{}, "files":[], "show":true, "comment":"This seems important enough to me to keep it in 6.0-4."}, {"time":"2013-06-24T13:30:05.379188-07:00", "updatedBy":{"username":"dsokolsky", "name":"Danny Sokolsky", "email":"dsokolsky@marklogic.com"}, "change":{}, "files":[], "show":true, "comment":"Jane thinks this is the same as http://bugtrack.marklogic.com/21487.  Let's try and fix this for 6.0-4."}, {"time":"2013-06-24T13:34:00.14291-07:00", "updatedBy":{"username":"wfeick", "name":"Wayne Feick", "email":"wfeick@marklogic.com"}, "change":{}, "files":[], "show":true, "comment":"We have lab machines with SSDs, so please try to replicate on one of those."}, {"time":"2013-07-10T11:49:10.695837-07:00", "updatedBy":{"username":"atsoi", "name":"Arthur Tsoi", "email":"arthur.tsoi@marklogic.com"}, "change":{}, "files":[], "show":true, "comment":"Jane,\r\n\r\nI used mlcp to load the data on a machine with fast data directory on SDD.\r\nBut I cannot reproduce the problem. I tried couple times.\r\nDenis also said he has not seen this for a while.\r\n\r\nDid you make any change that might fix this?\r\n\r\nArthur"}, {"time":"2013-07-10T11:56:48.346805-07:00", "updatedBy":{"username":"jchen", "name":"Jane Chen", "email":"jane.chen@marklogic.com"}, "change":{}, "files":[], "show":true, "comment":"I honestly wish I did.  If you are running against MarkLogic 6, I really didn't touch it.  For 21487, I put in a couple of minor changes in trunk to handle error conditions and improve logging.  \r\n\r\nDid you ever see missing journal files or number of journal files >2?"}, {"time":"2013-07-12T14:24:32.445839-07:00", "updatedBy":{"username":"rhu", "name":"Ron Hu", "email":"ron.hu@marklogic.com"}, "change":{}, "files":[], "show":true, "comment":"CJL suggested that you use /tmp directory instead of SSD.  This is because /tmp resides in memory.  So it is very fast.  After trying /tmp directory and you still cannot reproduce this problem, then you can close this bug."}, {"time":"2013-07-12T22:42:43.197389-07:00", "updatedBy":{"username":"atsoi", "name":"Arthur Tsoi", "email":"arthur.tsoi@marklogic.com"}, "change":{"status":{"from":"", "to":"Closed"}, "assignTo":{"from":{"username":"atsoi", "name":"Arthur Tsoi", "email":"arthur.tsoi@marklogic.com"}, "to":{"username":"nobody", "name":"nobody nobody", "email":"nobody@marklogic.com"}}}, "files":[], "show":true, "comment":"I cannot reproduce the problem with /tmp. "}], "updatedAt":"2013-07-12T22:42:43.197389-07:00", "closedAt":"2013-07-12T22:42:43.197389-07:00", "closedBy":{"username":"atsoi", "name":"Arthur Tsoi", "email":"arthur.tsoi@marklogic.com"}, "renderDescriptionAs":"normal"}
{"id":20259, "kind":"Bug", "createdAt":"2012-12-11T21:57:50.738898-08:00", "status":"Closed", "title":"\"MLConnector:DocUpload: Thread was being aborted\" thrown while uploading large amounts of documents from SP to ML (via ML-SP connector)", "category":"SharePoint Connector", "severity":"Major", "priority":{"level":"5", "title":""}, "submittedBy":{"username":"gvaidees", "name":"Ganesh Vaideeswaran", "email":"Ganesh.Vaideeswaran@marklogic.com"}, "assignTo":{"username":"nobody", "name":"nobody nobody", "email":"nobody@marklogic.com"}, "description":"This was reported by Preston as part of ML-SP testing for SOCOM. Also, see 20087 for some context. The error in ML connector log is - \r\n\r\n2012-12-11 20:36:22.654 Error: MLAdmin.Upload: UPLOAD failed http://w2k8-intel64-1/50kdocs/b (10667).xml: MLConnector:DocUpload: Thread was being aborted.\r\n2012-12-11 20:36:22.654 Error: MLAdmin.CopyFolder: UPLOAD failed 50kdocs/b (10667).xml: list 1 Document not found; send content\r\n\r\nThis seems to be a SP specific error where it looks like a thread is timing out.\r\n\r\nIn this scenario, we had about 26,000 documents in a SP site that we pushed to ML. After 9286 documents being ingested in ML, we see the above error", "samplequery":"", "sampledata":"", "version":"5.0-1", "tofixin":"5.0-5", "fixedin":"N/A", "platform":"all", "memory":"", "processors":"", "note":"Related to bug 20087", "subscribers":[{"username":"gvaidees", "name":"Ganesh Vaideeswaran", "email":"Ganesh.Vaideeswaran@marklogic.com"}, {"username":"crichey", "name":"Clark Richey", "email":"clark.richey@marklogic.com"}, {"username":"msarma", "name":"Meghalim Sarma", "email":"msarma@marklogic.com"}, {"username":"dgorbet", "name":"David Gorbet", "email":"David.Gorbet@marklogic.com"}, {"username":"jespinoza", "name":"Jose Espinoza", "email":"jespinoza@marklogic.com"}, {"username":"pmcgowan", "name":"Preston McGowan", "email":"Preston.McGowan@marklogic.com"}, {"username":"rpelton", "name":"Rick Pelton", "email":"rick.pelton@marklogic.com"}, {"username":"sreddy", "name":"Sudhakar Reddy", "email":"sreddy@marklogic.com"}], "attachments":[], "relationships":[{"type":"", "to":""}], "clones":[], "cloneOf":"", "support":{"headline":"", "supportDescription":"", "publishStatus":"Never Publish", "tickets":[], "customerImpact":{"level":"N/A", "title":""}, "workaround":""}, "tags":["SharePoint Connector", "gvaidees"], "changeHistory":[{"time":"2012-12-11T21:57:50.738898-08:00", "updatedBy":{"username":"gvaidees", "name":"Ganesh Vaideeswaran", "email":"Ganesh.Vaideeswaran@marklogic.com"}, "change":{"assignTo":{"from":{"username":"gvaidees", "name":"Ganesh Vaideeswaran", "email":"Ganesh.Vaideeswaran@marklogic.com"}, "to":{"username":"gvaidees", "name":"Ganesh Vaideeswaran", "email":"Ganesh.Vaideeswaran@marklogic.com"}}}, "files":[], "show":true}, {"time":"2012-12-11T23:23:36.179998-08:00", "updatedBy":{"username":"gvaidees", "name":"Ganesh Vaideeswaran", "email":"Ganesh.Vaideeswaran@marklogic.com"}, "change":{}, "files":[], "show":true, "comment":"I increased a timeout setting in a web.config file in SP and I was able to push more than 9286 documents (Pushed ~15,000 documents).\r\n\r\nWe will ingest 50,000 documents in a SP site and push it tomorrow. And if that succeeds, move onto a larger number.\r\n\r\nAnother test we will run tomorrow would be to pre-populate ML with 1 million documents and then push 50,000 and 100,000 documents from SP to ML "}, {"time":"2012-12-14T11:19:28.584403-08:00", "updatedBy":{"username":"sreddy", "name":"Sudhakar Reddy", "email":"sreddy@marklogic.com"}, "change":{}, "files":[], "show":true, "comment":"I was able to mirror 80k+ documents without issues. Will try to mirror 100k documents and update."}, {"time":"2012-12-14T13:11:24.834841-08:00", "updatedBy":{"username":"gvaidees", "name":"Ganesh Vaideeswaran", "email":"Ganesh.Vaideeswaran@marklogic.com"}, "change":{}, "files":[], "show":true, "comment":"I had to change web.config file under C:\\Program Files\\Common Files\\Microsoft Shared\\Web Server Extensions\\14\\TEMPLATE\\LAYOUTS \r\n\r\n(Note: the exact location could change based on SP version)\r\n\r\nI set httpRuntime executionTimeout to be \"3600000\" in web.config. It was set to 360.\r\n"}, {"time":"2012-12-14T21:20:53.738456-08:00", "updatedBy":{"username":"gvaidees", "name":"Ganesh Vaideeswaran", "email":"Ganesh.Vaideeswaran@marklogic.com"}, "change":{}, "files":[], "show":true, "comment":"Some more finding\r\n\r\n1. If we add, delete or update files, an even is fired for each of these operations that does the corresponding action on MarkLogic\r\n2. If we click on the \"Push to Server\" button, for every file in a SP library, we check for the corresponding file in MarkLogic to see if the file exists and then see what action to take. This could be very expensive. So, Push to Server should be used as a one-time operation"}, {"time":"2012-12-19T20:42:50.520307-08:00", "updatedBy":{"username":"gvaidees", "name":"Ganesh Vaideeswaran", "email":"Ganesh.Vaideeswaran@marklogic.com"}, "change":{}, "files":[], "show":true, "comment":"Preston,\r\n\r\nCan you try this in your SP environment. Under the C:\\Program Files\\Common Files\\Microsoft Shared\\Web Server Extensions\\14\\TEMPLATE\\LAYOUTS\\MarkLogicConnector directory\r\n\r\n(Exact location could be slightly different for you)\r\n\r\ncreate a file called web.config and add the lines given below and rerun your test to push 30,000 documents to MarkLogic. Make sure to reset the  executionTimeout  in web.config under C:\\Program Files\\Common Files\\Microsoft Shared\\Web Server Extensions\\14\\TEMPLATE\\LAYOUTS to what it was before. Let me know if this works. We now set the timeout for the ML connector aspx alone. I have pushed 51,000 documents to ML (it took about 20 mins) and it did not time out. Make sure to restart SP \r\n\r\n<?xml version=\"1.0\" encoding=\"UTF-8\" standalone=\"yes\"?>\r\n<configuration>\r\n  <system.web>\r\n    <compilation batch=\"false\" batchTimeout=\"600\" maxBatchSize=\"10000\" maxBatchGeneratedFileSize=\"10000\" />\r\n    <customErrors mode=\"On\" />\r\n    <httpRuntime executionTimeout=\"3600000\" />\r\n  </system.web>\r\n</configuration>"}, {"time":"2012-12-23T12:56:59.852513-08:00", "updatedBy":{"username":"gvaidees", "name":"Ganesh Vaideeswaran", "email":"Ganesh.Vaideeswaran@marklogic.com"}, "change":{}, "files":[], "show":true, "comment":"Preston tested this and was able to verify it works. We will get the customer an updated version of SP Connector that will include the \r\n\r\n- XQuery side changes for bug 20087 and \r\n- this fix\r\n\r\nI also think that we should update the new SP connector to use latest XCC dlls (6.0-2). Also, if the customer will use ML 6.0-x, there are options such as REST APIs that we could consider to improve performance and it may make it easier to add certain features"}, {"time":"2012-12-23T12:59:04.319973-08:00", "updatedBy":{"username":"gvaidees", "name":"Ganesh Vaideeswaran", "email":"Ganesh.Vaideeswaran@marklogic.com"}, "change":{}, "files":[], "show":true, "comment":"I also added a feature to \"Bulk Push\" content from SP sites to ML (this is to be used for the initial bulk load). This will not be part of the next version of SP connector\r\n\r\nI also think that we can further optimize by sending props and content in one shot (if we used REST APIs). This would require ML version to be 6.0-x"}, {"time":"2012-12-30T15:16:20.036357-08:00", "updatedBy":{"username":"gvaidees", "name":"Ganesh Vaideeswaran", "email":"Ganesh.Vaideeswaran@marklogic.com"}, "change":{}, "files":[], "show":true, "comment":"svnr 126013: Checked in web.config with http timeout of 24 hrs"}, {"time":"2012-12-30T15:16:20.036357-08:00", "updatedBy":{"username":"gvaidees", "name":"Ganesh Vaideeswaran", "email":"Ganesh.Vaideeswaran@marklogic.com"}, "change":{"status":{"from":"", "to":"Test"}, "assignTo":{"from":{"username":"gvaidees", "name":"Ganesh Vaideeswaran", "email":"Ganesh.Vaideeswaran@marklogic.com"}, "to":{"username":"sreddy", "name":"Sudhakar Reddy", "email":"sreddy@marklogic.com"}}}, "files":[], "show":true}, {"time":"2012-12-30T15:16:20.036357-08:00", "updatedBy":{"username":"gvaidees", "name":"Ganesh Vaideeswaran", "email":"Ganesh.Vaideeswaran@marklogic.com"}, "change":{"assignTo":{"from":{"username":"gvaidees", "name":"Ganesh Vaideeswaran", "email":"Ganesh.Vaideeswaran@marklogic.com"}, "to":{"username":"sreddy", "name":"Sudhakar Reddy", "email":"sreddy@marklogic.com"}}}, "files":[], "show":true}, {"time":"2013-01-08T12:54:25.955794-08:00", "updatedBy":{"username":"sreddy", "name":"Sudhakar Reddy", "email":"sreddy@marklogic.com"}, "change":{"status":{"from":"", "to":"Ship"}, "assignTo":{"from":{"username":"sreddy", "name":"Sudhakar Reddy", "email":"sreddy@marklogic.com"}, "to":{"username":"nobody", "name":"nobody nobody", "email":"nobody@marklogic.com"}}}, "files":[], "show":true, "comment":"pushed 50k docs, no issues."}, {"time":"2013-01-08T12:54:25.955794-08:00", "updatedBy":{"username":"sreddy", "name":"Sudhakar Reddy", "email":"sreddy@marklogic.com"}, "change":{"assignTo":{"from":{"username":"sreddy", "name":"Sudhakar Reddy", "email":"sreddy@marklogic.com"}, "to":{"username":"nobody", "name":"nobody nobody", "email":"nobody@marklogic.com"}}}, "files":[], "show":true}, {"time":"2013-03-04T16:20:07.533169-08:00", "updatedBy":{"username":"rpelton", "name":"Rick Pelton", "email":"rick.pelton@marklogic.com"}, "change":{}, "files":[], "show":true, "comment":"Ganesh, \r\n\r\nThis bug says to be fixed in 5.0-5 and ship. Can you set the \"fixed in\"and \"to be fixed in\"appropriately - probably should be a version of the sharepoint connector and not tied to MLS version.\r\n\r\nThanks "}, {"time":"2013-03-22T13:42:42.576108-07:00", "updatedBy":{"username":"dsokolsky", "name":"Danny Sokolsky", "email":"dsokolsky@marklogic.com"}, "change":{"status":{"from":"", "to":"Closed"}, "assignTo":{"from":{"username":"dsokolsky", "name":"Danny Sokolsky", "email":"dsokolsky@marklogic.com"}, "to":{"username":"nobody", "name":"nobody nobody", "email":"nobody@marklogic.com"}}}, "files":[], "show":true}], "updatedAt":"2013-03-22T13:42:42.576108-07:00", "fixedAt":"2012-12-30T15:16:20.036357-08:00", "fixedBy":{"username":"gvaidees", "name":"Ganesh Vaideeswaran", "email":"Ganesh.Vaideeswaran@marklogic.com"}, "shippedAt":"2013-01-08T12:54:25.955794-08:00", "shippedBy":{"username":"sreddy", "name":"Sudhakar Reddy", "email":"sreddy@marklogic.com"}, "closedAt":"2013-03-22T13:42:42.576108-07:00", "closedBy":{"username":"dsokolsky", "name":"Danny Sokolsky", "email":"dsokolsky@marklogic.com"}, "renderDescriptionAs":"normal"}
{"id":20272, "kind":"Bug", "createdAt":"2012-09-11T22:25:59.879148-07:00", "status":"Will not fix", "title":"Copy-namespaces doesn't behave correctly in xdmp:xslt-eval/xslt-invoke", "category":"XSLT", "severity":"Minor", "priority":{"level":"5", "title":""}, "submittedBy":{"username":"dchander", "name":"Dinesh Chander", "email":"dinesh.chander@globallogic.com"}, "assignTo":{"username":"nobody", "name":"nobody nobody", "email":"nobody@marklogic.com"}, "description":"Reported by user in case #11796\r\n------------------------------------------------------------------------------------------------------------\r\nAccording to the XSLT2 spec:\r\n“The xsl:copy instruction has an optional copy-namespaces attribute, with the value yes or no. The default value is yes. The attribute is used only when copying element nodes. If the value is set to yes, or is omitted, then all the namespace nodes of the source element are copied as namespace nodes for the result element. These copied namespace nodes are prepended to the sequence produced as a result of evaluating the sequence constructor (it is immaterial whether they come before or after any attribute nodes produced by expanding the use-attribute-sets attribute). If the value is set to no, then the namespace nodes are not copied. However, namespace nodes will still be added to the result element as required by the namespace fixup process: see 5.7.3 Namespace Fixup.”\r\n\r\nIn this case, the namespace declaration “xmlns:temp=http://temp” should be removed because of the copy-namespaces=\"no\" set in the identity template.", "samplequery":"Given a source XML document:\r\n<root xmlns:temp=\"http://temp\" xmlns:keep=\"http://keep\">\r\n<wrapper><temp:x>A</temp:x>BC<temp:x>D</temp:x></wrapper>\r\n<keep:me>XYZ</keep:me>\r\n</root>\r\n\r\nAnd XSLT:\r\n<xsl:stylesheet version=\"2.0\" xmlns:xsl=\"http://www.w3.org/1999/XSL/Transform\" xmlns:temp=\"http://temp\" xmlns:keep=\"http://keep\"\r\nexclude-result-prefixes=\"#all\">\r\n\r\n<xsl:template match=\"@*|node()\">\r\n<xsl:copy copy-namespaces=\"no\">\r\n<xsl:apply-templates select=\"@*|node()\" />\r\n</xsl:copy>\r\n</xsl:template>\r\n\r\n<xsl:template match=\"temp:x\">\r\n<xsl:apply-templates />\r\n</xsl:template>\r\n\r\n</xsl:stylesheet>\r\n\r\nResults from xdmp:xslt-eval() and xdmp:xslt-invoke() are:\r\n<root xmlns:temp=\"http://temp\" xmlns:keep=\"http://keep\">\r\n<wrapper>ABCD</wrapper>\r\n<keep:me>XYZ</keep:me>\r\n</root>\r\n\r\nThe correct output should be:\r\n<root xmlns:keep=\"http://keep\">\r\n<wrapper>ABCD</wrapper>\r\n<keep:me>XYZ</keep:me>\r\n</root>\r\n\r\nRunning the same XML/XSL through Saxon 9 results in this output. Other available online tools (e.g. http://xslttest.appspot.com) are also working fine. Here's the output.\r\n<?xml version=\"1.0\" encoding=\"UTF-8\"?>\r\n<root>\r\n<wrapper>ABCD</wrapper>\r\n<keep:me xmlns:keep=\"http://keep\">XYZ</keep:me>\r\n</root>", "sampledata":"", "version":"7.0-nightly", "tofixin":"N/A", "fixedin":"N/A", "platform":"all", "memory":"", "processors":"", "note":"", "subscribers":[{"username":"dchander", "name":"Dinesh Chander", "email":"dinesh.chander@globallogic.com"}], "attachments":[], "relationships":[{"type":"", "to":""}], "clones":[], "cloneOf":19282, "support":{"headline":"", "supportDescription":"", "publishStatus":"Not Ready", "tickets":[], "customerImpact":{"level":"Medium", "title":"Requires significant or unnatural effort to work around issue or to prevent significant business impact"}, "workaround":""}, "tags":["XSLT", "dchander"], "changeHistory":[{"time":"2012-09-12T17:06:56.196645-07:00", "updatedBy":{"username":"rhu", "name":"Ron Hu", "email":"ron.hu@marklogic.com"}, "change":{"status":{"from":"", "to":"Verify"}, "assignTo":{"from":{"username":"rhu", "name":"Ron Hu", "email":"ron.hu@marklogic.com"}, "to":{"username":"jsnelson", "name":"John Snelson", "email":"jsnelson@marklogic.com"}}}, "files":[], "show":true}, {"time":"2012-09-12T17:06:56.196645-07:00", "updatedBy":{"username":"rhu", "name":"Ron Hu", "email":"ron.hu@marklogic.com"}, "change":{"assignTo":{"from":{"username":"rhu", "name":"Ron Hu", "email":"ron.hu@marklogic.com"}, "to":{"username":"jsnelson", "name":"John Snelson", "email":"jsnelson@marklogic.com"}}}, "files":[], "show":true}, {"time":"2012-09-12T17:06:56.196645-07:00", "updatedBy":{"username":"rhu", "name":"Ron Hu", "email":"ron.hu@marklogic.com"}, "change":{"tofixin":{"from":"", "to":"5.0-4"}}, "files":[], "show":true}, {"time":"2012-09-12T17:16:05.350733-07:00", "updatedBy":{"username":"jsnelson", "name":"John Snelson", "email":"jsnelson@marklogic.com"}, "change":{}, "files":[], "show":true, "comment":"This is a little feature, and can safely be pushed to 5.0-5 unless this is an urgent customer issue."}, {"time":"2012-09-12T17:16:05.350733-07:00", "updatedBy":{"username":"jsnelson", "name":"John Snelson", "email":"jsnelson@marklogic.com"}, "change":{"tofixin":{"from":"5.0-4", "to":"5.0-5"}}, "files":[], "show":true}, {"time":"2012-12-12T18:04:55.204576-08:00", "updatedBy":{"username":"wfeick", "name":"Wayne Feick", "email":"wfeick@marklogic.com"}, "change":{"tofixin":{"from":"", "to":"7.0-1"}}, "files":[], "show":true}, {"time":"2013-05-15T09:21:15.333909-07:00", "updatedBy":{"username":"jsnelson", "name":"John Snelson", "email":"jsnelson@marklogic.com"}, "change":{"tofixin":{"from":"7.0-1", "to":"N/A"}}, "files":[], "show":true}, {"time":"2013-07-18T16:19:37.120224-07:00", "updatedBy":{"username":"rpelton", "name":"Rick Pelton", "email":"rick.pelton@marklogic.com"}, "change":{"tofixin":{"from":"N/A", "to":"8.0-1"}}, "files":[], "show":true}, {"time":"2013-07-18T16:22:30.936766-07:00", "updatedBy":{"username":"rpelton", "name":"Rick Pelton", "email":"rick.pelton@marklogic.com"}, "change":{"status":{"from":"", "to":"Will not fix"}, "assignTo":{"from":{"username":"rpelton", "name":"Rick Pelton", "email":"rick.pelton@marklogic.com"}, "to":{"username":"nobody", "name":"nobody nobody", "email":"nobody@marklogic.com"}}}, "files":[], "show":true, "comment":"set tbf of original to 8.01.  All other clones closed as will not fix."}, {"time":"2013-07-18T16:22:30.936766-07:00", "updatedBy":{"username":"rpelton", "name":"Rick Pelton", "email":"rick.pelton@marklogic.com"}, "change":{"tofixin":{"from":"8.0-1", "to":"N/A"}}, "files":[], "show":true}], "updatedAt":"2013-07-18T16:22:30.936766-07:00", "renderDescriptionAs":"normal", "renderSampleQueryAs":"normal"}
{"id":20320, "kind":"Bug", "createdAt":"2012-12-10T10:45:00.791824-08:00", "status":"Closed", "title":"xdmp:node-replace() on root node of a binary document does not work", "category":"xdmp", "severity":"Major", "priority":{"level":"5", "title":""}, "submittedBy":{"username":"mhelmstetter", "name":"Mark Helmstetter", "email":"mark.helmstetter@marklogic.com"}, "assignTo":{"username":"nobody", "name":"nobody nobody", "email":"nobody@marklogic.com"}, "description":"In 5.0-4, if I do xdmp:node-replace() on the root node of a binary document, the resulting document is empty. See sample query below for test case.", "samplequery":"(: Sample 1 :)\r\nxdmp:document-insert(\"/test/binary.gif\",binary{xs:hexBinary(xs:base64Binary(\"R0lGODlhQAASAKIAAKAALl0AG5gAMvLrzvTu1////wAAAAAAACH5BAEAAAUALAAAAABAABIAAANuCErc/jDKSZW1bOjNu/9gKArClYloqo4kcK5wnJKCbN8fje+kHfQy4E0IC/xsxGBNZlzGiDRndBN1Fo1I6TLZAyZVxkCWui3rvNZVeKxBD9xuJlZ51rWnb3xsvevLxX6BYHOChSB8hokciIqKYQkAOw==\"))})\r\n;\r\nxdmp:node-replace(fn:doc(\"/test/binary.gif\")/node(), binary{xs:hexBinary(xs:base64Binary(\"R0lGODlhQAASAKIAAKAALl0AG5gAMvLrzvTu1////wAAAAAAACH5BAEAAAUALAAAAABAABIAAANuCErc/jDKSZW1bOjNu/9gKArClYloqo4kcK5wnJKCbN8fje+kHfQy4E0IC/xsxGBNZlzGiDRndBN1Fo1I6TLZAyZVxkCWui3rvNZVeKxBD9xuJlZ51rWnb3xsvevLxX6BYHOChSB8hokciIqKYQkAOw==\"))})\r\n;\r\nxdmp:describe(fn:doc(\"/test/binary.gif\")/node())\r\n\r\n==>\r\n()\r\n\r\n(: Sample 2 :)\r\nxdmp:document-insert(\"/test/binary.gif\",binary{xs:hexBinary(xs:base64Binary(\"R0lGODlhQAASAKIAAKAALl0AG5gAMvLrzvTu1////wAAAAAAACH5BAEAAAUALAAAAABAABIAAANuCErc/jDKSZW1bOjNu/9gKArClYloqo4kcK5wnJKCbN8fje+kHfQy4E0IC/xsxGBNZlzGiDRndBN1Fo1I6TLZAyZVxkCWui3rvNZVeKxBD9xuJlZ51rWnb3xsvevLxX6BYHOChSB8hokciIqKYQkAOw==\"))})\r\n;\r\nxdmp:node-replace(fn:doc(\"/test/binary.gif\")/node(), xdmp:document-get(\"/opt/MarkLogic/Admin/images/narrow-load-fg.gif\")/node())\r\n;\r\nxdmp:describe(fn:doc(\"/test/binary.gif\")/node())\r\n\r\n==>\r\n()", "sampledata":"", "version":"6.0-1", "tofixin":"6.0-3", "fixedin":"6.0-3", "platform":"all", "memory":"", "processors":"", "note":"", "subscribers":[{"username":"mhelmstetter", "name":"Mark Helmstetter", "email":"mark.helmstetter@marklogic.com"}, {"username":"hwu", "name":"Haitao Wu", "email":"haitao.wu@marklogic.com"}, {"username":"rpolasani", "name":"Raghu Polasani", "email":"raghu.polasani@marklogic.com"}, {"username":"msrinivasan", "name":"Mahalakshmi Srinivasan", "email":"mahalakshmi.srinivasan@marklogic.com"}], "attachments":[], "relationships":[{"type":"", "to":""}], "clones":[], "cloneOf":20236, "support":{"headline":"xdmp:node-replace() on root node of a binary document does not work", "supportDescription":"After calling xdmp:node-replace() on root node of a binary document,  the resulting document is empty.", "publishStatus":"Publish", "tickets":[], "customerImpact":{"level":"N/A", "title":""}, "workaround":"node-replace the document node rather than the root node"}, "tags":["xdmp", "mhelmstetter"], "changeHistory":[{"time":"2012-12-10T10:48:58.96336-08:00", "updatedBy":{"username":"mhelmstetter", "name":"Mark Helmstetter", "email":"mark.helmstetter@marklogic.com"}, "change":{}, "files":[], "show":true, "comment":"Another workaround that I just discovered is to node-replace the document node rather than the root node, e.g. xdmp:node-replace(fn:doc(\"/test/binary.gif\"), document{xdmp:document-get(\"/opt/MarkLogic/Admin/images/narrow-load-fg.gif\")}"}, {"time":"2012-12-11T07:13:18.259751-08:00", "updatedBy":{"username":"cjl", "name":"Christopher Lindblad", "email":"cjl@cerisent.com"}, "change":{"status":{"from":"", "to":"Verify"}, "assignTo":{"from":{"username":"cjl", "name":"Christopher Lindblad", "email":"cjl@cerisent.com"}, "to":{"username":"hwu", "name":"Haitao Wu", "email":"haitao.wu@marklogic.com"}}}, "files":[], "show":true, "comment":" "}, {"time":"2012-12-11T07:13:18.259751-08:00", "updatedBy":{"username":"cjl", "name":"Christopher Lindblad", "email":"cjl@cerisent.com"}, "change":{"assignTo":{"from":{"username":"cjl", "name":"Christopher Lindblad", "email":"cjl@cerisent.com"}, "to":{"username":"hwu", "name":"Haitao Wu", "email":"haitao.wu@marklogic.com"}}}, "files":[], "show":true}, {"time":"2012-12-11T07:13:18.259751-08:00", "updatedBy":{"username":"cjl", "name":"Christopher Lindblad", "email":"cjl@cerisent.com"}, "change":{"tofixin":{"from":"", "to":"5.0-5"}}, "files":[], "show":true}, {"time":"2012-12-20T11:09:49.340876-08:00", "updatedBy":{"username":"hwu", "name":"Haitao Wu", "email":"haitao.wu@marklogic.com"}, "change":{}, "files":[], "show":true, "comment":"I tried the test cases on 4.2 and they show the same results."}, {"time":"2012-12-20T11:49:47.450784-08:00", "updatedBy":{"username":"hwu", "name":"Haitao Wu", "email":"haitao.wu@marklogic.com"}, "change":{}, "files":[], "show":true, "comment":"The two cases (node() vs. document) go through slightly different code path although both end up creating a NodeReplaceUpdate (apparently with different node kind). The same flow works fine for text."}, {"time":"2012-12-20T16:33:30.908942-08:00", "updatedBy":{"username":"hwu", "name":"Haitao Wu", "email":"haitao.wu@marklogic.com"}, "change":{}, "files":[], "show":true, "svn":{"repository":"/project/engsvn", "revision":"124875", "paths":["xdmp/branches/b5_0/src/UpdateBuiltins.cpp", "xdmp/branches/b5_0/src/Tree.h", "xdmp/branches/b5_0/src/Tree.cpp"], "affectedBugs":[]}, "comment":"bug:20236 xdmp:node-replace() on root node of a binary document does not work"}, {"time":"2012-12-20T17:00:51.559979-08:00", "updatedBy":{"username":"hwu", "name":"Haitao Wu", "email":"haitao.wu@marklogic.com"}, "change":{"tofixin":{"from":"", "to":"6.0-3"}}, "files":[], "show":true}, {"time":"2012-12-20T17:01:45.444449-08:00", "updatedBy":{"username":"hwu", "name":"Haitao Wu", "email":"haitao.wu@marklogic.com"}, "change":{}, "files":[], "show":true, "svn":{"repository":"/project/engsvn", "revision":"124883", "paths":["xdmp/branches/b6_0/src/Tree.cpp", "xdmp/branches/b6_0/src/Tree.h", "xdmp/branches/b6_0/src/UpdateBuiltins.cpp"], "affectedBugs":[]}, "comment":"bug:20320 xdmp:node-replace() on root node of a binary document does not work"}, {"time":"2012-12-20T17:09:50.985605-08:00", "updatedBy":{"username":"hwu", "name":"Haitao Wu", "email":"haitao.wu@marklogic.com"}, "change":{}, "files":[], "show":true, "svn":{"repository":"/project/engsvn", "revision":"124884", "paths":["xdmp/trunk/src/Tree.cpp", "xdmp/trunk/src/Tree.h", "xdmp/trunk/src/UpdateBuiltins.cpp"], "affectedBugs":[]}, "comment":"bug:20320 xdmp:node-replace() on root node of a binary document does not work"}, {"time":"2012-12-20T18:37:58.908388-08:00", "updatedBy":{"username":"hwu", "name":"Haitao Wu", "email":"haitao.wu@marklogic.com"}, "change":{}, "files":[], "show":true, "svn":{"repository":"/project/engsvn", "revision":"124895", "paths":["xdmp/branches/b6_0/src/UpdateBuiltins.cpp"], "affectedBugs":[]}, "comment":"bug:20320 xdmp:node-replace() on root node of a binary document does not work"}, {"time":"2012-12-20T18:43:32.705392-08:00", "updatedBy":{"username":"hwu", "name":"Haitao Wu", "email":"haitao.wu@marklogic.com"}, "change":{}, "files":[], "show":true, "svn":{"repository":"/project/engsvn", "revision":"124896", "paths":["xdmp/trunk/src/UpdateBuiltins.cpp"], "affectedBugs":[]}, "comment":"bug:20320 xdmp:node-replace() on root node of a binary document does not work"}, {"time":"2012-12-20T18:45:12.921118-08:00", "updatedBy":{"username":"hwu", "name":"Haitao Wu", "email":"haitao.wu@marklogic.com"}, "change":{"status":{"from":"", "to":"Test"}, "assignTo":{"from":{"username":"hwu", "name":"Haitao Wu", "email":"haitao.wu@marklogic.com"}, "to":{"username":"rpolasani", "name":"Raghu Polasani", "email":"raghu.polasani@marklogic.com"}}}, "files":[], "show":true, "comment":"It would good to have test cases that use different binary types, for example, replace with a small, large or even external binary."}, {"time":"2012-12-20T18:45:12.921118-08:00", "updatedBy":{"username":"hwu", "name":"Haitao Wu", "email":"haitao.wu@marklogic.com"}, "change":{"assignTo":{"from":{"username":"hwu", "name":"Haitao Wu", "email":"haitao.wu@marklogic.com"}, "to":{"username":"rpolasani", "name":"Raghu Polasani", "email":"raghu.polasani@marklogic.com"}}}, "files":[], "show":true}, {"time":"2013-03-18T16:51:04.226181-07:00", "updatedBy":{"username":"msrinivasan", "name":"Mahalakshmi Srinivasan", "email":"mahalakshmi.srinivasan@marklogic.com"}, "change":{"assignTo":{"from":{"username":"msrinivasan", "name":"Mahalakshmi Srinivasan", "email":"mahalakshmi.srinivasan@marklogic.com"}, "to":{"username":"msrinivasan", "name":"Mahalakshmi Srinivasan", "email":"mahalakshmi.srinivasan@marklogic.com"}}}, "files":[], "show":true}, {"time":"2013-03-25T12:16:29.879477-07:00", "updatedBy":{"username":"msrinivasan", "name":"Mahalakshmi Srinivasan", "email":"mahalakshmi.srinivasan@marklogic.com"}, "change":{"status":{"from":"", "to":"Ship"}, "assignTo":{"from":{"username":"msrinivasan", "name":"Mahalakshmi Srinivasan", "email":"mahalakshmi.srinivasan@marklogic.com"}, "to":{"username":"nobody", "name":"nobody nobody", "email":"nobody@marklogic.com"}}}, "files":[], "show":true, "comment":"Verified on build 6.0-20130221"}, {"time":"2013-04-22T16:25:35.654334-07:00", "updatedBy":{"username":"rpelton", "name":"Rick Pelton", "email":"rick.pelton@marklogic.com"}, "change":{"status":{"from":"", "to":"Closed"}, "assignTo":{"from":{"username":"rpelton", "name":"Rick Pelton", "email":"rick.pelton@marklogic.com"}, "to":{"username":"nobody", "name":"nobody nobody", "email":"nobody@marklogic.com"}}}, "files":[], "show":true}], "updatedAt":"2013-04-22T16:25:35.654334-07:00", "fixedAt":"2012-12-20T18:45:12.921118-08:00", "fixedBy":{"username":"hwu", "name":"Haitao Wu", "email":"haitao.wu@marklogic.com"}, "shippedAt":"2013-03-25T12:16:29.879477-07:00", "shippedBy":{"username":"msrinivasan", "name":"Mahalakshmi Srinivasan", "email":"mahalakshmi.srinivasan@marklogic.com"}, "closedAt":"2013-04-22T16:25:35.654334-07:00", "closedBy":{"username":"rpelton", "name":"Rick Pelton", "email":"rick.pelton@marklogic.com"}, "renderDescriptionAs":"normal", "renderSampleQueryAs":"normal"}
{"id":20789, "kind":"Bug", "createdAt":"2013-02-14T09:52:09.637061-08:00", "status":"Closed", "title":"REGR: 5.0 search unit-test failure (non-deterministic issue)", "category":"xdmp", "severity":"Minor", "priority":{"level":"2", "title":"Not required for product release"}, "submittedBy":{"username":"ayuwono", "name":"Aries Yuwono", "email":"ayuwono@marklogic.com"}, "assignTo":{"username":"nobody", "name":"nobody nobody", "email":"nobody@marklogic.com"}, "description":"search unit-test failure starting on 02/14\r\n\r\ntest-id: g28 and g29\r\n\r\n<h:result-text><results notice=\"empty if all tests ran successfully\"><report group=\"search\"><setup/><tests><FAIL test-id=\"g28\"><result>prop:date: prop:format: prop:persona: prop:summary: prop:intitle: prop:id: prop:line: prop:0 prop:00 prop:003092</result><expected>prop:date: prop:format: prop:persona: prop:summary: prop:intitle: prop:id: prop:line: prop:0 prop:00 prop:01</expected></FAIL><FAIL test-id=\"g29\"><result>line:date: line:format: line:persona: line:summary: line:intitle: line:id: line:line: line:0 line:00 line:003092</result><expected>line:date: line:format: line:persona: line:summary: line:intitle: line:id: line:line: line:0 line:00 line:01</expected></FAIL></tests><teardown/></report></results>", "samplequery":"", "sampledata":"", "version":"5.0-nightly", "tofixin":"5.0-6", "fixedin":"5.0-6", "platform":"all", "memory":"", "processors":"", "note":"", "subscribers":[{"username":"ayuwono", "name":"Aries Yuwono", "email":"ayuwono@marklogic.com"}, {"username":"cgreer", "name":"Charles Greer", "email":"charles.greer@marklogic.com"}, {"username":"ehennum", "name":"Erik Hennum", "email":"erik.hennum@marklogic.com"}], "attachments":[], "relationships":[{"type":"", "to":""}], "clones":[], "cloneOf":"", "support":{"headline":"", "supportDescription":"", "publishStatus":"Not Ready", "tickets":[], "customerImpact":{"level":"N/A", "title":""}, "workaround":""}, "tags":["xdmp", "ayuwono"], "changeHistory":[{"time":"2013-02-14T09:52:09.637061-08:00", "updatedBy":{"username":"ayuwono", "name":"Aries Yuwono", "email":"ayuwono@marklogic.com"}, "change":{"assignTo":{"from":{"username":"ayuwono", "name":"Aries Yuwono", "email":"ayuwono@marklogic.com"}, "to":{"username":"ehennum", "name":"Erik Hennum", "email":"erik.hennum@marklogic.com"}}}, "files":[], "show":true}, {"time":"2013-02-14T10:13:43.732687-08:00", "updatedBy":{"username":"ayuwono", "name":"Aries Yuwono", "email":"ayuwono@marklogic.com"}, "change":{"assignTo":{"from":{"username":"ayuwono", "name":"Aries Yuwono", "email":"ayuwono@marklogic.com"}, "to":{"username":"cgreer", "name":"Charles Greer", "email":"charles.greer@marklogic.com"}}}, "files":[], "show":true}, {"time":"2013-02-14T10:22:57.588278-08:00", "updatedBy":{"username":"cgreer", "name":"Charles Greer", "email":"charles.greer@marklogic.com"}, "change":{}, "files":[], "show":true, "comment":"This has the same symptoms as the last time search test failed.  I think we have some non-deterministic values that make the 10th position unstable.  My suggestion to fix stands -- we only check the first 9 suggest values for this,\r\n\r\nI'm rebuilding 5.0 to verify right now.\r\n\r\n"}, {"time":"2013-02-14T10:42:56.220917-08:00", "updatedBy":{"username":"cgreer", "name":"Charles Greer", "email":"charles.greer@marklogic.com"}, "change":{}, "files":[], "show":true, "comment":"Hi Aries, this is not failling for me on a fresh build.  I'll hold out the solution above to limit non-deterministic tests, but maybe it will right itself."}, {"time":"2013-02-14T10:45:23.529674-08:00", "updatedBy":{"username":"ayuwono", "name":"Aries Yuwono", "email":"ayuwono@marklogic.com"}, "change":{}, "files":[], "show":true, "comment":"This is an intermittent issue, not a show stopper. It's on how the unit-test framework handles the verification"}, {"time":"2013-02-14T15:20:49.753857-08:00", "updatedBy":{"username":"cgreer", "name":"Charles Greer", "email":"charles.greer@marklogic.com"}, "change":{}, "files":[], "show":true, "comment":"I think that if I narrow the result list for suggestion to 9 rather than 10, then it will always pass.  Would that be preferable?  I'll assign this back to you and you can decide how annoying it is."}, {"time":"2013-02-14T15:21:00.681082-08:00", "updatedBy":{"username":"cgreer", "name":"Charles Greer", "email":"charles.greer@marklogic.com"}, "change":{"assignTo":{"from":{"username":"cgreer", "name":"Charles Greer", "email":"charles.greer@marklogic.com"}, "to":{"username":"ayuwono", "name":"Aries Yuwono", "email":"ayuwono@marklogic.com"}}}, "files":[], "show":true}, {"time":"2013-02-14T16:07:50.022024-08:00", "updatedBy":{"username":"ayuwono", "name":"Aries Yuwono", "email":"ayuwono@marklogic.com"}, "change":{}, "files":[], "show":true, "comment":"Hi Charles, so you changed the result list for suggestion to 9? If it's stable I'm fine with that. The question is if we narrow it down to 9, would it affect the quality?"}, {"time":"2013-02-14T16:13:57.132449-08:00", "updatedBy":{"username":"cgreer", "name":"Charles Greer", "email":"charles.greer@marklogic.com"}, "change":{}, "files":[], "show":true, "comment":"No I took no action; wanted to leave it up to you.  I'm not sure why the tenth element is non-deterministic -- something just slips inbetween \"00 and 01\" in the properties fragments.  We'd have to examine a failed environment to see why.  My guess is that it's a timestamp or xdmp:random that sometimes gets in the way... The latter is likely.\r\n\r\nIf that's so, even limiting it to 9 wouldn't make the problem go away entirely, it would just be rarer. \r\n"}, {"time":"2013-02-14T16:49:01.277364-08:00", "updatedBy":{"username":"msarma", "name":"Meghalim Sarma", "email":"msarma@marklogic.com"}, "change":{}, "files":[], "show":true, "comment":"Aries seems like the other bug which you filed on search-unit test (that got moved to 5.0-6) and this one might be due to the same reason. As Raghu mentioned in that bug, some time we are seeing differecne in result when things are in-memory Vs on-disk  which is probably a bug in the server that needs further investigation.\r\n\r\nThats why this issue is intermittent and difficult to reproduce. I suggest, we move this bug to 5.0-6 as well and cross-refer both the bugs which will help when we investigate,"}, {"time":"2013-02-15T10:10:46.056993-08:00", "updatedBy":{"username":"ayuwono", "name":"Aries Yuwono", "email":"ayuwono@marklogic.com"}, "change":{}, "files":[], "show":true, "comment":"Similar issue with 20763, moving it to 5.0-6"}, {"time":"2013-02-15T10:10:46.056993-08:00", "updatedBy":{"username":"ayuwono", "name":"Aries Yuwono", "email":"ayuwono@marklogic.com"}, "change":{"tofixin":{"from":"5.0-5", "to":"5.0-6"}}, "files":[], "show":true}, {"time":"2014-03-19T17:47:22.989161-07:00", "updatedBy":{"username":"ayuwono", "name":"Aries Yuwono", "email":"ayuwono@marklogic.com"}, "change":{"status":{"from":"", "to":"Closed"}, "assignTo":{"from":{"username":"ayuwono", "name":"Aries Yuwono", "email":"ayuwono@marklogic.com"}, "to":{"username":"nobody", "name":"nobody nobody", "email":"nobody@marklogic.com"}}}, "files":[], "show":true, "comment":"Not reproducible on build 03/19"}, {"time":"2014-03-19T17:47:22.989161-07:00", "updatedBy":{"username":"ayuwono", "name":"Aries Yuwono", "email":"ayuwono@marklogic.com"}, "change":{"assignTo":{"from":{"username":"ayuwono", "name":"Aries Yuwono", "email":"ayuwono@marklogic.com"}, "to":{"username":"nobody", "name":"nobody nobody", "email":"nobody@marklogic.com"}}}, "files":[], "show":true}], "updatedAt":"2014-03-19T17:47:22.989161-07:00", "closedAt":"2014-03-19T17:47:22.989161-07:00", "closedBy":{"username":"ayuwono", "name":"Aries Yuwono", "email":"ayuwono@marklogic.com"}, "renderDescriptionAs":"normal"}
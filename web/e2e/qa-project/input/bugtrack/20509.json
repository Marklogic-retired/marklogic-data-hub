{"id":20509, "kind":"Bug", "createdAt":"2013-01-17T15:48:19.397521-08:00", "status":"Closed", "title":"REGR: Qconsole - Query persistence across different browser ( FF & IE9 )instances is broken", "category":"Query Console", "severity":"", "priority":{"level":"5", "title":""}, "submittedBy":{"username":"sreddy", "name":"Sudhakar Reddy", "email":"sreddy@marklogic.com"}, "assignTo":{"username":"nobody", "name":"nobody nobody", "email":"nobody@marklogic.com"}, "description":"Chrome is fine. Issue is with FF & IE9\r\nPick FF or IE9 or both\r\n\r\nRun a query in an FF browser instance (Browser-1)\r\nxquery version \"1.0-ml\";\r\ndeclare namespace html = \"http://www.w3.org/1999/xhtml\";\r\n<p>Browser-1</p>\r\n\r\nOpen another FF instance (Browser-2), the query shows up - Good!\r\n\r\nNow Go back to Browser-1, modify the query & run it \r\nxquery version \"1.0-ml\";\r\ndeclare namespace html = \"http://www.w3.org/1999/xhtml\";\r\n<p>Browser-1-modified</p>\r\n\r\n Refresh Browser-2 to verify the query persistence, it still shows the old query - Bad!\r\n", "samplequery":"", "sampledata":"", "version":"", "tofixin":"7.0-ea1", "fixedin":"N/A", "platform":"all", "memory":"", "processors":"", "note":"", "subscribers":[{"username":"sreddy", "name":"Sudhakar Reddy", "email":"sreddy@marklogic.com"}, {"username":"bmo", "name":"Brian Mo", "email":"brian.mo@marklogic.com"}, {"username":"gvaidees", "name":"Ganesh Vaideeswaran", "email":"Ganesh.Vaideeswaran@marklogic.com"}, {"username":"dsokolsky", "name":"Danny Sokolsky", "email":"dsokolsky@marklogic.com"}, {"username":"sbrooks", "name":"Scott Brooks", "email":"Scott.Brooks@marklogic.com"}, {"username":"ctaylor", "name":"Christophe Taylor", "email":"christophe.taylor@marklogic.com"}], "attachments":[], "relationships":[{"type":"", "to":""}], "clones":[], "cloneOf":"", "support":{"headline":"", "supportDescription":"", "publishStatus":"Not Ready", "tickets":[], "customerImpact":{"level":"N/A", "title":""}, "workaround":""}, "tags":["Query Console", "sreddy"], "changeHistory":[{"time":"2013-01-17T15:48:19.397521-08:00", "updatedBy":{"username":"sreddy", "name":"Sudhakar Reddy", "email":"sreddy@marklogic.com"}, "change":{"assignTo":{"from":{"username":"sreddy", "name":"Sudhakar Reddy", "email":"sreddy@marklogic.com"}, "to":{"username":"gvaidees", "name":"Ganesh Vaideeswaran", "email":"Ganesh.Vaideeswaran@marklogic.com"}}}, "files":[], "show":true}, {"time":"2013-01-17T15:49:28.747355-08:00", "updatedBy":{"username":"gvaidees", "name":"Ganesh Vaideeswaran", "email":"Ganesh.Vaideeswaran@marklogic.com"}, "change":{"assignTo":{"from":{"username":"gvaidees", "name":"Ganesh Vaideeswaran", "email":"Ganesh.Vaideeswaran@marklogic.com"}, "to":{"username":"ctaylor", "name":"Christophe Taylor", "email":"christophe.taylor@marklogic.com"}}}, "files":[], "show":true}, {"time":"2013-01-23T12:44:44.002618-08:00", "updatedBy":{"username":"ctaylor", "name":"Christophe Taylor", "email":"christophe.taylor@marklogic.com"}, "change":{}, "files":[], "show":true, "comment":"confirmed... no idea yet on how to fix it. there's some caching issue going on. maybe we need to append time stamps to the AJAX calls?"}, {"time":"2013-01-23T12:44:44.002618-08:00", "updatedBy":{"username":"ctaylor", "name":"Christophe Taylor", "email":"christophe.taylor@marklogic.com"}, "change":{"status":{"from":"", "to":"Fix"}, "assignTo":{"from":{"username":"ctaylor", "name":"Christophe Taylor", "email":"christophe.taylor@marklogic.com"}, "to":{"username":"ctaylor", "name":"Christophe Taylor", "email":"christophe.taylor@marklogic.com"}}}, "files":[], "show":true}, {"time":"2013-01-23T18:26:18.268308-08:00", "updatedBy":{"username":"sbrooks", "name":"Scott Brooks", "email":"Scott.Brooks@marklogic.com"}, "change":{}, "files":[], "show":true, "comment":"We are already doing the cache buster.\r\n\r\nThe server-interactions.js file controls all that.  If you look at:\r\n_serverRequest()\r\n\r\nyou'll see the cache buster getting attached.  I'm wondering if there's a small bug there as I am seeing the cache buster get attached to some, but not all server requests.   Should be a simple fix.\r\n\r\nHope that's helpful."}, {"time":"2013-02-04T12:14:07.141288-08:00", "updatedBy":{"username":"ctaylor", "name":"Christophe Taylor", "email":"christophe.taylor@marklogic.com"}, "change":{}, "files":[], "show":true, "comment":"the issue isn't caching. or at least, it's not caching on the client side. if i run the REST request through curl, i still get the issue. something on the server is wonky, or somehow the old settings are cached and resaved on reload? I'm still a bit confused. The server is sending conflicting information from the queries.xqy endpoint"}, {"time":"2013-02-04T12:38:08.543627-08:00", "updatedBy":{"username":"sbrooks", "name":"Scott Brooks", "email":"Scott.Brooks@marklogic.com"}, "change":{"status":{"from":"", "to":"Closed"}, "assignTo":{"from":{"username":"sbrooks", "name":"Scott Brooks", "email":"Scott.Brooks@marklogic.com"}, "to":{"username":"nobody", "name":"nobody nobody", "email":"nobody@marklogic.com"}}}, "files":[], "show":true, "comment":"Danny, I'm attaching you to this issue as I think there continues to be a shortfall in QConsole documentation surrounding this specific use case and the fact we *do not* support it.  \r\n\r\n\r\nSo after reading this bug over in more detail, it's actually CORRECT behavior.  My apologies for not seeing that earlier.  I saw some note on caching and incorrectly thought that was at the root of the problem.  \r\n\r\nHere's why the behavior in the bug is actually CORRECT:\r\n\r\n- Browser # 1 & 2 open with identical queries.   \r\n- Change query in Browser # 2 - run it.  This triggers a server-side save of the query text.\r\n- Browser # 2 still has OLD query text in the UI - refresh the page.  This triggers a server-side save of the query text, again saving the OLD text to the database.\r\n- Upon seeing the refreshed state, we CORRECTLY see the OLD query text.\r\n\r\nSince there's no explicit \"save\" button in QConsole, we trigger a save to the server on query execution, swithing between queries/workspaces & whenever the page unloads (either from closing it or refreshing it). The reason it's not ONLY triggered on the execution of a query is because users may actually work on some query text and then decide to close the browser before actually running it.  When they come back, they'd expect that query text to be there, even if they didn't run it.\r\n\r\nSo that the \"last one wins\" scenario, where the last browser to hit the server will overwrite.\r\n\r\nThis is why I continue to say, in almost every meeting, WE DON'T SUPPORT USERS MOVING BETWEEN TWO BROWSERS OR SHARED USAGE OF ONE USER ACCOUNT.  Overwriting occurs!  \r\n\r\nOne day it will sink in, I hope.  (maybe the CAPS helped)  :)   \r\n\r\nDanny, I'd really like to see this explicitly spelled out in the docs as soon as possible.  This continues to be a point of confusion and frustration for users.\r\n\r\nIn conclusion, unless we implement some sort of persistent polling on the client, where we keep both browsers updated with the contents of the server, we cannot guarantee that users won't overwrite changes made in another browsers.   In fact, I can guarantee they will.\r\n\r\nWith that, I'm closing this bug.   Let's hope I don't hear anything more on this for quite some time.\r\n"}, {"time":"2013-02-04T12:38:08.543627-08:00", "updatedBy":{"username":"sbrooks", "name":"Scott Brooks", "email":"Scott.Brooks@marklogic.com"}, "change":{"assignTo":{"from":{"username":"sbrooks", "name":"Scott Brooks", "email":"Scott.Brooks@marklogic.com"}, "to":{"username":"nobody", "name":"nobody nobody", "email":"nobody@marklogic.com"}}}, "files":[], "show":true}, {"time":"2013-02-04T12:43:39.289494-08:00", "updatedBy":{"username":"ctaylor", "name":"Christophe Taylor", "email":"christophe.taylor@marklogic.com"}, "change":{}, "files":[], "show":true, "comment":"I think I know what's going on. When you refresh the browser, the query is saved to the server. If you have a stale query, that stale query overwrites the updated query.\r\n\r\nSo you open browser window 1 and edit a query. When you click run, that query is updated.\r\n\r\nNow you open browser two. It shows the query you just ran.\r\n\r\nWhen you edit the query in browser 1, then run it, the query is saved to the server again in edited form.\r\n\r\nWhen you refresh browser two, the unedited query is saved as the 'new' query and overwrites your changes.\r\n\r\nIf you go back to browser one, you still see your edited query, and if you refresh, it will stay there, as it's being saved as the page unloads.\r\n\r\nIf instead, you open a third browser, you'll see that your query update is now lost and the old query is loaded.\r\n\r\n\r\nSo, the question is, how do we handle this use case?\r\n\r\nWe have several issues that can come up.\r\n\r\nWhat if the query is edited in browser 2? Should we throw out those changes, or should those changes overwrite the changes from browser 1? Should we be polling for stale data to test to see if the current data is out of date? Should we do a check on page unload to see if there's new data before saving old data? Should we test to see if the query has been edited before attempting to save it?\r\n\r\nI had thought that we weren't attempting to maintain state across different browser windows. We don't have any push notification architecture enabled that would allow a save in one browser window to update other browser windows."}, {"time":"2013-02-04T12:43:39.289494-08:00", "updatedBy":{"username":"ctaylor", "name":"Christophe Taylor", "email":"christophe.taylor@marklogic.com"}, "change":{"status":{"from":"", "to":"Fix"}, "assignTo":{"from":{"username":"ctaylor", "name":"Christophe Taylor", "email":"christophe.taylor@marklogic.com"}, "to":{"username":"ctaylor", "name":"Christophe Taylor", "email":"christophe.taylor@marklogic.com"}}}, "files":[], "show":true}, {"time":"2013-02-04T12:43:39.289494-08:00", "updatedBy":{"username":"ctaylor", "name":"Christophe Taylor", "email":"christophe.taylor@marklogic.com"}, "change":{"assignTo":{"from":{"username":"ctaylor", "name":"Christophe Taylor", "email":"christophe.taylor@marklogic.com"}, "to":{"username":"ctaylor", "name":"Christophe Taylor", "email":"christophe.taylor@marklogic.com"}}}, "files":[], "show":true}, {"time":"2013-02-04T12:46:21.10963-08:00", "updatedBy":{"username":"ctaylor", "name":"Christophe Taylor", "email":"christophe.taylor@marklogic.com"}, "change":{"status":{"from":"", "to":"Closed"}, "assignTo":{"from":{"username":"ctaylor", "name":"Christophe Taylor", "email":"christophe.taylor@marklogic.com"}, "to":{"username":"nobody", "name":"nobody nobody", "email":"nobody@marklogic.com"}}}, "files":[], "show":true, "comment":"speaking of this issue... just ran into the same problem from multiple people editing this bug at the same time.\r\n\r\nre-closing and re-assigning to nobody."}, {"time":"2013-02-04T12:46:21.10963-08:00", "updatedBy":{"username":"ctaylor", "name":"Christophe Taylor", "email":"christophe.taylor@marklogic.com"}, "change":{"assignTo":{"from":{"username":"ctaylor", "name":"Christophe Taylor", "email":"christophe.taylor@marklogic.com"}, "to":{"username":"nobody", "name":"nobody nobody", "email":"nobody@marklogic.com"}}}, "files":[], "show":true}, {"time":"2013-02-04T13:34:30.266665-08:00", "updatedBy":{"username":"sbrooks", "name":"Scott Brooks", "email":"Scott.Brooks@marklogic.com"}, "change":{}, "files":[], "show":true, "comment":"\"speaking of this issue... just ran into the same problem from multiple people editing this bug at the same time.\"\r\n\r\nhahaha  :)  Too funny."}, {"time":"2013-02-04T13:47:26.045867-08:00", "updatedBy":{"username":"gvaidees", "name":"Ganesh Vaideeswaran", "email":"Ganesh.Vaideeswaran@marklogic.com"}, "change":{}, "files":[], "show":true, "comment":"Christophe,\r\n\r\nWhy is this not an issue on Chrome?"}, {"time":"2013-02-04T13:54:26.463504-08:00", "updatedBy":{"username":"ctaylor", "name":"Christophe Taylor", "email":"christophe.taylor@marklogic.com"}, "change":{}, "files":[], "show":true, "comment":"I was able to reproduce the bug on chrome. chrome is consistent with the other browsers in behavior. it was difficult to narrow down the exact nature of what was going on at first. there may have been some confusion."}, {"time":"2013-02-04T13:55:32.710576-08:00", "updatedBy":{"username":"sbrooks", "name":"Scott Brooks", "email":"Scott.Brooks@marklogic.com"}, "change":{}, "files":[], "show":true, "comment":"The scenario in question isn't supported.  So you can let this one go."}, {"time":"2013-02-04T14:04:42.756655-08:00", "updatedBy":{"username":"sreddy", "name":"Sudhakar Reddy", "email":"sreddy@marklogic.com"}, "change":{}, "files":[], "show":true, "comment":"This is happening in all browsers, probably at the time when I logged I could not reproduce. I can reproduce the issue on chrome as well.\r\nAs Scott suggested, this scenario is not supported so ** RIP 20509 **"}], "updatedAt":"2013-02-04T14:04:42.756655-08:00", "closedAt":"2013-02-04T12:46:21.10963-08:00", "closedBy":{"username":"ctaylor", "name":"Christophe Taylor", "email":"christophe.taylor@marklogic.com"}, "renderDescriptionAs":"normal"}
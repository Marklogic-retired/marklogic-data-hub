{"id":2072, "kind":"Bug", "createdAt":"2005-08-11T07:19:37.998994-07:00", "status":"Closed", "title":"near-query weght doesn't seem to do anything", "category":"xdmp", "severity":"Critical", "priority":{"level":"5", "title":""}, "submittedBy":{"username":"michael", "name":"Michael Blakeley", "email":"michael.blakeley@marklogic.com"}, "assignTo":{"username":"nobody", "name":"nobody nobody", "email":"nobody@marklogic.com"}, "description":"Result of sample query: 1\n\nExpected result: 100", "samplequery":"cts:near-query-weight(\n  cts:near-query((\"trental\", \"neuropathy\"), 100, \"unordered\", 100)\n)", "sampledata":"", "version":"3.0-2", "tofixin":"3.0-3", "fixedin":"3.0-3", "platform":"linux", "memory":"", "processors":"", "note":"", "subscribers":[{"username":"michael", "name":"Michael Blakeley", "email":"michael.blakeley@marklogic.com"}], "attachments":[], "clones":[], "cloneOf":"", "support":{"headline":"cts:near-query misinterprets parameters", "supportDescription":"cts:near-query interprets it's arguments based on type rather than position, leading to problems when inexplicit  types are passed in. In particular, weight can be misinterpreted as distance.", "publishStatus":"Publish", "tickets":[], "customerImpact":{"level":"N/A", "title":""}, "workaround":"Explicitly cast the weight argument to an xs:double."}, "tags":["xdmp", "michael"], "changeHistory":[{"time":"2005-08-11T11:50:22.665315-07:00", "updatedBy":{"username":"ian", "name":"Ian Small", "email":"ian@cerisent.com"}, "change":{"status":{"from":"", "to":"Verify"}, "assignTo":{"from":{"username":"ian", "name":"Ian Small", "email":"ian@cerisent.com"}, "to":{"username":"hui", "name":"Hui Li", "email":"hui.li@marklogic.com"}}}, "files":[], "show":true, "comment":"don't know if this is a bug or not, let's investigate and either respond or fix."}, {"time":"2005-08-11T14:15:21.272068-07:00", "updatedBy":{"username":"michael", "name":"Michael Blakeley", "email":"michael.blakeley@marklogic.com"}, "change":{}, "files":[], "show":true, "comment":"There seems to be a nasty side-effect to this: thesaurus expansions on near-queries have the effect of setting the near-query distance to 1."}, {"time":"2005-08-17T16:37:01.668756-07:00", "updatedBy":{"username":"hui", "name":"Hui Li", "email":"hui.li@marklogic.com"}, "change":{}, "files":[], "show":true, "comment":"Filed bug 2099 and hope Nick will fix it then this bug will be gone."}, {"time":"2005-08-17T20:22:06.670495-07:00", "updatedBy":{"username":"michael", "name":"Michael Blakeley", "email":"michael.blakeley@marklogic.com"}, "change":{}, "files":[], "show":true, "comment":"Hui, I'm trying to understand why that would work, and it looks to me like cts:near-query() sets the wrong distance *and* weight if it's called with integer weight (100), but sets the correct distance if called with double weight (100.0). For example:\n\ncts:near-query-weight(\n  cts:near-query((\"trental\", \"neuropathy\"), 5, \"unordered\", 7)\n),\ncts:near-query-weight(\n  cts:near-query((\"trental\", \"neuropathy\"), 5, \"unordered\", 7.0)\n),\ncts:near-query-distance(\n  cts:near-query((\"trental\", \"neuropathy\"), 5, \"unordered\", 7)\n),\ncts:near-query-distance(\n  cts:near-query((\"trental\", \"neuropathy\"), 5, \"unordered\", 7.0)\n)\n\n=> \n1, 7, 7, 5\n\nExpected: 7, 7, 5, 5 \n\nI agree that Nick could work around this problem by constructing his arguments as xs:double, but I want to make sure that we're going to fix the underlying bug in the near-query functions, too. I do think it's a bug: I'd prefer it if the cts:near-query() function silently promoted integer weight arguments to doubles for me, but if that's not practical then it should throw an error instead of silently creating a mangled query."}, {"time":"2005-08-23T15:06:00.931388-07:00", "updatedBy":{"username":"hui", "name":"Hui Li", "email":"hui.li@marklogic.com"}, "change":{"status":{"from":"", "to":"Fix"}, "assignTo":{"from":{"username":"hui", "name":"Hui Li", "email":"hui.li@marklogic.com"}, "to":{"username":"michael", "name":"Michael Blakeley", "email":"michael.blakeley@marklogic.com"}}}, "files":[], "show":true, "comment":"Now the parameters are determinted by positions (instead of the parameter data type)"}, {"time":"2005-08-23T15:36:51.760853-07:00", "updatedBy":{"username":"hui", "name":"Hui Li", "email":"hui.li@marklogic.com"}, "change":{"status":{"from":"", "to":"Test"}, "assignTo":{"from":{"username":"hui", "name":"Hui Li", "email":"hui.li@marklogic.com"}, "to":{"username":"michael", "name":"Michael Blakeley", "email":"michael.blakeley@marklogic.com"}}}, "files":[], "show":true, "comment":"I should assign you to test "}, {"time":"2005-09-01T08:11:21.420126-07:00", "updatedBy":{"username":"michael", "name":"Michael Blakeley", "email":"michael.blakeley@marklogic.com"}, "change":{"status":{"from":"", "to":"Ship"}, "assignTo":{"from":{"username":"michael", "name":"Michael Blakeley", "email":"michael.blakeley@marklogic.com"}, "to":{"username":"cjl", "name":"Christopher Lindblad", "email":"cjl@cerisent.com"}}}, "files":[], "show":true, "comment":"Works in 3.0-20050829"}, {"time":"2005-09-01T08:16:28.241023-07:00", "updatedBy":{"username":"michael", "name":"Michael Blakeley", "email":"michael.blakeley@marklogic.com"}, "change":{"assignTo":{"from":{"username":"michael", "name":"Michael Blakeley", "email":"michael.blakeley@marklogic.com"}, "to":{"username":"nobody", "name":"nobody nobody", "email":"nobody@marklogic.com"}}}, "files":[], "show":true}], "updatedAt":"2005-09-01T08:16:28.241023-07:00", "fixedAt":"2005-08-23T15:36:51.760853-07:00", "fixedBy":{"username":"hui", "name":"Hui Li", "email":"hui.li@marklogic.com"}, "shippedAt":"2005-09-01T08:11:21.420126-07:00", "shippedBy":{"username":"michael", "name":"Michael Blakeley", "email":"michael.blakeley@marklogic.com"}, "renderDescriptionAs":"normal", "renderSampleQueryAs":"normal"}
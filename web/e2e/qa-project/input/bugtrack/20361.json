{"id":20361, "kind":"Bug", "createdAt":"2012-11-06T19:06:37.905224-08:00", "status":"Closed", "title":"element-word-query returns wrong results with multiple QNames", "category":"", "severity":"Major", "priority":{"level":"5", "title":""}, "submittedBy":{"username":"sravotto", "name":"Silvano  Ravotto", "email":"sravotto@marklogic.com"}, "assignTo":{"username":"nobody", "name":"nobody nobody", "email":"nobody@marklogic.com"}, "description":"Create a new database set all the indexes to false except: word searches,  element word positions. Also, set stemming to \"off\".\r\n\r\nInsert the following documents:\r\n\r\nxdmp:document-insert(\"/tmp/a.xml\", <r><a>one</a><b>two</b></r>);\r\nxdmp:document-insert(\"/tmp/b.xml\", <r><a>three</a><b>four</b></r>);\r\nxdmp:document-insert(\"/tmp/c.xml\", <r><a>five</a><b>six</b></r>)\r\n\r\n\r\nRun the following queries:\r\n\r\nxdmp:estimate(cts:search(fn:doc(), cts:element-word-query((xs:QName(\"a\")), \"one\")))\r\n\r\n=> 1  (correct)\r\n\r\nxdmp:estimate(cts:search(fn:doc(), cts:element-word-query((xs:QName(\"a\"),xs:QName(\"b\")), \"one\")))\r\n\r\n=> 3  (returns all the documents)", "samplequery":"", "sampledata":"", "version":"6.0-2", "tofixin":"6.0-3", "fixedin":"6.0-3", "platform":"all", "memory":"", "processors":"", "note":"", "subscribers":[{"username":"sravotto", "name":"Silvano  Ravotto", "email":"sravotto@marklogic.com"}, {"username":"mary", "name":"Mary Holstege", "email":"mary@cerisent.com"}, {"username":"rpolasani", "name":"Raghu Polasani", "email":"raghu.polasani@marklogic.com"}], "attachments":[], "relationships":[{"type":"", "to":""}], "clones":[], "cloneOf":20011, "support":{"headline":"cts:element-word-query with multiple elements returning too many false positives if fast-element-word-searches and word-positions are turned off", "supportDescription":"cts:element-word-query with multiple elements returning too many false positives if fast-element-word-searches and word-positions are turned off.\r\nFor example, cts:search(doc(), cts:element-word-query((xs:QName(\"a\"),xs:QName(\"b\")),\"one\"), \"unfiltered\") will incorrectly match the following document:\r\n<r><a>three</a><b>four</b></r>", "publishStatus":"Publish", "tickets":[], "customerImpact":{"level":"N/A", "title":""}, "workaround":"Enable fast-element-word-searches or word-positions."}, "tags":["", "sravotto"], "changeHistory":[{"time":"2012-11-06T19:06:37.905224-08:00", "updatedBy":{"username":"sravotto", "name":"Silvano  Ravotto", "email":"sravotto@marklogic.com"}, "change":{"assignTo":{"from":{"username":"sravotto", "name":"Silvano  Ravotto", "email":"sravotto@marklogic.com"}, "to":{"username":"mary", "name":"Mary Holstege", "email":"mary@cerisent.com"}}}, "files":[], "show":true}, {"time":"2012-11-06T19:13:50.240119-08:00", "updatedBy":{"username":"sravotto", "name":"Silvano  Ravotto", "email":"sravotto@marklogic.com"}, "change":{}, "files":[], "show":true, "comment":"Also, this query is not correct:\r\n\r\nxdmp:estimate(cts:search(fn:doc(), cts:element-word-query((xs:QName(\"dummy\")), \"one\")))\r\n\r\n==> 1\r\n\r\nUsing fast-element-phrase-searches instead of element-word-positions returns the correct result."}, {"time":"2012-11-07T11:15:16.726206-08:00", "updatedBy":{"username":"rhu", "name":"Ron Hu", "email":"ron.hu@marklogic.com"}, "change":{"tofixin":{"from":"", "to":"5.0-5"}}, "files":[], "show":true}, {"time":"2012-12-10T13:21:39.431218-08:00", "updatedBy":{"username":"rhu", "name":"Ron Hu", "email":"ron.hu@marklogic.com"}, "change":{}, "files":[], "show":true, "comment":"Mary,\r\nPlease investigate this bug."}, {"time":"2013-01-02T11:13:23.015476-08:00", "updatedBy":{"username":"mary", "name":"Mary Holstege", "email":"mary@cerisent.com"}, "change":{}, "files":[], "show":true, "comment":"element-word-positions is meaningless without fast-element-word enabled: these are the positions associated with the element-word entries from fast-element-word. If you turn on fast-element-word or plain word-positions the query cts:element-word-query(xs:QName(\"dummy\"),\"one\")) will be accurate."}, {"time":"2013-01-02T14:42:33.728057-08:00", "updatedBy":{"username":"mary", "name":"Mary Holstege", "email":"mary@cerisent.com"}, "change":{"tofixin":{"from":"", "to":"6.0-3"}}, "files":[], "show":true}, {"time":"2013-01-02T14:54:14.839002-08:00", "updatedBy":{"username":"mary", "name":"Mary Holstege", "email":"mary@cerisent.com"}, "change":{}, "files":[], "show":true, "svn":{"repository":"/project/engsvn", "revision":"126283", "paths":["xdmp/branches/b6_0/src/SearchBuiltins.cpp"], "affectedBugs":[]}, "comment":"Bug:20361 e-w-q avoid dropping non-duplicate word-query clauses when multiple element names used"}, {"time":"2013-01-02T14:54:47.404441-08:00", "updatedBy":{"username":"mary", "name":"Mary Holstege", "email":"mary@cerisent.com"}, "change":{"status":{"from":"", "to":"Test"}, "assignTo":{"from":{"username":"mary", "name":"Mary Holstege", "email":"mary@cerisent.com"}, "to":{"username":"rpolasani", "name":"Raghu Polasani", "email":"raghu.polasani@marklogic.com"}}}, "files":[], "show":true, "comment":"Fixed 6.0-20130103"}, {"time":"2013-01-02T14:54:47.404441-08:00", "updatedBy":{"username":"mary", "name":"Mary Holstege", "email":"mary@cerisent.com"}, "change":{"assignTo":{"from":{"username":"mary", "name":"Mary Holstege", "email":"mary@cerisent.com"}, "to":{"username":"rpolasani", "name":"Raghu Polasani", "email":"raghu.polasani@marklogic.com"}}}, "files":[], "show":true}, {"time":"2013-03-21T23:32:29.253124-07:00", "updatedBy":{"username":"rpolasani", "name":"Raghu Polasani", "email":"raghu.polasani@marklogic.com"}, "change":{"assignTo":{"from":{"username":"rpolasani", "name":"Raghu Polasani", "email":"raghu.polasani@marklogic.com"}, "to":{"username":"jsolis", "name":"Julio Solis", "email":"Julio.Solis@marklogic.com"}}}, "files":[], "show":true}, {"time":"2013-03-29T13:23:54.962009-07:00", "updatedBy":{"username":"jsolis", "name":"Julio Solis", "email":"Julio.Solis@marklogic.com"}, "change":{"status":{"from":"", "to":"Ship"}, "assignTo":{"from":{"username":"jsolis", "name":"Julio Solis", "email":"Julio.Solis@marklogic.com"}, "to":{"username":"nobody", "name":"nobody nobody", "email":"nobody@marklogic.com"}}}, "files":[], "show":true, "comment":"Verified on MarkLogic-6.0-20130329.x86_64. New test case bug20361.xml added to test suite bugs51.txt."}, {"time":"2013-04-22T16:24:40.625958-07:00", "updatedBy":{"username":"rpelton", "name":"Rick Pelton", "email":"rick.pelton@marklogic.com"}, "change":{"status":{"from":"", "to":"Closed"}, "assignTo":{"from":{"username":"rpelton", "name":"Rick Pelton", "email":"rick.pelton@marklogic.com"}, "to":{"username":"nobody", "name":"nobody nobody", "email":"nobody@marklogic.com"}}}, "files":[], "show":true}], "updatedAt":"2013-04-22T16:24:40.625958-07:00", "fixedAt":"2013-01-02T14:54:47.404441-08:00", "fixedBy":{"username":"mary", "name":"Mary Holstege", "email":"mary@cerisent.com"}, "shippedAt":"2013-03-29T13:23:54.962009-07:00", "shippedBy":{"username":"jsolis", "name":"Julio Solis", "email":"Julio.Solis@marklogic.com"}, "closedAt":"2013-04-22T16:24:40.625958-07:00", "closedBy":{"username":"rpelton", "name":"Rick Pelton", "email":"rick.pelton@marklogic.com"}, "renderDescriptionAs":"normal"}
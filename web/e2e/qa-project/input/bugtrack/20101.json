{"id":20101, "kind":"Bug", "createdAt":"2012-11-15T22:56:08.731273-08:00", "status":"Closed", "title":"xdmp:forest-clear restarting ML server", "category":"xdmp", "severity":"Critical", "priority":{"level":"5", "title":""}, "submittedBy":{"username":"ksaxena", "name":"Kapil Saxena", "email":"kapil.saxena@marklogic.com"}, "assignTo":{"username":"nobody", "name":"nobody nobody", "email":"nobody@marklogic.com"}, "description":"The following xquery on trunk causing ML server restart:\r\n  xquery version \"1.0-ml\";\r\n  xdmp:forest-clear(xdmp:forest(\"Schemas\")) \r\n\r\nHere's is what we see in ErrorLog:\r\n\r\n2012-11-15 20:56:29.786 Info: QAxdbcServer: **************Starting Test: bug5406.xml**************\r\n2012-11-15 20:56:29.790 Info: QAxdbcServer: start log setup-000\r\n2012-11-15 20:56:29.791 Info: Clearing forest Schemas\r\n2012-11-15 20:57:54.469 Info: Saving /var/opt/MarkLogic/Forests/Documents/00000003\r\n2012-11-15 20:57:54.567 Info: Saved 15 MB in 1 sec at 153 MB/sec to /var/opt/MarkLogic/Forests/Documents/00000003\r\n2012-11-15 20:57:54.568 Info: Merging 1 MB from /var/opt/MarkLogic/Forests/Documents/00000002 and /var/opt/MarkLogic/Forests/Documents/00000003 to /var/opt/MarkLogic/Forests/Documents/00000004\r\n2012-11-15 20:57:54.616 Info: Merged 1 MB in 1 sec at 21 MB/sec to /var/opt/MarkLogic/Forests/Documents/00000004\r\n2012-11-15 20:57:57.546 Info: Deleted 1 MB in 1 sec at 650 MB/sec /var/opt/MarkLogic/Forests/Documents/00000004\r\n2012-11-15 20:59:30.215 Alert: XDMP-FORESTERR: Error in shutdown of forest Schemas: XDMP-FORESTTIM: Forest Schemas close operation timed out\r\n2012-11-15 20:59:30.388 Notice: Starting MarkLogic Server 6.1-20121115 x86_64 in /opt/MarkLogic with data in /var/opt/MarkLogic\r\n2012-11-15 20:59:30.451 Info: Host rh6-intel64-51-test-3.marklogic.com running Linux 2.6.32-131.0.15.el6.x86_64 (Red Hat Enterprise Linux Server release 6.1 (Santiago))\r\n2012-11-15 20:59:30.518 Info: SSL FIPS mode has been enabled\r\n2012-11-15 20:59:32.562 Info: Native plugin cache manifest initialized\r\n2012-11-15 20:59:32.571 Info: Linux ext4 mount option 'barrier' is default; recommend faster 'nobarrier' if storage has non-volatile write cache\r\n2012-11-15 20:59:32.571 Info: Mounted forest Documents locally on /var/opt/MarkLogic/Forests/Documents (sda8 ext4 rw)\r\n\r\nTest: bug5406.xml\r\nML Server:  6.1-20121115\r\nMachine Name: rh6-intel64-51-test-3\r\nPath to ErrorLog: /space/builder/builds/linux64/HEAD/logs.20121115.1\r\n", "samplequery":"", "sampledata":"", "version":"7.0-nightly", "tofixin":"7.0-ea1", "fixedin":"7.0-ea1", "platform":"all", "memory":"", "processors":"", "note":"", "subscribers":[{"username":"ksaxena", "name":"Kapil Saxena", "email":"kapil.saxena@marklogic.com"}, {"username":"jsnelson", "name":"John Snelson", "email":"jsnelson@marklogic.com"}, {"username":"knagar", "name":"Kuldeep Nagar", "email":"Kuldeep.Nagar@marklogic.com"}], "attachments":[], "relationships":[{"type":"", "to":""}], "clones":[21084], "cloneOf":"", "support":{"headline":"", "supportDescription":"", "publishStatus":"Never Publish", "tickets":[], "customerImpact":{"level":"N/A", "title":""}, "workaround":""}, "tags":["xdmp", "ksaxena"], "changeHistory":[{"time":"2012-11-15T22:56:08.731273-08:00", "updatedBy":{"username":"ksaxena", "name":"Kapil Saxena", "email":"kapil.saxena@marklogic.com"}, "change":{"assignTo":{"from":{"username":"ksaxena", "name":"Kapil Saxena", "email":"kapil.saxena@marklogic.com"}, "to":{"username":"jsnelson", "name":"John Snelson", "email":"jsnelson@marklogic.com"}}}, "files":[], "show":true}, {"time":"2013-02-19T13:29:53.330945-08:00", "updatedBy":{"username":"jsnelson", "name":"John Snelson", "email":"jsnelson@marklogic.com"}, "change":{}, "files":[], "show":true, "comment":"I don't have a way to reproduce this. Is this still happening? If so, how can I reproduce it?"}, {"time":"2013-02-19T13:29:53.330945-08:00", "updatedBy":{"username":"jsnelson", "name":"John Snelson", "email":"jsnelson@marklogic.com"}, "change":{"assignTo":{"from":{"username":"jsnelson", "name":"John Snelson", "email":"jsnelson@marklogic.com"}, "to":{"username":"ksaxena", "name":"Kapil Saxena", "email":"kapil.saxena@marklogic.com"}}}, "files":[], "show":true}, {"time":"2013-02-22T02:55:42.170797-08:00", "updatedBy":{"username":"ksaxena", "name":"Kapil Saxena", "email":"kapil.saxena@marklogic.com"}, "change":{}, "files":[], "show":true, "comment":"During test \"pdf-conv-mod-alert.xml\" on 02/21 nightly regression, during delete forest operation, I'm seeing:\r\n\r\n2013-02-20 05:28:55.974 Debug: Detected compatibility for database App-Services\r\n2013-02-20 05:32:55.690 Alert: XDMP-FORESTERR: Error in shutdown of forest pdf-conv-mod-alert: XDMP-FORESTTIM: Forest pdf-conv-mod-alert close operation timed out\r\n2013-02-20 05:32:55.690 Error: Reference /var/opt/MarkLogic/Forests/pdf-conv-mod-alert/00000000 4 2013-02-20T05:27:52 2013-02-20T05:28:53\r\n2013-02-20 05:32:55.833 Notice: Starting MarkLogic Server 7.0-20130220 x86_64 in /opt/MarkLogic with data in /var/opt/MarkLogic\r\n2013-02-20 05:32:55.849 Info: Host rh6-intel64-70-test-2.marklogic.com running Linux 2.6.32-279.el6.x86_64 (Red Hat Enterprise Linux Server release 6.3 (Santiago))\r\n2013-02-20 05:32:55.897 Info: SSL FIPS mode has been enabled\r\n\r\nHere's the link to diff:\r\nhttps://regression-status.marklogic.com/new-app/space2/diff-archive/b7_0-ea1/2013-02-21/linux-64-rh6/diffs/pdf-conv-mod-alert.xml\r\n\r\nErrorLog can found on \"rh6-intel64-70-test-2\" at \"/space/builder/builds/linux64/HEAD/logs.20130220.0/reg-results\"."}, {"time":"2013-02-22T02:55:42.170797-08:00", "updatedBy":{"username":"ksaxena", "name":"Kapil Saxena", "email":"kapil.saxena@marklogic.com"}, "change":{"assignTo":{"from":{"username":"ksaxena", "name":"Kapil Saxena", "email":"kapil.saxena@marklogic.com"}, "to":{"username":"jsnelson", "name":"John Snelson", "email":"jsnelson@marklogic.com"}}}, "files":[], "show":true}, {"time":"2013-02-28T01:46:09.180982-08:00", "updatedBy":{"username":"jsnelson", "name":"John Snelson", "email":"jsnelson@marklogic.com"}, "change":{}, "files":[], "show":true, "comment":"On 28/02/13 05:47, Wayne Feick wrote:\r\nLooks like you have to enable the \"Forest Finish Closing Fail Abort\" trace flag to get the abort and stack trace if a forest can't close within 3 minutes. Try replicating the bug with that trace flag on. "}, {"time":"2013-03-04T14:15:46.772447-08:00", "updatedBy":{"username":"gvaidees", "name":"Ganesh Vaideeswaran", "email":"Ganesh.Vaideeswaran@marklogic.com"}, "change":{}, "files":[], "show":true, "svn":{"repository":"/project/engsvn", "revision":"134851", "paths":["xdmp/branches/b7_0-ea1/src/Admin/create-field-go.xqy"], "affectedBugs":[]}, "comment":"bug:20101 Getting error 500 on creating Field with more than one path. The check to make sure that we have one path if field type is path could be improved. THis is just a start"}, {"time":"2013-03-04T14:18:24.695489-08:00", "updatedBy":{"username":"gvaidees", "name":"Ganesh Vaideeswaran", "email":"Ganesh.Vaideeswaran@marklogic.com"}, "change":{}, "files":[], "show":true, "svn":{"repository":"/project/engsvn", "revision":"134852", "paths":["xdmp/trunk/src/Admin/create-field-go.xqy"], "affectedBugs":[]}, "comment":"bug:20101 Getting error 500 on creating Field with more than one path. The check to make sure that we have one path if field type is path could be improved. THis is just a start"}, {"time":"2013-03-06T14:49:18.290539-08:00", "updatedBy":{"username":"gvaidees", "name":"Ganesh Vaideeswaran", "email":"Ganesh.Vaideeswaran@marklogic.com"}, "change":{}, "files":[], "show":true, "comment":"Above comment is for i21010 "}, {"time":"2013-03-07T08:50:29.289358-08:00", "updatedBy":{"username":"jsnelson", "name":"John Snelson", "email":"jsnelson@marklogic.com"}, "change":{}, "files":[], "show":true, "svn":{"repository":"/project/engsvn", "revision":"135475", "paths":["xdmp/trunk/src/VM.cpp", "xdmp/trunk/src/VM.h", "xdmp/trunk/src/icu/include/unicode/unistr.h"], "affectedBugs":[]}, "comment":"bug:20101 Avoid storing DynamicEnv and var bindings in a VMProgram"}, {"time":"2013-03-07T11:41:51.824799-08:00", "updatedBy":{"username":"jsnelson", "name":"John Snelson", "email":"jsnelson@marklogic.com"}, "change":{}, "files":[], "show":true, "svn":{"repository":"/project/engsvn", "revision":"135502", "paths":["xdmp/branches/b7_0-ea1/src/VM.h", "xdmp/branches/b7_0-ea1/src/icu/include/unicode/unistr.h", "xdmp/branches/b7_0-ea1/src/VM.cpp"], "affectedBugs":[]}, "comment":"bug:20101 Avoid storing DynamicEnv and var bindings in a VMProgram"}, {"time":"2013-03-07T11:48:53.162476-08:00", "updatedBy":{"username":"jsnelson", "name":"John Snelson", "email":"jsnelson@marklogic.com"}, "change":{"status":{"from":"", "to":"Test"}, "assignTo":{"from":{"username":"jsnelson", "name":"John Snelson", "email":"jsnelson@marklogic.com"}, "to":{"username":"ksaxena", "name":"Kapil Saxena", "email":"kapil.saxena@marklogic.com"}}}, "files":[], "show":true, "comment":"Fixed."}, {"time":"2013-03-07T11:48:53.162476-08:00", "updatedBy":{"username":"jsnelson", "name":"John Snelson", "email":"jsnelson@marklogic.com"}, "change":{"assignTo":{"from":{"username":"jsnelson", "name":"John Snelson", "email":"jsnelson@marklogic.com"}, "to":{"username":"ksaxena", "name":"Kapil Saxena", "email":"kapil.saxena@marklogic.com"}}}, "files":[], "show":true}, {"time":"2013-03-08T02:05:11.82599-08:00", "updatedBy":{"username":"ksaxena", "name":"Kapil Saxena", "email":"kapil.saxena@marklogic.com"}, "change":{"status":{"from":"", "to":"Ship"}, "assignTo":{"from":{"username":"ksaxena", "name":"Kapil Saxena", "email":"kapil.saxena@marklogic.com"}, "to":{"username":"nobody", "name":"nobody nobody", "email":"nobody@marklogic.com"}}}, "files":[], "show":true, "comment":"Verified in 7.0-ea1_20130308"}, {"time":"2013-03-08T02:05:11.82599-08:00", "updatedBy":{"username":"ksaxena", "name":"Kapil Saxena", "email":"kapil.saxena@marklogic.com"}, "change":{"assignTo":{"from":{"username":"ksaxena", "name":"Kapil Saxena", "email":"kapil.saxena@marklogic.com"}, "to":{"username":"nobody", "name":"nobody nobody", "email":"nobody@marklogic.com"}}}, "files":[], "show":true}], "updatedAt":"2013-03-08T02:05:11.82599-08:00", "fixedAt":"2013-03-07T11:48:53.162476-08:00", "fixedBy":{"username":"jsnelson", "name":"John Snelson", "email":"jsnelson@marklogic.com"}, "shippedAt":"2013-03-08T02:05:11.82599-08:00", "shippedBy":{"username":"ksaxena", "name":"Kapil Saxena", "email":"kapil.saxena@marklogic.com"}, "renderDescriptionAs":"normal"}
{"id":20310, "kind":"Bug", "createdAt":"2012-12-19T07:23:16.261735-08:00", "status":"Verify", "title":"Server-status doesn't show expanded tree cache hits or misses for nested evals", "category":"adminGUI", "severity":"Minor", "priority":{"level":"2", "title":"Not required for product release"}, "submittedBy":{"username":"dchander", "name":"Dinesh Chander", "email":"dinesh.chander@globallogic.com"}, "assignTo":{"username":"dlee", "name":"David  Lee", "email":"David.Lee@marklogic.com"}, "description":"Reported by user (Michael Blakeley) in case #12254\r\n--------------------------------------------------------------------------------------------------------------------------------------------\r\nWith 6.0-2 I notice that server-status doesn't show expanded tree cache data for nested evals. I've attached two screen shots taken about 30-sec apart. The server is quiescent except for the single query shown, which is a cq call to xdmp:eval.\r\nThe cq query itself has 0 expanded tree cache accesses, but its nested eval has many. We can see these at the host level in the first table, where the expanded tree cache hits and misses increases from screen shot #1 to #2. But the counts for the cq eval remain 0.\r\nIn a situation where multiple concurrent queries are running, this makes it difficult to track down the slow ones. I'm not certain that previous releases rolled up the statistics from nested evals. But if this isn't a regression, it would make a nice enhancement.\r\n--------------------------------------------------------------------------------------------------------------------------------------------", "samplequery":"Heres a sample query which depicts this behavior.\r\n \r\nfor $j in 1 to 10000\r\nlet $_ := doc()[1]\r\nlet $_ := xdmp:sleep(125)\r\nreturn ()\r\n, xdmp:query-meters()\r\n \r\nThis behavior is consistent across all ML versions.\r\n\r\nThe following query seems to work fine as we can see the expanded tree statistics at query level.\r\n\r\nfor $doc in doc()\r\nreturn $doc", "sampledata":"", "version":"6.0-2", "tofixin":"9.0-1", "fixedin":"", "platform":"all", "memory":"", "processors":"", "note":"", "subscribers":[{"username":"dchander", "name":"Dinesh Chander", "email":"dinesh.chander@globallogic.com"}, {"username":"dlee", "name":"David  Lee", "email":"David.Lee@marklogic.com"}, {"username":"cjl", "name":"Christopher Lindblad", "email":"cjl@cerisent.com"}, {"username":"bmo", "name":"Brian Mo", "email":"brian.mo@marklogic.com"}], "attachments":[{"name":"Expanded tree increasing at host level but not at query level in host status", "uri":"root/support/bugtracking/attachments/20310/ETC.zip"}], "relationships":[{"type":"", "to":""}], "clones":[], "cloneOf":"", "support":{"headline":"", "supportDescription":"", "publishStatus":"Not Ready", "tickets":[], "customerImpact":{"level":"Low", "title":"Minimal business impact or reasonable workaround is available"}, "workaround":""}, "tags":["adminGUI", "dchander"], "changeHistory":[{"time":"2012-12-22T10:58:08.740152-08:00", "updatedBy":{"username":"gvaidees", "name":"Ganesh Vaideeswaran", "email":"Ganesh.Vaideeswaran@marklogic.com"}, "change":{"assignTo":{"from":{"username":"gvaidees", "name":"Ganesh Vaideeswaran", "email":"Ganesh.Vaideeswaran@marklogic.com"}, "to":{"username":"bmo", "name":"Brian Mo", "email":"brian.mo@marklogic.com"}}}, "files":[], "show":true}, {"time":"2012-12-22T10:58:08.740152-08:00", "updatedBy":{"username":"gvaidees", "name":"Ganesh Vaideeswaran", "email":"Ganesh.Vaideeswaran@marklogic.com"}, "change":{"tofixin":{"from":"", "to":"6.0-3"}}, "files":[], "show":true}, {"time":"2013-01-17T18:20:58.301385-08:00", "updatedBy":{"username":"gvaidees", "name":"Ganesh Vaideeswaran", "email":"Ganesh.Vaideeswaran@marklogic.com"}, "change":{}, "files":[], "show":true, "comment":"Chris,\r\n\r\nIs this a UI defect or a does server not provide this info? "}, {"time":"2013-01-21T14:22:08.802982-08:00", "updatedBy":{"username":"rhu", "name":"Ron Hu", "email":"ron.hu@marklogic.com"}, "change":{}, "files":[], "show":true, "comment":"This should be a server issue."}, {"time":"2013-01-21T14:22:08.802982-08:00", "updatedBy":{"username":"rhu", "name":"Ron Hu", "email":"ron.hu@marklogic.com"}, "change":{"status":{"from":"", "to":"Verify"}, "assignTo":{"from":{"username":"rhu", "name":"Ron Hu", "email":"ron.hu@marklogic.com"}, "to":{"username":"dlee", "name":"David  Lee", "email":"David.Lee@marklogic.com"}}}, "files":[], "show":true}, {"time":"2013-01-21T14:22:08.802982-08:00", "updatedBy":{"username":"rhu", "name":"Ron Hu", "email":"ron.hu@marklogic.com"}, "change":{"assignTo":{"from":{"username":"rhu", "name":"Ron Hu", "email":"ron.hu@marklogic.com"}, "to":{"username":"dlee", "name":"David  Lee", "email":"David.Lee@marklogic.com"}}}, "files":[], "show":true}, {"time":"2013-02-25T11:18:09.793516-08:00", "updatedBy":{"username":"rpelton", "name":"Rick Pelton", "email":"rick.pelton@marklogic.com"}, "change":{"tofixin":{"from":"6.0-3", "to":"6.0-4"}}, "files":[], "show":true}, {"time":"2013-05-29T16:44:45.858554-07:00", "updatedBy":{"username":"wfeick", "name":"Wayne Feick", "email":"wfeick@marklogic.com"}, "change":{}, "files":[], "show":true, "comment":"This doesn't seem like a critical defect, and can be punted to ML7."}, {"time":"2013-05-29T16:44:45.858554-07:00", "updatedBy":{"username":"wfeick", "name":"Wayne Feick", "email":"wfeick@marklogic.com"}, "change":{"tofixin":{"from":"6.0-4", "to":"7.0-1"}}, "files":[], "show":true}, {"time":"2013-08-30T10:57:59.85827-07:00", "updatedBy":{"username":"dlee", "name":"David  Lee", "email":"David.Lee@marklogic.com"}, "change":{"tofixin":{"from":"7.0-1", "to":"8.0-1"}}, "files":[], "show":true}, {"time":"2014-12-02T16:54:53.959362-08:00", "updatedBy":{"username":"dgorbet", "name":"David Gorbet", "email":"David.Gorbet@marklogic.com"}, "change":{}, "files":[], "show":true, "comment":"someday/maybe"}, {"time":"2014-12-02T16:54:53.959362-08:00", "updatedBy":{"username":"dgorbet", "name":"David Gorbet", "email":"David.Gorbet@marklogic.com"}, "change":{"tofixin":{"from":"8.0-1", "to":"N/A"}}, "files":[], "show":true}, {"time":"2015-03-10T03:02:54.574363-07:00", "updatedBy":{"username":"dlee", "name":"David  Lee", "email":"David.Lee@marklogic.com"}, "change":{"tofixin":{"from":"N/A", "to":"9.0-1"}}, "files":[], "show":true}], "updatedAt":"2015-03-10T03:02:54.574363-07:00", "renderDescriptionAs":"normal", "renderSampleQueryAs":"normal"}
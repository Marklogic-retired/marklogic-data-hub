{"id":20846, "kind":"Bug", "createdAt":"2013-02-20T09:08:21.366589-08:00", "status":"Closed", "title":"search:suggest support for json:key", "category":"Search API", "severity":"Minor", "priority":{"level":"5", "title":""}, "submittedBy":{"username":"ehennum", "name":"Erik Hennum", "email":"erik.hennum@marklogic.com"}, "assignTo":{"username":"nobody", "name":"nobody nobody", "email":"nobody@marklogic.com"}, "description":"This call succeeds:\r\n\r\nsearch:suggest(\"con\",\r\n<options xmlns=\"http://marklogic.com/appservices/search\">\r\n<default-suggestion-source>\r\n    <word><element ns=\"http://marklogic.com/xdmp/json/basic\" name=\"abstract\"/></word>\r\n</default-suggestion-source>\r\n</options>\r\n)\r\n\r\nbut this semantically identical call fails:\r\n\r\nsearch:suggest(\"con\",\r\n<options xmlns=\"http://marklogic.com/appservices/search\">\r\n<default-suggestion-source>\r\n    <word><json-key>abstract</json-key></word>\r\n</default-suggestion-source>\r\n</options>\r\n)\r\n\r\nwith the following error:\r\n\r\nIn /MarkLogic/appservices/search/suggest.xqy on line 421\r\nIn suggest:get-words(\"con*\", (), <default-suggestion-source xmlns=\"http://marklogic.com/appservices/search\"><word><json-key>abstract</json-key><!--&#10; <element ns=...</default-suggestion-source>, \"document\", xs:unsignedInt(\"10\"), xs:double(\"1\"), ())\r\n\r\n$pqstr := \"con*\"\r\n$ctsquery := ()\r\n$rule := <default-suggestion-source xmlns=\"http://marklogic.com/appservices/search\"><word><json-key>abstract</json-key><!--&#10; <element ns=...</default-suggestion-source>\r\n$options := \"document\"\r\n$limit := xs:unsignedInt(\"10\")\r\n$quality-weight := xs:double(\"1\")\r\n$forests := ()\r\n\r\nThe failing function has a case for element-attributes and elements but not JSON keys.\r\n ", "samplequery":"", "sampledata":"", "version":"6.0-nightly", "tofixin":"6.0-3", "fixedin":"6.0-3", "platform":"all", "memory":"", "processors":"", "note":"", "subscribers":[{"username":"ehennum", "name":"Erik Hennum", "email":"erik.hennum@marklogic.com"}, {"username":"ayuwono", "name":"Aries Yuwono", "email":"ayuwono@marklogic.com"}, {"username":"cgreer", "name":"Charles Greer", "email":"charles.greer@marklogic.com"}, {"username":"msarma", "name":"Meghalim Sarma", "email":"msarma@marklogic.com"}], "attachments":[], "relationships":[{"type":"", "to":""}], "clones":[], "cloneOf":20845, "support":{"headline":"Suggestions from JSON keys not supported", "supportDescription":"Query options could not declare a JSON key as a source for suggestions.\r\n\r\nQuery options should allow a JSON key as a suggestion source:\r\n\r\n<default-suggestion-source>\r\n    <word><json-key>abstract</json-key></word> \r\n</default-suggestion-source>\r\n", "publishStatus":"Publish", "tickets":[], "customerImpact":{"level":"N/A", "title":""}, "workaround":"Specify the JSON key as the equivalent transformed XML element:\r\n\r\n<default-suggestion-source>\r\n    <word><element ns=\"http://marklogic.com/xdmp/json/basic\" name=\"abstract\"/></word>\r\n</default-suggestion-source>\r\n"}, "tags":["Search API", "ehennum"], "changeHistory":[{"time":"2013-02-20T09:08:21.366589-08:00", "updatedBy":{"username":"ehennum", "name":"Erik Hennum", "email":"erik.hennum@marklogic.com"}, "change":{"assignTo":{"from":{"username":"ehennum", "name":"Erik Hennum", "email":"erik.hennum@marklogic.com"}, "to":{"username":"ehennum", "name":"Erik Hennum", "email":"erik.hennum@marklogic.com"}}}, "files":[], "show":true}, {"time":"2013-02-20T09:32:18.539945-08:00", "updatedBy":{"username":"cgreer", "name":"Charles Greer", "email":"charles.greer@marklogic.com"}, "change":{"status":{"from":"", "to":"Fix"}, "assignTo":{"from":{"username":"cgreer", "name":"Charles Greer", "email":"charles.greer@marklogic.com"}, "to":{"username":"cgreer", "name":"Charles Greer", "email":"charles.greer@marklogic.com"}}}, "files":[], "show":true, "comment":"I'll check the options transform to make sure this json key position is included."}, {"time":"2013-02-20T09:32:18.539945-08:00", "updatedBy":{"username":"cgreer", "name":"Charles Greer", "email":"charles.greer@marklogic.com"}, "change":{"assignTo":{"from":{"username":"cgreer", "name":"Charles Greer", "email":"charles.greer@marklogic.com"}, "to":{"username":"cgreer", "name":"Charles Greer", "email":"charles.greer@marklogic.com"}}}, "files":[], "show":true}, {"time":"2013-02-20T09:38:04.178718-08:00", "updatedBy":{"username":"cgreer", "name":"Charles Greer", "email":"charles.greer@marklogic.com"}, "change":{"assignTo":{"from":{"username":"cgreer", "name":"Charles Greer", "email":"charles.greer@marklogic.com"}, "to":{"username":"ehennum", "name":"Erik Hennum", "email":"erik.hennum@marklogic.com"}}}, "files":[], "show":true}, {"time":"2013-02-20T10:13:04.787386-08:00", "updatedBy":{"username":"ehennum", "name":"Erik Hennum", "email":"erik.hennum@marklogic.com"}, "change":{}, "files":[], "show":true, "comment":"Patch in review"}, {"time":"2013-02-20T11:00:16.548846-08:00", "updatedBy":{"username":"ehennum", "name":"Erik Hennum", "email":"erik.hennum@marklogic.com"}, "change":{"tofixin":{"from":"", "to":"6.0-3"}}, "files":[], "show":true}, {"time":"2013-02-20T14:16:31.933493-08:00", "updatedBy":{"username":"ehennum", "name":"Erik Hennum", "email":"erik.hennum@marklogic.com"}, "change":{}, "files":[], "show":true, "svn":{"repository":"/project/engsvn", "revision":"132685", "paths":["xdmp/branches/b6_0/src/Modules/MarkLogic/appservices/search/search-impl.xqy", "xdmp/branches/b6_0/src/Apps/test/appservices/searchjson-unittest/jsonkey-unittest.xqy"], "affectedBugs":[]}, "comment":"Bug:20846 JSON keys in search:suggest()"}, {"time":"2013-02-20T14:18:14.041849-08:00", "updatedBy":{"username":"ehennum", "name":"Erik Hennum", "email":"erik.hennum@marklogic.com"}, "change":{"status":{"from":"", "to":"Test"}, "assignTo":{"from":{"username":"ehennum", "name":"Erik Hennum", "email":"erik.hennum@marklogic.com"}, "to":{"username":"ayuwono", "name":"Aries Yuwono", "email":"ayuwono@marklogic.com"}}}, "files":[], "show":true, "comment":"default-suggestion-source and suggestion-source should now support options that extract words from a json-key "}, {"time":"2013-02-20T14:18:14.041849-08:00", "updatedBy":{"username":"ehennum", "name":"Erik Hennum", "email":"erik.hennum@marklogic.com"}, "change":{"assignTo":{"from":{"username":"ehennum", "name":"Erik Hennum", "email":"erik.hennum@marklogic.com"}, "to":{"username":"ayuwono", "name":"Aries Yuwono", "email":"ayuwono@marklogic.com"}}}, "files":[], "show":true}, {"time":"2013-03-29T14:00:25.301248-07:00", "updatedBy":{"username":"msarma", "name":"Meghalim Sarma", "email":"msarma@marklogic.com"}, "change":{"assignTo":{"from":{"username":"msarma", "name":"Meghalim Sarma", "email":"msarma@marklogic.com"}, "to":{"username":"msarma", "name":"Meghalim Sarma", "email":"msarma@marklogic.com"}}}, "files":[], "show":true}, {"time":"2013-03-31T20:04:10.691531-07:00", "updatedBy":{"username":"msarma", "name":"Meghalim Sarma", "email":"msarma@marklogic.com"}, "change":{}, "files":[], "show":true, "comment":"Aries, when you add test for suggestion support for json:key, let us add the same test to 7.0 as well"}, {"time":"2013-03-31T20:04:10.691531-07:00", "updatedBy":{"username":"msarma", "name":"Meghalim Sarma", "email":"msarma@marklogic.com"}, "change":{"assignTo":{"from":{"username":"msarma", "name":"Meghalim Sarma", "email":"msarma@marklogic.com"}, "to":{"username":"ayuwono", "name":"Aries Yuwono", "email":"ayuwono@marklogic.com"}}}, "files":[], "show":true}, {"time":"2013-03-31T20:05:02.301791-07:00", "updatedBy":{"username":"msarma", "name":"Meghalim Sarma", "email":"msarma@marklogic.com"}, "change":{}, "files":[], "show":true, "comment":"Aries, when you add test for suggestion support for json:key, let us add the same test to 7.0 as well"}, {"time":"2013-03-31T20:05:02.301791-07:00", "updatedBy":{"username":"msarma", "name":"Meghalim Sarma", "email":"msarma@marklogic.com"}, "change":{"assignTo":{"from":{"username":"msarma", "name":"Meghalim Sarma", "email":"msarma@marklogic.com"}, "to":{"username":"msarma", "name":"Meghalim Sarma", "email":"msarma@marklogic.com"}}}, "files":[], "show":true}, {"time":"2013-04-01T11:00:51.924299-07:00", "updatedBy":{"username":"msarma", "name":"Meghalim Sarma", "email":"msarma@marklogic.com"}, "change":{"status":{"from":"", "to":"Ship"}, "assignTo":{"from":{"username":"msarma", "name":"Meghalim Sarma", "email":"msarma@marklogic.com"}, "to":{"username":"nobody", "name":"nobody nobody", "email":"nobody@marklogic.com"}}}, "files":[], "show":true, "comment":"Automated test searchAPI-bug20845.xml is added to regression and is passing on 6.0 0401 nightly run"}, {"time":"2013-04-01T11:00:51.924299-07:00", "updatedBy":{"username":"msarma", "name":"Meghalim Sarma", "email":"msarma@marklogic.com"}, "change":{"assignTo":{"from":{"username":"msarma", "name":"Meghalim Sarma", "email":"msarma@marklogic.com"}, "to":{"username":"nobody", "name":"nobody nobody", "email":"nobody@marklogic.com"}}}, "files":[], "show":true}, {"time":"2013-04-22T16:21:29.077323-07:00", "updatedBy":{"username":"rpelton", "name":"Rick Pelton", "email":"rick.pelton@marklogic.com"}, "change":{"status":{"from":"", "to":"Closed"}, "assignTo":{"from":{"username":"rpelton", "name":"Rick Pelton", "email":"rick.pelton@marklogic.com"}, "to":{"username":"nobody", "name":"nobody nobody", "email":"nobody@marklogic.com"}}}, "files":[], "show":true}], "updatedAt":"2013-04-22T16:21:29.077323-07:00", "fixedAt":"2013-02-20T14:18:14.041849-08:00", "fixedBy":{"username":"ehennum", "name":"Erik Hennum", "email":"erik.hennum@marklogic.com"}, "shippedAt":"2013-04-01T11:00:51.924299-07:00", "shippedBy":{"username":"msarma", "name":"Meghalim Sarma", "email":"msarma@marklogic.com"}, "closedAt":"2013-04-22T16:21:29.077323-07:00", "closedBy":{"username":"rpelton", "name":"Rick Pelton", "email":"rick.pelton@marklogic.com"}, "renderDescriptionAs":"normal"}
{"id":20545, "kind":"Bug", "createdAt":"2013-01-17T14:36:35.132692-08:00", "status":"Closed", "title":"xdmp:tidy exhaustive memory and cpu consumption --> crash of server", "category":"xdmp", "severity":"Critical", "priority":{"level":"5", "title":""}, "submittedBy":{"username":"oschwering", "name":"Olav  Schwering", "email":"oschwering@marklogic.com"}, "assignTo":{"username":"nobody", "name":"nobody nobody", "email":"nobody@marklogic.com"}, "description":"Converting the attached 44KB file with xdmp:tidy will consume 100% CPU and eats up all available memory after some time with the result that the server crashes.\r\n\r\nThis is the used XQuery code:\r\n\r\nlet $doc := xdmp:document-get(\r\n  \"/path/to/20120113.txt\",\r\n<options xmlns=\"xdmp:document-get\">\r\n     <format>xml</format>\r\n    </options>\r\n    )\r\nreturn xdmp:tidy($doc//articles/article/message/text())\r\n\r\nTested on on 5.0 and 6.0 versions. \r\n\r\n\r\n", "samplequery":"", "sampledata":"", "version":"7.0-nightly", "tofixin":"7.0-1", "fixedin":"7.0-1", "platform":"all", "memory":"", "processors":"", "note":"Fails also on 6.0.", "subscribers":[{"username":"oschwering", "name":"Olav  Schwering", "email":"oschwering@marklogic.com"}, {"username":"msrinivasan", "name":"Mahalakshmi Srinivasan", "email":"mahalakshmi.srinivasan@marklogic.com"}, {"username":"smiller", "name":"Scott Miller", "email":"Scott.Miller@marklogic.com"}, {"username":"rpolasani", "name":"Raghu Polasani", "email":"raghu.polasani@marklogic.com"}, {"username":"ksaxena", "name":"Kapil Saxena", "email":"kapil.saxena@marklogic.com"}], "attachments":[{"name":"conversion file", "uri":"root/support/bugtracking/attachments/20506/20120113.txt"}, {"name":"server error log", "uri":"root/support/bugtracking/attachments/20506/ErrorLog.txt"}, {"name":"linux /var/log/messages", "uri":"root/support/bugtracking/attachments/20506/messages.txt"}], "relationships":[{"type":"", "to":""}], "clones":[], "cloneOf":20506, "support":{"headline":"xdmp:tidy of source needing list and nested table inference can loop, exhaust memory, and crash the server.", "supportDescription":"When xdmp:tidy is run on a source document with an element pattern such as the following, where a <ul> element must be deduced from <li> and a nested table must be deduced within the same outer table element context, this can cause an infinite loop in system software, exhaust memory, and crash the server.", "publishStatus":"Publish", "tickets":[], "customerImpact":{"level":"High", "title":"Significant business impact with no reasonable workaround"}, "workaround":""}, "tags":["xdmp", "oschwering"], "changeHistory":[{"time":"2013-01-17T15:24:24.966985-08:00", "updatedBy":{"username":"dsokolsky", "name":"Danny Sokolsky", "email":"dsokolsky@marklogic.com"}, "change":{"status":{"from":"", "to":"Verify"}, "assignTo":{"from":{"username":"dsokolsky", "name":"Danny Sokolsky", "email":"dsokolsky@marklogic.com"}, "to":{"username":"smiller", "name":"Scott Miller", "email":"Scott.Miller@marklogic.com"}}}, "files":[], "show":true, "comment":"Scott, can you see if you can reproduce this and evaluate the cause?"}, {"time":"2013-01-17T15:24:24.966985-08:00", "updatedBy":{"username":"dsokolsky", "name":"Danny Sokolsky", "email":"dsokolsky@marklogic.com"}, "change":{"assignTo":{"from":{"username":"dsokolsky", "name":"Danny Sokolsky", "email":"dsokolsky@marklogic.com"}, "to":{"username":"smiller", "name":"Scott Miller", "email":"Scott.Miller@marklogic.com"}}}, "files":[], "show":true}, {"time":"2013-01-17T15:24:24.966985-08:00", "updatedBy":{"username":"dsokolsky", "name":"Danny Sokolsky", "email":"dsokolsky@marklogic.com"}, "change":{"tofixin":{"from":"", "to":"5.0-5"}}, "files":[], "show":true}, {"time":"2013-01-21T16:45:02.775469-08:00", "updatedBy":{"username":"rhu", "name":"Ron Hu", "email":"ron.hu@marklogic.com"}, "change":{}, "files":[], "show":true, "comment":"Hi Scott,\r\nSupport team thinks that this bug has high customer impact.  They want it to be fixed in 5.0-5.  Please give it a high priority.  Thanks."}, {"time":"2013-01-23T08:38:43.17089-08:00", "updatedBy":{"username":"smiller", "name":"Scott Miller", "email":"Scott.Miller@marklogic.com"}, "change":{}, "files":[], "show":true, "svn":{"repository":"/project/engsvn", "revision":"128988", "paths":["xdmp/trunk/src/tidy/src/parser.c"], "affectedBugs":[]}, "comment":"bug:20545 (clone of 20506) - in ParseList (which may be entered when processing an inferred list), set lexer->inTable to 'no' (only for implicity rows; in cases like bug 3531, ML may elect to remove a list and inherit an outer table context)."}, {"time":"2013-01-23T08:39:50.587211-08:00", "updatedBy":{"username":"smiller", "name":"Scott Miller", "email":"Scott.Miller@marklogic.com"}, "change":{"status":{"from":"", "to":"Test"}, "assignTo":{"from":{"username":"smiller", "name":"Scott Miller", "email":"Scott.Miller@marklogic.com"}, "to":{"username":"rpolasani", "name":"Raghu Polasani", "email":"raghu.polasani@marklogic.com"}}}, "files":[], "show":true, "comment":"Merge 5_0 fix forward."}, {"time":"2013-01-23T08:39:50.587211-08:00", "updatedBy":{"username":"smiller", "name":"Scott Miller", "email":"Scott.Miller@marklogic.com"}, "change":{"assignTo":{"from":{"username":"smiller", "name":"Scott Miller", "email":"Scott.Miller@marklogic.com"}, "to":{"username":"rpolasani", "name":"Raghu Polasani", "email":"raghu.polasani@marklogic.com"}}}, "files":[], "show":true}, {"time":"2013-01-23T08:39:50.587211-08:00", "updatedBy":{"username":"smiller", "name":"Scott Miller", "email":"Scott.Miller@marklogic.com"}, "change":{"tofixin":{"from":"", "to":"7.0-ea1"}}, "files":[], "show":true}, {"time":"2013-02-21T12:13:26.004352-08:00", "updatedBy":{"username":"rpolasani", "name":"Raghu Polasani", "email":"raghu.polasani@marklogic.com"}, "change":{"assignTo":{"from":{"username":"rpolasani", "name":"Raghu Polasani", "email":"raghu.polasani@marklogic.com"}, "to":{"username":"msrinivasan", "name":"Mahalakshmi Srinivasan", "email":"mahalakshmi.srinivasan@marklogic.com"}}}, "files":[], "show":true}, {"time":"2013-02-25T11:21:40.411576-08:00", "updatedBy":{"username":"msrinivasan", "name":"Mahalakshmi Srinivasan", "email":"mahalakshmi.srinivasan@marklogic.com"}, "change":{}, "files":[], "show":true, "comment":"Please see clone...it has steps to verify manually."}, {"time":"2013-02-25T11:21:40.411576-08:00", "updatedBy":{"username":"msrinivasan", "name":"Mahalakshmi Srinivasan", "email":"mahalakshmi.srinivasan@marklogic.com"}, "change":{"assignTo":{"from":{"username":"msrinivasan", "name":"Mahalakshmi Srinivasan", "email":"mahalakshmi.srinivasan@marklogic.com"}, "to":{"username":"rpolasani", "name":"Raghu Polasani", "email":"raghu.polasani@marklogic.com"}}}, "files":[], "show":true}, {"time":"2013-03-02T10:37:18.42311-08:00", "updatedBy":{"username":"rpolasani", "name":"Raghu Polasani", "email":"raghu.polasani@marklogic.com"}, "change":{"assignTo":{"from":{"username":"rpolasani", "name":"Raghu Polasani", "email":"raghu.polasani@marklogic.com"}, "to":{"username":"ksaxena", "name":"Kapil Saxena", "email":"kapil.saxena@marklogic.com"}}}, "files":[], "show":true}, {"time":"2013-03-04T01:49:31.024272-08:00", "updatedBy":{"username":"ksaxena", "name":"Kapil Saxena", "email":"kapil.saxena@marklogic.com"}, "change":{"status":{"from":"", "to":"Ship"}, "assignTo":{"from":{"username":"ksaxena", "name":"Kapil Saxena", "email":"kapil.saxena@marklogic.com"}, "to":{"username":"nobody", "name":"nobody nobody", "email":"nobody@marklogic.com"}}}, "files":[], "show":true, "comment":"Verified on 7.0-ea1_20130304."}, {"time":"2013-03-04T01:49:31.024272-08:00", "updatedBy":{"username":"ksaxena", "name":"Kapil Saxena", "email":"kapil.saxena@marklogic.com"}, "change":{"assignTo":{"from":{"username":"ksaxena", "name":"Kapil Saxena", "email":"kapil.saxena@marklogic.com"}, "to":{"username":"nobody", "name":"nobody nobody", "email":"nobody@marklogic.com"}}}, "files":[], "show":true}], "updatedAt":"2013-03-04T01:49:31.024272-08:00", "fixedAt":"2013-01-23T08:39:50.587211-08:00", "fixedBy":{"username":"smiller", "name":"Scott Miller", "email":"Scott.Miller@marklogic.com"}, "shippedAt":"2013-03-04T01:49:31.024272-08:00", "shippedBy":{"username":"ksaxena", "name":"Kapil Saxena", "email":"kapil.saxena@marklogic.com"}, "renderDescriptionAs":"normal"}
{"id":20927, "kind":"Bug", "createdAt":"2013-02-22T13:59:54.852611-08:00", "status":"Closed", "title":"timeout when displaying thousands of protected collections", "category":"adminGUI", "severity":"Major", "priority":{"level":"5", "title":""}, "submittedBy":{"username":"jespinoza", "name":"Jose Espinoza", "email":"jespinoza@marklogic.com"}, "assignTo":{"username":"nobody", "name":"nobody nobody", "email":"nobody@marklogic.com"}, "description":"The Admin UI times out when there are several thousand collections while trying to display them in t his page:\r\n\r\nAdmin UI -> Security -> collections\r\n\r\nIt seems the algorithm does not scale for thousands of collections.", "samplequery":"", "sampledata":"", "version":"6.0-1", "tofixin":"6.0-4", "fixedin":"6.0-4", "platform":"linux(64-bit)", "memory":"", "processors":"", "note":"Reported by Kevin Fries of Catalyst as support case 12535.", "subscribers":[{"username":"jespinoza", "name":"Jose Espinoza", "email":"jespinoza@marklogic.com"}, {"username":"cjl", "name":"Christopher Lindblad", "email":"cjl@cerisent.com"}, {"username":"mdubinko", "name":"Micah  Dubinko", "email":"mdubinko@marklogic.com"}, {"username":"gvaidees", "name":"Ganesh Vaideeswaran", "email":"Ganesh.Vaideeswaran@marklogic.com"}, {"username":"msarma", "name":"Meghalim Sarma", "email":"msarma@marklogic.com"}], "attachments":[], "relationships":[{"type":"", "to":""}], "clones":[23151], "cloneOf":20907, "support":{"headline":"Administratation UI times out with large number of collections", "supportDescription":"Viewing a large number of protected collection in the administration UI (under Security -> Collections) could result in browser timing out. In order to prevent such time out, only 250 collections will be displayed.", "publishStatus":"Publish", "tickets":[], "customerImpact":{"level":"Medium", "title":"Requires significant or unnatural effort to work around issue or to prevent significant business impact"}, "workaround":""}, "tags":["adminGUI", "jespinoza"], "changeHistory":[{"time":"2013-02-22T14:53:46.641706-08:00", "updatedBy":{"username":"dsokolsky", "name":"Danny Sokolsky", "email":"dsokolsky@marklogic.com"}, "change":{"status":{"from":"", "to":"Verify"}, "assignTo":{"from":{"username":"dsokolsky", "name":"Danny Sokolsky", "email":"dsokolsky@marklogic.com"}, "to":{"username":"mdubinko", "name":"Micah  Dubinko", "email":"mdubinko@marklogic.com"}}}, "files":[], "show":true, "comment":"Note that this displays protected collections."}, {"time":"2013-02-22T14:53:46.641706-08:00", "updatedBy":{"username":"dsokolsky", "name":"Danny Sokolsky", "email":"dsokolsky@marklogic.com"}, "change":{"assignTo":{"from":{"username":"dsokolsky", "name":"Danny Sokolsky", "email":"dsokolsky@marklogic.com"}, "to":{"username":"mdubinko", "name":"Micah  Dubinko", "email":"mdubinko@marklogic.com"}}}, "files":[], "show":true}, {"time":"2013-02-22T14:53:46.641706-08:00", "updatedBy":{"username":"dsokolsky", "name":"Danny Sokolsky", "email":"dsokolsky@marklogic.com"}, "change":{"tofixin":{"from":"", "to":"5.0-6"}}, "files":[], "show":true}, {"time":"2013-02-22T15:00:41.220414-08:00", "updatedBy":{"username":"rpelton", "name":"Rick Pelton", "email":"rick.pelton@marklogic.com"}, "change":{}, "files":[], "show":true, "comment":"cloning to 6.0 branch"}, {"time":"2013-02-25T14:11:36.442904-08:00", "updatedBy":{"username":"jespinoza", "name":"Jose Espinoza", "email":"jespinoza@marklogic.com"}, "change":{}, "files":[], "show":true, "comment":"Customer is asking about this issue. Setting To-Fix-In to '5.0-5'.\r\n\r\nAlso, customer is asking how many collections it takes before it stops scaling."}, {"time":"2013-02-25T14:11:36.442904-08:00", "updatedBy":{"username":"jespinoza", "name":"Jose Espinoza", "email":"jespinoza@marklogic.com"}, "change":{"tofixin":{"from":"5.0-6", "to":"5.0-5"}}, "files":[], "show":true}, {"time":"2013-02-25T17:28:44.255493-08:00", "updatedBy":{"username":"rpelton", "name":"Rick Pelton", "email":"rick.pelton@marklogic.com"}, "change":{"tofixin":{"from":"5.0-5", "to":"5.0-6"}}, "files":[], "show":true}, {"time":"2013-02-25T17:30:02.396459-08:00", "updatedBy":{"username":"rpelton", "name":"Rick Pelton", "email":"rick.pelton@marklogic.com"}, "change":{"tofixin":{"from":"", "to":"6.0-3"}}, "files":[], "show":true}, {"time":"2013-03-03T23:43:25.771395-08:00", "updatedBy":{"username":"gvaidees", "name":"Ganesh Vaideeswaran", "email":"Ganesh.Vaideeswaran@marklogic.com"}, "change":{"assignTo":{"from":{"username":"gvaidees", "name":"Ganesh Vaideeswaran", "email":"Ganesh.Vaideeswaran@marklogic.com"}, "to":{"username":"gvaidees", "name":"Ganesh Vaideeswaran", "email":"Ganesh.Vaideeswaran@marklogic.com"}}}, "files":[], "show":true}, {"time":"2013-03-05T12:08:02.195595-08:00", "updatedBy":{"username":"gvaidees", "name":"Ganesh Vaideeswaran", "email":"Ganesh.Vaideeswaran@marklogic.com"}, "change":{}, "files":[], "show":true, "comment":"Rick, Jose, \r\n\r\nCan the solution be to display a certain number (say 100) and indicate the total count and how many are not displayed. The admin UI is not conducive to such large scale number of collections. Even if we were able to display them, the user has to scroll down to see what they are interested in. We do not have a mechanism to page or search for specific subsets of collections.\r\n\r\nSome advice/input on a solution would be good. Danny, feel free to jump in.\r\n\r\nThanks,\r\n\r\nGanesh"}, {"time":"2013-03-05T15:50:45.356325-08:00", "updatedBy":{"username":"gvaidees", "name":"Ganesh Vaideeswaran", "email":"Ganesh.Vaideeswaran@marklogic.com"}, "change":{}, "files":[], "show":true, "comment":"I am going to truncate to first 20 collections and then say that users can use the API to retrieve the large list. \r\n\r\nChristopher,\r\n\r\nNot sure if you have any advice on this defect"}, {"time":"2013-03-08T11:12:57.578181-08:00", "updatedBy":{"username":"gvaidees", "name":"Ganesh Vaideeswaran", "email":"Ganesh.Vaideeswaran@marklogic.com"}, "change":{}, "files":[], "show":true, "comment":"As per guidance from Rick. Movint to 6.0-4"}, {"time":"2013-03-08T11:12:57.578181-08:00", "updatedBy":{"username":"gvaidees", "name":"Ganesh Vaideeswaran", "email":"Ganesh.Vaideeswaran@marklogic.com"}, "change":{"tofixin":{"from":"6.0-3", "to":"6.0-4"}}, "files":[], "show":true}, {"time":"2013-05-12T21:54:19.246539-07:00", "updatedBy":{"username":"gvaidees", "name":"Ganesh Vaideeswaran", "email":"Ganesh.Vaideeswaran@marklogic.com"}, "change":{}, "files":[], "show":true, "comment":"Rick, Jose,\r\n\r\nare you OK with only showing the first 20 collections and asking the user to use APIs to look at all security collections."}, {"time":"2013-05-13T12:07:10.153469-07:00", "updatedBy":{"username":"jespinoza", "name":"Jose Espinoza", "email":"jespinoza@marklogic.com"}, "change":{}, "files":[], "show":true, "comment":"This probably won't fly with the customer. I recall Blakeley putting in a fix for the case of too many users, can we do the same thing for protected collections?\r\n\r\nAlso, is there an existing RFE for fixing this type of issue throughout the Admin UI? If not, I will submit one.\r\n"}, {"time":"2013-06-28T11:33:05.497685-07:00", "updatedBy":{"username":"rpelton", "name":"Rick Pelton", "email":"rick.pelton@marklogic.com"}, "change":{}, "files":[], "show":true, "comment":"push to later release if too difficult for 6.0-4"}, {"time":"2013-07-11T15:41:39.48132-07:00", "updatedBy":{"username":"gvaidees", "name":"Ganesh Vaideeswaran", "email":"Ganesh.Vaideeswaran@marklogic.com"}, "change":{}, "files":[], "show":true, "comment":"As per our discussion, I am showing 250 collections only. If number of collections exceed 250, I display a message in red such as \r\n\r\nOnly 250of 1000 collections displayed \r\n\r\nSubscribing Chris to make sure he is aware of this, since he wanted to cover this whole thing as an RFE. I want to make sure he is OK with this interim solution"}, {"time":"2013-07-15T21:03:34.270178-07:00", "updatedBy":{"username":"gvaidees", "name":"Ganesh Vaideeswaran", "email":"Ganesh.Vaideeswaran@marklogic.com"}, "change":{}, "files":[], "show":true, "comment":"Fixed pas part of SVN Info: \r\nRevision: 146803\r\n\r\nModified Files:\r\nxdmp/branches/b6_0/src/Admin/lib/collection-summary-form.xqy\r\nxdmp/branches/b6_0/src/Admin/lib/nav-format.xqy"}, {"time":"2013-07-15T21:03:34.270178-07:00", "updatedBy":{"username":"gvaidees", "name":"Ganesh Vaideeswaran", "email":"Ganesh.Vaideeswaran@marklogic.com"}, "change":{"assignTo":{"from":{"username":"gvaidees", "name":"Ganesh Vaideeswaran", "email":"Ganesh.Vaideeswaran@marklogic.com"}, "to":{"username":"msarma", "name":"Meghalim Sarma", "email":"msarma@marklogic.com"}}}, "files":[], "show":true}, {"time":"2013-07-16T15:59:26.04951-07:00", "updatedBy":{"username":"gvaidees", "name":"Ganesh Vaideeswaran", "email":"Ganesh.Vaideeswaran@marklogic.com"}, "change":{"status":{"from":"", "to":"Test"}, "assignTo":{"from":{"username":"gvaidees", "name":"Ganesh Vaideeswaran", "email":"Ganesh.Vaideeswaran@marklogic.com"}, "to":{"username":"msarma", "name":"Meghalim Sarma", "email":"msarma@marklogic.com"}}}, "files":[], "show":true}, {"time":"2013-07-18T14:18:01.436097-07:00", "updatedBy":{"username":"msarma", "name":"Meghalim Sarma", "email":"msarma@marklogic.com"}, "change":{"status":{"from":"", "to":"Ship"}, "assignTo":{"from":{"username":"msarma", "name":"Meghalim Sarma", "email":"msarma@marklogic.com"}, "to":{"username":"nobody", "name":"nobody nobody", "email":"nobody@marklogic.com"}}}, "files":[], "show":true}, {"time":"2013-07-18T14:18:01.436097-07:00", "updatedBy":{"username":"msarma", "name":"Meghalim Sarma", "email":"msarma@marklogic.com"}, "change":{"assignTo":{"from":{"username":"msarma", "name":"Meghalim Sarma", "email":"msarma@marklogic.com"}, "to":{"username":"nobody", "name":"nobody nobody", "email":"nobody@marklogic.com"}}}, "files":[], "show":true}, {"time":"2013-07-18T14:33:57.083797-07:00", "updatedBy":{"username":"msarma", "name":"Meghalim Sarma", "email":"msarma@marklogic.com"}, "change":{}, "files":[], "show":true, "comment":"Verified on 0718 6.0 build.\r\n\r\nCreated 500 protected collections and verified the behavior in Admin GUI. Admin GUI now displays 250 collections with an message indicating that not all collections are seen here (Only 250 of 506 collections displayed )\r\n\r\n(: Create 500 Collections :) \r\nxdmp:document-insert(\"/a.xml\",<doc>hello</doc>);\r\nfor $i in 1 to 500\r\nreturn xdmp:document-add-collections(\r\n    \"/a.xml\", \r\n    concat(\"http://examples-\",$i,\".com\")); \r\n\r\n(: make those 500 collections protected :)\r\nxquery version \"1.0-ml\";\r\nimport module namespace sec=\"http://marklogic.com/xdmp/security\" at  \"/MarkLogic/security.xqy\";\r\nfor $i in 1 to 500\r\nreturn sec:protect-collection(concat(\"http://examples-\",$i,\".com\"), \r\n                       (xdmp:permission(\"app-user\", \"read\"), \r\n                        xdmp:permission(\"app-user\", \"insert\")))"}, {"time":"2013-07-18T15:07:30.501836-07:00", "updatedBy":{"username":"msarma", "name":"Meghalim Sarma", "email":"msarma@marklogic.com"}, "change":{}, "files":[], "show":true, "comment":"Want to add a note that passing count=506 in the URL returns all the collections."}, {"time":"2013-07-23T15:08:23.104305-07:00", "updatedBy":{"username":"rpelton", "name":"Rick Pelton", "email":"rick.pelton@marklogic.com"}, "change":{}, "files":[], "show":true, "comment":"Note for support only: There is a hidden URL parameter called count that can be used to increase/decrease the default display count of 250. Here is an example - \r\n\r\nhttp://<host>:8001/collection-summary.xqy?section=security&count=500"}, {"time":"2013-08-12T18:07:16.691981-07:00", "updatedBy":{"username":"rpelton", "name":"Rick Pelton", "email":"rick.pelton@marklogic.com"}, "change":{"status":{"from":"", "to":"Closed"}, "assignTo":{"from":{"username":"rpelton", "name":"Rick Pelton", "email":"rick.pelton@marklogic.com"}, "to":{"username":"nobody", "name":"nobody nobody", "email":"nobody@marklogic.com"}}}, "files":[], "show":true}], "updatedAt":"2013-08-12T18:07:16.691981-07:00", "fixedAt":"2013-07-16T15:59:26.04951-07:00", "fixedBy":{"username":"gvaidees", "name":"Ganesh Vaideeswaran", "email":"Ganesh.Vaideeswaran@marklogic.com"}, "shippedAt":"2013-07-18T14:18:01.436097-07:00", "shippedBy":{"username":"msarma", "name":"Meghalim Sarma", "email":"msarma@marklogic.com"}, "closedAt":"2013-08-12T18:07:16.691981-07:00", "closedBy":{"username":"rpelton", "name":"Rick Pelton", "email":"rick.pelton@marklogic.com"}, "renderDescriptionAs":"normal"}
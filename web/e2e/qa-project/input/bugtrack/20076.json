{"id":20076, "kind":"Bug", "createdAt":"2012-10-16T13:08:01.11723-07:00", "status":"Closed", "title":"Invalid JSON not rejected", "category":"", "severity":"Minor", "priority":{"level":"5", "title":""}, "submittedBy":{"username":"nwalsh", "name":"Norman Walsh", "email":"norman.walsh@marklogic.com"}, "assignTo":{"username":"nobody", "name":"nobody nobody", "email":"nobody@marklogic.com"}, "description":"The following invalid fragment is not rejected:\r\n\r\nlet $x := '{\r\n    \"query\": {\r\n        \"or-query\": {\r\n                \"term-query\": {\r\n                    \"text\": \"cafe\"\r\n                },\r\n                \"term-query\": {\r\n                    \"text\": \"deli\"\r\n                }\r\n        }\r\n    }\r\n}\r\n'\r\nreturn\r\n  xdmp:from-json($x)\r\n  ", "samplequery":"", "sampledata":"", "version":"7.0-nightly", "tofixin":"7.0-ea1", "fixedin":"7.0-ea1", "platform":"all", "memory":"", "processors":"", "note":"", "subscribers":[{"username":"nwalsh", "name":"Norman Walsh", "email":"norman.walsh@marklogic.com"}, {"username":"dlee", "name":"David  Lee", "email":"David.Lee@marklogic.com"}, {"username":"rpolasani", "name":"Raghu Polasani", "email":"raghu.polasani@marklogic.com"}], "attachments":[], "relationships":[{"type":"", "to":""}], "clones":[], "cloneOf":19782, "support":{"headline":"", "supportDescription":"", "publishStatus":"Not Ready", "tickets":[], "customerImpact":{"level":"N/A", "title":""}, "workaround":""}, "tags":["", "nwalsh"], "changeHistory":[{"time":"2012-10-17T09:50:44.453931-07:00", "updatedBy":{"username":"rhu", "name":"Ron Hu", "email":"ron.hu@marklogic.com"}, "change":{"status":{"from":"", "to":"Verify"}, "assignTo":{"from":{"username":"rhu", "name":"Ron Hu", "email":"ron.hu@marklogic.com"}, "to":{"username":"dlee", "name":"David  Lee", "email":"David.Lee@marklogic.com"}}}, "files":[], "show":true}, {"time":"2012-10-17T09:50:44.453931-07:00", "updatedBy":{"username":"rhu", "name":"Ron Hu", "email":"ron.hu@marklogic.com"}, "change":{"assignTo":{"from":{"username":"rhu", "name":"Ron Hu", "email":"ron.hu@marklogic.com"}, "to":{"username":"dlee", "name":"David  Lee", "email":"David.Lee@marklogic.com"}}}, "files":[], "show":true}, {"time":"2012-10-17T09:50:44.453931-07:00", "updatedBy":{"username":"rhu", "name":"Ron Hu", "email":"ron.hu@marklogic.com"}, "change":{"tofixin":{"from":"", "to":"6.0-2"}}, "files":[], "show":true}, {"time":"2012-10-18T14:18:19.589637-07:00", "updatedBy":{"username":"rhu", "name":"Ron Hu", "email":"ron.hu@marklogic.com"}, "change":{"tofixin":{"from":"6.0-2", "to":"6.0-3"}}, "files":[], "show":true}, {"time":"2012-11-05T15:11:12.914361-08:00", "updatedBy":{"username":"dlee", "name":"David  Lee", "email":"David.Lee@marklogic.com"}, "change":{}, "files":[], "show":true, "comment":"This is interesting.   I do question that it is a requirement that the above invalid JSON be rejected.\r\nIs the xdmp:from-json() *required* to reject invalid or semi valid JSON ?   \r\nThere are many fuzy boundries where it is useful to accept the JSON and just do something with it, although I agree this is prety far over the fuzzy fence.   But on example is that xdmp:from-json accepts unquoted key names event though they are invalid .. .they occur all the time in the wild.\r\n\r\nI suggest perhaps this be changed to an RFE where we have a set of fixup options with various levels of tolerance such as we do with XML parsing.\r\nMy main consideration is that is this hurting more then helping people by rejecting \"invalid\"  JSON ... when we have indentified real world cases where it actually helps to pass it through.  Where do we draw the line and what is the business case for it ?"}, {"time":"2012-11-06T13:00:29.953187-08:00", "updatedBy":{"username":"nwalsh", "name":"Norman Walsh", "email":"norman.walsh@marklogic.com"}, "change":{}, "files":[], "show":true, "comment":"Well, the problem with not rejecting this bit of invalid JSON is that it causes the search to fail in inexplicable ways.\r\n\r\nIf I can't validate the JSON, I don't know how to prevent that problem."}, {"time":"2012-11-08T13:40:17.994201-08:00", "updatedBy":{"username":"dlee", "name":"David  Lee", "email":"David.Lee@marklogic.com"}, "change":{}, "files":[], "show":true, "comment":"Suggestions welcome on a \"WISH LIST\" of what \"invalid\" JSON should be rejected.\r\n\r\nI agree duplicate names should either be rejected or the 2nd name replacing the first (?)\r\n\r\nOther Fix-em-or-abort suggestions ?\r\n"}, {"time":"2012-11-13T12:19:01.174047-08:00", "updatedBy":{"username":"dlee", "name":"David  Lee", "email":"David.Lee@marklogic.com"}, "change":{}, "files":[], "show":true, "svn":{"repository":"/project/engsvn", "revision":"120392", "paths":["xdmp/trunk/src/Messages/XDMP-en.xml", "xdmp/trunk/src/JSONBuiltins.cpp"], "affectedBugs":[]}, "comment":"bug:20076 Reject JSON with duplicate key names in a single object.\n"}, {"time":"2012-11-13T12:19:43.734176-08:00", "updatedBy":{"username":"dlee", "name":"David  Lee", "email":"David.Lee@marklogic.com"}, "change":{"status":{"from":"", "to":"Test"}, "assignTo":{"from":{"username":"dlee", "name":"David  Lee", "email":"David.Lee@marklogic.com"}, "to":{"username":"dlee", "name":"David  Lee", "email":"David.Lee@marklogic.com"}}}, "files":[], "show":true, "comment":"Test with:\r\n\r\nxdmp:from-json( \"{ a: 1 , a : 2 }\" )\r\n\r\nShould produce:\r\n\r\n[1.0-ml] XDMP-JSONDUPKEY: xdmp:from-json(\"{ a: 1 , a : 2 }\") -- Duplicate key value on line 1\r\n"}, {"time":"2012-12-03T10:56:25.429725-08:00", "updatedBy":{"username":"dlee", "name":"David  Lee", "email":"David.Lee@marklogic.com"}, "change":{"assignTo":{"from":{"username":"dlee", "name":"David  Lee", "email":"David.Lee@marklogic.com"}, "to":{"username":"rpolasani", "name":"Raghu Polasani", "email":"raghu.polasani@marklogic.com"}}}, "files":[], "show":true}, {"time":"2012-12-04T16:33:37.507634-08:00", "updatedBy":{"username":"lling", "name":"Ling Ling", "email":"ling.ling@marklogic.com"}, "change":{}, "files":[], "show":true, "svn":{"repository":"/project/engsvn", "revision":"122715", "paths":["qa/trunk/scripts/keys/bug20076.xml", "qa/trunk/scripts/tests/bug20076.xml", "qa/trunk/scripts/list/bugs51.txt"], "affectedBugs":[]}, "comment":"bug:20076"}, {"time":"2012-12-04T16:34:51.125179-08:00", "updatedBy":{"username":"lling", "name":"Ling Ling", "email":"ling.ling@marklogic.com"}, "change":{"status":{"from":"", "to":"Ship"}, "assignTo":{"from":{"username":"lling", "name":"Ling Ling", "email":"ling.ling@marklogic.com"}, "to":{"username":"nobody", "name":"nobody nobody", "email":"nobody@marklogic.com"}}}, "files":[], "show":true}, {"time":"2012-12-04T16:34:51.125179-08:00", "updatedBy":{"username":"lling", "name":"Ling Ling", "email":"ling.ling@marklogic.com"}, "change":{"assignTo":{"from":{"username":"lling", "name":"Ling Ling", "email":"ling.ling@marklogic.com"}, "to":{"username":"nobody", "name":"nobody nobody", "email":"nobody@marklogic.com"}}}, "files":[], "show":true}, {"time":"2013-01-09T17:04:25.485374-08:00", "updatedBy":{"username":"lling", "name":"Ling Ling", "email":"ling.ling@marklogic.com"}, "change":{}, "files":[], "show":true, "svn":{"repository":"/project/engsvn", "revision":"127279", "paths":["qa/trunk/scripts/tests/json_basic_2.xml", "qa/trunk/scripts/keys/json_basic_2.xml", "qa/trunk/scripts/keys/json_custom_4.xml", "qa/trunk/scripts/tests/json_custom_4.xml"], "affectedBugs":[]}, "comment":"bug:20076 fix regression diff due to bug fix"}, {"time":"2013-01-09T17:05:29.959993-08:00", "updatedBy":{"username":"lling", "name":"Ling Ling", "email":"ling.ling@marklogic.com"}, "change":{}, "files":[], "show":true, "svn":{"repository":"/project/engsvn", "revision":"127280", "paths":["qa/trunk/scripts/keys/json_transform_to_json_object_basic.xml", "qa/trunk/scripts/keys/json_transform_to_json_xml_basic.xml", "qa/trunk/scripts/tests/json_transform_to_json_xml_basic.xml", "qa/trunk/scripts/tests/json_transform_to_json_object_basic.xml"], "affectedBugs":["18904"]}, "comment":"bug:20076 bug:18904 fix regression diff due to bug fix"}, {"time":"2013-01-09T17:06:36.552031-08:00", "updatedBy":{"username":"lling", "name":"Ling Ling", "email":"ling.ling@marklogic.com"}, "change":{}, "files":[], "show":true, "svn":{"repository":"/project/engsvn", "revision":"127281", "paths":["qa/trunk/scripts/keys/from_json.xml"], "affectedBugs":["20065"]}, "comment":"bug:20065 bug:20076 fix regression diff due to bug fix"}], "updatedAt":"2013-01-09T17:06:36.552031-08:00", "fixedAt":"2012-11-13T12:19:43.734176-08:00", "fixedBy":{"username":"dlee", "name":"David  Lee", "email":"David.Lee@marklogic.com"}, "shippedAt":"2012-12-04T16:34:51.125179-08:00", "shippedBy":{"username":"lling", "name":"Ling Ling", "email":"ling.ling@marklogic.com"}, "renderDescriptionAs":"normal"}
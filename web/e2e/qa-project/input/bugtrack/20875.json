{"id":20875, "kind":"Bug", "createdAt":"2013-02-21T04:14:04.649042-08:00", "status":"Closed", "title":"REGR:cts:search yields higher scores on field queries", "category":"search", "severity":"Major", "priority":{"level":"5", "title":""}, "submittedBy":{"username":"iagrawal", "name":"Isha Agrawal", "email":"iagrawal@marklogic.com"}, "assignTo":{"username":"nobody", "name":"nobody nobody", "email":"nobody@marklogic.com"}, "description":"cts:search is yielding higher scores on field queries: cts:field-word-query and cts:field-value-query\r\n\r\nTest failing: synonym-field-value-query.xml\r\nMl version: 20130220\r\n\r\nSteps to reproduce:\r\n\r\n1. Create DB with forest.\r\n2. Enable field value positions and field value searches.\r\n3. Setup field title in DB:\r\nxquery version \"1.0-ml\";\r\n   import module namespace admin=\"http://marklogic.com/xdmp/admin\" at \"/MarkLogic/admin.xqy\";\r\n   let $name := \"sewq11\"\r\n   let $dbid := xdmp:database($name)\r\n   let $config := admin:get-configuration()\r\n   let $fieldspec := admin:database-field(\"foo\", fn:false() )\r\n   let $config := admin:database-add-field($config, $dbid, $fieldspec)\r\n   let $fieldspec := admin:database-included-element(\"\",\r\n        \"foo\", 1.0, \"\", \"\", \"\")\r\n   let $config := admin:database-add-field-included-element($config, $dbid, \"foo\", $fieldspec)\r\n   return admin:save-configuration($config)\r\n4. Insert Documents\r\n xquery version \"1.0-ml\";\r\n        xdmp:document-insert(\"/test1.xml\", <baz><foo>cat feline kitty</foo></baz>);\r\n        xdmp:document-insert(\"/test2.xml\", <baz><foo>cat cat</foo></baz>);\r\n        xdmp:document-insert(\"/test3.xml\", <baz><foo>cat feline</foo></baz>);\r\n        xdmp:document-insert(\"/test4.xml\", <baz><foo>cat</foo></baz>);\r\n        xdmp:document-insert(\"/test5.xml\", <baz><foo>feline</foo></baz>);\r\n        xdmp:document-insert(\"/test6.xml\", <baz><foo>kitty</foo></baz>);\r\n        xdmp:document-insert(\"/test7.xml\", <baz><foo>cat cat cat feline feline feline feline kitty kitty kitty kitty</foo></baz>);\r\n        xdmp:document-insert(\"/test8.xml\", <baz><foo>cat cat cat feline feline feline feline feline kitty kitty kitty</foo></baz>);\r\n        xdmp:document-insert(\"/test9.xml\", <baz><foo>cat cat cat feline feline feline kitty kitty kitty kitty kitty</foo></baz>);\r\n        xdmp:document-insert(\"/test10.xml\", <baz><bar><foo>cat</foo><foo>feline</foo><foo>kitty</foo></bar></baz>);\r\n        xdmp:document-insert(\"/test11.xml\", <baz><bar><foo>cat</foo><foo>feline</foo></bar></baz>);\r\n        xdmp:document-insert(\"/test12.xml\", <baz><bar><foo>cat</foo></bar></baz>);\r\n5. Perform merge and wait till merge is done\r\n6. Run Following query:\r\nfor $doc in cts:search( /baz, cts:field-value-query(\"foo\", (\"cat\", \"feline\", \"kitty\"))) return <doc uri=\"{base-uri($doc)}\" score=\"{cts:score($doc)}\"/>\r\n\r\nActual result:\r\n<doc score=\"37547\" uri=\"/test10.xml\"/>\r\n<doc score=\"23211\" uri=\"/test11.xml\"/>\r\n<doc score=\"14336\" uri=\"/test6.xml\"/>\r\n<doc score=\"12288\" uri=\"/test5.xml\"/>\r\n<doc score=\"10923\" uri=\"/test12.xml\"/>\r\n<doc score=\"10923\" uri=\"/test4.xml\"/>\r\n\r\nExpected Result:\r\n<doc score=\"36864\" uri=\"/test10.xml\"/>\r\n<doc score=\"22528\" uri=\"/test11.xml\"/>\r\n<doc score=\"14336\" uri=\"/test6.xml\"/>\r\n<doc score=\"12288\" uri=\"/test5.xml\"/>\r\n<doc score=\"10240\" uri=\"/test12.xml\"/>\r\n<doc score=\"10240\" uri=\"/test4.xml\"/>\r\n\r\nThe following tests are also failing with similar reasons:\r\nsynonym-field-value-query-wild.xml,synonym-field-word-query-wild.xml,synonym-field-word-query.xml\r\n\r\nNote: these tests started failing since 2013-02-16\r\n", "samplequery":"", "sampledata":"", "version":"7.0-nightly", "tofixin":"7.0-ea3", "fixedin":"7.0-ea3", "platform":"all", "memory":"", "processors":"", "note":"", "subscribers":[{"username":"iagrawal", "name":"Isha Agrawal", "email":"iagrawal@marklogic.com"}, {"username":"gchinchwadkar", "name":"Gajanan Chinchwadkar", "email":"Gajanan.Chinchwadkar@marklogic.com"}, {"username":"sverma", "name":"Shiva Verma", "email":"shiva.verma@marklogic.com"}, {"username":"rpolasani", "name":"Raghu Polasani", "email":"raghu.polasani@marklogic.com"}], "attachments":[], "relationships":[{"type":"", "to":""}], "clones":[], "cloneOf":"", "support":{"headline":"", "supportDescription":"", "publishStatus":"Not Ready", "tickets":[], "customerImpact":{"level":"N/A", "title":""}, "workaround":""}, "tags":["search", "iagrawal"], "changeHistory":[{"time":"2013-02-21T04:14:04.649042-08:00", "updatedBy":{"username":"iagrawal", "name":"Isha Agrawal", "email":"iagrawal@marklogic.com"}, "change":{"assignTo":{"from":{"username":"iagrawal", "name":"Isha Agrawal", "email":"iagrawal@marklogic.com"}, "to":{"username":"gchinchwadkar", "name":"Gajanan Chinchwadkar", "email":"Gajanan.Chinchwadkar@marklogic.com"}}}, "files":[], "show":true}, {"time":"2013-02-21T11:43:04.343216-08:00", "updatedBy":{"username":"gchinchwadkar", "name":"Gajanan Chinchwadkar", "email":"Gajanan.Chinchwadkar@marklogic.com"}, "change":{}, "files":[], "show":true, "comment":"I think this is fixed with my Feb 19th checkin revisions r132491 and r132526. I will verify today's regression run and then assign it back to Isha."}, {"time":"2013-02-21T18:19:49.168212-08:00", "updatedBy":{"username":"gchinchwadkar", "name":"Gajanan Chinchwadkar", "email":"Gajanan.Chinchwadkar@marklogic.com"}, "change":{"status":{"from":"", "to":"Test"}, "assignTo":{"from":{"username":"gchinchwadkar", "name":"Gajanan Chinchwadkar", "email":"Gajanan.Chinchwadkar@marklogic.com"}, "to":{"username":"iagrawal", "name":"Isha Agrawal", "email":"iagrawal@marklogic.com"}}}, "files":[], "show":true}, {"time":"2013-02-21T18:19:49.168212-08:00", "updatedBy":{"username":"gchinchwadkar", "name":"Gajanan Chinchwadkar", "email":"Gajanan.Chinchwadkar@marklogic.com"}, "change":{"assignTo":{"from":{"username":"gchinchwadkar", "name":"Gajanan Chinchwadkar", "email":"Gajanan.Chinchwadkar@marklogic.com"}, "to":{"username":"iagrawal", "name":"Isha Agrawal", "email":"iagrawal@marklogic.com"}}}, "files":[], "show":true}, {"time":"2013-02-25T04:11:26.587248-08:00", "updatedBy":{"username":"iagrawal", "name":"Isha Agrawal", "email":"iagrawal@marklogic.com"}, "change":{}, "files":[], "show":true, "comment":"Hi Gajanan,\r\nThese are still failing on 7.0-ea1 with similar reasons"}, {"time":"2013-02-25T04:11:26.587248-08:00", "updatedBy":{"username":"iagrawal", "name":"Isha Agrawal", "email":"iagrawal@marklogic.com"}, "change":{"assignTo":{"from":{"username":"iagrawal", "name":"Isha Agrawal", "email":"iagrawal@marklogic.com"}, "to":{"username":"gchinchwadkar", "name":"Gajanan Chinchwadkar", "email":"Gajanan.Chinchwadkar@marklogic.com"}}}, "files":[], "show":true}, {"time":"2013-02-27T05:39:57.596416-08:00", "updatedBy":{"username":"gchinchwadkar", "name":"Gajanan Chinchwadkar", "email":"Gajanan.Chinchwadkar@marklogic.com"}, "change":{}, "files":[], "show":true, "comment":"This looks like a test harness issue to me. I can get all these tests passed even now on my private latest nightly on b7_0-ea1.\r\n\r\nHere is a typical command I use to run tests as ut:\r\n make ut user=admin pass=admin tname=synonym-field-word-query.xml\r\n\r\nHere are the results that show time-stamp of when I ran these tests.\r\n\r\nWed Feb 27 05:30:34 PST 2013: creating threads...\r\nWed Feb 27 05:30:34 PST 2013: starting...\r\nWed Feb 27 05:31:05 PST 2013: Reporting results...\r\nWed Feb 27 05:31:05 PST 2013: Writing results to /space/gc/svnws/HEAD/qa2/scripts/results/synonym-field-value-query.xml\r\n\r\nTest synonym-field-value-query.xml: Passed\r\n---------------------------------------------------------------------\r\nWed Feb 27 05:32:59 PST 2013: creating threads...\r\nWed Feb 27 05:32:59 PST 2013: starting...\r\nWed Feb 27 05:33:33 PST 2013: Reporting results...\r\nWed Feb 27 05:33:33 PST 2013: Writing results to /space/gc/svnws/HEAD/qa2/scripts/results/synonym-field-value-query-wild.xml\r\n\r\nsynonym-field-value-query-wild.xml: Passed\r\n-----------------------------------------------------------------------\r\nWed Feb 27 05:34:42 PST 2013: creating threads...\r\nWed Feb 27 05:34:42 PST 2013: starting...\r\nWed Feb 27 05:35:16 PST 2013: Reporting results...\r\n\r\nTest synonym-field-word-query-wild.xml: Passed\r\n-------------------------------------------------------------------------\r\nWed Feb 27 05:36:17 PST 2013: creating threads...\r\nWed Feb 27 05:36:17 PST 2013: starting...\r\nWed Feb 27 05:36:46 PST 2013: Reporting results...\r\n\r\nTest synonym-field-word-query.xml: Passed\r\n-----------------------------------------------------------------------------\r\n\r\n"}, {"time":"2013-02-27T05:39:57.596416-08:00", "updatedBy":{"username":"gchinchwadkar", "name":"Gajanan Chinchwadkar", "email":"Gajanan.Chinchwadkar@marklogic.com"}, "change":{"assignTo":{"from":{"username":"gchinchwadkar", "name":"Gajanan Chinchwadkar", "email":"Gajanan.Chinchwadkar@marklogic.com"}, "to":{"username":"rpolasani", "name":"Raghu Polasani", "email":"raghu.polasani@marklogic.com"}}}, "files":[], "show":true}, {"time":"2013-05-09T17:05:10.129069-07:00", "updatedBy":{"username":"rpolasani", "name":"Raghu Polasani", "email":"raghu.polasani@marklogic.com"}, "change":{}, "files":[], "show":true, "comment":"not able to reproduce this easily. not a showstopper for EA2."}, {"time":"2013-05-09T17:05:10.129069-07:00", "updatedBy":{"username":"rpolasani", "name":"Raghu Polasani", "email":"raghu.polasani@marklogic.com"}, "change":{"tofixin":{"from":"7.0-ea2", "to":"7.0-ea3"}}, "files":[], "show":true}, {"time":"2013-06-17T23:06:18.853396-07:00", "updatedBy":{"username":"iagrawal", "name":"Isha Agrawal", "email":"iagrawal@marklogic.com"}, "change":{"assignTo":{"from":{"username":"iagrawal", "name":"Isha Agrawal", "email":"iagrawal@marklogic.com"}, "to":{"username":"iagrawal", "name":"Isha Agrawal", "email":"iagrawal@marklogic.com"}}}, "files":[], "show":true}, {"time":"2013-06-17T23:07:31.658194-07:00", "updatedBy":{"username":"iagrawal", "name":"Isha Agrawal", "email":"iagrawal@marklogic.com"}, "change":{"status":{"from":"", "to":"Closed"}, "assignTo":{"from":{"username":"iagrawal", "name":"Isha Agrawal", "email":"iagrawal@marklogic.com"}, "to":{"username":"nobody", "name":"nobody nobody", "email":"nobody@marklogic.com"}}}, "files":[], "show":true, "comment":"These tests are passing now,verified on 20130617 build. Hence closing the bug."}, {"time":"2013-06-17T23:07:31.658194-07:00", "updatedBy":{"username":"iagrawal", "name":"Isha Agrawal", "email":"iagrawal@marklogic.com"}, "change":{"assignTo":{"from":{"username":"iagrawal", "name":"Isha Agrawal", "email":"iagrawal@marklogic.com"}, "to":{"username":"nobody", "name":"nobody nobody", "email":"nobody@marklogic.com"}}}, "files":[], "show":true}], "updatedAt":"2013-06-17T23:07:31.658194-07:00", "fixedAt":"2013-02-21T18:19:49.168212-08:00", "fixedBy":{"username":"gchinchwadkar", "name":"Gajanan Chinchwadkar", "email":"Gajanan.Chinchwadkar@marklogic.com"}, "closedAt":"2013-06-17T23:07:31.658194-07:00", "closedBy":{"username":"iagrawal", "name":"Isha Agrawal", "email":"iagrawal@marklogic.com"}, "renderDescriptionAs":"normal"}
{"id":20375, "kind":"Bug", "createdAt":"2013-01-03T13:47:34.368914-08:00", "status":"Will not fix", "title":"json:array in return clause of FLWOR with a set in it shows the value after the set", "category":"xdmp", "severity":"Minor", "priority":{"level":"5", "title":""}, "submittedBy":{"username":"dsokolsky", "name":"Danny Sokolsky", "email":"dsokolsky@marklogic.com"}, "assignTo":{"username":"nobody", "name":"nobody nobody", "email":"nobody@marklogic.com"}, "description":"If you return a json:array in the return clause of a FLWOR, and later in that return clause you modify the array, it returns the modified version (even though it should have not been modified first).  For example the $array in the following query returs the array as it appears after the set--I think it should return it as it appears before the set:\r\n\r\nlet $array := json:to-array((\"a\", \"z\", \"c\")) return (\r\n    $array,\r\n    json:set-item-at($array, 2, \"b\"),\r\n    $array[2]\r\n    )\r\n=>\r\n\r\njson:array(<json:array xmlns:xs=\"http://www.w3.org/2001/XMLSchema\"\r\n               xmlns:xsi=\"http://www.w3.org/2001/XMLSchema-instance\"\r\n               xmlns:json=\"http://marklogic.com/xdmp/json\">\r\n               <json:value xsi:type=\"xs:string\">a</json:value>\r\n               <json:value xsi:type=\"xs:string\">b</json:value>\r\n               <json:value xsi:type=\"xs:string\">c</json:value>\r\n            </json:array>)\r\nb\r\n", "samplequery":"", "sampledata":"", "version":"6.0-1", "tofixin":"N/A", "fixedin":"N/A", "platform":"all", "memory":"", "processors":"", "note":"", "subscribers":[{"username":"dsokolsky", "name":"Danny Sokolsky", "email":"dsokolsky@marklogic.com"}, {"username":"dlee", "name":"David  Lee", "email":"David.Lee@marklogic.com"}, {"username":"mary", "name":"Mary Holstege", "email":"mary@cerisent.com"}, {"username":"jsnelson", "name":"John Snelson", "email":"jsnelson@marklogic.com"}], "attachments":[], "relationships":[{"type":"", "to":""}], "clones":[], "cloneOf":"", "support":{"headline":"", "supportDescription":"", "publishStatus":"Not Ready", "tickets":[], "customerImpact":{"level":"N/A", "title":""}, "workaround":""}, "tags":["xdmp", "dsokolsky"], "changeHistory":[{"time":"2013-01-03T13:47:34.368914-08:00", "updatedBy":{"username":"dsokolsky", "name":"Danny Sokolsky", "email":"dsokolsky@marklogic.com"}, "change":{"assignTo":{"from":{"username":"dsokolsky", "name":"Danny Sokolsky", "email":"dsokolsky@marklogic.com"}, "to":{"username":"dlee", "name":"David  Lee", "email":"David.Lee@marklogic.com"}}}, "files":[], "show":true}, {"time":"2013-01-03T13:56:13.642005-08:00", "updatedBy":{"username":"dlee", "name":"David  Lee", "email":"David.Lee@marklogic.com"}, "change":{"status":{"from":"", "to":"Closed"}, "assignTo":{"from":{"username":"dlee", "name":"David  Lee", "email":"David.Lee@marklogic.com"}, "to":{"username":"nobody", "name":"nobody nobody", "email":"nobody@marklogic.com"}}}, "files":[], "show":true, "comment":"This is not a bug.\r\nXQuery does not guarentee order of evaluation of values in a sequence."}, {"time":"2013-01-03T14:38:55.993468-08:00", "updatedBy":{"username":"dlee", "name":"David  Lee", "email":"David.Lee@marklogic.com"}, "change":{}, "files":[], "show":true, "comment":"Note from Danny:\r\nWe did similar work to make xdmp:set work in these circumstances.\r\n\r\nMaybe we should make a special case for json:array ? what about map:map and json:object ? \r\n\r\nAssigning to Mary to consider.\r\nI still am of the oppinion this is not a bug, but maybe its a feature we should do ?\r\n"}, {"time":"2013-01-03T14:38:55.993468-08:00", "updatedBy":{"username":"dlee", "name":"David  Lee", "email":"David.Lee@marklogic.com"}, "change":{"status":{"from":"", "to":"New"}, "assignTo":{"from":{"username":"dlee", "name":"David  Lee", "email":"David.Lee@marklogic.com"}, "to":{"username":"mary", "name":"Mary Holstege", "email":"mary@cerisent.com"}}}, "files":[], "show":true, "comment":"Mary could you add your opinion as to if this is a bug or a feature ?\r\nI may be premature closing this as not-a-bug.\r\n"}, {"time":"2013-01-03T14:38:55.993468-08:00", "updatedBy":{"username":"dlee", "name":"David  Lee", "email":"David.Lee@marklogic.com"}, "change":{"assignTo":{"from":{"username":"dlee", "name":"David  Lee", "email":"David.Lee@marklogic.com"}, "to":{"username":"mary", "name":"Mary Holstege", "email":"mary@cerisent.com"}}}, "files":[], "show":true}, {"time":"2013-01-03T15:40:49.3362-08:00", "updatedBy":{"username":"dsokolsky", "name":"Danny Sokolsky", "email":"dsokolsky@marklogic.com"}, "change":{"status":{"from":"", "to":"Verify"}, "assignTo":{"from":{"username":"dsokolsky", "name":"Danny Sokolsky", "email":"dsokolsky@marklogic.com"}, "to":{"username":"mary", "name":"Mary Holstege", "email":"mary@cerisent.com"}}}, "files":[], "show":true, "comment":"It does seem like a usability surprise to me.  "}, {"time":"2013-02-01T10:32:07.014756-08:00", "updatedBy":{"username":"rhu", "name":"Ron Hu", "email":"ron.hu@marklogic.com"}, "change":{"assignTo":{"from":{"username":"rhu", "name":"Ron Hu", "email":"ron.hu@marklogic.com"}, "to":{"username":"dlee", "name":"David  Lee", "email":"David.Lee@marklogic.com"}}}, "files":[], "show":true}, {"time":"2013-02-27T13:46:50.828526-08:00", "updatedBy":{"username":"rhu", "name":"Ron Hu", "email":"ron.hu@marklogic.com"}, "change":{"tofixin":{"from":"6.0-3", "to":"6.0-4"}}, "files":[], "show":true}, {"time":"2013-05-29T16:46:40.531456-07:00", "updatedBy":{"username":"wfeick", "name":"Wayne Feick", "email":"wfeick@marklogic.com"}, "change":{}, "files":[], "show":true, "comment":"David doesn't have any experience in this area of the code, so sending back Mary's way. Mary, can you triage for 6.0-4 and possibly assign to someone else?"}, {"time":"2013-05-29T16:46:40.531456-07:00", "updatedBy":{"username":"wfeick", "name":"Wayne Feick", "email":"wfeick@marklogic.com"}, "change":{"assignTo":{"from":{"username":"wfeick", "name":"Wayne Feick", "email":"wfeick@marklogic.com"}, "to":{"username":"mary", "name":"Mary Holstege", "email":"mary@cerisent.com"}}}, "files":[], "show":true}, {"time":"2013-06-21T10:21:09.561607-07:00", "updatedBy":{"username":"rhu", "name":"Ron Hu", "email":"ron.hu@marklogic.com"}, "change":{"assignTo":{"from":{"username":"rhu", "name":"Ron Hu", "email":"ron.hu@marklogic.com"}, "to":{"username":"jsnelson", "name":"John Snelson", "email":"jsnelson@marklogic.com"}}}, "files":[], "show":true}, {"time":"2013-06-24T01:51:55.880693-07:00", "updatedBy":{"username":"jsnelson", "name":"John Snelson", "email":"jsnelson@marklogic.com"}, "change":{"status":{"from":"", "to":"Will not fix"}, "assignTo":{"from":{"username":"jsnelson", "name":"John Snelson", "email":"jsnelson@marklogic.com"}, "to":{"username":"nobody", "name":"nobody nobody", "email":"nobody@marklogic.com"}}}, "files":[], "show":true, "comment":"Not a bug."}, {"time":"2013-06-28T11:57:02.776935-07:00", "updatedBy":{"username":"dsokolsky", "name":"Danny Sokolsky", "email":"dsokolsky@marklogic.com"}, "change":{"tofixin":{"from":"6.0-4", "to":"N/A"}}, "files":[], "show":true}], "updatedAt":"2013-06-28T11:57:02.776935-07:00", "closedAt":"2013-01-03T13:56:13.642005-08:00", "closedBy":{"username":"dlee", "name":"David  Lee", "email":"David.Lee@marklogic.com"}, "renderDescriptionAs":"normal"}
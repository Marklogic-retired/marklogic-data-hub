{"id":20421, "kind":"Bug", "createdAt":"2013-01-09T21:45:15.819241-08:00", "status":"Closed", "title":"xdmp:xslt-invoke throwing 500 Internal Server Error ", "category":"xdmp", "severity":"Critical", "priority":{"level":"5", "title":""}, "submittedBy":{"username":"ksaxena", "name":"Kapil Saxena", "email":"kapil.saxena@marklogic.com"}, "assignTo":{"username":"nobody", "name":"nobody nobody", "email":"nobody@marklogic.com"}, "description":"ML Version: MarkLogic-7.0-20130106\r\nTest Name: bug15388.xml\r\nLink to diff: \r\nhttps://regression-status.marklogic.com/new-app/space2/diff-archive/sand-box/b7_0/2013-01-06/linux-64-rh5sandbox_HEAD_2-1212/diffs/bug15388.xml\r\n************************************************************************************************************************************************\r\n\r\nSteps to reproduce:\r\n*********************\r\n1. create new db (bug15388)\r\n2. create a new forest and associated forest with the db\r\n3. point XDBC server to new DB\r\n4. set output encoding of xdbc server to UTF-8\r\n5. create http server\r\n        xquery version \"1.0-ml\";\r\n        import module namespace adm = \"http://marklogic.com/xdmp/admin\" at \"/MarkLogic/admin.xqy\";\r\n        let $hostName := xdmp:host()\r\n        let $database := xdmp:database(\"bug15388\")\r\n        let $config := adm:get-configuration()\r\n        let $defaultgroup := adm:host-get-group($config, $hostName)\r\n        let $c := adm:http-server-create($config,$defaultgroup,\"bug15388\",\"QA_HOME/testdata/bug15388/\",9011,0,$database)\r\n        return adm:save-configuration($c)\r\n\r\n6. Run the following XQUERY:\r\n                xquery version \"1.0-ml\";\r\n                let $x := xdmp:http-get(\"http://localhost:9011/attrtest/default.xqy\",\r\n                       <options xmlns=\"xdmp:http\">\r\n                          <authentication method=\"digest\">\r\n                           <username>admin</username>\r\n                           <password>admin</password>\r\n                          </authentication>\r\n                       </options>)\r\n                return if($x//*:code eq 200) then true() else $x\r\n\r\nAfter running the following xquery, we are seeing:\r\n<h:result-text><response xmlns=\"xdmp:http\">\r\n  <code>500</code>\r\n  <message>Internal Server Error</message>\r\n  <headers>\r\n    <content-type>text/html; charset=utf-8</content-type>\r\n    <server>MarkLogic</server>\r\n    <content-length>1644</content-length>\r\n    <connection>Keep-Alive</connection>\r\n    <keep-alive>timeout=5</keep-alive>\r\n  </headers>\r\n</response><html xmlns=\"http://www.w3.org/1999/xhtml\">\r\n  <head>\r\n    <title>500 Internal Server Error</title>\r\n    <meta content=\"noindex,nofollow\" name=\"robots\"/>\r\n    <link href=\"/error.css\" rel=\"stylesheet\"/>\r\n  </head>\r\n                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                  <body>\r\n    <span class=\"error\">\r\n      <h1>500 Internal Server Error</h1>\r\n      <dl>\r\n        <dt>SVC-FILOPN: File open error: open '/space/builder/builds/linux64/HEAD/qa/testdata/bug15388/attrtest/DocBook/base/common/DocBook/base/common/marklogic.xqy': No such file or directory</dt>\r\n        <dd/>\r\n        <dt>in /attrtest/custom.xsl, at 19:0,<br/>\r\n          in xdmp:xslt-invoke(\"/attrtest/custom.xsl\", document{<chapter xmlns=\"http://docbook.org/ns/docbook\"><title>Chapter Title</title><para>A paragraph.</para><programlis...</chapter>}) [XSLT]</dt>\r\n        <dd/>\r\n        <dt>in /attrtest/default.xqy, at 16:2 [1.0-ml]</dt>\r\n        <dd>\r\n          $doc = document{<chapter xmlns=\"http://docbook.org/ns/docbook\"><title>Chapter Title</title><para>A paragraph.</para><programlis...</chapter>}</dd>\r\n      </dl>\r\n    </span>\r\n  </body>\r\n</html></h:result-text>\r\n\r\n\r\nNote:\r\n1. This started during 1612 sandbox run on 7.0 06th Jan.\r\n\r\n2. When I look at the diff, I see that it is failing due to “not able to locate the needed marklogic.xqy file” as wrong path evaluation is done:\r\nSVC-FILOPN: File open error: open '/space/builder/builds/linux64/HEAD/qa/testdata/bug15388/attrtest/DocBook/base/common/DocBook/base/common/marklogic.xqy': No such file or directory\r\n\r\n\r\n", "samplequery":"", "sampledata":"", "version":"7.0-nightly", "tofixin":"7.0-ea1", "fixedin":"7.0-ea1", "platform":"all", "memory":"", "processors":"", "note":"", "subscribers":[{"username":"ksaxena", "name":"Kapil Saxena", "email":"kapil.saxena@marklogic.com"}, {"username":"jsnelson", "name":"John Snelson", "email":"jsnelson@marklogic.com"}, {"username":"rhu", "name":"Ron Hu", "email":"ron.hu@marklogic.com"}, {"username":"msrinivasan", "name":"Mahalakshmi Srinivasan", "email":"mahalakshmi.srinivasan@marklogic.com"}], "attachments":[], "relationships":[{"type":"", "to":""}], "clones":[], "cloneOf":"", "support":{"headline":"", "supportDescription":"", "publishStatus":"Never Publish", "tickets":[], "customerImpact":{"level":"N/A", "title":""}, "workaround":""}, "tags":["xdmp", "ksaxena"], "changeHistory":[{"time":"2013-01-09T21:45:15.819241-08:00", "updatedBy":{"username":"ksaxena", "name":"Kapil Saxena", "email":"kapil.saxena@marklogic.com"}, "change":{"assignTo":{"from":{"username":"ksaxena", "name":"Kapil Saxena", "email":"kapil.saxena@marklogic.com"}, "to":{"username":"rhu", "name":"Ron Hu", "email":"ron.hu@marklogic.com"}}}, "files":[], "show":true}, {"time":"2013-02-07T12:01:14.5062-08:00", "updatedBy":{"username":"rhu", "name":"Ron Hu", "email":"ron.hu@marklogic.com"}, "change":{"assignTo":{"from":{"username":"rhu", "name":"Ron Hu", "email":"ron.hu@marklogic.com"}, "to":{"username":"jsnelson", "name":"John Snelson", "email":"jsnelson@marklogic.com"}}}, "files":[], "show":true}, {"time":"2013-02-21T08:34:29.664231-08:00", "updatedBy":{"username":"jsnelson", "name":"John Snelson", "email":"jsnelson@marklogic.com"}, "change":{"status":{"from":"", "to":"Test"}, "assignTo":{"from":{"username":"jsnelson", "name":"John Snelson", "email":"jsnelson@marklogic.com"}, "to":{"username":"msrinivasan", "name":"Mahalakshmi Srinivasan", "email":"mahalakshmi.srinivasan@marklogic.com"}}}, "files":[], "show":true, "comment":"This changed as a result of the fix to bug 15636:\r\n\r\nhttps://bugtrack.marklogic.com/15636"}, {"time":"2013-02-21T08:34:29.664231-08:00", "updatedBy":{"username":"jsnelson", "name":"John Snelson", "email":"jsnelson@marklogic.com"}, "change":{"assignTo":{"from":{"username":"jsnelson", "name":"John Snelson", "email":"jsnelson@marklogic.com"}, "to":{"username":"msrinivasan", "name":"Mahalakshmi Srinivasan", "email":"mahalakshmi.srinivasan@marklogic.com"}}}, "files":[], "show":true}, {"time":"2013-02-21T11:31:48.708515-08:00", "updatedBy":{"username":"msrinivasan", "name":"Mahalakshmi Srinivasan", "email":"mahalakshmi.srinivasan@marklogic.com"}, "change":{"status":{"from":"", "to":"Ship"}, "assignTo":{"from":{"username":"msrinivasan", "name":"Mahalakshmi Srinivasan", "email":"mahalakshmi.srinivasan@marklogic.com"}, "to":{"username":"nobody", "name":"nobody nobody", "email":"nobody@marklogic.com"}}}, "files":[], "show":true, "comment":"Verified on build 7.0-20130220. This test has been passing in nightly regression for sometime now."}], "updatedAt":"2013-02-21T11:31:48.708515-08:00", "fixedAt":"2013-02-21T08:34:29.664231-08:00", "fixedBy":{"username":"jsnelson", "name":"John Snelson", "email":"jsnelson@marklogic.com"}, "shippedAt":"2013-02-21T11:31:48.708515-08:00", "shippedBy":{"username":"msrinivasan", "name":"Mahalakshmi Srinivasan", "email":"mahalakshmi.srinivasan@marklogic.com"}, "renderDescriptionAs":"normal"}
{"id":20524, "kind":"Bug", "createdAt":"2012-03-06T10:18:15.276211-08:00", "status":"Closed", "title":"DB Replication: New replica forest created on newly added host in replica cluster never syncs up with its master forest (stays in synching replica)", "category":"Replication", "severity":"Major", "priority":{"level":"2", "title":"Not required for product release"}, "submittedBy":{"username":"svempati", "name":"Sundeep Vempati", "email":"sundeep.vempati@marklogic.com"}, "assignTo":{"username":"nobody", "name":"nobody nobody", "email":"nobody@marklogic.com"}, "description":"DB Replication: New replica forest created on newly added host in replica cluster never syncs up with its master forest (stays in synching replica)\r\n\r\nSteps:\r\n1 Couple 2 clusters. Cluster 1 with one host and Cluster 2 with two hosts.\r\n2  Create a database on each host and attach forests to them (at least one forest residing on each host) - \"Map forests by name\" is set to true\r\n3  Enable database replication on these databases and see replication happen.\r\n4  Add a new host to cluster 1. Create a new forest on this host and attach the forest to the replicating database (Master)\r\n5  Do inserts and updates on master, they should be replicated (except for the additional forest)\r\n6  Now add another host on replica side and create forest with same name as step 4 and attach the forest to replica database.\r\n7  At this point, the newly added forest on replica should sync up with its foreign master forest.\r\n\r\nBug: This newly added forest on the replica side stays in \"sync replicating state\"\r\n\r\nThese error messages are flashed on host in master forest, where master forest resides for the replica forest in question:\r\n2012-03-06 10:04:52.686 Debug: Detected compatibility for database test-DB\r\n2012-03-06 10:04:52.897 Warning: XDQPServerConnection::init(172.18.9.45:7998-172.18.9.48:40945): XDMP-NOHOST: No host with identifier 3689000171186154671\r\n2012-03-06 10:04:53.900 Warning: XDQPServerConnection::init(172.18.9.45:7998-172.18.9.48:40946): XDMP-NOHOST: No host with identifier 3689000171186154671\r\n2012-03-06 10:04:54.901 Warning: XDQPServerConnection::init(172.18.9.45:7998-172.18.9.48:40947): XDMP-NOHOST: No host with identifier 3689000171186154671\r\n\r\n\r\nWill attach complete logs.", "samplequery":"", "sampledata":"", "version":"7.0-nightly", "tofixin":"7.0-ea1", "fixedin":"7.0-ea1", "platform":"all", "memory":"", "processors":"", "note":"", "subscribers":[{"username":"svempati", "name":"Sundeep Vempati", "email":"sundeep.vempati@marklogic.com"}, {"username":"atsoi", "name":"Arthur Tsoi", "email":"arthur.tsoi@marklogic.com"}, {"username":"wfeick", "name":"Wayne Feick", "email":"wfeick@marklogic.com"}, {"username":"rpolasani", "name":"Raghu Polasani", "email":"raghu.polasani@marklogic.com"}], "attachments":[{"name":"Error Logs from all the hosts", "uri":"root/support/bugtracking/attachments/16478/logs-030612-104903.tar.gz"}], "relationships":[{"type":"", "to":""}], "clones":[], "cloneOf":16478, "support":{"headline":"", "supportDescription":"", "publishStatus":"Not Ready", "tickets":[], "customerImpact":{"level":"N/A", "title":""}, "workaround":""}, "tags":["Replication", "svempati"], "changeHistory":[{"time":"2012-03-06T10:18:15.276211-08:00", "updatedBy":{"username":"svempati", "name":"Sundeep Vempati", "email":"sundeep.vempati@marklogic.com"}, "change":{"assignTo":{"from":{"username":"svempati", "name":"Sundeep Vempati", "email":"sundeep.vempati@marklogic.com"}, "to":{"username":"wfeick", "name":"Wayne Feick", "email":"wfeick@marklogic.com"}}}, "files":[], "show":true}, {"time":"2012-03-06T10:44:57.452655-08:00", "updatedBy":{"username":"svempati", "name":"Sundeep Vempati", "email":"sundeep.vempati@marklogic.com"}, "change":{}, "files":[], "show":true, "comment":"Eventually MarkLogic gets restarted (on the host where master forest resides) and the replica forest syncs up.\r\n\r\n2012-03-06 10:30:00.070 Warning: XDQPServerConnection::init(172.18.9.45:7998-172.18.9.48:12518): XDMP-NOHOST: No host with identifier 3689000171186154671\r\n2012-03-06 10:30:01.072 Warning: XDQPServerConnection::init(172.18.9.45:7998-172.18.9.48:12519): XDMP-NOHOST: No host with identifier 3689000171186154671\r\n2012-03-06 10:35:02.076 Notice: Starting MarkLogic Server 5.0-20120305 x86_64 in /opt/MarkLogic with data in /var/opt/MarkLogic\r\n2012-03-06 10:35:02.087 Info: Host rh5-intel64-22.marklogic.com running Linux 2.6.18-194.el5 (Red Hat Enterprise Linux Server release 5.5 (Tikanga))\r\n2012-03-06 10:35:02.103 Debug: Setting trace events for group 14587453393782232602\r\n2012-03-06 10:35:02.103 Debug: Trace events activated flag is false\r\n"}, {"time":"2012-03-06T10:50:34.138496-08:00", "updatedBy":{"username":"svempati", "name":"Sundeep Vempati", "email":"sundeep.vempati@marklogic.com"}, "change":{}, "files":[], "show":true, "comment":"Cluster details:\r\n\r\nCluster-1 (Master):\r\nrh5-intel64-21\r\nrh5-intel64-22 (added after couple cluster and DB Rep setup)\r\n\r\nCluster-2 (Replica):\r\nrh5-intel64-23\r\nrh5-intel64-24\r\nrh5-intel64-25 (added after couple cluster and DB Rep setup)"}, {"time":"2012-03-06T14:05:18.36392-08:00", "updatedBy":{"username":"wfeick", "name":"Wayne Feick", "email":"wfeick@marklogic.com"}, "change":{}, "files":[], "show":true, "comment":"Moving to 5.0-4 since a host restart resolves the issue."}, {"time":"2013-01-18T15:57:05.969807-08:00", "updatedBy":{"username":"wfeick", "name":"Wayne Feick", "email":"wfeick@marklogic.com"}, "change":{}, "files":[], "show":true, "comment":"Arthur, can you take a look at this? You can turn on the Forest Replicate and Database Replication trace flags to figure out why it's not running.\r\n\r\nIt looks like this bug needs to be cloned to 6.0 and trunk."}, {"time":"2013-01-18T15:57:05.969807-08:00", "updatedBy":{"username":"wfeick", "name":"Wayne Feick", "email":"wfeick@marklogic.com"}, "change":{"assignTo":{"from":{"username":"wfeick", "name":"Wayne Feick", "email":"wfeick@marklogic.com"}, "to":{"username":"atsoi", "name":"Arthur Tsoi", "email":"arthur.tsoi@marklogic.com"}}}, "files":[], "show":true}, {"time":"2013-01-18T19:49:48.806898-08:00", "updatedBy":{"username":"atsoi", "name":"Arthur Tsoi", "email":"arthur.tsoi@marklogic.com"}, "change":{"tofixin":{"from":"", "to":"7.0-ea1"}}, "files":[], "show":true}, {"time":"2013-01-22T15:30:00.654246-08:00", "updatedBy":{"username":"atsoi", "name":"Arthur Tsoi", "email":"arthur.tsoi@marklogic.com"}, "change":{}, "files":[], "show":true, "svn":{"repository":"/project/engsvn", "revision":"128830", "paths":["xdmp/trunk/src/Cluster.h", "xdmp/trunk/src/Cluster.cpp"], "affectedBugs":[]}, "comment":"bug:20524 bootstrap hosts need to send heartbeat to foreign host with database replication forests"}, {"time":"2013-01-22T15:30:25.105276-08:00", "updatedBy":{"username":"atsoi", "name":"Arthur Tsoi", "email":"arthur.tsoi@marklogic.com"}, "change":{"status":{"from":"", "to":"Test"}, "assignTo":{"from":{"username":"atsoi", "name":"Arthur Tsoi", "email":"arthur.tsoi@marklogic.com"}, "to":{"username":"rpolasani", "name":"Raghu Polasani", "email":"raghu.polasani@marklogic.com"}}}, "files":[], "show":true}, {"time":"2013-01-22T15:30:25.105276-08:00", "updatedBy":{"username":"atsoi", "name":"Arthur Tsoi", "email":"arthur.tsoi@marklogic.com"}, "change":{"assignTo":{"from":{"username":"atsoi", "name":"Arthur Tsoi", "email":"arthur.tsoi@marklogic.com"}, "to":{"username":"rpolasani", "name":"Raghu Polasani", "email":"raghu.polasani@marklogic.com"}}}, "files":[], "show":true}, {"time":"2013-03-02T10:47:18.273679-08:00", "updatedBy":{"username":"rpolasani", "name":"Raghu Polasani", "email":"raghu.polasani@marklogic.com"}, "change":{"assignTo":{"from":{"username":"rpolasani", "name":"Raghu Polasani", "email":"raghu.polasani@marklogic.com"}, "to":{"username":"svempati", "name":"Sundeep Vempati", "email":"sundeep.vempati@marklogic.com"}}}, "files":[], "show":true}, {"time":"2013-03-07T15:12:43.762234-08:00", "updatedBy":{"username":"svempati", "name":"Sundeep Vempati", "email":"sundeep.vempati@marklogic.com"}, "change":{"status":{"from":"", "to":"Ship"}, "assignTo":{"from":{"username":"svempati", "name":"Sundeep Vempati", "email":"sundeep.vempati@marklogic.com"}, "to":{"username":"nobody", "name":"nobody nobody", "email":"nobody@marklogic.com"}}}, "files":[], "show":true, "comment":"Verified with MarkLogic-7.0-ea1_20130307\r\n\r\nVerified the number of documents and checked ErrorLog. \r\nSee this in ErrorLog:\r\n2013-03-07 15:09:17.011 Info: Forest Test-F3 accepts foreign forest {rh5-intel64-21.marklogic.com-cluster Test-DB Test-F3} as its master with new precise time 13626974137829850\r\n2013-03-07 15:09:17.013 Debug: Starting XDQPClientConnection, server=rh5-intel64-22.marklogic.com, conn=172.18.9.48:15783-172.18.9.45:7998\r\n2013-03-07 15:09:21.356 Info: Forest Test-F3 received 66 replication timestamps start at 0/0 more coming false from foreign forest Test-F3 in cluster rh5-intel64-21.marklogic.com-cluster\r\n2013-03-07 15:09:21.358 Info: Forest Test-F3 finished replicating timestamps master-only=66 replica-only=0 timestamp-right=0 timestamp-wrong=0 duplicate=0 more-coming=false\r\n2013-03-07 15:09:21.403 Debug: InMemoryStand /var/opt/MarkLogic/Forests/Test-F3/00000000, disk=15MB, memory=655MB, list=512MB, tree=128MB, rangeIndex=16MB, reverseIndex=16MB, tripleIndex=16MB\r\n2013-03-07 15:09:21.425 Info: Saving /var/opt/MarkLogic/Forests/Test-F3/00000000\r\n2013-03-07 15:09:21.503 Debug: OnDiskStand /var/opt/MarkLogic/Forests/Test-F3/00000000, disk=15MB, memory=16MB\r\n2013-03-07 15:09:21.504 Info: Saved 15 MB in 1 sec at 191 MB/sec to /var/opt/MarkLogic/Forests/Test-F3/00000000\r\n2013-03-07 15:09:21.504 Debug: ~InMemoryStand /var/opt/MarkLogic/Forests/Test-F3/00000000\r\n2013-03-07 15:09:21.510 Info: Forest Test-F3 received bulk replicate complete from foreign forest Test-F3 in cluster rh5-intel64-21.marklogic.com-cluster; lastFSN=75 lastSeqKey=13641326570786732407\r\n2013-03-07 15:09:21.511 Info: Forest Test-F3 finished synchronizing from foreign master (fsn=75)\r\n\r\n"}], "updatedAt":"2013-03-07T15:12:43.762234-08:00", "fixedAt":"2013-01-22T15:30:25.105276-08:00", "fixedBy":{"username":"atsoi", "name":"Arthur Tsoi", "email":"arthur.tsoi@marklogic.com"}, "shippedAt":"2013-03-07T15:12:43.762234-08:00", "shippedBy":{"username":"svempati", "name":"Sundeep Vempati", "email":"sundeep.vempati@marklogic.com"}, "renderDescriptionAs":"normal"}
{"id":20305, "kind":"Bug", "createdAt":"2012-12-18T17:19:58.441484-08:00", "status":"Closed", "title":"QConsole: JSON output errors out when rendering HTML", "category":"Query Console", "severity":"Major", "priority":{"level":"5", "title":""}, "submittedBy":{"username":"sbrooks", "name":"Scott Brooks", "email":"Scott.Brooks@marklogic.com"}, "assignTo":{"username":"nobody", "name":"nobody nobody", "email":"nobody@marklogic.com"}, "description":"1) Enter this query into QConsole:\r\n\r\nxquery version \"1.0-ml\";\r\ndeclare namespace html = \"http://www.w3.org/1999/xhtml\";\r\n<p>hello world</p>,\r\n<p>hello world</p>\r\n\r\n2) Run query as XML\r\n3) Observe correct rendering of output\r\n4) click JSON\r\n5) Observe output is rendering the correct error:\r\n\r\nCannot parse result as json\r\nOriginal Content:\r\n<p>hello world</p>\r\n<p>hello world</p>\r\n\r\n6) Press XML & see XML rendering\r\n7) Press JSON  (error occurs)\r\n\r\nThe error no longer displays.\r\n\r\nConsole error output displays:\r\n\r\nUncaught Error: Non-whitespace before {[.\r\nLine: 2\r\nColumn: 18\r\nChar: > clarinet.js:263\r\n", "samplequery":"", "sampledata":"", "version":"7.0-nightly", "tofixin":"7.0-ea1", "fixedin":"7.0-ea1", "platform":"all", "memory":"", "processors":"", "note":"", "subscribers":[{"username":"sbrooks", "name":"Scott Brooks", "email":"Scott.Brooks@marklogic.com"}, {"username":"ctaylor", "name":"Christophe Taylor", "email":"christophe.taylor@marklogic.com"}, {"username":"sreddy", "name":"Sudhakar Reddy", "email":"sreddy@marklogic.com"}], "attachments":[], "relationships":[{"type":"", "to":""}], "clones":[], "cloneOf":"", "support":{"headline":"", "supportDescription":"", "publishStatus":"Not Ready", "tickets":[], "customerImpact":{"level":"N/A", "title":""}, "workaround":""}, "tags":["Query Console", "sbrooks"], "changeHistory":[{"time":"2012-12-18T17:19:58.441484-08:00", "updatedBy":{"username":"sbrooks", "name":"Scott Brooks", "email":"Scott.Brooks@marklogic.com"}, "change":{"assignTo":{"from":{"username":"sbrooks", "name":"Scott Brooks", "email":"Scott.Brooks@marklogic.com"}, "to":{"username":"ctaylor", "name":"Christophe Taylor", "email":"christophe.taylor@marklogic.com"}}}, "files":[], "show":true}, {"time":"2012-12-19T11:14:00.163753-08:00", "updatedBy":{"username":"ctaylor", "name":"Christophe Taylor", "email":"christophe.taylor@marklogic.com"}, "change":{}, "files":[], "show":true, "comment":"Ah, i see what happened. I was one level too high in my variable scope for the error handler flag. I just need to switch around the errorhandled = false; statement into the dataHighlight function instead of in its closure."}, {"time":"2012-12-19T11:17:23.369793-08:00", "updatedBy":{"username":"ctaylor", "name":"Christophe Taylor", "email":"christophe.taylor@marklogic.com"}, "change":{}, "files":[], "show":true, "svn":{"repository":"/project/engsvn", "revision":"124678", "paths":["xdmp/trunk/src/Apps/common/output-formatter/output-formatter.js"], "affectedBugs":[]}, "comment":"Bug:20305 - moved error handled flag from the closure into the local context, so that it resets every time dataHighlight() is called. Problem was the flag was set once and errors in future invocations were not being handled."}, {"time":"2012-12-21T11:28:10.976085-08:00", "updatedBy":{"username":"sbrooks", "name":"Scott Brooks", "email":"Scott.Brooks@marklogic.com"}, "change":{"status":{"from":"", "to":"Test"}, "assignTo":{"from":{"username":"sbrooks", "name":"Scott Brooks", "email":"Scott.Brooks@marklogic.com"}, "to":{"username":"sreddy", "name":"Sudhakar Reddy", "email":"sreddy@marklogic.com"}}}, "files":[], "show":true, "comment":"Passing to QA to verify on their end."}, {"time":"2012-12-21T11:28:10.976085-08:00", "updatedBy":{"username":"sbrooks", "name":"Scott Brooks", "email":"Scott.Brooks@marklogic.com"}, "change":{"assignTo":{"from":{"username":"sbrooks", "name":"Scott Brooks", "email":"Scott.Brooks@marklogic.com"}, "to":{"username":"sreddy", "name":"Sudhakar Reddy", "email":"sreddy@marklogic.com"}}}, "files":[], "show":true}, {"time":"2013-01-17T12:43:22.41798-08:00", "updatedBy":{"username":"sreddy", "name":"Sudhakar Reddy", "email":"sreddy@marklogic.com"}, "change":{}, "files":[], "show":true, "comment":"Christophe mentioned offline that the bug is fixed on the UI but JS error would still show up and its harmless. shipping it"}, {"time":"2013-01-17T12:43:22.41798-08:00", "updatedBy":{"username":"sreddy", "name":"Sudhakar Reddy", "email":"sreddy@marklogic.com"}, "change":{"status":{"from":"", "to":"Ship"}, "assignTo":{"from":{"username":"sreddy", "name":"Sudhakar Reddy", "email":"sreddy@marklogic.com"}, "to":{"username":"nobody", "name":"nobody nobody", "email":"nobody@marklogic.com"}}}, "files":[], "show":true}, {"time":"2013-01-17T12:43:22.41798-08:00", "updatedBy":{"username":"sreddy", "name":"Sudhakar Reddy", "email":"sreddy@marklogic.com"}, "change":{"assignTo":{"from":{"username":"sreddy", "name":"Sudhakar Reddy", "email":"sreddy@marklogic.com"}, "to":{"username":"nobody", "name":"nobody nobody", "email":"nobody@marklogic.com"}}}, "files":[], "show":true}], "updatedAt":"2013-01-17T12:43:22.41798-08:00", "fixedAt":"2012-12-21T11:28:10.976085-08:00", "fixedBy":{"username":"sbrooks", "name":"Scott Brooks", "email":"Scott.Brooks@marklogic.com"}, "shippedAt":"2013-01-17T12:43:22.41798-08:00", "shippedBy":{"username":"sreddy", "name":"Sudhakar Reddy", "email":"sreddy@marklogic.com"}, "renderDescriptionAs":"normal"}
{"id":20804, "kind":"Bug", "createdAt":"2013-02-15T11:02:59.159026-08:00", "status":"Closed", "title":"Annotations for geospatial queries with multiple region types wrong", "category":"search", "severity":"Major", "priority":{"level":"5", "title":""}, "submittedBy":{"username":"mary", "name":"Mary Holstege", "email":"mary@cerisent.com"}, "assignTo":{"username":"nobody", "name":"nobody nobody", "email":"nobody@marklogic.com"}, "description":"Set up a geospatial element pair index on \"quake\" with children \"lat\" and \"long\"\r\n\r\nxdmp:plan(\r\n  cts:search(doc(), \r\n    cts:element-pair-geospatial-query(\r\n      xs:QName(\"quake\"), xs:QName(\"lat\"), xs:QName(\"long\"),\r\n      (cts:circle(5,cts:point(-14.704,166.818)),\r\n       cts:point(4,5)),\"uncached\"), \"unfiltered\"))\r\n\r\nThe key here is that because we have mixed region types, we end up constructing a CircleQuery and a RangeQuery<point> but the key is the same.\r\n\r\nI think the annotation needs to just indicate what the range index is; annotate it as a range(whatever). The value doesn't need to be part of the annotation in this case as it is part of the query description anyway.", "samplequery":"", "sampledata":"", "version":"7.0-nightly", "tofixin":"7.0-ea2", "fixedin":"7.0-ea2", "platform":"all", "memory":"", "processors":"", "note":"", "subscribers":[{"username":"mary", "name":"Mary Holstege", "email":"mary@cerisent.com"}, {"username":"fxue", "name":"Fei Xue", "email":"Fei.Xue@marklogic.com"}, {"username":"rpolasani", "name":"Raghu Polasani", "email":"raghu.polasani@marklogic.com"}], "attachments":[], "relationships":[{"type":"", "to":""}], "clones":[], "cloneOf":"", "support":{"headline":"", "supportDescription":"", "publishStatus":"Not Ready", "tickets":[], "customerImpact":{"level":"N/A", "title":""}, "workaround":""}, "tags":["search", "mary"], "changeHistory":[{"time":"2013-02-15T11:02:59.159026-08:00", "updatedBy":{"username":"mary", "name":"Mary Holstege", "email":"mary@cerisent.com"}, "change":{"assignTo":{"from":{"username":"mary", "name":"Mary Holstege", "email":"mary@cerisent.com"}, "to":{"username":"fxue", "name":"Fei Xue", "email":"Fei.Xue@marklogic.com"}}}, "files":[], "show":true}, {"time":"2013-02-17T12:28:11.376499-08:00", "updatedBy":{"username":"fxue", "name":"Fei Xue", "email":"Fei.Xue@marklogic.com"}, "change":{}, "files":[], "show":true, "comment":"This exists in all range indexes (geo and non-geo).\r\nFix will be that all annotation on range index will not include the value as key could not be able to tell."}, {"time":"2013-02-17T12:34:28.976193-08:00", "updatedBy":{"username":"fxue", "name":"Fei Xue", "email":"Fei.Xue@marklogic.com"}, "change":{}, "files":[], "show":true, "comment":"After the fix, in the example both annotation should be the same string as follow:\r\npair(latitude(element-child(quake/lat)),longitude(element-child(quake/long)))"}, {"time":"2013-02-17T13:03:46.006955-08:00", "updatedBy":{"username":"fxue", "name":"Fei Xue", "email":"Fei.Xue@marklogic.com"}, "change":{}, "files":[], "show":true, "comment":"Note to self: beware of the complication with path range indexes."}, {"time":"2013-02-22T10:03:09.642172-08:00", "updatedBy":{"username":"fxue", "name":"Fei Xue", "email":"Fei.Xue@marklogic.com"}, "change":{}, "files":[], "show":true, "svn":{"repository":"/project/engsvn", "revision":"133077", "paths":["xdmp/trunk/src/RangeIndexes.cpp", "xdmp/trunk/src/Collation.cpp", "xdmp/trunk/src/QueryVal.h", "xdmp/trunk/src/OnDiskRangeIndexes.cpp", "xdmp/trunk/src/SearchBuiltins.cpp", "xdmp/trunk/src/GeospatialBuiltins.cpp", "xdmp/trunk/src/Collation.h"], "affectedBugs":["20627"]}, "comment":"Bug:20804 + Bug:20627 infrastructure"}, {"time":"2013-02-25T15:40:48.255601-08:00", "updatedBy":{"username":"fxue", "name":"Fei Xue", "email":"Fei.Xue@marklogic.com"}, "change":{"status":{"from":"", "to":"Fix"}, "assignTo":{"from":{"username":"fxue", "name":"Fei Xue", "email":"Fei.Xue@marklogic.com"}, "to":{"username":"fxue", "name":"Fei Xue", "email":"Fei.Xue@marklogic.com"}}}, "files":[], "show":true}, {"time":"2013-02-25T17:09:36.70184-08:00", "updatedBy":{"username":"fxue", "name":"Fei Xue", "email":"Fei.Xue@marklogic.com"}, "change":{}, "files":[], "show":true, "svn":{"repository":"/project/engsvn", "revision":"133596", "paths":["xdmp/trunk/src/RangeIndexes.cpp", "xdmp/trunk/src/Tree.h", "xdmp/trunk/src/GeospatialBuiltins.cpp"], "affectedBugs":[]}, "comment":"Bug:20804 fix geo-path and non-geo path range index annotation"}, {"time":"2013-02-25T17:13:35.888753-08:00", "updatedBy":{"username":"fxue", "name":"Fei Xue", "email":"Fei.Xue@marklogic.com"}, "change":{}, "files":[], "show":true, "svn":{"repository":"/project/engsvn", "revision":"133599", "paths":["xdmp/trunk/src/RangeIndexes.cpp"], "affectedBugs":[]}, "comment":"Bug:20804 minor fix for non-geo path annot."}, {"time":"2013-02-25T17:17:12.190061-08:00", "updatedBy":{"username":"fxue", "name":"Fei Xue", "email":"Fei.Xue@marklogic.com"}, "change":{"status":{"from":"", "to":"Test"}, "assignTo":{"from":{"username":"fxue", "name":"Fei Xue", "email":"Fei.Xue@marklogic.com"}, "to":{"username":"rpolasani", "name":"Raghu Polasani", "email":"raghu.polasani@marklogic.com"}}}, "files":[], "show":true, "comment":"Fixed for all geo and non-geo range index annotation.\r\npath range indexes are annotated as path(/path//expression)\r\nNot noting it is range query as it will always appear in a range query"}, {"time":"2013-02-25T17:17:12.190061-08:00", "updatedBy":{"username":"fxue", "name":"Fei Xue", "email":"Fei.Xue@marklogic.com"}, "change":{"assignTo":{"from":{"username":"fxue", "name":"Fei Xue", "email":"Fei.Xue@marklogic.com"}, "to":{"username":"rpolasani", "name":"Raghu Polasani", "email":"raghu.polasani@marklogic.com"}}}, "files":[], "show":true}, {"time":"2013-05-03T14:40:45.619164-07:00", "updatedBy":{"username":"rpolasani", "name":"Raghu Polasani", "email":"raghu.polasani@marklogic.com"}, "change":{"assignTo":{"from":{"username":"rpolasani", "name":"Raghu Polasani", "email":"raghu.polasani@marklogic.com"}, "to":{"username":"lratcliff", "name":"Larry Ratcliff", "email":"lratcliff@marklogic.com"}}}, "files":[], "show":true}, {"time":"2013-06-17T16:04:56.337696-07:00", "updatedBy":{"username":"lratcliff", "name":"Larry Ratcliff", "email":"lratcliff@marklogic.com"}, "change":{"status":{"from":"", "to":"Ship"}, "assignTo":{"from":{"username":"lratcliff", "name":"Larry Ratcliff", "email":"lratcliff@marklogic.com"}, "to":{"username":"nobody", "name":"nobody nobody", "email":"nobody@marklogic.com"}}}, "files":[], "show":true, "comment":"Verified on build 7.0-20130617"}], "updatedAt":"2013-06-17T16:04:56.337696-07:00", "fixedAt":"2013-02-25T17:17:12.190061-08:00", "fixedBy":{"username":"fxue", "name":"Fei Xue", "email":"Fei.Xue@marklogic.com"}, "shippedAt":"2013-06-17T16:04:56.337696-07:00", "shippedBy":{"username":"lratcliff", "name":"Larry Ratcliff", "email":"lratcliff@marklogic.com"}, "renderDescriptionAs":"normal"}
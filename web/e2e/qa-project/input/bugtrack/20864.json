{"id":20864, "kind":"Bug", "createdAt":"2013-02-20T17:48:55.050565-08:00", "status":"Closed", "title":"field range index doesn't work for suggestion source in app builder", "category":"App Builder", "severity":"Major", "priority":{"level":"1", "title":"Required for product release"}, "submittedBy":{"username":"fsalonga", "name":"Frank Salonga", "email":"franklin.salonga@marklogic.com"}, "assignTo":{"username":"nobody", "name":"nobody nobody", "email":"nobody@marklogic.com"}, "description":"from this case: https://help.marklogic.com/staff/Tickets/Ticket/View/12522\r\n\r\nGiven the attached database settings, it's not possible to set a field range index to the suggestion source. Attempting to do so, redeploying, then revisiting the advanced search settings shows the previously selected field range index has been reset to the default (of nothing). In the attached database settings, the particular field range index we're talking about is called \"suggest\"", "samplequery":"", "sampledata":"", "version":"6.0-2.1", "tofixin":"6.0-5", "fixedin":"6.0-5", "platform":"linux(64-bit)", "memory":"", "processors":"", "note":"", "subscribers":[{"username":"fsalonga", "name":"Frank Salonga", "email":"franklin.salonga@marklogic.com"}, {"username":"gvaidees", "name":"Ganesh Vaideeswaran", "email":"Ganesh.Vaideeswaran@marklogic.com"}, {"username":"gchinchwadkar", "name":"Gajanan Chinchwadkar", "email":"Gajanan.Chinchwadkar@marklogic.com"}, {"username":"rhu", "name":"Ron Hu", "email":"ron.hu@marklogic.com"}, {"username":"jfuller", "name":"Jim Fuller", "email":"jim.fuller@marklogic.com"}, {"username":"sreddy", "name":"Sudhakar Reddy", "email":"sreddy@marklogic.com"}, {"username":"gghai", "name":"Gaurav Ghai", "email":"Gaurav.ghai@marklogic.com"}], "attachments":[{"name":"PFE database settings showing the relevant field range index", "uri":"root/support/bugtracking/attachments/20864/temp.txt"}], "relationships":[{"type":"", "to":""}], "clones":[24135], "cloneOf":"", "support":{"headline":"field range index doesn't work for suggestion source in app builder", "supportDescription":"Adding a field range index as a suggestion source in appbuilder does not work properly", "publishStatus":"Publish", "tickets":[], "customerImpact":{"level":"Medium", "title":"Requires significant or unnatural effort to work around issue or to prevent significant business impact"}, "workaround":"I) create new appbuilder app with new database (can be oscar example) or open existing appbuilder app\r\nII) add  new field range index to the database\r\nIII) go back to appbuilder search tab and click 'advanced settings'\r\nIV) select new field range index for search suggestions source\r\nV) deploy and observe search bar now returns suggestions from that index\r\n"}, "tags":["App Builder", "fsalonga"], "changeHistory":[{"time":"2013-02-22T15:16:30.957745-08:00", "updatedBy":{"username":"rpelton", "name":"Rick Pelton", "email":"rick.pelton@marklogic.com"}, "change":{"tofixin":{"from":"", "to":"6.0-3"}}, "files":[], "show":true}, {"time":"2013-02-25T10:52:19.728216-08:00", "updatedBy":{"username":"rpelton", "name":"Rick Pelton", "email":"rick.pelton@marklogic.com"}, "change":{}, "files":[], "show":true, "comment":"support would like this fixed"}, {"time":"2013-02-25T10:52:19.728216-08:00", "updatedBy":{"username":"rpelton", "name":"Rick Pelton", "email":"rick.pelton@marklogic.com"}, "change":{"assignTo":{"from":{"username":"rpelton", "name":"Rick Pelton", "email":"rick.pelton@marklogic.com"}, "to":{"username":"rhu", "name":"Ron Hu", "email":"ron.hu@marklogic.com"}}}, "files":[], "show":true}, {"time":"2013-02-25T11:50:23.141946-08:00", "updatedBy":{"username":"rhu", "name":"Ron Hu", "email":"ron.hu@marklogic.com"}, "change":{"status":{"from":"", "to":"Verify"}, "assignTo":{"from":{"username":"rhu", "name":"Ron Hu", "email":"ron.hu@marklogic.com"}, "to":{"username":"gchinchwadkar", "name":"Gajanan Chinchwadkar", "email":"Gajanan.Chinchwadkar@marklogic.com"}}}, "files":[], "show":true}, {"time":"2013-02-25T11:50:23.141946-08:00", "updatedBy":{"username":"rhu", "name":"Ron Hu", "email":"ron.hu@marklogic.com"}, "change":{"assignTo":{"from":{"username":"rhu", "name":"Ron Hu", "email":"ron.hu@marklogic.com"}, "to":{"username":"gchinchwadkar", "name":"Gajanan Chinchwadkar", "email":"Gajanan.Chinchwadkar@marklogic.com"}}}, "files":[], "show":true}, {"time":"2013-02-26T14:38:59.528836-08:00", "updatedBy":{"username":"gchinchwadkar", "name":"Gajanan Chinchwadkar", "email":"Gajanan.Chinchwadkar@marklogic.com"}, "change":{"assignTo":{"from":{"username":"gchinchwadkar", "name":"Gajanan Chinchwadkar", "email":"Gajanan.Chinchwadkar@marklogic.com"}, "to":{"username":"gvaidees", "name":"Ganesh Vaideeswaran", "email":"Ganesh.Vaideeswaran@marklogic.com"}}}, "files":[], "show":true}, {"time":"2013-03-05T10:26:46.564686-08:00", "updatedBy":{"username":"gvaidees", "name":"Ganesh Vaideeswaran", "email":"Ganesh.Vaideeswaran@marklogic.com"}, "change":{}, "files":[], "show":true, "comment":"I can reproduce this. "}, {"time":"2013-03-05T10:26:46.564686-08:00", "updatedBy":{"username":"gvaidees", "name":"Ganesh Vaideeswaran", "email":"Ganesh.Vaideeswaran@marklogic.com"}, "change":{"status":{"from":"", "to":"Fix"}, "assignTo":{"from":{"username":"gvaidees", "name":"Ganesh Vaideeswaran", "email":"Ganesh.Vaideeswaran@marklogic.com"}, "to":{"username":"gvaidees", "name":"Ganesh Vaideeswaran", "email":"Ganesh.Vaideeswaran@marklogic.com"}}}, "files":[], "show":true}, {"time":"2013-03-05T10:33:39.594003-08:00", "updatedBy":{"username":"gvaidees", "name":"Ganesh Vaideeswaran", "email":"Ganesh.Vaideeswaran@marklogic.com"}, "change":{}, "files":[], "show":true, "comment":"This works with element range index. Does not with field range index. I think we are not saving this info in widgets.xml probably "}, {"time":"2013-03-05T10:34:33.881239-08:00", "updatedBy":{"username":"gvaidees", "name":"Ganesh Vaideeswaran", "email":"Ganesh.Vaideeswaran@marklogic.com"}, "change":{}, "files":[], "show":true, "comment":"Jim,\r\n\r\nAny suggestions which code I should look at? "}, {"time":"2013-03-05T10:51:04.469966-08:00", "updatedBy":{"username":"jfuller", "name":"Jim Fuller", "email":"jim.fuller@marklogic.com"}, "change":{}, "files":[], "show":true, "comment":"sounds like we would have like to amend\r\n\r\n\r\n<widget type=\"results\">\r\n  <desc>results pane widget uses search option defined metadata to display paginated summary listing</desc>\r\n  <style>\r\n    <css>lib/viz/results/results.css</css>\r\n  </style>\r\n  <prolog>\r\n    <js>lib/viz/results/results.js</js>\r\n  </prolog>\r\n  <invoke>var results = ML.createResults('results', results_config);          \r\n  </invoke>\r\n</widget>\r\n\r\nin widgets\r\n\r\nline 593 Apps/appbuilder/search.xqy\r\n\r\nModules/MarkLogic/appservices/appbuilder/\r\n\r\napart from that I would have to flop in where I would start doing this work ... it smells like it would go across the entire stack, but thats probably just appbuilder fear talking."}, {"time":"2013-03-05T10:56:20.663366-08:00", "updatedBy":{"username":"gvaidees", "name":"Ganesh Vaideeswaran", "email":"Ganesh.Vaideeswaran@marklogic.com"}, "change":{}, "files":[], "show":true, "comment":"I would at least like to see 2 things - \r\n\r\n1. Persist the change\r\n2. Make sure the suggest gets into options node\r\n\r\nJim,\r\n\r\nCan you please tell me which file(s) I should start with?I will do the preliminary investigation"}, {"time":"2013-03-22T12:58:56.304502-07:00", "updatedBy":{"username":"gvaidees", "name":"Ganesh Vaideeswaran", "email":"Ganesh.Vaideeswaran@marklogic.com"}, "change":{}, "files":[], "show":true, "comment":"As per guidance from Rick, moving to 6.0-4"}, {"time":"2013-03-22T12:58:56.304502-07:00", "updatedBy":{"username":"gvaidees", "name":"Ganesh Vaideeswaran", "email":"Ganesh.Vaideeswaran@marklogic.com"}, "change":{"tofixin":{"from":"6.0-3", "to":"6.0-4"}}, "files":[], "show":true}, {"time":"2013-06-28T11:35:20.641189-07:00", "updatedBy":{"username":"rpelton", "name":"Rick Pelton", "email":"rick.pelton@marklogic.com"}, "change":{"assignTo":{"from":{"username":"rpelton", "name":"Rick Pelton", "email":"rick.pelton@marklogic.com"}, "to":{"username":"jfuller", "name":"Jim Fuller", "email":"jim.fuller@marklogic.com"}}}, "files":[], "show":true}, {"time":"2013-06-28T11:35:20.641189-07:00", "updatedBy":{"username":"rpelton", "name":"Rick Pelton", "email":"rick.pelton@marklogic.com"}, "change":{"tofixin":{"from":"6.0-4", "to":"7.0-1"}}, "files":[], "show":true}, {"time":"2013-07-26T22:12:00.799751-07:00", "updatedBy":{"username":"gvaidees", "name":"Ganesh Vaideeswaran", "email":"Ganesh.Vaideeswaran@marklogic.com"}, "change":{}, "files":[], "show":true, "comment":"Micah and I spent about 3 hours trying to figure this out today. There is something deep in xforms/xslt and JS interaction that is not revealing what is wrong yet. \r\n\r\nWe have planned to stop work on this for now and treat this as lower priority defect. If we cannot fix this, we may choose to not include fields in suggest drop down and document the limitation. \r\n\r\nAssigning to Micah since he has some context on this now."}, {"time":"2013-09-03T12:34:39.097291-07:00", "updatedBy":{"username":"jfuller", "name":"Jim Fuller", "email":"jim.fuller@marklogic.com"}, "change":{}, "files":[], "show":true, "comment":"keeping this as priority 1 as support requested a fix on this"}, {"time":"2013-09-12T12:15:08.879774-07:00", "updatedBy":{"username":"jfuller", "name":"Jim Fuller", "email":"jim.fuller@marklogic.com"}, "change":{"tofixin":{"from":"7.0-1", "to":"6.0-5"}}, "files":[], "show":true}, {"time":"2013-09-20T10:00:00.780658-07:00", "updatedBy":{"username":"jfuller", "name":"Jim Fuller", "email":"jim.fuller@marklogic.com"}, "change":{}, "files":[], "show":true, "svn":{"repository":"/project/engsvn", "revision":"151964", "paths":["xdmp/branches/b6_0/src/Modules/MarkLogic/appservices/appbuilder/transform.xqy"], "affectedBugs":[]}, "comment":"fix for bug:20864 on 6.05 branch"}, {"time":"2013-09-20T10:00:20.787786-07:00", "updatedBy":{"username":"jfuller", "name":"Jim Fuller", "email":"jim.fuller@marklogic.com"}, "change":{}, "files":[], "show":true, "svn":{"repository":"/project/engsvn", "revision":"151965", "paths":["xdmp/branches/b6_0/src/Apps/common/static/js/widgets.js"], "affectedBugs":[]}, "comment":"fix for bug:20864 on 6.05 branch"}, {"time":"2013-09-20T10:00:53.32988-07:00", "updatedBy":{"username":"jfuller", "name":"Jim Fuller", "email":"jim.fuller@marklogic.com"}, "change":{}, "files":[], "show":true, "svn":{"repository":"/project/engsvn", "revision":"151966", "paths":["xdmp/branches/b6_0/src/Apps/appbuilder/search.xqy"], "affectedBugs":[]}, "comment":"fix for bug:20864 on 6.05 branch"}, {"time":"2013-09-20T10:04:14.112836-07:00", "updatedBy":{"username":"jfuller", "name":"Jim Fuller", "email":"jim.fuller@marklogic.com"}, "change":{"status":{"from":"", "to":"Test"}, "assignTo":{"from":{"username":"jfuller", "name":"Jim Fuller", "email":"jim.fuller@marklogic.com"}, "to":{"username":"sreddy", "name":"Sudhakar Reddy", "email":"sreddy@marklogic.com"}}}, "files":[], "show":true, "comment":"test should be the same as on clone 24135\r\n\r\n"}, {"time":"2013-09-20T10:04:14.112836-07:00", "updatedBy":{"username":"jfuller", "name":"Jim Fuller", "email":"jim.fuller@marklogic.com"}, "change":{"assignTo":{"from":{"username":"jfuller", "name":"Jim Fuller", "email":"jim.fuller@marklogic.com"}, "to":{"username":"sreddy", "name":"Sudhakar Reddy", "email":"sreddy@marklogic.com"}}}, "files":[], "show":true}, {"time":"2014-02-11T18:31:19.244557-08:00", "updatedBy":{"username":"sreddy", "name":"Sudhakar Reddy", "email":"sreddy@marklogic.com"}, "change":{}, "files":[], "show":true, "comment":"Gaurav - please verify. "}, {"time":"2014-02-11T18:31:19.244557-08:00", "updatedBy":{"username":"sreddy", "name":"Sudhakar Reddy", "email":"sreddy@marklogic.com"}, "change":{"assignTo":{"from":{"username":"sreddy", "name":"Sudhakar Reddy", "email":"sreddy@marklogic.com"}, "to":{"username":"gghai", "name":"Gaurav Ghai", "email":"Gaurav.ghai@marklogic.com"}}}, "files":[], "show":true}, {"time":"2014-02-13T12:27:30.433566-08:00", "updatedBy":{"username":"gghai", "name":"Gaurav Ghai", "email":"Gaurav.ghai@marklogic.com"}, "change":{"status":{"from":"", "to":"Ship"}, "assignTo":{"from":{"username":"gghai", "name":"Gaurav Ghai", "email":"Gaurav.ghai@marklogic.com"}, "to":{"username":"nobody", "name":"nobody nobody", "email":"nobody@marklogic.com"}}}, "files":[], "show":true, "comment":"Fixed . Verified on 02/12\r\n\r\n I) create new appbuilder app with new database (can be oscar example)\r\n  \r\n II) add new field range index to new app database\r\n  \r\n III) go back to appbuilder search tab and click 'advanced settings'\r\n  \r\n IV) select the new field range index listed in default suggestion dropdown\r\n \r\nV) deploy (again) and see in /v1/config/query/all search options now has correct search:default-suggestion-source\r\n \r\n<search:default-suggestion-source><search:range collation=\"http://marklogic.com/collation/\" type=\"xs:string\" facet=\"false\"><search:element ns=\"/packaging/my/namespace\" name=\"elementname\"/></search:range></search:default-suggestion-source>\r\n  \r\ndeployed app search should now use this field range index "}, {"time":"2014-02-13T12:27:30.433566-08:00", "updatedBy":{"username":"gghai", "name":"Gaurav Ghai", "email":"Gaurav.ghai@marklogic.com"}, "change":{"assignTo":{"from":{"username":"gghai", "name":"Gaurav Ghai", "email":"Gaurav.ghai@marklogic.com"}, "to":{"username":"nobody", "name":"nobody nobody", "email":"nobody@marklogic.com"}}}, "files":[], "show":true}, {"time":"2014-03-24T06:22:27.860478-07:00", "updatedBy":{"username":"rpelton", "name":"Rick Pelton", "email":"rick.pelton@marklogic.com"}, "change":{"status":{"from":"", "to":"Closed"}, "assignTo":{"from":{"username":"rpelton", "name":"Rick Pelton", "email":"rick.pelton@marklogic.com"}, "to":{"username":"nobody", "name":"nobody nobody", "email":"nobody@marklogic.com"}}}, "files":[], "show":true, "comment":"ga"}], "updatedAt":"2014-03-24T06:22:27.860478-07:00", "fixedAt":"2013-09-20T10:04:14.112836-07:00", "fixedBy":{"username":"jfuller", "name":"Jim Fuller", "email":"jim.fuller@marklogic.com"}, "shippedAt":"2014-02-13T12:27:30.433566-08:00", "shippedBy":{"username":"gghai", "name":"Gaurav Ghai", "email":"Gaurav.ghai@marklogic.com"}, "closedAt":"2014-03-24T06:22:27.860478-07:00", "closedBy":{"username":"rpelton", "name":"Rick Pelton", "email":"rick.pelton@marklogic.com"}, "renderDescriptionAs":"normal"}
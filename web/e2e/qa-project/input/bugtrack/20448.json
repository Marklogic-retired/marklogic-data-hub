{"id":20448, "kind":"Bug", "createdAt":"2013-01-13T21:50:31.693548-08:00", "status":"Closed", "title":"Thesaurus expand returning different results", "category":"search", "severity":"Major", "priority":{"level":"5", "title":""}, "submittedBy":{"username":"ksaxena", "name":"Kapil Saxena", "email":"kapil.saxena@marklogic.com"}, "assignTo":{"username":"nobody", "name":"nobody nobody", "email":"nobody@marklogic.com"}, "description":"ML Version: 7.0 - 20130113\r\nTest Name: thesaurus_lang.xml\r\nLink to diff: https://regression-status.marklogic.com/new-app/space2/diff-archive/b7_0/2013-01-13/linux-64-rh5-cluster/diffs/thesaurus_lang.xml\r\n******************************************************************************************************************************************************\r\n\r\nXQUERY:\r\n\timport module namespace thsr=\"http://marklogic.com/xdmp/thesaurus\" at \"/MarkLogic/thesaurus.xqy\" \r\n\tlet $str := cts:or-query((cts:word-query(\"&#xfdf1;\",\"lang=ar\"),cts:word-query(\"&#xfdf0;\",\"lang=ar\")))\r\n\treturn <res>{xdmp:describe(thsr:expand($str,thsr:query-lookup(\"ar_t.xml\",$str),(),(),()))}</res>]]></h:query>\r\n******************************************************************************************************************************************************\t\r\n\r\nActual Result :\r\n\t\t<res>cts:or-query((cts:word-query((\"&#xfdf1;\", \"&#x0642;&#x0644;&#x06d2;\"), (\"lang=ar\",\"synonym\"), 1), cts:word-query((\"&#xfdf0;\", \"&#x0635;&#x0644;&#x06d2;\"), (\"lang=ar\",\"synonym\"), 1)))</res></h:result-text>\r\n******************************************************************************************************************************************************\r\n\r\nExpected Result: \r\n\t\t<res>cts:or-query((cts:word-query((\"&#xfdf1;\", \"&#x0642;&#x0644;&#x06d2;\"), (\"lang=ar\"), 1), cts:word-query((\"&#xfdf0;\", \"&#x0635;&#x0644;&#x06d2;\"), (\"lang=ar\"), 1)))</res></h:expected-result>\r\n******************************************************************************************************************************************************\r\n\r\n\r\nNote: This is only failing on 7.0 and not on any other branch.", "samplequery":"", "sampledata":"", "version":"7.0-nightly", "tofixin":"7.0-ea1", "fixedin":"N/A", "platform":"all", "memory":"", "processors":"", "note":"", "subscribers":[{"username":"ksaxena", "name":"Kapil Saxena", "email":"kapil.saxena@marklogic.com"}, {"username":"rhu", "name":"Ron Hu", "email":"ron.hu@marklogic.com"}], "attachments":[], "relationships":[{"type":"", "to":""}], "clones":[], "cloneOf":"", "support":{"headline":"", "supportDescription":"", "publishStatus":"Not Ready", "tickets":[], "customerImpact":{"level":"N/A", "title":""}, "workaround":""}, "tags":["search", "ksaxena"], "changeHistory":[{"time":"2013-01-13T21:50:31.693548-08:00", "updatedBy":{"username":"ksaxena", "name":"Kapil Saxena", "email":"kapil.saxena@marklogic.com"}, "change":{"assignTo":{"from":{"username":"ksaxena", "name":"Kapil Saxena", "email":"kapil.saxena@marklogic.com"}, "to":{"username":"rhu", "name":"Ron Hu", "email":"ron.hu@marklogic.com"}}}, "files":[], "show":true}, {"time":"2013-01-13T22:39:08.376518-08:00", "updatedBy":{"username":"ksaxena", "name":"Kapil Saxena", "email":"kapil.saxena@marklogic.com"}, "change":{}, "files":[], "show":true, "comment":"Test Name: bug3741.xml\r\n\r\nXQUERY:\r\nimport module namespace thsr = \"http://marklogic.com/xdmp/thesaurus\" at \"/MarkLogic/thesaurus.xqy\"\r\n<res>{thsr:expand( cts:field-word-query(\"foo\",\"'hood\"), thsr:lookup( \"small.xml\", \"'hood\"), (), (), ())}</res>\r\n\r\nACTUAL Result:\r\n<res><cts:field-word-query><cts:field>foo</cts:field><cts:text xml:lang=\"en\">'hood</cts:text><cts:text xml:lang=\"en\">vicinity</cts:text><cts:text xml:lang=\"en\">locality</cts:text><cts:text xml:lang=\"en\">neighborhood</cts:text><cts:text xml:lang=\"en\">neighbourhood</cts:text><cts:text xml:lang=\"en\">neck of the woods</cts:text><cts:option>synonym</cts:option></cts:field-word-query></res>\r\n\r\nEXPECTED Result:\r\n<res><cts:field-word-query><cts:field>foo</cts:field><cts:text xml:lang=\"en\">'hood</cts:text><cts:text xml:lang=\"en\">vicinity</cts:text><cts:text xml:lang=\"en\">locality</cts:text><cts:text xml:lang=\"en\">neighborhood</cts:text><cts:text xml:lang=\"en\">neighbourhood</cts:text><cts:text xml:lang=\"en\">neck of the woods</cts:text></cts:field-word-query></res>\r\n\r\nIf I compare above then I see that \r\n<cts:option>synonym</cts:option>\r\nis appearing extra in actual results."}, {"time":"2013-01-16T08:35:24.661236-08:00", "updatedBy":{"username":"mary", "name":"Mary Holstege", "email":"mary@cerisent.com"}, "change":{}, "files":[], "show":true, "comment":"This is expected. It is a consequence of the fix to 19982\r\n"}, {"time":"2013-01-17T02:00:56.176164-08:00", "updatedBy":{"username":"ksaxena", "name":"Kapil Saxena", "email":"kapil.saxena@marklogic.com"}, "change":{"status":{"from":"", "to":"Closed"}, "assignTo":{"from":{"username":"ksaxena", "name":"Kapil Saxena", "email":"kapil.saxena@marklogic.com"}, "to":{"username":"nobody", "name":"nobody nobody", "email":"nobody@marklogic.com"}}}, "files":[], "show":true, "comment":"Closing it as it is expected. I'll update the keys where ever necessary."}, {"time":"2013-01-17T02:00:56.176164-08:00", "updatedBy":{"username":"ksaxena", "name":"Kapil Saxena", "email":"kapil.saxena@marklogic.com"}, "change":{"assignTo":{"from":{"username":"ksaxena", "name":"Kapil Saxena", "email":"kapil.saxena@marklogic.com"}, "to":{"username":"nobody", "name":"nobody nobody", "email":"nobody@marklogic.com"}}}, "files":[], "show":true}], "updatedAt":"2013-01-17T02:00:56.176164-08:00", "closedAt":"2013-01-17T02:00:56.176164-08:00", "closedBy":{"username":"ksaxena", "name":"Kapil Saxena", "email":"kapil.saxena@marklogic.com"}, "renderDescriptionAs":"normal"}
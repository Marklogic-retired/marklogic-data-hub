{"id":20900, "kind":"Bug", "createdAt":"2013-02-22T10:26:40.255011-08:00", "status":"Closed", "title":"admin:validate-field-tokenizer-overrides to check for dups across what is passed and what is persisted/comes as default", "category":"search", "severity":"Minor", "priority":{"level":"5", "title":""}, "submittedBy":{"username":"gvaidees", "name":"Ganesh Vaideeswaran", "email":"Ganesh.Vaideeswaran@marklogic.com"}, "assignTo":{"username":"nobody", "name":"nobody nobody", "email":"nobody@marklogic.com"}, "description":"Mary,\r\n\r\nAs we discussed .. it would be good to have this method check for dups across what is passed to the API and what comes as default.\r\n\r\nNice addition would be clear indication (in the exception format string perhaps?) what were the duplicates. \r\n\r\nI am marking for EA1. Feel free to push it out", "samplequery":"", "sampledata":"", "version":"7.0-nightly", "tofixin":"7.0-ea2", "fixedin":"7.0-ea2", "platform":"all", "memory":"", "processors":"", "note":"", "subscribers":[{"username":"gvaidees", "name":"Ganesh Vaideeswaran", "email":"Ganesh.Vaideeswaran@marklogic.com"}, {"username":"lling", "name":"Ling Ling", "email":"ling.ling@marklogic.com"}, {"username":"mary", "name":"Mary Holstege", "email":"mary@cerisent.com"}], "attachments":[], "relationships":[{"type":"", "to":""}], "clones":[], "cloneOf":"", "support":{"headline":"", "supportDescription":"", "publishStatus":"Not Ready", "tickets":[], "customerImpact":{"level":"N/A", "title":""}, "workaround":""}, "tags":["search", "gvaidees"], "changeHistory":[{"time":"2013-02-22T10:26:40.255011-08:00", "updatedBy":{"username":"gvaidees", "name":"Ganesh Vaideeswaran", "email":"Ganesh.Vaideeswaran@marklogic.com"}, "change":{"assignTo":{"from":{"username":"gvaidees", "name":"Ganesh Vaideeswaran", "email":"Ganesh.Vaideeswaran@marklogic.com"}, "to":{"username":"mary", "name":"Mary Holstege", "email":"mary@cerisent.com"}}}, "files":[], "show":true}, {"time":"2013-02-22T10:30:07.696663-08:00", "updatedBy":{"username":"mary", "name":"Mary Holstege", "email":"mary@cerisent.com"}, "change":{}, "files":[], "show":true, "comment":"You mean to check for what is redundant with default classification, right?\r\n"}, {"time":"2013-02-22T10:31:31.901308-08:00", "updatedBy":{"username":"gvaidees", "name":"Ganesh Vaideeswaran", "email":"Ganesh.Vaideeswaran@marklogic.com"}, "change":{}, "files":[], "show":true, "comment":"Yes"}, {"time":"2013-02-22T13:15:18.378266-08:00", "updatedBy":{"username":"mary", "name":"Mary Holstege", "email":"mary@cerisent.com"}, "change":{"tofixin":{"from":"7.0-ea1", "to":"7.0-ea2"}}, "files":[], "show":true}, {"time":"2013-04-25T14:09:10.785917-07:00", "updatedBy":{"username":"mary", "name":"Mary Holstege", "email":"mary@cerisent.com"}, "change":{}, "files":[], "show":true, "svn":{"repository":"/project/engsvn", "revision":"140088", "paths":["xdmp/trunk/src/Lexer.h", "xdmp/trunk/src/Tokenizer.cpp", "xdmp/trunk/src/Messages/ADMIN-en.xml", "xdmp/trunk/src/Messages/XDMP-en.xml", "xdmp/trunk/src/SearchBuiltins.cpp"], "affectedBugs":[]}, "comment":"bug:20900 strengthen error-checking"}, {"time":"2013-04-25T14:09:28.977885-07:00", "updatedBy":{"username":"mary", "name":"Mary Holstege", "email":"mary@cerisent.com"}, "change":{}, "files":[], "show":true, "svn":{"repository":"/project/engsvn", "revision":"140089", "paths":["xdmp/trunk/src/Modules/MarkLogic/admin.xqy"], "affectedBugs":[]}, "comment":"bug:20900 strengthen error-checking"}, {"time":"2013-04-25T14:13:33.930411-07:00", "updatedBy":{"username":"mary", "name":"Mary Holstege", "email":"mary@cerisent.com"}, "change":{"status":{"from":"", "to":"Test"}, "assignTo":{"from":{"username":"mary", "name":"Mary Holstege", "email":"mary@cerisent.com"}, "to":{"username":"lling", "name":"Ling Ling", "email":"ling.ling@marklogic.com"}}}, "files":[], "show":true, "comment":"Fixed 7.0-20140426\r\n\r\nYou will now see some errors in cases that used to not be, in the configuration setting.\r\n(1) Redundant assignment, e.g. punctuation to punctuation\r\n(2) Multi-codepoint characters under NFD normalization\r\n\r\nwrt (1) assigning to 'word' is never redundant in this sense, because 'word' is a generic class across scripts.\r\nwrt (2) Ã€ (xE0) used to be allowed in configuration, even though it couldn't work; now it will give an error"}, {"time":"2013-04-25T14:13:33.930411-07:00", "updatedBy":{"username":"mary", "name":"Mary Holstege", "email":"mary@cerisent.com"}, "change":{"assignTo":{"from":{"username":"mary", "name":"Mary Holstege", "email":"mary@cerisent.com"}, "to":{"username":"lling", "name":"Ling Ling", "email":"ling.ling@marklogic.com"}}}, "files":[], "show":true}, {"time":"2013-04-30T17:51:17.755371-07:00", "updatedBy":{"username":"lling", "name":"Ling Ling", "email":"ling.ling@marklogic.com"}, "change":{}, "files":[], "show":true, "svn":{"repository":"/project/engsvn", "revision":"140534", "paths":["qa/trunk/scripts/tests/custom_tokenization_french.xml", "qa/trunk/scripts/keys/custom_tokenization_french_1.xml", "qa/trunk/scripts/keys/custom_tokenization_french.xml"], "affectedBugs":[]}, "comment":"bug:20900"}, {"time":"2013-04-30T18:44:26.457434-07:00", "updatedBy":{"username":"lling", "name":"Ling Ling", "email":"ling.ling@marklogic.com"}, "change":{}, "files":[], "show":true, "svn":{"repository":"/project/engsvn", "revision":"140539", "paths":["qa/trunk/scripts/tests/custom_tokenization_symbol.xml", "qa/trunk/scripts/keys/custom_tokenization_symbol.xml", "qa/trunk/scripts/keys/custom_tokenization_negative_special.xml", "qa/trunk/scripts/keys/custom_tokenization_space.xml", "qa/trunk/scripts/tests/custom_tokenization_space.xml", "qa/trunk/scripts/keys/custom_tokenization_punctuation.xml"], "affectedBugs":[]}, "comment":"bug:20900"}, {"time":"2013-04-30T18:47:09.237404-07:00", "updatedBy":{"username":"lling", "name":"Ling Ling", "email":"ling.ling@marklogic.com"}, "change":{}, "files":[], "show":true, "comment":"First, this word->word is not detected. As Test-12 in keys/custom_tokenization_negative_special.xml, no exception is thrown.\r\n\r\nSuppose you have a field \"ct\"\r\n1. add \"a\"-> word \r\nxquery version \"1.0-ml\";\r\nimport module namespace admin = \"http://marklogic.com/xdmp/admin\"\r\nat \"/MarkLogic/admin.xqy\";\r\nlet $config := admin:get-configuration()\r\nlet $dbid := xdmp:database(\"Documents\")\r\nlet $override := (\r\nadmin:database-tokenizer-override(\"a\",\"word\")\r\n)\r\nlet $c := admin:database-add-field-tokenizer-override($config, $dbid, \"ct\", $override)\r\nreturn admin:save-configuration($c)\r\n\r\n2. fetch\r\nxquery version \"1.0-ml\";\r\nimport module namespace admin = \"http://marklogic.com/xdmp/admin\" at \"/MarkLogic/admin.xqy\";\r\nlet $config := admin:get-configuration()\r\nfor $override in admin:database-get-field-tokenizer-overrides($config, xdmp:database(\"Documents\"), \"ct\")\r\nreturn $override\r\n\r\nYou'll get \r\n<tokenizer-override xmlns:xsi=\"http://www.w3.org/2001/XMLSchema-instance\" xmlns=\"http://marklogic.com/xdmp/database\">\r\n<character>a</character>\r\n<tokenizer-class>word</tokenizer-class>\r\n</tokenizer-override>"}, {"time":"2013-04-30T18:56:35.68592-07:00", "updatedBy":{"username":"lling", "name":"Ling Ling", "email":"ling.ling@marklogic.com"}, "change":{}, "files":[], "show":true, "comment":"Second, there's a concern when character is treated differently in different language. Like Test-50, 51 and 71. Test-50 and 51 is about setting apostrophe as a punctuation. Apostrophe is treated differently in English and French. Previously in French, when you set apostrophe as a punctuation specifically, you will get apostrophe as a separate punctuation token, but now as you cannot set apostrophe as a punctuation as it is already punctuation, so you couldn't get this kind of results. Like below,\r\n\r\n1. the results of setting apostrophe as punctuation before in French\r\n (cts:word(\"d\"), cts:punctuation(\"'\"), cts:word(\"abord\"), cts:space(\" \"), cts:word(\"aujourd\"), cts:punctuation(\"'\"), cts:word(\"hui\"))(cts:word(\"d\"), cts:punctuation(\"'\"), cts:word(\"abord\"), cts:space(\" \"), cts:word(\"aujourd\"), cts:punctuation(\"'\"), cts:word(\"hui\"))\r\n\r\n2. Now as you cannot set it to punctuation, so you'll get below results in French\r\n(cts:word(\"d'abord\"), cts:space(\" \"), cts:word(\"aujourd'hui\"))(cts:word(\"d\"), cts:punctuation(\"'\"), cts:word(\"abord\"), cts:space(\" \"), cts:word(\"aujourd\"), cts:punctuation(\"'\"), cts:word(\"hui\"))\r\n\r\nsame thing happens to ZWNJ. Now we cannot set ZWNJ to punctuation, so we couldn't get below results in Persian\r\n(cts:word(\"&#x0645;&#x06cc;\"), cts:punctuation(\"&#x200c;\"), cts:word(\"&#x062e;&#x0648;&#x0627;&#x0647;&#x0645;\"))\r\nWe're always getting\r\ncts:word(\"&#x0645;&#x06cc;&#x200c;&#x062e;&#x0648;&#x0627;&#x0647;&#x0645;\")\r\n"}, {"time":"2013-05-01T08:19:28.2858-07:00", "updatedBy":{"username":"mary", "name":"Mary Holstege", "email":"mary@cerisent.com"}, "change":{}, "files":[], "show":true, "comment":"wrt the word/word thing, yes, this is expected, as indicated in my check-in comment. The \"word\" override class is not the same as any built-in class, because it puts the character into the same class as whatever the default script is for the current language. So 'a' mapped to 'word' will behave as 'latin' in English and 'cyrillic' in Russian and so onl.\r\n\r\nI see what you are saying about apostrophe and NWNJ, but think the restriction on special characters like that is OK, because there really isn't a use case for that. We're really testing the edge cases like this so we can characterize the effect. I will update the spec to clarify. Also, getting the effect you describe is at odds with other bugs where you shouldn't get different behaviour if you have an override to the same thing. So I think it is all for the best. "}, {"time":"2013-05-01T14:22:59.632825-07:00", "updatedBy":{"username":"lling", "name":"Ling Ling", "email":"ling.ling@marklogic.com"}, "change":{}, "files":[], "show":true, "comment":"In Japanese, when I assign x304c to a word, I get \"Bad tokenizer override\" exception. query like below\r\n\r\nxquery version \"1.0-ml\";\r\nimport module namespace admin = \"http://marklogic.com/xdmp/admin\"\r\nat \"/MarkLogic/admin.xqy\";\r\nlet $config := admin:get-configuration()\r\nlet $dbid := xdmp:database(\"custom_token_jaDB\")\r\nlet $override := (\r\nadmin:database-tokenizer-override(\"&#x304c;\",\"word\")\r\n)\r\nlet $c := admin:database-add-field-tokenizer-override($config, $dbid, \"ct\", $override)\r\nreturn admin:save-configuration($c)"}, {"time":"2013-05-01T14:23:12.877818-07:00", "updatedBy":{"username":"lling", "name":"Ling Ling", "email":"ling.ling@marklogic.com"}, "change":{"status":{"from":"", "to":"Fix"}, "assignTo":{"from":{"username":"lling", "name":"Ling Ling", "email":"ling.ling@marklogic.com"}, "to":{"username":"mary", "name":"Mary Holstege", "email":"mary@cerisent.com"}}}, "files":[], "show":true}, {"time":"2013-05-01T14:23:12.877818-07:00", "updatedBy":{"username":"lling", "name":"Ling Ling", "email":"ling.ling@marklogic.com"}, "change":{"assignTo":{"from":{"username":"lling", "name":"Ling Ling", "email":"ling.ling@marklogic.com"}, "to":{"username":"mary", "name":"Mary Holstege", "email":"mary@cerisent.com"}}}, "files":[], "show":true}, {"time":"2013-05-01T14:37:45.42763-07:00", "updatedBy":{"username":"mary", "name":"Mary Holstege", "email":"mary@cerisent.com"}, "change":{}, "files":[], "show":true, "comment":"That is not due to word/word override, that is due to the fact that it has an NFD decomposition. This is expected."}, {"time":"2013-05-01T15:12:05.874873-07:00", "updatedBy":{"username":"mary", "name":"Mary Holstege", "email":"mary@cerisent.com"}, "change":{"status":{"from":"", "to":"Test"}, "assignTo":{"from":{"username":"mary", "name":"Mary Holstege", "email":"mary@cerisent.com"}, "to":{"username":"lling", "name":"Ling Ling", "email":"ling.ling@marklogic.com"}}}, "files":[], "show":true, "comment":"See last comment"}, {"time":"2013-05-01T15:12:05.874873-07:00", "updatedBy":{"username":"mary", "name":"Mary Holstege", "email":"mary@cerisent.com"}, "change":{"assignTo":{"from":{"username":"mary", "name":"Mary Holstege", "email":"mary@cerisent.com"}, "to":{"username":"lling", "name":"Ling Ling", "email":"ling.ling@marklogic.com"}}}, "files":[], "show":true}, {"time":"2013-05-01T15:16:05.288419-07:00", "updatedBy":{"username":"lling", "name":"Ling Ling", "email":"ling.ling@marklogic.com"}, "change":{"status":{"from":"", "to":"Ship"}, "assignTo":{"from":{"username":"lling", "name":"Ling Ling", "email":"ling.ling@marklogic.com"}, "to":{"username":"nobody", "name":"nobody nobody", "email":"nobody@marklogic.com"}}}, "files":[], "show":true}, {"time":"2013-05-01T15:16:05.288419-07:00", "updatedBy":{"username":"lling", "name":"Ling Ling", "email":"ling.ling@marklogic.com"}, "change":{"assignTo":{"from":{"username":"lling", "name":"Ling Ling", "email":"ling.ling@marklogic.com"}, "to":{"username":"nobody", "name":"nobody nobody", "email":"nobody@marklogic.com"}}}, "files":[], "show":true}], "updatedAt":"2013-05-01T15:16:05.288419-07:00", "fixedAt":"2013-05-01T15:12:05.874873-07:00", "fixedBy":{"username":"mary", "name":"Mary Holstege", "email":"mary@cerisent.com"}, "shippedAt":"2013-05-01T15:16:05.288419-07:00", "shippedBy":{"username":"lling", "name":"Ling Ling", "email":"ling.ling@marklogic.com"}, "renderDescriptionAs":"normal"}
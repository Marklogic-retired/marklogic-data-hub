{"id":20190, "kind":"Bug", "createdAt":"2012-08-13T20:48:06.817091-07:00", "status":"Will not fix", "title":"json:transform-to-json should give a better error message for basic transformation", "category":"xdmp", "severity":"Minor", "priority":{"level":"5", "title":""}, "submittedBy":{"username":"dsokolsky", "name":"Danny Sokolsky", "email":"dsokolsky@marklogic.com"}, "assignTo":{"username":"nobody", "name":"nobody nobody", "email":"nobody@marklogic.com"}, "description":"If you do a json:transform-to-json and do not supply a decond arg (or supply a json:config(\"basic\") for the second arg), it does not work and gives a not very informative error message.  For example:\r\n\r\nxquery version \"1.0-ml\";\r\nimport module namespace json = \"http://marklogic.com/xdmp/json\"\r\n    at \"/MarkLogic/json/json.xqy\";\r\n\r\njson:transform-to-json(<foo>hello</foo>, json:config(\"basic\"))\r\n=>\r\n[1.0-ml] XDMP-ARGTYPE: (err:XPTY0004) fn:error(\"json:INVALIDELEM\", \"Unexpected type attribute\", ()) -- arg1 is not of type xs:QName?\r\n\r\nStack Trace\r\nIn /MarkLogic/json/basic.xqy on line 173\r\nIn element-to-json#2(map:map(<map:map xmlns:xs=\"http://www.w3.org/2001/XMLSchema\" xmlns:xsi=\"http://www.w3.org/2001/XMLSchema-instance\" xmlns:map=\"http://marklogic.com/xdmp/map\"><map:entry key=\"check-config\"><map:value xsi:type=\"xs:anySimpleT...</map:map>...XDMP-XMLFUNC: (err:XQTY0105) Functions cannot be used in the content of an element constructor...), <foo>hello</foo>)\r\n.....\r\n\r\nIt should try to give a better error, as this seems like a common error case for someone trying to transform xml to json.", "samplequery":"", "sampledata":"", "version":"6.0-2", "tofixin":"N/A", "fixedin":"N/A", "platform":"all", "memory":"", "processors":"", "note":"", "subscribers":[{"username":"dsokolsky", "name":"Danny Sokolsky", "email":"dsokolsky@marklogic.com"}, {"username":"dlee", "name":"David  Lee", "email":"David.Lee@marklogic.com"}, {"username":"rpolasani", "name":"Raghu Polasani", "email":"raghu.polasani@marklogic.com"}, {"username":"lling", "name":"Ling Ling", "email":"ling.ling@marklogic.com"}], "attachments":[], "relationships":[{"type":"", "to":""}], "clones":[], "cloneOf":18904, "support":{"headline":"", "supportDescription":"", "publishStatus":"Not Ready", "tickets":[], "customerImpact":{"level":"N/A", "title":""}, "workaround":""}, "tags":["xdmp", "dsokolsky"], "changeHistory":[{"time":"2012-08-13T20:48:06.817091-07:00", "updatedBy":{"username":"dsokolsky", "name":"Danny Sokolsky", "email":"dsokolsky@marklogic.com"}, "change":{"assignTo":{"from":{"username":"dsokolsky", "name":"Danny Sokolsky", "email":"dsokolsky@marklogic.com"}, "to":{"username":"dlee", "name":"David  Lee", "email":"David.Lee@marklogic.com"}}}, "files":[], "show":true}, {"time":"2012-08-14T04:45:18.484272-07:00", "updatedBy":{"username":"dlee", "name":"David  Lee", "email":"David.Lee@marklogic.com"}, "change":{}, "files":[], "show":true, "comment":"This looks like a regression and a serious one.\r\nProposed to be fixed in 6.0  "}, {"time":"2012-08-14T04:45:18.484272-07:00", "updatedBy":{"username":"dlee", "name":"David  Lee", "email":"David.Lee@marklogic.com"}, "change":{"tofixin":{"from":"6.0-2", "to":"6.0-1"}}, "files":[], "show":true}, {"time":"2012-08-14T05:32:57.666574-07:00", "updatedBy":{"username":"dlee", "name":"David  Lee", "email":"David.Lee@marklogic.com"}, "change":{}, "files":[], "show":true, "comment":"I should have had my first coffee before responding.\r\nThis is not a regression and is correctly tagged as Minor.\r\njson:transform-to-json() using the default (\"basic\") strategy is only intended to work on XML documents produced by a previous call to json:transform-from-json() using the basic strategy.    Thus this case is expected to be an error.  \r\n\r\nThe defect is that the error messages is not clear.  Moving back to 6.0.2 unless esculated by mgt.\r\n"}, {"time":"2012-08-14T05:32:57.666574-07:00", "updatedBy":{"username":"dlee", "name":"David  Lee", "email":"David.Lee@marklogic.com"}, "change":{"tofixin":{"from":"6.0-1", "to":"6.0-2"}}, "files":[], "show":true}, {"time":"2012-09-26T08:56:47.624733-07:00", "updatedBy":{"username":"dlee", "name":"David  Lee", "email":"David.Lee@marklogic.com"}, "change":{}, "files":[], "show":true, "svn":{"repository":"/project/engsvn", "revision":"115258", "paths":["xdmp/trunk/src/Modules/MarkLogic/json/basic.xqy", "xdmp/trunk/src/Modules/MarkLogic/json/custom.xqy"], "affectedBugs":[]}, "comment":"bug:18904 Added checking for proper namespace on all elements when transformed from xml using basic configuration.   Fix use of fn:error to use a QName instead of a string."}, {"time":"2012-09-26T08:57:47.01762-07:00", "updatedBy":{"username":"dlee", "name":"David  Lee", "email":"David.Lee@marklogic.com"}, "change":{"status":{"from":"", "to":"Test"}, "assignTo":{"from":{"username":"dlee", "name":"David  Lee", "email":"David.Lee@marklogic.com"}, "to":{"username":"rpolasani", "name":"Raghu Polasani", "email":"raghu.polasani@marklogic.com"}}}, "files":[], "show":true, "comment":"Fixed in trunk as per comments.\r\nNote: I am not quite sure if the \"Fixed In\" target is correct."}, {"time":"2012-09-26T08:57:47.01762-07:00", "updatedBy":{"username":"dlee", "name":"David  Lee", "email":"David.Lee@marklogic.com"}, "change":{"assignTo":{"from":{"username":"dlee", "name":"David  Lee", "email":"David.Lee@marklogic.com"}, "to":{"username":"rpolasani", "name":"Raghu Polasani", "email":"raghu.polasani@marklogic.com"}}}, "files":[], "show":true}, {"time":"2012-11-21T01:56:43.188095-08:00", "updatedBy":{"username":"rpolasani", "name":"Raghu Polasani", "email":"raghu.polasani@marklogic.com"}, "change":{"assignTo":{"from":{"username":"rpolasani", "name":"Raghu Polasani", "email":"raghu.polasani@marklogic.com"}, "to":{"username":"lling", "name":"Ling Ling", "email":"ling.ling@marklogic.com"}}}, "files":[], "show":true}, {"time":"2012-12-04T16:38:43.800167-08:00", "updatedBy":{"username":"lling", "name":"Ling Ling", "email":"ling.ling@marklogic.com"}, "change":{}, "files":[], "show":true, "svn":{"repository":"/project/engsvn", "revision":"122716", "paths":["qa/trunk/scripts/tests/bug18904.xml", "qa/trunk/scripts/keys/bug18904.xml", "qa/trunk/scripts/list/bugs51.txt"], "affectedBugs":[]}, "comment":"bug:18904"}, {"time":"2012-12-04T16:48:15.586531-08:00", "updatedBy":{"username":"dlee", "name":"David  Lee", "email":"David.Lee@marklogic.com"}, "change":{"status":{"from":"", "to":"Fix"}, "assignTo":{"from":{"username":"dlee", "name":"David  Lee", "email":"David.Lee@marklogic.com"}, "to":{"username":"dlee", "name":"David  Lee", "email":"David.Lee@marklogic.com"}}}, "files":[], "show":true, "comment":"Apply fix to 6.0.3"}, {"time":"2012-12-04T16:48:15.586531-08:00", "updatedBy":{"username":"dlee", "name":"David  Lee", "email":"David.Lee@marklogic.com"}, "change":{"assignTo":{"from":{"username":"dlee", "name":"David  Lee", "email":"David.Lee@marklogic.com"}, "to":{"username":"dlee", "name":"David  Lee", "email":"David.Lee@marklogic.com"}}}, "files":[], "show":true}, {"time":"2012-12-04T16:48:15.586531-08:00", "updatedBy":{"username":"dlee", "name":"David  Lee", "email":"David.Lee@marklogic.com"}, "change":{"tofixin":{"from":"", "to":"6.0-3"}}, "files":[], "show":true}, {"time":"2012-12-07T09:54:46.60651-08:00", "updatedBy":{"username":"dlee", "name":"David  Lee", "email":"David.Lee@marklogic.com"}, "change":{}, "files":[], "show":true, "comment":"According to my interpretation of criteria for 6.0.3 as per the server meeting this week  this defect is not in the category that should be fixed for 6.0.3\r\nThe use case is not one users should be doing,\r\nit does correctly produce an error (so does nothing bad)\r\nThe fix only refines what the error is.\r\nMarking Will Not Fix.\r\n\r\n"}, {"time":"2012-12-07T09:54:46.60651-08:00", "updatedBy":{"username":"dlee", "name":"David  Lee", "email":"David.Lee@marklogic.com"}, "change":{"status":{"from":"", "to":"Will not fix"}, "assignTo":{"from":{"username":"dlee", "name":"David  Lee", "email":"David.Lee@marklogic.com"}, "to":{"username":"nobody", "name":"nobody nobody", "email":"nobody@marklogic.com"}}}, "files":[], "show":true}], "updatedAt":"2012-12-07T09:54:46.60651-08:00", "fixedAt":"2012-09-26T08:57:47.01762-07:00", "fixedBy":{"username":"dlee", "name":"David  Lee", "email":"David.Lee@marklogic.com"}, "renderDescriptionAs":"normal"}
{"id":20707, "kind":"Bug", "createdAt":"2013-02-05T01:56:36.954211-08:00", "status":"Closed", "title":"Package Import Issue - Invalid coercion error", "category":"packaging", "severity":"Major", "priority":{"level":"5", "title":""}, "submittedBy":{"username":"bgupta", "name":"Balkrishna Gupta", "email":"balkrishna.gupta@marklogic.com"}, "assignTo":{"username":"nobody", "name":"nobody nobody", "email":"nobody@marklogic.com"}, "description":"We have a case where customer is importing a database package xml having field definition with include elements local name as white-space separated string. It is failing with an 'invalid coercion' error. Below is the stack trace:\r\n\r\n----------------------------------------------------------------------------------------------------------------------------------------------------------------------------------\r\nerr:XPTY0004: XDMP-AS: (err:XPTY0004) pkgcheck:bogus-localnames($pkg) -- Invalid coercion: (<pkg:configuration-errors xmlns:pkg=\"http://marklogic.com/package\"><pkg:resource-type>database</pkg:resource-type><pkg:resource-typ...</pkg:configuration-errors>, <pkg:configuration-errors xmlns:pkg=\"http://marklogic.com/package\"><pkg:resource-type>database</pkg:resource-type><pkg:resource-typ...</pkg:configuration-errors>) as element(pkg:configuration-errors)?\r\n\r\nIn /MarkLogic/package/check-impl.xqy on line 107\r\nIn pkgcheck:bogus-localnames(<pkg:package xmlns:pkg=\"http://marklogic.com/package\"><package-database xmlns=\"http://marklogic.com/package/databases\"...</pkg:package>)\r\n$pkg = <pkg:package xmlns:pkg=\"http://marklogic.com/package\"><package-database xmlns=\"http://marklogic.com/package/databases\"...</pkg:package>\r\nIn /MarkLogic/package/check-impl.xqy on line 59\r\nIn check-impl:package-errors(<pkg:package xmlns:pkg=\"http://marklogic.com/package\"><package-database xmlns=\"http://marklogic.com/package/databases\"...</pkg:package>)\r\n$pkg = <pkg:package xmlns:pkg=\"http://marklogic.com/package\"><package-database xmlns=\"http://marklogic.com/package/databases\"...</pkg:package>\r\n$pkg = <pkg:package xmlns:pkg=\"http://marklogic.com/package\"><package-database xmlns=\"http://marklogic.com/package/databases\"...</pkg:package>\r\n$validity-errs = ()\r\nIn /MarkLogic/package/package.xqy on line 70\r\nIn package:errors(<pkg:package xmlns:pkg=\"http://marklogic.com/package\"><package-database xmlns=\"http://marklogic.com/package/databases\"...</pkg:package>)\r\n$pkg = <pkg:package xmlns:pkg=\"http://marklogic.com/package\"><package-database xmlns=\"http://marklogic.com/package/databases\"...</pkg:package>\r\nIn /MarkLogic/package/package.xqy on line 63\r\nIn package:valid(<pkg:package xmlns:pkg=\"http://marklogic.com/package\"><package-database xmlns=\"http://marklogic.com/package/databases\"...</pkg:package>)\r\n$pkg = <pkg:package xmlns:pkg=\"http://marklogic.com/package\"><package-database xmlns=\"http://marklogic.com/package/databases\"...</pkg:package>\r\nIn /packaging/compare-package.xqy on line 176\r\nIn local:do-post()\r\n$params = map:map(<map:map xmlns:xs=\"http://www.w3.org/2001/XMLSchema\" xmlns:xsi=\"http://www.w3.org/2001/XMLSchema-instance\" xmlns:map=\"http://marklogic.com/xdmp/map\"><map:entry key=\"format\"><map:value xsi:type=\"xs:string\">html</ma...</map:map>)\r\n$format = \"html\"\r\n$pkg = <pkg:package xmlns:pkg=\"http://marklogic.com/package\"><package-database xmlns=\"http://marklogic.com/package/databases\"...</pkg:package>\r\n$filename = \"database.xml\"\r\nIn /packaging/compare-package.xqy on line 260\r\n-------------------------------------------------------------------------------------------------------------------------------------------------------------------------------\r\n\r\nIt is working fine if we specify localname without whitespace separated string and single element name. I am attaching the database package xml for the reference.", "samplequery":"", "sampledata":"", "version":"6.0-2.1", "tofixin":"6.0-3", "fixedin":"6.0-3", "platform":"all", "memory":"", "processors":"", "note":"", "subscribers":[{"username":"bgupta", "name":"Balkrishna Gupta", "email":"balkrishna.gupta@marklogic.com"}, {"username":"gghai", "name":"Gaurav Ghai", "email":"Gaurav.ghai@marklogic.com"}, {"username":"msarma", "name":"Meghalim Sarma", "email":"msarma@marklogic.com"}, {"username":"nwalsh", "name":"Norman Walsh", "email":"norman.walsh@marklogic.com"}], "attachments":[{"name":"database.xml", "uri":"root/support/bugtracking/attachments/20707/database.xml"}], "relationships":[{"type":"", "to":""}], "clones":[21326], "cloneOf":"", "support":{"headline":"Package Import Invalid coercion error ", "supportDescription":"Importing a database package that has a field definition with include elements local name as white-space separated string failing with an 'invalid coercion' error. ", "publishStatus":"Publish", "tickets":[], "customerImpact":{"level":"Medium", "title":"Requires significant or unnatural effort to work around issue or to prevent significant business impact"}, "workaround":""}, "tags":["packaging", "bgupta"], "changeHistory":[{"time":"2013-02-06T08:18:19.17874-08:00", "updatedBy":{"username":"rpelton", "name":"Rick Pelton", "email":"rick.pelton@marklogic.com"}, "change":{"assignTo":{"from":{"username":"rpelton", "name":"Rick Pelton", "email":"rick.pelton@marklogic.com"}, "to":{"username":"nwalsh", "name":"Norman Walsh", "email":"norman.walsh@marklogic.com"}}}, "files":[], "show":true}, {"time":"2013-02-06T08:18:19.17874-08:00", "updatedBy":{"username":"rpelton", "name":"Rick Pelton", "email":"rick.pelton@marklogic.com"}, "change":{"tofixin":{"from":"", "to":"6.0-3"}}, "files":[], "show":true}, {"time":"2013-02-06T08:25:42.257928-08:00", "updatedBy":{"username":"rpelton", "name":"Rick Pelton", "email":"rick.pelton@marklogic.com"}, "change":{}, "files":[], "show":true, "comment":"Adding comment from support ticket (customer / Michael Blakely on behalf of Twin Dolphin):\r\n\r\nYes, I am editing the package XML to add the field. When I export from a database with that field configured, the export seems to skip the field entirely. So I copied it directly from my live databases.xml file.\r\n\r\nI can get the package to work by creating a separate field included element for every localname. So that's a workaround. However my main issue is with the error reporting: when I upload that originally-attached package I'd like to see a more useful error message. That originally-reported XDMP-AS seems to be a symptom of something breaking inside the package code, and doesn't help resolve the problem.\r\n\r\n"}, {"time":"2013-02-15T13:22:14.975386-08:00", "updatedBy":{"username":"dgorbet", "name":"David Gorbet", "email":"David.Gorbet@marklogic.com"}, "change":{"status":{"from":"", "to":"Verify"}, "assignTo":{"from":{"username":"dgorbet", "name":"David Gorbet", "email":"David.Gorbet@marklogic.com"}, "to":{"username":"nwalsh", "name":"Norman Walsh", "email":"norman.walsh@marklogic.com"}}}, "files":[], "show":true, "comment":"Triage says please investigate and fix."}, {"time":"2013-02-20T13:38:56.463771-08:00", "updatedBy":{"username":"nwalsh", "name":"Norman Walsh", "email":"norman.walsh@marklogic.com"}, "change":{}, "files":[], "show":true, "svn":{"repository":"/project/engsvn", "revision":"132675", "paths":["xdmp/branches/b6_0/src/Modules/MarkLogic/package/check-impl.xqy"], "affectedBugs":[]}, "comment":"Fix bug:20707, handle the case where there's more than one bogus localname"}, {"time":"2013-02-20T13:40:25.128812-08:00", "updatedBy":{"username":"nwalsh", "name":"Norman Walsh", "email":"norman.walsh@marklogic.com"}, "change":{"status":{"from":"", "to":"Test"}, "assignTo":{"from":{"username":"nwalsh", "name":"Norman Walsh", "email":"norman.walsh@marklogic.com"}, "to":{"username":"msarma", "name":"Meghalim Sarma", "email":"msarma@marklogic.com"}}}, "files":[], "show":true, "comment":"Fixed, I believe. In b6_0.\r\n\r\nThis bug goes all the way back to b5_0 so it might make sense to clone it onto other branches.\r\n"}, {"time":"2013-02-20T13:40:25.128812-08:00", "updatedBy":{"username":"nwalsh", "name":"Norman Walsh", "email":"norman.walsh@marklogic.com"}, "change":{"assignTo":{"from":{"username":"nwalsh", "name":"Norman Walsh", "email":"norman.walsh@marklogic.com"}, "to":{"username":"msarma", "name":"Meghalim Sarma", "email":"msarma@marklogic.com"}}}, "files":[], "show":true}, {"time":"2013-03-12T11:06:34.272638-07:00", "updatedBy":{"username":"msarma", "name":"Meghalim Sarma", "email":"msarma@marklogic.com"}, "change":{"assignTo":{"from":{"username":"msarma", "name":"Meghalim Sarma", "email":"msarma@marklogic.com"}, "to":{"username":"gghai", "name":"Gaurav Ghai", "email":"Gaurav.ghai@marklogic.com"}}}, "files":[], "show":true}, {"time":"2013-03-27T12:53:52.080001-07:00", "updatedBy":{"username":"gghai", "name":"Gaurav Ghai", "email":"Gaurav.ghai@marklogic.com"}, "change":{}, "files":[], "show":true, "comment":"Hi Norm : I am seeing the below error message is that what is expected now via uploading the attached database.xml . Per my understanding  it looks reasonable now . \r\n\r\nThe supplied document is not a valid package. Invalid localname: ABST CLMS DESC TITL"}, {"time":"2013-03-27T12:56:15.746506-07:00", "updatedBy":{"username":"gghai", "name":"Gaurav Ghai", "email":"Gaurav.ghai@marklogic.com"}, "change":{"status":{"from":"", "to":"Verify"}, "assignTo":{"from":{"username":"gghai", "name":"Gaurav Ghai", "email":"Gaurav.ghai@marklogic.com"}, "to":{"username":"nwalsh", "name":"Norman Walsh", "email":"norman.walsh@marklogic.com"}}}, "files":[], "show":true}, {"time":"2013-03-27T12:56:15.746506-07:00", "updatedBy":{"username":"gghai", "name":"Gaurav Ghai", "email":"Gaurav.ghai@marklogic.com"}, "change":{"assignTo":{"from":{"username":"gghai", "name":"Gaurav Ghai", "email":"Gaurav.ghai@marklogic.com"}, "to":{"username":"nwalsh", "name":"Norman Walsh", "email":"norman.walsh@marklogic.com"}}}, "files":[], "show":true}, {"time":"2013-03-27T12:57:50.34175-07:00", "updatedBy":{"username":"nwalsh", "name":"Norman Walsh", "email":"norman.walsh@marklogic.com"}, "change":{}, "files":[], "show":true, "comment":"Yes, that's right. We no longer throw a 500 error but in ML6, you're not allowed to do that.\r\n\r\nIn ML7, I think it will work, FWIW."}, {"time":"2013-03-27T12:57:50.34175-07:00", "updatedBy":{"username":"nwalsh", "name":"Norman Walsh", "email":"norman.walsh@marklogic.com"}, "change":{"status":{"from":"", "to":"Test"}, "assignTo":{"from":{"username":"nwalsh", "name":"Norman Walsh", "email":"norman.walsh@marklogic.com"}, "to":{"username":"gghai", "name":"Gaurav Ghai", "email":"Gaurav.ghai@marklogic.com"}}}, "files":[], "show":true}, {"time":"2013-03-27T12:57:50.34175-07:00", "updatedBy":{"username":"nwalsh", "name":"Norman Walsh", "email":"norman.walsh@marklogic.com"}, "change":{"assignTo":{"from":{"username":"nwalsh", "name":"Norman Walsh", "email":"norman.walsh@marklogic.com"}, "to":{"username":"gghai", "name":"Gaurav Ghai", "email":"Gaurav.ghai@marklogic.com"}}}, "files":[], "show":true}, {"time":"2013-03-27T13:00:50.806055-07:00", "updatedBy":{"username":"gghai", "name":"Gaurav Ghai", "email":"Gaurav.ghai@marklogic.com"}, "change":{"status":{"from":"", "to":"Ship"}, "assignTo":{"from":{"username":"gghai", "name":"Gaurav Ghai", "email":"Gaurav.ghai@marklogic.com"}, "to":{"username":"nobody", "name":"nobody nobody", "email":"nobody@marklogic.com"}}}, "files":[], "show":true, "comment":"Fixed on 03/27 build . Thanks Norm for confirming ."}, {"time":"2013-03-27T13:00:50.806055-07:00", "updatedBy":{"username":"gghai", "name":"Gaurav Ghai", "email":"Gaurav.ghai@marklogic.com"}, "change":{"assignTo":{"from":{"username":"gghai", "name":"Gaurav Ghai", "email":"Gaurav.ghai@marklogic.com"}, "to":{"username":"nobody", "name":"nobody nobody", "email":"nobody@marklogic.com"}}}, "files":[], "show":true}, {"time":"2013-04-22T16:25:56.584938-07:00", "updatedBy":{"username":"rpelton", "name":"Rick Pelton", "email":"rick.pelton@marklogic.com"}, "change":{"status":{"from":"", "to":"Closed"}, "assignTo":{"from":{"username":"rpelton", "name":"Rick Pelton", "email":"rick.pelton@marklogic.com"}, "to":{"username":"nobody", "name":"nobody nobody", "email":"nobody@marklogic.com"}}}, "files":[], "show":true}], "updatedAt":"2013-04-22T16:25:56.584938-07:00", "fixedAt":"2013-03-27T12:57:50.34175-07:00", "fixedBy":{"username":"nwalsh", "name":"Norman Walsh", "email":"norman.walsh@marklogic.com"}, "shippedAt":"2013-03-27T13:00:50.806055-07:00", "shippedBy":{"username":"gghai", "name":"Gaurav Ghai", "email":"Gaurav.ghai@marklogic.com"}, "closedAt":"2013-04-22T16:25:56.584938-07:00", "closedBy":{"username":"rpelton", "name":"Rick Pelton", "email":"rick.pelton@marklogic.com"}, "renderDescriptionAs":"normal"}
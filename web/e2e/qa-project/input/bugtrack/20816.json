{"id":20816, "kind":"Bug", "createdAt":"2013-02-18T07:25:31.68206-08:00", "status":"Closed", "title":"Test Harness called mladmin abort during test bug12557.xml on 5.0 nightly of 02/18", "category":"xdmp", "severity":"Catastrophic", "priority":{"level":"5", "title":""}, "submittedBy":{"username":"ksaxena", "name":"Kapil Saxena", "email":"kapil.saxena@marklogic.com"}, "assignTo":{"username":"nobody", "name":"nobody nobody", "email":"nobody@marklogic.com"}, "description":"ML Version: 20130218\r\nPlatform: Linux64 - rh6\r\nMachine Name: rh6-intel64-43-test-1.marklogic.com\r\nPath to Logs: /space/builder/builds/linux64/b5_0/logs.20130218.0/reg-results\r\n***********************************************************************************************************************************************\r\n\r\nThere was no trace available in the ErrorLog.txt, however following is seen: (It contains abort and alarm)\r\n#########################################################\r\n\r\n2013-02-18 04:56:22.449 Debug: Detected indexes for database Fab: sln\r\n2013-02-18 04:56:22.449 Debug: Detecting compatibility for database Fab\r\n2013-02-18 04:56:22.449 Debug: Detected compatibility for database Fab\r\n___________________________________\r\nAbort in thread 140722639669056 pid 10358\r\n___________________________________\r\n2013-02-18 05:28:06.705 Config: Wrote /var/opt/MarkLogic/groups.xml\r\n2013-02-18 05:28:06.705 Config: Loading /var/opt/MarkLogic/groups.xml\r\n2013-02-18 05:28:06.712 Config: Loading /var/opt/MarkLogic/clusters.xml\r\n2013-02-18 05:28:06.712 Config: Loading /var/opt/MarkLogic/hosts.xml\r\n2013-02-18 05:28:06.712 Config: Loading /var/opt/MarkLogic/server.xml\r\n2013-02-18 05:28:06.713 Debug: Setting trace events for group 8720384582230223466\r\n2013-02-18 05:28:06.713 Debug: Trace events activated flag is false\r\n2013-02-18 05:28:06.713 Debug: Setting audit configuration for group 8720384582230223466\r\n2013-02-18 05:28:06.713 Debug: Audit enabled flag is true\r\n2013-02-18 05:28:06.776 Notice: QAxdbcServer: CPF-PIPELINENOTFOUND: (err:FOER0000) Processing pipeline not found: Flexible Replication\r\n2013-02-18 05:28:06.776 Notice: QAxdbcServer: in /MarkLogic/cpf/pipelines.xqy, at 157:9,\r\n2013-02-18 05:28:06.776 Notice: QAxdbcServer: in p:get(\"Flexible Replication\") [1.0-ml]\r\n2013-02-18 05:28:06.776 Notice: QAxdbcServer:   $pipeline-name = \"Flexible Replication\"\r\n2013-02-18 05:28:06.776 Notice: QAxdbcServer:   $pipeline = ()\r\n2013-02-18 05:28:06.776 Notice: QAxdbcServer: at 10:47 [1.0-ml]\r\n____________________________\r\nAlarm in thread 140722639669056\r\n____________________________\r\n2013-02-18 05:28:36.388 Notice: Starting MarkLogic Server 5.0-20130218 x86_64 in /opt/MarkLogic with data in /var/opt/MarkLogic\r\n2013-02-18 05:28:36.395 Info: Host rh6-intel64-43-test-1.marklogic.com running Linux 2.6.32-71.el6.x86_64 (Red Hat Enterprise Linux Server release 6.0 (Santiago))\r\n2013-02-18 05:29:06.406 Critical: HostManager::updateConfig: SVC-SOCBIND: Socket bind error: bind 0.0.0.0:7999: Address already in use\r\n2013-02-18 05:29:07.388 Notice: Starting MarkLogic Server 5.0-20130218 x86_64 in /opt/MarkLogic with data in /var/opt/MarkLogic\r\n2013-02-18 05:29:07.395 Info: Host rh6-intel64-43-test-1.marklogic.com running Linux 2.6.32-71.el6.x86_64 (Red Hat Enterprise Linux Server release 6.0 (Santiago))\r\n2013-02-18 05:29:07.401 Debug: Setting trace events for group 8720384582230223466\r\n2013-02-18 05:29:07.401 Debug: Trace events activated flag is false\r\n2013-02-18 05:29:07.401 Debug: Setting audit configuration for group 8720384582230223466\r\n2013-02-18 05:29:07.402 Debug: Audit enabled flag is true\r\n\r\n************************************************************************************************************************************************\r\n\r\nThe following is suspected XQuery:\r\n\r\nxquery version \"1.0-ml\";\r\ndeclare namespace xi=\"http://www.w3.org/2001/XInclude\";\r\nimport module namespace dom = \"http://marklogic.com/cpf/domains\" at \"/MarkLogic/cpf/domains.xqy\";\r\nimport module namespace p = \"http://marklogic.com/cpf/pipelines\" at \"/MarkLogic/cpf/pipelines.xqy\";\r\ndom:add-pipeline( \"Default bug12557m\", p:get(\"Flexible Replication\")/p:pipeline-id )\r\n\r\n************************************************************************************************************************************************\r\n\r\nFollowing is seen in qa-stdout:\r\n\r\nMon Feb 18 04:56:13 PST 2013: creating threads...\r\nMon Feb 18 04:56:13 PST 2013: starting...\r\nTaking stack trace with a total of one minute sleep\r\ndate +%Y%m%d%H%M%S >> /space/builder/builds/linux64/b5_0/logs.20130218.0/reg-results/pstack.log; sudo /usr/local/sbin/mladmin pstack >> /space/builder/builds/linux64/b5_0/logs.20130218.0/reg-results/pstack.log 2>> /space/builder/builds/linux64/b5_0/logs.20130218.0/reg-results/pstack.log; sleep 30;date +%Y%m%d%H%M%S >> /space/builder/builds/linux64/b5_0/logs.20130218.0/reg-results/pstack.log; sudo /usr/local/sbin/mladmin pstack >> /space/builder/builds/linux64/b5_0/logs.20130218.0/reg-results/pstack.log 2>> /space/builder/builds/linux64/b5_0/logs.20130218.0/reg-results/pstack.log\r\nKilling Server last query to run\r\nsudo /usr/local/sbin/mladmin abort\r\nAborting MarkLogic: [  OK  ]\r\nKilling Server done\r\nKilling procs\r\nsudo /usr/local/sbin/mladmin killprocs\r\njava.lang.NullPointerException\r\n        at test.utilities.CommandUtil.executeCommand(CommandUtil.java:181)\r\n        at test.utilities.TimeOutThread.stopServer(TimeOutThread.java:93)\r\n        at test.utilities.TimeOutThread.restartServer(TimeOutThread.java:163)\r\n        at test.utilities.TimeOutThread.run(TimeOutThread.java:190)\r\nStarting Server\r\nsudo /usr/local/sbin/mladmin start\r\nStarting MarkLogic: [  OK  ]\r\nServer Started\r\nwaiting 2 second for before checking for restart\r\nwaiting 2 second for before checking for restart\r\nWaiting restart\r\nrunning following shell command: sleep 10\r\nMon Feb 18 05:29:59 PST 2013: Reporting results...\r\nMon Feb 18 05:29:59 PST 2013: Writing results to /space/builder/builds/linux64/b5_0/qa/scripts/results/bug12557.xml\r\n#### Differing in the element <h:got-error> in the test-> TEST3   ######\r\n#### Differing in the element <h:got-error> in the test-> TEST3a   ######\r\nbug12557.xml : Failed\r\n\r\n\r\nNote: \r\n1. Attached is the pstack log just before call to abort was made.", "samplequery":"", "sampledata":"", "version":"5.0-nightly", "tofixin":"5.0-5", "fixedin":"N/A", "platform":"linux(64-bit)", "memory":"", "processors":"", "note":"", "subscribers":[{"username":"ksaxena", "name":"Kapil Saxena", "email":"kapil.saxena@marklogic.com"}, {"username":"rhu", "name":"Ron Hu", "email":"ron.hu@marklogic.com"}, {"username":"wfeick", "name":"Wayne Feick", "email":"wfeick@marklogic.com"}], "attachments":[{"name":"pstack log", "uri":"root/support/bugtracking/attachments/20816/pstack.log"}], "relationships":[{"type":"", "to":""}], "clones":[], "cloneOf":"", "support":{"headline":"", "supportDescription":"", "publishStatus":"Not Ready", "tickets":[], "customerImpact":{"level":"N/A", "title":""}, "workaround":""}, "tags":["xdmp", "ksaxena"], "changeHistory":[{"time":"2013-02-18T07:25:31.68206-08:00", "updatedBy":{"username":"ksaxena", "name":"Kapil Saxena", "email":"kapil.saxena@marklogic.com"}, "change":{"assignTo":{"from":{"username":"ksaxena", "name":"Kapil Saxena", "email":"kapil.saxena@marklogic.com"}, "to":{"username":"rhu", "name":"Ron Hu", "email":"ron.hu@marklogic.com"}}}, "files":[], "show":true}, {"time":"2013-02-18T07:32:12.70251-08:00", "updatedBy":{"username":"ksaxena", "name":"Kapil Saxena", "email":"kapil.saxena@marklogic.com"}, "change":{}, "files":[], "show":true, "comment":"This started today and was working fine till yesterday."}, {"time":"2013-02-18T08:35:54.481445-08:00", "updatedBy":{"username":"cjl", "name":"Christopher Lindblad", "email":"cjl@cerisent.com"}, "change":{}, "files":[], "show":true, "comment":"The alarm usually means that when it got the abort signal it just happened to be inside malloc, \r\nso when it was trying to fork and run pstack it hung waiting for the malloc mutex.\r\nSo there is nothing necessarily \"alarming\" about the alarm."}, {"time":"2013-02-18T09:05:23.396121-08:00", "updatedBy":{"username":"wfeick", "name":"Wayne Feick", "email":"wfeick@marklogic.com"}, "change":{"assignTo":{"from":{"username":"wfeick", "name":"Wayne Feick", "email":"wfeick@marklogic.com"}, "to":{"username":"wfeick", "name":"Wayne Feick", "email":"wfeick@marklogic.com"}}}, "files":[], "show":true}, {"time":"2013-02-18T09:07:52.507014-08:00", "updatedBy":{"username":"wfeick", "name":"Wayne Feick", "email":"wfeick@marklogic.com"}, "change":{}, "files":[], "show":true, "comment":"Stuck in pthread_create() again. Some googling brings up the following bug and suggests that a kernel upgrade may avoid the issue. I'll give that a try.\r\n\r\nhttps://bugzilla.redhat.com/show_bug.cgi?id=750419"}, {"time":"2013-02-19T11:39:37.767941-08:00", "updatedBy":{"username":"wfeick", "name":"Wayne Feick", "email":"wfeick@marklogic.com"}, "change":{}, "files":[], "show":true, "comment":"Moving back to Kapil since we believe the kernel upgrade will address this."}, {"time":"2013-02-19T11:39:37.767941-08:00", "updatedBy":{"username":"wfeick", "name":"Wayne Feick", "email":"wfeick@marklogic.com"}, "change":{"assignTo":{"from":{"username":"wfeick", "name":"Wayne Feick", "email":"wfeick@marklogic.com"}, "to":{"username":"ksaxena", "name":"Kapil Saxena", "email":"kapil.saxena@marklogic.com"}}}, "files":[], "show":true}, {"time":"2013-02-20T23:27:24.919502-08:00", "updatedBy":{"username":"ksaxena", "name":"Kapil Saxena", "email":"kapil.saxena@marklogic.com"}, "change":{"status":{"from":"", "to":"Closed"}, "assignTo":{"from":{"username":"ksaxena", "name":"Kapil Saxena", "email":"kapil.saxena@marklogic.com"}, "to":{"username":"nobody", "name":"nobody nobody", "email":"nobody@marklogic.com"}}}, "files":[], "show":true, "comment":"No longer seeing abort in this test. However, there are other aborts and separate bugs exist for them.\r\n\r\nHence, closing this."}, {"time":"2013-02-20T23:27:24.919502-08:00", "updatedBy":{"username":"ksaxena", "name":"Kapil Saxena", "email":"kapil.saxena@marklogic.com"}, "change":{"assignTo":{"from":{"username":"ksaxena", "name":"Kapil Saxena", "email":"kapil.saxena@marklogic.com"}, "to":{"username":"nobody", "name":"nobody nobody", "email":"nobody@marklogic.com"}}}, "files":[], "show":true}], "updatedAt":"2013-02-20T23:27:24.919502-08:00", "closedAt":"2013-02-20T23:27:24.919502-08:00", "closedBy":{"username":"ksaxena", "name":"Kapil Saxena", "email":"kapil.saxena@marklogic.com"}, "renderDescriptionAs":"normal"}
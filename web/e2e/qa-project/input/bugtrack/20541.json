{"id":20541, "kind":"Bug", "createdAt":"2012-03-01T10:54:46.504897-08:00", "status":"Closed", "title":"Documentation for:  admin UI upgrade code needs to handle upgrading on clusters running a replica security database", "category":"documentation", "severity":"Major", "priority":{"level":"5", "title":""}, "submittedBy":{"username":"wfeick", "name":"Wayne Feick", "email":"wfeick@marklogic.com"}, "assignTo":{"username":"nobody", "name":"nobody nobody", "email":"nobody@marklogic.com"}, "description":"See bug 16381.\r\n\r\nOff the top of my head:\r\n\r\n1. upgrade the master cluster.\r\n2. make sure the replica has received the new security database state.\r\n3. the Admin UI upgrade code will need to detect that it's running on a replica security database, either offer to upgrade or do it automatically, and not attempt to write to the security database if the version is already correct.", "samplequery":"", "sampledata":"", "version":"5.0-1", "tofixin":"5.0-5", "fixedin":"N/A", "platform":"all", "memory":"", "processors":"", "note":"", "subscribers":[{"username":"wfeick", "name":"Wayne Feick", "email":"wfeick@marklogic.com"}, {"username":"bmo", "name":"Brian Mo", "email":"brian.mo@marklogic.com"}, {"username":"gvaidees", "name":"Ganesh Vaideeswaran", "email":"Ganesh.Vaideeswaran@marklogic.com"}, {"username":"dsokolsky", "name":"Danny Sokolsky", "email":"dsokolsky@marklogic.com"}], "attachments":[{"name":"Adding a new Upgrade button on Support Page (1st cut)", "uri":"root/support/bugtracking/attachments/16382/bug 16382 - first cut.JPG"}, {"name":"2nd cut - when it is NOT a replica", "uri":"root/support/bugtracking/attachments/16382/bug 16382 - 2nd cut when it is NOT replica.JPG"}, {"name":"2nd cut - when it is a replica", "uri":"root/support/bugtracking/attachments/16382/bug 16382 - 2nd cut when it is replica.JPG"}], "relationships":[{"type":"", "to":""}], "clones":[], "cloneOf":16382, "support":{"headline":"", "supportDescription":"", "publishStatus":"Not Ready", "tickets":[], "customerImpact":{"level":"N/A", "title":""}, "workaround":""}, "tags":["documentation", "wfeick"], "changeHistory":[{"time":"2012-03-01T10:54:46.504897-08:00", "updatedBy":{"username":"wfeick", "name":"Wayne Feick", "email":"wfeick@marklogic.com"}, "change":{"assignTo":{"from":{"username":"wfeick", "name":"Wayne Feick", "email":"wfeick@marklogic.com"}, "to":{"username":"gvaidees", "name":"Ganesh Vaideeswaran", "email":"Ganesh.Vaideeswaran@marklogic.com"}}}, "files":[], "show":true}, {"time":"2012-12-08T23:36:03.475424-08:00", "updatedBy":{"username":"gvaidees", "name":"Ganesh Vaideeswaran", "email":"Ganesh.Vaideeswaran@marklogic.com"}, "change":{"assignTo":{"from":{"username":"gvaidees", "name":"Ganesh Vaideeswaran", "email":"Ganesh.Vaideeswaran@marklogic.com"}, "to":{"username":"bmo", "name":"Brian Mo", "email":"brian.mo@marklogic.com"}}}, "files":[], "show":true}, {"time":"2012-12-17T12:36:33.774224-08:00", "updatedBy":{"username":"gvaidees", "name":"Ganesh Vaideeswaran", "email":"Ganesh.Vaideeswaran@marklogic.com"}, "change":{}, "files":[], "show":true, "comment":"Ganesh: I will talk to Wayne and see what we need to do here"}, {"time":"2012-12-17T12:36:33.774224-08:00", "updatedBy":{"username":"gvaidees", "name":"Ganesh Vaideeswaran", "email":"Ganesh.Vaideeswaran@marklogic.com"}, "change":{"assignTo":{"from":{"username":"gvaidees", "name":"Ganesh Vaideeswaran", "email":"Ganesh.Vaideeswaran@marklogic.com"}, "to":{"username":"gvaidees", "name":"Ganesh Vaideeswaran", "email":"Ganesh.Vaideeswaran@marklogic.com"}}}, "files":[], "show":true}, {"time":"2012-12-17T15:54:03.942669-08:00", "updatedBy":{"username":"wfeick", "name":"Wayne Feick", "email":"wfeick@marklogic.com"}, "change":{}, "files":[], "show":true, "comment":"An upgrade involves two sets of actions. One is to make changes to the security database, and the other is to make changes to the config files. We use the security-version in the security database to determine whether we need to run the upgrade logic.\r\n\r\nWhen the security database is being replicated, the replica cluster can't run the security database portion of the upgrade because the replica database is read only. This is why we run the upgrade on the master cluster first, and this caused both the master's security database and also its config files to be upgraded.\r\n\r\nThe updated security database is then replicated to the replica cluster.\r\n\r\nAt this point, the replica cluster still needs to (potentially) have its config files upgraded but doesn't realize it because it sees the newer security version in the replica security database.\r\n\r\nIn development, we just access http://localhost:8001/security-upgrade-go.xqy?force=true to force the upgrade logic to run.\r\n\r\nFor customers, we need a more elegant way to run the config upgrade part of the process. One possibility is to just offer the user a button somewhere to \"force upgrade process\" that they could be instructed to use on their replica cluster after upgrading the master."}, {"time":"2012-12-26T23:06:39.799198-08:00", "updatedBy":{"username":"gvaidees", "name":"Ganesh Vaideeswaran", "email":"Ganesh.Vaideeswaran@marklogic.com"}, "change":{}, "files":[], "show":true, "comment":"Brian,\r\n\r\nCan you please look into this defect for 5.0-5. We are targetting to get all 5.0-5 defects checked in by January 23rd. Thanks. "}, {"time":"2012-12-26T23:06:39.799198-08:00", "updatedBy":{"username":"gvaidees", "name":"Ganesh Vaideeswaran", "email":"Ganesh.Vaideeswaran@marklogic.com"}, "change":{"assignTo":{"from":{"username":"gvaidees", "name":"Ganesh Vaideeswaran", "email":"Ganesh.Vaideeswaran@marklogic.com"}, "to":{"username":"bmo", "name":"Brian Mo", "email":"brian.mo@marklogic.com"}}}, "files":[], "show":true}, {"time":"2013-01-16T10:22:57.810504-08:00", "updatedBy":{"username":"bmo", "name":"Brian Mo", "email":"brian.mo@marklogic.com"}, "change":{"status":{"from":"", "to":"Fix"}, "assignTo":{"from":{"username":"bmo", "name":"Brian Mo", "email":"brian.mo@marklogic.com"}, "to":{"username":"bmo", "name":"Brian Mo", "email":"brian.mo@marklogic.com"}}}, "files":[], "show":true, "comment":"Investigating..."}, {"time":"2013-01-17T17:45:05.326329-08:00", "updatedBy":{"username":"bmo", "name":"Brian Mo", "email":"brian.mo@marklogic.com"}, "change":{}, "files":[], "show":true, "comment":"Hi Wayne, please take a look of the attached screenshot  and confirm if this serve the need.\r\n  \r\nThe button is linked to  security-upgrade-go.xqy?force=true (relative link); upon clicking the button, there will be no confirmation pop-up and the upgrade process will start, and upon finishing the upgrade, the page will be redirected to the Admin home page.\r\n\r\nIMO, it is safer to add a confirm popup but it seems that is not being used in other admin pages as far as I know.\r\n"}, {"time":"2013-01-17T17:45:05.326329-08:00", "updatedBy":{"username":"bmo", "name":"Brian Mo", "email":"brian.mo@marklogic.com"}, "change":{"assignTo":{"from":{"username":"bmo", "name":"Brian Mo", "email":"brian.mo@marklogic.com"}, "to":{"username":"wfeick", "name":"Wayne Feick", "email":"wfeick@marklogic.com"}}}, "files":[], "show":true}, {"time":"2013-01-17T17:46:02.987229-08:00", "updatedBy":{"username":"bmo", "name":"Brian Mo", "email":"brian.mo@marklogic.com"}, "change":{}, "files":[], "show":true, "comment":"Hi Wayne, would you suggest better wording/description too.  Thanks!"}, {"time":"2013-01-17T18:29:47.019594-08:00", "updatedBy":{"username":"wfeick", "name":"Wayne Feick", "email":"wfeick@marklogic.com"}, "change":{}, "files":[], "show":true, "comment":"Is this always available, or only when the security database is a replica?\r\n\r\nIt might be good to have a little bit of verbiage there to explain why someone might press that button."}, {"time":"2013-01-18T15:54:52.357979-08:00", "updatedBy":{"username":"wfeick", "name":"Wayne Feick", "email":"wfeick@marklogic.com"}, "change":{}, "files":[], "show":true, "comment":"The button should be \"Upgrade\", not \"Update\".\r\n\r\nI would like the following text displayed next to the button.\r\n\r\n\"Upgrade logic normally runs automatically when the server software is upgraded, such that there is no need to run this logic manually.\"\r\n\r\nIf the security database is a replica database, I would like the following additional text.\r\n\r\n\"Because your security database is a replica of a foreign database, its security database has already been upgrade. It may, however, be necessary to manually run the upgrade logic once to make adjustments to configuration files. If you are unsure whether you need to run the upgrade logic, please contact support.\""}, {"time":"2013-01-18T15:54:52.357979-08:00", "updatedBy":{"username":"wfeick", "name":"Wayne Feick", "email":"wfeick@marklogic.com"}, "change":{"assignTo":{"from":{"username":"wfeick", "name":"Wayne Feick", "email":"wfeick@marklogic.com"}, "to":{"username":"bmo", "name":"Brian Mo", "email":"brian.mo@marklogic.com"}}}, "files":[], "show":true}, {"time":"2013-01-18T17:10:08.810316-08:00", "updatedBy":{"username":"bmo", "name":"Brian Mo", "email":"brian.mo@marklogic.com"}, "change":{}, "files":[], "show":true, "comment":"Hi Wayne,\r\n\r\nAttached please check two new 2nd-cut screenshots:\r\n- when the security database *not* a replica\r\n- when the security database *is* a replica\r\n\r\nI didn't follow your exact suggestion because it seems too crowded to me; instead, if I follow kinda other pages and come up this slightly modified presentation.  Let me it is clear enough for you.\r\n\r\n\r\n"}, {"time":"2013-01-18T17:11:52.240727-08:00", "updatedBy":{"username":"bmo", "name":"Brian Mo", "email":"brian.mo@marklogic.com"}, "change":{"assignTo":{"from":{"username":"bmo", "name":"Brian Mo", "email":"brian.mo@marklogic.com"}, "to":{"username":"wfeick", "name":"Wayne Feick", "email":"wfeick@marklogic.com"}}}, "files":[], "show":true}, {"time":"2013-01-21T13:22:00.592885-08:00", "updatedBy":{"username":"wfeick", "name":"Wayne Feick", "email":"wfeick@marklogic.com"}, "change":{"assignTo":{"from":{"username":"wfeick", "name":"Wayne Feick", "email":"wfeick@marklogic.com"}, "to":{"username":"dsokolsky", "name":"Danny Sokolsky", "email":"dsokolsky@marklogic.com"}}}, "files":[], "show":true}, {"time":"2013-01-21T13:36:28.259638-08:00", "updatedBy":{"username":"dsokolsky", "name":"Danny Sokolsky", "email":"dsokolsky@marklogic.com"}, "change":{}, "files":[], "show":true, "comment":"Brian, can you check in the code so I can see the real wording for this.  Or come find me and we can wordsmith it together.\r\n\r\nRemove the sentence about calling support, as it is not needed."}, {"time":"2013-01-21T13:36:28.259638-08:00", "updatedBy":{"username":"dsokolsky", "name":"Danny Sokolsky", "email":"dsokolsky@marklogic.com"}, "change":{"assignTo":{"from":{"username":"dsokolsky", "name":"Danny Sokolsky", "email":"dsokolsky@marklogic.com"}, "to":{"username":"bmo", "name":"Brian Mo", "email":"brian.mo@marklogic.com"}}}, "files":[], "show":true}, {"time":"2013-01-21T13:46:48.880546-08:00", "updatedBy":{"username":"bmo", "name":"Brian Mo", "email":"brian.mo@marklogic.com"}, "change":{}, "files":[], "show":true, "svn":{"repository":"/project/engsvn", "revision":"128605", "paths":["xdmp/branches/b5_0/src/Admin/lib/support-request-form.xqy"], "affectedBugs":[]}, "comment":"Bug:16382 - add UI button to force run upgrade logic"}, {"time":"2013-01-21T13:52:07.26923-08:00", "updatedBy":{"username":"bmo", "name":"Brian Mo", "email":"brian.mo@marklogic.com"}, "change":{}, "files":[], "show":true, "svn":{"repository":"/project/engsvn", "revision":"128606", "paths":["xdmp/branches/b5_0/src/Admin/lib/support-request-form.xqy"], "affectedBugs":[]}, "comment":"Bug:16382 - removed the sentence about calling support"}, {"time":"2013-01-21T13:53:27.429525-08:00", "updatedBy":{"username":"bmo", "name":"Brian Mo", "email":"brian.mo@marklogic.com"}, "change":{}, "files":[], "show":true, "comment":"Danny, I will look for you... "}, {"time":"2013-01-21T14:10:23.399524-08:00", "updatedBy":{"username":"dsokolsky", "name":"Danny Sokolsky", "email":"dsokolsky@marklogic.com"}, "change":{}, "files":[], "show":true, "svn":{"repository":"/project/engsvn", "revision":"128609", "paths":["xdmp/branches/b5_0/src/Admin/lib/support-request-form.xqy"], "affectedBugs":[]}, "comment":"bug:16382 -- tweaked the language for replica upgrade stuff"}, {"time":"2013-01-21T14:11:33.358474-08:00", "updatedBy":{"username":"dsokolsky", "name":"Danny Sokolsky", "email":"dsokolsky@marklogic.com"}, "change":{}, "files":[], "show":true, "comment":"Brian, I made a few tweaks to the language.  Please check it out and see if it makes sense."}, {"time":"2013-01-21T14:51:15.493422-08:00", "updatedBy":{"username":"dsokolsky", "name":"Danny Sokolsky", "email":"dsokolsky@marklogic.com"}, "change":{}, "files":[], "show":true, "comment":"Woops, meant to assign this to brian.  Brian, if you are done with it, please put it in test."}, {"time":"2013-01-21T14:52:03.880052-08:00", "updatedBy":{"username":"bmo", "name":"Brian Mo", "email":"brian.mo@marklogic.com"}, "change":{}, "files":[], "show":true, "comment":"ok.  working on other bugs and will come back to this one soon..."}, {"time":"2013-01-21T14:58:35.402734-08:00", "updatedBy":{"username":"dsokolsky", "name":"Danny Sokolsky", "email":"dsokolsky@marklogic.com"}, "change":{"assignTo":{"from":{"username":"dsokolsky", "name":"Danny Sokolsky", "email":"dsokolsky@marklogic.com"}, "to":{"username":"dsokolsky", "name":"Danny Sokolsky", "email":"dsokolsky@marklogic.com"}}}, "files":[], "show":true}, {"time":"2013-01-21T14:58:35.402734-08:00", "updatedBy":{"username":"dsokolsky", "name":"Danny Sokolsky", "email":"dsokolsky@marklogic.com"}, "change":{"tofixin":{"from":"", "to":"5.0-5"}}, "files":[], "show":true}, {"time":"2013-01-29T12:37:29.903791-08:00", "updatedBy":{"username":"dsokolsky", "name":"Danny Sokolsky", "email":"dsokolsky@marklogic.com"}, "change":{"status":{"from":"", "to":"Closed"}, "assignTo":{"from":{"username":"dsokolsky", "name":"Danny Sokolsky", "email":"dsokolsky@marklogic.com"}, "to":{"username":"nobody", "name":"nobody nobody", "email":"nobody@marklogic.com"}}}, "files":[], "show":true, "comment":"Since we fixed the underlying bug, there is no need for documentation changes, so closing this."}], "updatedAt":"2013-01-29T12:37:29.903791-08:00", "closedAt":"2013-01-29T12:37:29.903791-08:00", "closedBy":{"username":"dsokolsky", "name":"Danny Sokolsky", "email":"dsokolsky@marklogic.com"}, "renderDescriptionAs":"normal"}
{"id":20539, "kind":"Bug", "createdAt":"2013-01-21T11:55:04.76175-08:00", "status":"Closed", "title":"xdmp:get-request-body() consumes the body?", "category":"xdmp", "severity":"Minor", "priority":{"level":"5", "title":""}, "submittedBy":{"username":"nwalsh", "name":"Norman Walsh", "email":"norman.walsh@marklogic.com"}, "assignTo":{"username":"nobody", "name":"nobody nobody", "email":"nobody@marklogic.com"}, "description":"In attempting to write an endpoint that can receive XML, text, or binary body content, it appears that an attempt to read the body content as XML \"consumes\" the content. See the query fragment below.\r\n\r\nIf text content is POSTed to a query that processes the body as shown, the text body content is empty. The xdmp:get-request-body(\"text\") returns a document node but the content of that node is empty.", "samplequery":"let $db := try {\r\n             (\"xml\", xdmp:get-request-body(\"xml\"))\r\n           } catch * {\r\n             ()\r\n           }\r\nlet $db := if (empty($db))\r\n           then\r\n             try {\r\n               (\"text\", xdmp:get-request-body(\"text\"))\r\n             } catch * {\r\n               ()\r\n             }\r\n           else\r\n             $db\r\nlet $db := if (empty($db))\r\n           then\r\n             try {\r\n               (\"binary\", xdmp:get-request-body(\"binary\"))\r\n             } catch * {\r\n               ()\r\n             }\r\n           else\r\n             $db\r\nreturn\r\n  $db", "sampledata":"", "version":"7.0-nightly", "tofixin":"7.0-ea1", "fixedin":"N/A", "platform":"all", "memory":"", "processors":"", "note":"", "subscribers":[{"username":"nwalsh", "name":"Norman Walsh", "email":"norman.walsh@marklogic.com"}], "attachments":[], "relationships":[{"type":"", "to":""}], "clones":[], "cloneOf":"", "support":{"headline":"", "supportDescription":"", "publishStatus":"Not Ready", "tickets":[], "customerImpact":{"level":"N/A", "title":""}, "workaround":""}, "tags":["xdmp", "nwalsh"], "changeHistory":[{"time":"2013-01-21T17:12:17.408728-08:00", "updatedBy":{"username":"cjl", "name":"Christopher Lindblad", "email":"cjl@cerisent.com"}, "change":{}, "files":[], "show":true, "comment":"Yes.\r\nIt consumes the body.\r\nThere is no buffering of the body, as it can be arbitrarily large.\r\nThis is as designed.\r\n"}, {"time":"2013-01-23T11:41:46.955884-08:00", "updatedBy":{"username":"gvaidees", "name":"Ganesh Vaideeswaran", "email":"Ganesh.Vaideeswaran@marklogic.com"}, "change":{}, "files":[], "show":true, "comment":"Chris,\r\n\r\nCan this be closed?"}, {"time":"2013-01-23T11:41:46.955884-08:00", "updatedBy":{"username":"gvaidees", "name":"Ganesh Vaideeswaran", "email":"Ganesh.Vaideeswaran@marklogic.com"}, "change":{"status":{"from":"", "to":"Verify"}, "assignTo":{"from":{"username":"gvaidees", "name":"Ganesh Vaideeswaran", "email":"Ganesh.Vaideeswaran@marklogic.com"}, "to":{"username":"gvaidees", "name":"Ganesh Vaideeswaran", "email":"Ganesh.Vaideeswaran@marklogic.com"}}}, "files":[], "show":true}, {"time":"2013-01-23T11:41:46.955884-08:00", "updatedBy":{"username":"gvaidees", "name":"Ganesh Vaideeswaran", "email":"Ganesh.Vaideeswaran@marklogic.com"}, "change":{"assignTo":{"from":{"username":"gvaidees", "name":"Ganesh Vaideeswaran", "email":"Ganesh.Vaideeswaran@marklogic.com"}, "to":{"username":"gvaidees", "name":"Ganesh Vaideeswaran", "email":"Ganesh.Vaideeswaran@marklogic.com"}}}, "files":[], "show":true}, {"time":"2013-01-23T13:05:31.968484-08:00", "updatedBy":{"username":"nwalsh", "name":"Norman Walsh", "email":"norman.walsh@marklogic.com"}, "change":{"status":{"from":"", "to":"Closed"}, "assignTo":{"from":{"username":"nwalsh", "name":"Norman Walsh", "email":"norman.walsh@marklogic.com"}, "to":{"username":"nobody", "name":"nobody nobody", "email":"nobody@marklogic.com"}}}, "files":[], "show":true, "comment":"Not a bug."}], "updatedAt":"2013-01-23T13:05:31.968484-08:00", "closedAt":"2013-01-23T13:05:31.968484-08:00", "closedBy":{"username":"nwalsh", "name":"Norman Walsh", "email":"norman.walsh@marklogic.com"}, "renderDescriptionAs":"normal", "renderSampleQueryAs":"normal"}
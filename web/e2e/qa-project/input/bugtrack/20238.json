{"id":20238, "kind":"Bug", "createdAt":"2012-12-10T11:04:56.666418-08:00", "status":"Closed", "title":"degradation in XSLTS performance starting 1201 nightly", "category":"XSLT", "severity":"Performance", "priority":{"level":"5", "title":""}, "submittedBy":{"username":"sverma", "name":"Shiva Verma", "email":"shiva.verma@marklogic.com"}, "assignTo":{"username":"nobody", "name":"nobody nobody", "email":"nobody@marklogic.com"}, "description":"We are observing a significant degradation in XSLTS performance starting 1201 nightly. performance was good untill 1130 nightly. \r\n\r\nThe XSLTS performance test is reporting almost 50-55% degradation.\r\n\r\nSTEPS TO REPRODUCE:\r\nThere is an automated XSLTS test script that execute XSLTS performance test.\r\n1. checkout qa b6_0 branch \r\n2. cd <QA_HOME>/performance/scripts/xslt/\r\n3. ./run-XSLTS.sh 602\r\n\r\nThis will run the test and will compare the results with that of 6.0-2 release baseline. check the delta file in QA_HOME>/scripts/results/xsltsDiff-<nightly-version>.xml\r\n\r\n", "samplequery":"", "sampledata":"", "version":"5.0-nightly", "tofixin":"5.0-5", "fixedin":"N/A", "platform":"all", "memory":"", "processors":"", "note":"", "subscribers":[{"username":"sverma", "name":"Shiva Verma", "email":"shiva.verma@marklogic.com"}, {"username":"jsnelson", "name":"John Snelson", "email":"jsnelson@marklogic.com"}, {"username":"mary", "name":"Mary Holstege", "email":"mary@cerisent.com"}, {"username":"rhu", "name":"Ron Hu", "email":"ron.hu@marklogic.com"}, {"username":"rpolasani", "name":"Raghu Polasani", "email":"raghu.polasani@marklogic.com"}, {"username":"msrinivasan", "name":"Mahalakshmi Srinivasan", "email":"mahalakshmi.srinivasan@marklogic.com"}], "attachments":[], "relationships":[{"type":"", "to":""}], "clones":[], "cloneOf":20237, "support":{"headline":"", "supportDescription":"", "publishStatus":"Not Ready", "tickets":[], "customerImpact":{"level":"N/A", "title":""}, "workaround":""}, "tags":["XSLT", "sverma"], "changeHistory":[{"time":"2012-12-14T21:01:43.711934-08:00", "updatedBy":{"username":"gvaidees", "name":"Ganesh Vaideeswaran", "email":"Ganesh.Vaideeswaran@marklogic.com"}, "change":{"status":{"from":"", "to":"Verify"}, "assignTo":{"from":{"username":"gvaidees", "name":"Ganesh Vaideeswaran", "email":"Ganesh.Vaideeswaran@marklogic.com"}, "to":{"username":"rhu", "name":"Ron Hu", "email":"ron.hu@marklogic.com"}}}, "files":[], "show":true}, {"time":"2012-12-14T21:01:43.711934-08:00", "updatedBy":{"username":"gvaidees", "name":"Ganesh Vaideeswaran", "email":"Ganesh.Vaideeswaran@marklogic.com"}, "change":{"assignTo":{"from":{"username":"gvaidees", "name":"Ganesh Vaideeswaran", "email":"Ganesh.Vaideeswaran@marklogic.com"}, "to":{"username":"rhu", "name":"Ron Hu", "email":"ron.hu@marklogic.com"}}}, "files":[], "show":true}, {"time":"2012-12-14T21:01:43.711934-08:00", "updatedBy":{"username":"gvaidees", "name":"Ganesh Vaideeswaran", "email":"Ganesh.Vaideeswaran@marklogic.com"}, "change":{"tofixin":{"from":"", "to":"5.0-5"}}, "files":[], "show":true}, {"time":"2012-12-17T12:23:59.911051-08:00", "updatedBy":{"username":"rhu", "name":"Ron Hu", "email":"ron.hu@marklogic.com"}, "change":{"assignTo":{"from":{"username":"rhu", "name":"Ron Hu", "email":"ron.hu@marklogic.com"}, "to":{"username":"mary", "name":"Mary Holstege", "email":"mary@cerisent.com"}}}, "files":[], "show":true}, {"time":"2012-12-21T14:47:38.20312-08:00", "updatedBy":{"username":"rhu", "name":"Ron Hu", "email":"ron.hu@marklogic.com"}, "change":{}, "files":[], "show":true, "comment":"Mary's comments:\r\nHey, did anyone check in something in the 5.0 and 6.0 branches around 11/30 that might have made XSLT run way slower? Something in the evaluator (XQuery or XPath), or in update or type handling?  Or, for that matter, reading files from the file system? Or the parser? Anything?\r\n\r\nI looked through the diffs and nothing jumped out.\r\n"}, {"time":"2012-12-21T14:51:55.674392-08:00", "updatedBy":{"username":"rpolasani", "name":"Raghu Polasani", "email":"raghu.polasani@marklogic.com"}, "change":{}, "files":[], "show":true, "comment":"Here are the results from 12/19 performance regression test:\r\n\r\nXSLTS: 61 % degradation\r\nThe total time taken to run the test on 5.0-20121219 is 76.758 sec whereas on 5.0.4 it was  47.486 sec \r\n\r\nLooks like we are consistently seeing this degradation in 5.0 nightly performance tests."}, {"time":"2012-12-21T14:54:31.477815-08:00", "updatedBy":{"username":"rhu", "name":"Ron Hu", "email":"ron.hu@marklogic.com"}, "change":{}, "files":[], "show":true, "comment":"Hi Mary,\r\nPlease work with Maha to find out the root cause of this issue.  Thanks."}, {"time":"2012-12-21T17:14:39.860398-08:00", "updatedBy":{"username":"mary", "name":"Mary Holstege", "email":"mary@cerisent.com"}, "change":{}, "files":[], "show":true, "comment":"John now owns XSLT"}, {"time":"2012-12-21T17:14:39.860398-08:00", "updatedBy":{"username":"mary", "name":"Mary Holstege", "email":"mary@cerisent.com"}, "change":{"assignTo":{"from":{"username":"mary", "name":"Mary Holstege", "email":"mary@cerisent.com"}, "to":{"username":"jsnelson", "name":"John Snelson", "email":"jsnelson@marklogic.com"}}}, "files":[], "show":true}, {"time":"2013-01-18T06:49:08.194396-08:00", "updatedBy":{"username":"jsnelson", "name":"John Snelson", "email":"jsnelson@marklogic.com"}, "change":{}, "files":[], "show":true, "comment":"I used checkouts of b5_0 from Nov 25 and Dec 14 to try to reproduce this performance degradation using a wide time range around the date that this regression was seen. I have been unable to find a regression in performance in either the xslt-perf or xslts performance tests.\r\n\r\nI've reviewed the commits to b5_0 in the same time frame, and can't find anything that would account for performance changes to XSLT.\r\n\r\nAre we still seeing a performance regression? If so, I would suspect it was due to a change in the hardware, resources, or operating system on the performance machine. Can we re-run the baseline for this test on the performance machine to verify that it can still be reproduced?"}, {"time":"2013-01-18T06:49:08.194396-08:00", "updatedBy":{"username":"jsnelson", "name":"John Snelson", "email":"jsnelson@marklogic.com"}, "change":{"assignTo":{"from":{"username":"jsnelson", "name":"John Snelson", "email":"jsnelson@marklogic.com"}, "to":{"username":"sverma", "name":"Shiva Verma", "email":"shiva.verma@marklogic.com"}}}, "files":[], "show":true}, {"time":"2013-01-21T12:20:24.522312-08:00", "updatedBy":{"username":"rhu", "name":"Ron Hu", "email":"ron.hu@marklogic.com"}, "change":{"status":{"from":"", "to":"Test"}, "assignTo":{"from":{"username":"rhu", "name":"Ron Hu", "email":"ron.hu@marklogic.com"}, "to":{"username":"sverma", "name":"Shiva Verma", "email":"shiva.verma@marklogic.com"}}}, "files":[], "show":true}, {"time":"2013-01-25T13:02:11.069338-08:00", "updatedBy":{"username":"sverma", "name":"Shiva Verma", "email":"shiva.verma@marklogic.com"}, "change":{}, "files":[], "show":true, "comment":"I tried XSLTS performance test on a different machine (my test linux-64 machine) and still getting degradation in 5.0 nightly. \r\n\r\nData: \r\n\r\nbuild: total-time-taken\r\n5.0-nightly(1205 and 1225): 202.443\r\n5.0-4: 84.196\r\n5.0-nightly(1125): 86.577\r\n\r\n\r\nThis data shows that the results are coming good not only on 5.0-4 release, but also on 5.0 1125 nightly builds. \r\n\r\nThe way we execute the tests:\r\n1. install build\r\n2. cd <QA_HOME>/performance/scripts/xslts\r\n3. ./run-XSLTS.sh 504 \r\n4. in <QA_HOME>/scripts/results, check for total-actual-time-in-secs in xsltsDiff-<version>.xml\r\n"}, {"time":"2013-01-25T13:02:11.069338-08:00", "updatedBy":{"username":"sverma", "name":"Shiva Verma", "email":"shiva.verma@marklogic.com"}, "change":{"assignTo":{"from":{"username":"sverma", "name":"Shiva Verma", "email":"shiva.verma@marklogic.com"}, "to":{"username":"jsnelson", "name":"John Snelson", "email":"jsnelson@marklogic.com"}}}, "files":[], "show":true}, {"time":"2013-01-31T12:27:24.43699-08:00", "updatedBy":{"username":"dsokolsky", "name":"Danny Sokolsky", "email":"dsokolsky@marklogic.com"}, "change":{"status":{"from":"", "to":"Verify"}, "assignTo":{"from":{"username":"dsokolsky", "name":"Danny Sokolsky", "email":"dsokolsky@marklogic.com"}, "to":{"username":"jsnelson", "name":"John Snelson", "email":"jsnelson@marklogic.com"}}}, "files":[], "show":true, "comment":"Looks to me like this bug should not be in test."}, {"time":"2013-02-04T03:28:15.999436-08:00", "updatedBy":{"username":"jsnelson", "name":"John Snelson", "email":"jsnelson@marklogic.com"}, "change":{}, "files":[], "show":true, "comment":"On Fri, 01 Feb 2013 02:43:33 -0800, John Snelson <john.snelson@marklogic.com> wrote:\r\n\r\n> All,\r\n>\r\n> This bug is time consuming, and I'm feeling under pressure with EA1, the semantics functional spec needed, and XML Prague trip coming soon. I'm afraid I've not managed to reproduce the slow down - although that might be because I was using debug builds.\r\n>\r\n> Chris sent a few emails about this slow down about a week ago, and mentioned that he thought it was due to necessary bug fixes. He was proposing performance optimizations in casting as a way to mitigate the slow down due to bugs fixed. Chris - did you manage to achieve the speed up you wanted?\r\n>\r\n> I'd also mention that the value of using the W3C XSLT test suite as a performance benchmark is minimal. It likely focuses a lot on a breadth of small operations, rather than the operations that actually constitute the majority of the time taken in a real transformation. I think it's telling that the other XSLT benchmarks do not show performance degredation.\r\n>\r\n\r\nI think this last point is the significant one.  XSLTS as a sniff test performance\r\ntest is good, in point of fact, it is probably exercising the XQuery code almost\r\nas much as the XSLT code. And probably the XSD code as well. So I would\r\nnot take it as a sign of slow down in XSLT per se.\r\n\r\nI think it is worth asking QA whether anything has changed in the test setup\r\nas well. e.g. in the driver itself, or, since the testsuite hits the filesystem a lot, in\r\nwhere they are getting their data from.\r\n\r\n//Mary "}, {"time":"2013-02-04T03:29:24.687851-08:00", "updatedBy":{"username":"jsnelson", "name":"John Snelson", "email":"jsnelson@marklogic.com"}, "change":{}, "files":[], "show":true, "comment":"On 01/02/13 18:24, Christopher Lindblad wrote:\r\nI got the performance speedup I wanted through in-lining some common base class constructors and through eliminating some frequent atomic operations.\r\nMy intuition is that the XSLTS test slowdown is a testing artifact."}, {"time":"2013-02-05T18:12:07.204446-08:00", "updatedBy":{"username":"rhu", "name":"Ron Hu", "email":"ron.hu@marklogic.com"}, "change":{}, "files":[], "show":true, "comment":"Raghu,\r\nWith the above comments, we can only guess what happened.  Mary asked this:\r\nI think it is worth asking QA whether anything has changed in the test setup\r\nas well. e.g. in the driver itself, or, since the testsuite hits the filesystem a lot, in\r\nwhere they are getting their data from.  "}, {"time":"2013-02-05T18:12:07.204446-08:00", "updatedBy":{"username":"rhu", "name":"Ron Hu", "email":"ron.hu@marklogic.com"}, "change":{"assignTo":{"from":{"username":"rhu", "name":"Ron Hu", "email":"ron.hu@marklogic.com"}, "to":{"username":"rpolasani", "name":"Raghu Polasani", "email":"raghu.polasani@marklogic.com"}}}, "files":[], "show":true}, {"time":"2013-02-06T10:33:09.506789-08:00", "updatedBy":{"username":"rpolasani", "name":"Raghu Polasani", "email":"raghu.polasani@marklogic.com"}, "change":{}, "files":[], "show":true, "comment":"Maha is looking into this issue."}, {"time":"2013-02-06T10:33:09.506789-08:00", "updatedBy":{"username":"rpolasani", "name":"Raghu Polasani", "email":"raghu.polasani@marklogic.com"}, "change":{"assignTo":{"from":{"username":"rpolasani", "name":"Raghu Polasani", "email":"raghu.polasani@marklogic.com"}, "to":{"username":"msrinivasan", "name":"Mahalakshmi Srinivasan", "email":"mahalakshmi.srinivasan@marklogic.com"}}}, "files":[], "show":true}, {"time":"2013-02-06T12:38:34.043766-08:00", "updatedBy":{"username":"msrinivasan", "name":"Mahalakshmi Srinivasan", "email":"mahalakshmi.srinivasan@marklogic.com"}, "change":{}, "files":[], "show":true, "comment":"I just ran this test on 5.0-3.3, 5.0-4.3 and found the numbers to be very close to the ones that we have saved as baseline. However, running the test on 5.0-20130205 shows a 60% degradation. I ran this test on all these builds on the same machine. Per Mary's advice, I also checked if testdriver-lib.xqy has changed and found no changes to the file in the past 1 year."}, {"time":"2013-02-06T13:21:59.130871-08:00", "updatedBy":{"username":"msrinivasan", "name":"Mahalakshmi Srinivasan", "email":"mahalakshmi.srinivasan@marklogic.com"}, "change":{}, "files":[], "show":true, "comment":"I also ran the test on 5.0-20121130 and 5.0-20121201, clearly there seems to be a degradation on the 12/01 build and not on the 11/30 build. I also checked the svn log on all the xquery modules under xslts_1_1_0/app/lib and there is no change there. The testing environment or the setup has not changed in this time. Please let me know if there is anything I can try out."}, {"time":"2013-02-06T16:09:40.349542-08:00", "updatedBy":{"username":"msrinivasan", "name":"Mahalakshmi Srinivasan", "email":"mahalakshmi.srinivasan@marklogic.com"}, "change":{"status":{"from":"", "to":"Closed"}, "assignTo":{"from":{"username":"msrinivasan", "name":"Mahalakshmi Srinivasan", "email":"mahalakshmi.srinivasan@marklogic.com"}, "to":{"username":"nobody", "name":"nobody nobody", "email":"nobody@marklogic.com"}}}, "files":[], "show":true, "comment":"Looks like the QA harness has been setting the system-log-level to 'debug' in the initial setup. Hence, the fix for bug 20025 checked in on 11/30/2012 might have started logging more info at the system level and that explains the degradation. \r\n\r\nI ran the XSLTS test with system-log-level set to 'notice' on build 5.0-20130205 and I see that there is no degradation. Hence closing this bug."}], "updatedAt":"2013-02-06T16:09:40.349542-08:00", "fixedAt":"2013-01-21T12:20:24.522312-08:00", "fixedBy":{"username":"rhu", "name":"Ron Hu", "email":"ron.hu@marklogic.com"}, "closedAt":"2013-02-06T16:09:40.349542-08:00", "closedBy":{"username":"msrinivasan", "name":"Mahalakshmi Srinivasan", "email":"mahalakshmi.srinivasan@marklogic.com"}, "renderDescriptionAs":"normal"}
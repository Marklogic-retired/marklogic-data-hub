{"id":20669, "kind":"Bug", "createdAt":"2013-01-31T12:56:36.57129-08:00", "status":"Closed", "title":"Admin API allow path-fields with invalid path expression to be created", "category":"xdmp", "severity":"Major", "priority":{"level":"5", "title":""}, "submittedBy":{"username":"msrinivasan", "name":"Mahalakshmi Srinivasan", "email":"mahalakshmi.srinivasan@marklogic.com"}, "assignTo":{"username":"nobody", "name":"nobody nobody", "email":"nobody@marklogic.com"}, "description":"MarkLogic Version 7.0-20130130\r\n\r\n1. Run the following to create path-field \"./a\" which is an invalid path expression: \r\n\r\nxquery version \"1.0-ml\";\r\nimport module namespace admin = \"http://marklogic.com/xdmp/admin\" at \"/MarkLogic/admin.xqy\";\r\ndeclare namespace db = \"http://marklogic.com/xdmp/database\";                          \r\n  let $config := admin:get-configuration()\r\n  let $dbid := xdmp:database(\"Documents\")\r\n\r\n  let $field-name2 := \"name\"\r\n  let $field-paths := admin:database-field-path(\"./a\", xs:double(1.0))\r\n\r\n  let $fieldspec2 :=  admin:database-path-field($field-name2,$field-paths) \r\n\r\n  let $spec := admin:database-add-field($config, $dbid, $fieldspec2)\r\n  \r\n  return admin:save-configuration($spec)\r\n\r\nRunning this in qconsole returns and empty sequence without throwing an exception and the API to get field-paths:\r\nxquery version \"1.0-ml\";\r\n\r\n\r\nimport module namespace admin = \"http://marklogic.com/xdmp/admin\" at \"/MarkLogic/admin.xqy\";\r\ndeclare namespace db = \"http://marklogic.com/xdmp/database\";\r\n  let $config := admin:get-configuration()\r\n  let $dbid := xdmp:database(\"Documents\")\r\n  let $field-name2 := \"name\"\r\nreturn admin:database-get-field-paths($config,$dbid,$field-name2)\r\n\r\nalso shows the field created as follows:\r\n<field-path xmlns:xsi=\"http://www.w3.org/2001/XMLSchema-instance\" xmlns=\"http://marklogic.com/xdmp/database\">\r\n<path>./a</path>\r\n<weight>1</weight>\r\n</field-path>\r\n\r\nHowever, there is just a 'Warning' message in the Error Logs like:\r\n2013-01-31 13:42:05.249 Warning: XDMP-INDEXPATHSELFAXIS: An indexable path must not begin with a self-axis. -- using /var/opt/MarkLogic/databases_1.xml\r\n\r\nAlthough there is a Warning, I think it's still a bug because we should not even be able to create such a field-path in the first place.", "samplequery":"", "sampledata":"", "version":"7.0-nightly", "tofixin":"7.0-ea1", "fixedin":"7.0-ea1", "platform":"all", "memory":"", "processors":"", "note":"", "subscribers":[{"username":"msrinivasan", "name":"Mahalakshmi Srinivasan", "email":"mahalakshmi.srinivasan@marklogic.com"}, {"username":"gchinchwadkar", "name":"Gajanan Chinchwadkar", "email":"Gajanan.Chinchwadkar@marklogic.com"}], "attachments":[], "relationships":[{"type":"", "to":""}], "clones":[], "cloneOf":"", "support":{"headline":"", "supportDescription":"", "publishStatus":"Not Ready", "tickets":[], "customerImpact":{"level":"N/A", "title":""}, "workaround":""}, "tags":["xdmp", "msrinivasan"], "changeHistory":[{"time":"2013-01-31T12:56:36.57129-08:00", "updatedBy":{"username":"msrinivasan", "name":"Mahalakshmi Srinivasan", "email":"mahalakshmi.srinivasan@marklogic.com"}, "change":{"assignTo":{"from":{"username":"msrinivasan", "name":"Mahalakshmi Srinivasan", "email":"mahalakshmi.srinivasan@marklogic.com"}, "to":{"username":"gchinchwadkar", "name":"Gajanan Chinchwadkar", "email":"Gajanan.Chinchwadkar@marklogic.com"}}}, "files":[], "show":true}, {"time":"2013-02-05T11:55:51.202559-08:00", "updatedBy":{"username":"gchinchwadkar", "name":"Gajanan Chinchwadkar", "email":"Gajanan.Chinchwadkar@marklogic.com"}, "change":{}, "files":[], "show":true, "comment":"Basically this is negative test. We will first get all the functionality resolved and then come to bugs related to negative tests."}, {"time":"2013-02-05T11:55:51.202559-08:00", "updatedBy":{"username":"gchinchwadkar", "name":"Gajanan Chinchwadkar", "email":"Gajanan.Chinchwadkar@marklogic.com"}, "change":{"tofixin":{"from":"7.0-ea1", "to":"7.0-ea2"}}, "files":[], "show":true}, {"time":"2013-02-08T11:33:55.94741-08:00", "updatedBy":{"username":"msrinivasan", "name":"Mahalakshmi Srinivasan", "email":"mahalakshmi.srinivasan@marklogic.com"}, "change":{}, "files":[], "show":true, "comment":"There is one more case to be tested here. If there is a path-field defined with namespace prefix, like '/aaa:f/g', but there is no path namespace defined for the prefix 'aaa', it is not being treated as invalid and there is no exception thrown. The document I used looks like this:\r\n        \r\ndeclare namespace aaa= \"http://aaa.com/\";\r\nxdmp:document-insert(\"/t2.xml\", \r\n                      <aaa:f>\r\n                       <g>\r\n                        <fname>Jill</fname>\r\n                        <mname>Vill</mname>\r\n                        <lname>mill</lname>\r\n                       </g>\r\n                       </aaa:f>\r\n                    )\r\n\r\nRunning cts:field-values(\"nsfield\") with or without namespace decalration returns 'Vill mill' which is not the expected behavior."}, {"time":"2013-02-11T19:57:41.777698-08:00", "updatedBy":{"username":"gchinchwadkar", "name":"Gajanan Chinchwadkar", "email":"Gajanan.Chinchwadkar@marklogic.com"}, "change":{"tofixin":{"from":"7.0-ea2", "to":"7.0-ea1"}}, "files":[], "show":true}, {"time":"2013-02-11T20:11:53.7617-08:00", "updatedBy":{"username":"gchinchwadkar", "name":"Gajanan Chinchwadkar", "email":"Gajanan.Chinchwadkar@marklogic.com"}, "change":{}, "files":[], "show":true, "svn":{"repository":"/project/engsvn", "revision":"131336", "paths":["xdmp/trunk/src/Modules/MarkLogic/admin.xqy"], "affectedBugs":[]}, "comment":"Fix for bug:20669.\n"}, {"time":"2013-02-11T20:14:35.091691-08:00", "updatedBy":{"username":"gchinchwadkar", "name":"Gajanan Chinchwadkar", "email":"Gajanan.Chinchwadkar@marklogic.com"}, "change":{"status":{"from":"", "to":"Test"}, "assignTo":{"from":{"username":"gchinchwadkar", "name":"Gajanan Chinchwadkar", "email":"Gajanan.Chinchwadkar@marklogic.com"}, "to":{"username":"msrinivasan", "name":"Mahalakshmi Srinivasan", "email":"mahalakshmi.srinivasan@marklogic.com"}}}, "files":[], "show":true}, {"time":"2013-02-11T20:14:35.091691-08:00", "updatedBy":{"username":"gchinchwadkar", "name":"Gajanan Chinchwadkar", "email":"Gajanan.Chinchwadkar@marklogic.com"}, "change":{"assignTo":{"from":{"username":"gchinchwadkar", "name":"Gajanan Chinchwadkar", "email":"Gajanan.Chinchwadkar@marklogic.com"}, "to":{"username":"msrinivasan", "name":"Mahalakshmi Srinivasan", "email":"mahalakshmi.srinivasan@marklogic.com"}}}, "files":[], "show":true}, {"time":"2013-03-12T13:20:16.592628-07:00", "updatedBy":{"username":"msrinivasan", "name":"Mahalakshmi Srinivasan", "email":"mahalakshmi.srinivasan@marklogic.com"}, "change":{"status":{"from":"", "to":"Ship"}, "assignTo":{"from":{"username":"msrinivasan", "name":"Mahalakshmi Srinivasan", "email":"mahalakshmi.srinivasan@marklogic.com"}, "to":{"username":"nobody", "name":"nobody nobody", "email":"nobody@marklogic.com"}}}, "files":[], "show":true, "comment":"Verified on build 7.0-20130305"}], "updatedAt":"2013-03-12T13:20:16.592628-07:00", "fixedAt":"2013-02-11T20:14:35.091691-08:00", "fixedBy":{"username":"gchinchwadkar", "name":"Gajanan Chinchwadkar", "email":"Gajanan.Chinchwadkar@marklogic.com"}, "shippedAt":"2013-03-12T13:20:16.592628-07:00", "shippedBy":{"username":"msrinivasan", "name":"Mahalakshmi Srinivasan", "email":"mahalakshmi.srinivasan@marklogic.com"}, "renderDescriptionAs":"normal"}
{"id":20911, "kind":"Bug", "createdAt":"2013-02-05T22:57:27.417077-08:00", "status":"Closed", "title":"Search on cts:element-word-query failing on 5.0", "category":"search", "severity":"Critical", "priority":{"level":"5", "title":""}, "submittedBy":{"username":"ksaxena", "name":"Kapil Saxena", "email":"kapil.saxena@marklogic.com"}, "assignTo":{"username":"nobody", "name":"nobody nobody", "email":"nobody@marklogic.com"}, "description":"ML Version: 5.0-20130205\r\nTest Name: bug20011.xml\r\nLink to diff:\r\nhttps://regression-status.marklogic.com/new-app/space2/diff-archive/b5_0/2013-02-05/linux-64-rh54-cluster-RH5.4/diffs/bug20011.xml\r\n********************************************************************************************************************************************************\r\n\r\nSteps to reproduce:\r\n**************************************\r\n1. Create DB (bug20011db)\r\n2. Create Forest and attach forest to DB\r\n3. Attach DB with XDBC Server\r\n4. Set all indexes = false\r\n\t\txquery version \"1.0-ml\";\r\n        import module namespace admin = \"http://marklogic.com/xdmp/admin\" at \"/MarkLogic/admin.xqy\";\r\n        let $config := admin:get-configuration()\r\n        let $config := admin:database-set-attribute-value-positions($config,xdmp:database(\"bug20011db\"),fn:false())\r\n        let $config := admin:database-set-collection-lexicon($config,xdmp:database(\"bug20011db\"),fn:false())\r\n        let $config := admin:database-set-element-value-positions($config,xdmp:database(\"bug20011db\"),fn:false())\r\n        let $config := admin:database-set-fast-case-sensitive-searches($config,xdmp:database(\"bug20011db\"),fn:false())\r\n        let $config := admin:database-set-fast-diacritic-sensitive-searches($config,xdmp:database(\"bug20011db\"),fn:false())\r\n        let $config := admin:database-set-fast-element-character-searches($config,xdmp:database(\"bug20011db\"),fn:false())\r\n        let $config := admin:database-set-fast-element-phrase-searches($config,xdmp:database(\"bug20011db\"),fn:false())\r\n        let $config := admin:database-set-fast-element-trailing-wildcard-searches($config,xdmp:database(\"bug20011db\"),fn:false())\r\n        let $config := admin:database-set-fast-element-word-searches($config,xdmp:database(\"bug20011db\"),fn:false())\r\n        let $config := admin:database-set-fast-phrase-searches($config,xdmp:database(\"bug20011db\"),fn:false())\r\n        let $config := admin:database-set-fast-reverse-searches($config,xdmp:database(\"bug20011db\"),fn:false())\r\n        return\r\n          admin:save-configuration($config)\r\n5. set word query search = true\r\n6. set element word positions\r\n7. Set stemming=off\r\n8. Insert docs\r\n\t\txquery version \"1.0-ml\";\r\n        xdmp:document-insert(\"/tmp/a.xml\", <r><a>one</a><b>two</b></r>);\r\n        xdmp:document-insert(\"/tmp/b.xml\", <r><a>three</a><b>four</b></r>);\r\n        xdmp:document-insert(\"/tmp/c.xml\", <r><a>five</a><b>six</b></r>)\r\n9. Run the following XQuery:\r\n\t\txquery version \"1.0-ml\";\r\n        xdmp:estimate(cts:search(fn:doc(), cts:element-word-query((xs:QName(\"dummy\")), \"one\")))\r\n\r\n********************************************************************************************************************************************************\r\nExpected Result: 1\r\nActual Result: 0\r\n\r\n\r\n\r\nNote:\r\nThe following additional diffs are also failing on 5.0, which also deals with search performed on element-word-query:\r\nlang_query2.xml\t\r\nlang_query3.xml\t\r\nreverse_query2.xml\t\r\nreverse_query5.xml\t\r\nrquery_roundtripserial.xml\t\r\n\t\t", "samplequery":"", "sampledata":"", "version":"6.0-1", "tofixin":"6.0-3", "fixedin":"6.0-3", "platform":"all", "memory":"", "processors":"", "note":"", "subscribers":[{"username":"ksaxena", "name":"Kapil Saxena", "email":"kapil.saxena@marklogic.com"}, {"username":"mary", "name":"Mary Holstege", "email":"mary@cerisent.com"}, {"username":"gpushkar", "name":"Gaurav Pushkarna", "email":"gaurav.pushkarna@marklogic.com"}], "attachments":[], "relationships":[{"type":"", "to":""}], "clones":[], "cloneOf":20721, "support":{"headline":"", "supportDescription":"nightly", "publishStatus":"Never Publish", "tickets":[], "customerImpact":{"level":"N/A", "title":""}, "workaround":""}, "tags":["search", "ksaxena"], "changeHistory":[{"time":"2013-02-05T22:57:27.417077-08:00", "updatedBy":{"username":"ksaxena", "name":"Kapil Saxena", "email":"kapil.saxena@marklogic.com"}, "change":{"assignTo":{"from":{"username":"ksaxena", "name":"Kapil Saxena", "email":"kapil.saxena@marklogic.com"}, "to":{"username":"mary", "name":"Mary Holstege", "email":"mary@cerisent.com"}}}, "files":[], "show":true}, {"time":"2013-02-07T07:34:04.58848-08:00", "updatedBy":{"username":"mary", "name":"Mary Holstege", "email":"mary@cerisent.com"}, "change":{}, "files":[], "show":true, "svn":{"repository":"/project/engsvn", "revision":"130906", "paths":["xdmp/trunk/src/QueryPath.h", "xdmp/trunk/src/SearchBuiltins.cpp", "xdmp/trunk/src/IndexerOpts.h"], "affectedBugs":[]}, "comment":"Bug:20721 try out on head; debugging function cts:show-get-query"}, {"time":"2013-02-07T10:40:33.018289-08:00", "updatedBy":{"username":"mary", "name":"Mary Holstege", "email":"mary@cerisent.com"}, "change":{}, "files":[], "show":true, "svn":{"repository":"/project/engsvn", "revision":"130914", "paths":["xdmp/branches/b6_0/src/SearchBuiltins.cpp"], "affectedBugs":[]}, "comment":"Bug:20721 port to b6"}, {"time":"2013-02-07T12:28:18.033994-08:00", "updatedBy":{"username":"mary", "name":"Mary Holstege", "email":"mary@cerisent.com"}, "change":{}, "files":[], "show":true, "svn":{"repository":"/project/engsvn", "revision":"130921", "paths":["xdmp/branches/b5_0/src/SearchBuiltins.cpp"], "affectedBugs":["20011"]}, "comment":"Bug:20721 e-w-q again/still; Bug:20011 case was over-constrained"}, {"time":"2013-02-07T12:30:18.16234-08:00", "updatedBy":{"username":"mary", "name":"Mary Holstege", "email":"mary@cerisent.com"}, "change":{}, "files":[], "show":true, "comment":"I don't know how reverse_query5 ever worked. It is a bunch of registered queries being stored in the database: both the reverse index and the filter return true for this case.  Latest patch should take care of the rest, although one cae in bug20011 still fails, but that is because the expected result is wrong. estimate(e-w-q(\"dummy\",\"one\")) should be 0."}, {"time":"2013-02-08T11:54:18.494616-08:00", "updatedBy":{"username":"mary", "name":"Mary Holstege", "email":"mary@cerisent.com"}, "change":{"status":{"from":"", "to":"Test"}, "assignTo":{"from":{"username":"mary", "name":"Mary Holstege", "email":"mary@cerisent.com"}, "to":{"username":"ksaxena", "name":"Kapil Saxena", "email":"kapil.saxena@marklogic.com"}}}, "files":[], "show":true, "comment":"Fixed 5.0-20130208.\r\n\r\nSee my last comment, however. I don't think reverse_query5 should be storing registered queries at all. I wonder if the test has changed, or something else has changed in some other part of the system (not related to e-w-q per se at all)"}, {"time":"2013-02-08T11:54:18.494616-08:00", "updatedBy":{"username":"mary", "name":"Mary Holstege", "email":"mary@cerisent.com"}, "change":{"assignTo":{"from":{"username":"mary", "name":"Mary Holstege", "email":"mary@cerisent.com"}, "to":{"username":"ksaxena", "name":"Kapil Saxena", "email":"kapil.saxena@marklogic.com"}}}, "files":[], "show":true}, {"time":"2013-02-08T13:49:24.017509-08:00", "updatedBy":{"username":"msarma", "name":"Meghalim Sarma", "email":"msarma@marklogic.com"}, "change":{}, "files":[], "show":true, "comment":"FYI...The regressions that were seen on search:search element-word-query tests because of this bug went away on today's regression. "}, {"time":"2013-02-10T22:00:24.60807-08:00", "updatedBy":{"username":"ksaxena", "name":"Kapil Saxena", "email":"kapil.saxena@marklogic.com"}, "change":{"status":{"from":"", "to":"Ship"}, "assignTo":{"from":{"username":"ksaxena", "name":"Kapil Saxena", "email":"kapil.saxena@marklogic.com"}, "to":{"username":"nobody", "name":"nobody nobody", "email":"nobody@marklogic.com"}}}, "files":[], "show":true, "comment":"Verified and found fixed in 5.0-20130210."}, {"time":"2013-02-10T22:00:24.60807-08:00", "updatedBy":{"username":"ksaxena", "name":"Kapil Saxena", "email":"kapil.saxena@marklogic.com"}, "change":{"assignTo":{"from":{"username":"ksaxena", "name":"Kapil Saxena", "email":"kapil.saxena@marklogic.com"}, "to":{"username":"nobody", "name":"nobody nobody", "email":"nobody@marklogic.com"}}}, "files":[], "show":true}, {"time":"2013-02-22T15:25:14.084196-08:00", "updatedBy":{"username":"rpelton", "name":"Rick Pelton", "email":"rick.pelton@marklogic.com"}, "change":{}, "files":[], "show":true, "comment":"cloning to 6.0.  Looks like fix already checked into that branch"}, {"time":"2013-02-22T15:26:27.521362-08:00", "updatedBy":{"username":"rpelton", "name":"Rick Pelton", "email":"rick.pelton@marklogic.com"}, "change":{"status":{"from":"", "to":"Test"}, "assignTo":{"from":{"username":"rpelton", "name":"Rick Pelton", "email":"rick.pelton@marklogic.com"}, "to":{"username":"ksaxena", "name":"Kapil Saxena", "email":"kapil.saxena@marklogic.com"}}}, "files":[], "show":true}, {"time":"2013-02-22T15:26:27.521362-08:00", "updatedBy":{"username":"rpelton", "name":"Rick Pelton", "email":"rick.pelton@marklogic.com"}, "change":{"assignTo":{"from":{"username":"rpelton", "name":"Rick Pelton", "email":"rick.pelton@marklogic.com"}, "to":{"username":"ksaxena", "name":"Kapil Saxena", "email":"kapil.saxena@marklogic.com"}}}, "files":[], "show":true}, {"time":"2013-02-22T15:26:27.521362-08:00", "updatedBy":{"username":"rpelton", "name":"Rick Pelton", "email":"rick.pelton@marklogic.com"}, "change":{"tofixin":{"from":"", "to":"6.0-3"}}, "files":[], "show":true}, {"time":"2013-03-12T23:31:51.104258-07:00", "updatedBy":{"username":"ksaxena", "name":"Kapil Saxena", "email":"kapil.saxena@marklogic.com"}, "change":{"assignTo":{"from":{"username":"ksaxena", "name":"Kapil Saxena", "email":"kapil.saxena@marklogic.com"}, "to":{"username":"gpushkar", "name":"Gaurav Pushkarna", "email":"gaurav.pushkarna@marklogic.com"}}}, "files":[], "show":true}, {"time":"2013-03-15T00:25:13.65429-07:00", "updatedBy":{"username":"gpushkar", "name":"Gaurav Pushkarna", "email":"gaurav.pushkarna@marklogic.com"}, "change":{"status":{"from":"", "to":"Ship"}, "assignTo":{"from":{"username":"gpushkar", "name":"Gaurav Pushkarna", "email":"gaurav.pushkarna@marklogic.com"}, "to":{"username":"nobody", "name":"nobody nobody", "email":"nobody@marklogic.com"}}}, "files":[], "show":true, "comment":"Verified on ML 20130313"}, {"time":"2013-03-15T00:25:13.65429-07:00", "updatedBy":{"username":"gpushkar", "name":"Gaurav Pushkarna", "email":"gaurav.pushkarna@marklogic.com"}, "change":{"assignTo":{"from":{"username":"gpushkar", "name":"Gaurav Pushkarna", "email":"gaurav.pushkarna@marklogic.com"}, "to":{"username":"nobody", "name":"nobody nobody", "email":"nobody@marklogic.com"}}}, "files":[], "show":true}], "updatedAt":"2013-03-15T00:25:13.65429-07:00", "fixedAt":"2013-02-22T15:26:27.521362-08:00", "fixedBy":{"username":"rpelton", "name":"Rick Pelton", "email":"rick.pelton@marklogic.com"}, "shippedAt":"2013-03-15T00:25:13.65429-07:00", "shippedBy":{"username":"gpushkar", "name":"Gaurav Pushkarna", "email":"gaurav.pushkarna@marklogic.com"}, "renderDescriptionAs":"normal"}
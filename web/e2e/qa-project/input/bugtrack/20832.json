{"id":20832, "kind":"Bug", "createdAt":"2013-02-19T05:04:47.910209-08:00", "status":"Closed", "title":"Incorrect scores returned by cts:search with cts:word-query", "category":"search", "severity":"Major", "priority":{"level":"5", "title":""}, "submittedBy":{"username":"iagrawal", "name":"Isha Agrawal", "email":"iagrawal@marklogic.com"}, "assignTo":{"username":"nobody", "name":"nobody nobody", "email":"nobody@marklogic.com"}, "description":"Incorrect scores returned by cts:search with cts:word-query\r\n\r\nFailing test:quality.xml\r\nMl Version:20130218\r\n\r\nSteps to reproduce:\r\n\r\n1. After creating DB and forest,Set request time limit of QAxdbcServer to 8000\r\n\r\nXquery for setting request time limit of QAxdbcServer to 8000 :\r\nxquery version \"1.0-ml\";\r\n\r\nimport module namespace admin = \"http://marklogic.com/xdmp/admin\" at \"/MarkLogic/admin.xqy\";\r\n\r\nlet $config := admin:get-configuration()\r\nlet $groupid := admin:group-get-id($config, \"Default\")\r\nlet $appserverid := admin:appserver-get-id ($config, $groupid, \"QAxdbcServer\")\r\nlet $config := admin:appserver-set-max-time-limit ($config, $appserverid, 8000)\r\nlet $config := admin:appserver-set-default-time-limit ($config, $appserverid, 8000)\r\nlet $config := admin:appserver-set-root($config, $appserverid, \"QA_HOME/testscripts/xquery\")\r\nreturn admin:save-configuration ($config),\r\nxdmp:log (\"request time limit set to 8,000\")\r\n\r\n2. Disable stemmed-searches on DB created.\r\n3. Enable word-searches on Db created.\r\n4. Load test data:\r\ndefault element namespace=\"http://marklogic.com/xdmp/directory\"\r\n      <a>;\r\n      { for $a in data(xdmp:filesystem-directory(\"/space/builder/builds/linux64/HEAD/qa/testdata/1.2Scripts/Shakespeare\")//pathname)\r\n        let $name := if (xdmp:platform()=\"winnt\") then fn:substring-after($a, \"/space/builder/builds/linux64/HEAD/qa/testdata/1.2Scripts/Shakespeare/\")\r\n        else\r\n        fn:substring-after($a, \"/space/builder/builds/linux64/HEAD/qa/testdata/1.2Scripts/Shakespeare/\")\r\n        return if (contains($name,\".xml\")) then xdmp:load($a,$name[last()],(),(),0) else ()\r\n      } </a>;\r\n\t  \r\n5. Preform Merge and wait for merge to get complete\r\n\r\n6. Run following query:\r\n\r\nXquery:\r\nfor $a in  cts:search(//*:LINE,cts:word-query(\"Venetian\")) \r\n      return <res>{base-uri($a), cts:score($a),xdmp:document-get-quality(base-uri($a)) }</res> \r\n   \r\n  \r\n  \r\nActual result: <res>othello.xml 55296 0</res><res>othello.xml 55296 0</res><res>othello.xml 55296 0</res><res>othello.xml 55296 0</res><res>merchant.xml 41472 0</res><res>merchant.xml 41472 0</res><res>merchant.xml 41472 0</res><res>merchant.xml 41472 0</res><res>m_wives.xml 13824 0</res>\r\n\r\nExpected Result:<res>othello.xml 55296 0</res><res>othello.xml 55296 0</res><res>othello.xml 55296 0</res><res>othello.xml 55296 0</res><res>merchant.xml 48384 0</res><res>merchant.xml 48384 0</res><res>merchant.xml 48384 0</res><res>merchant.xml 48384 0</res><res>m_wives.xml 20736 0</res></h:expected-result>", "samplequery":"", "sampledata":"", "version":"7.0-nightly", "tofixin":"7.0-ea1", "fixedin":"7.0-ea1", "platform":"all", "memory":"", "processors":"", "note":"", "subscribers":[{"username":"iagrawal", "name":"Isha Agrawal", "email":"iagrawal@marklogic.com"}, {"username":"gchinchwadkar", "name":"Gajanan Chinchwadkar", "email":"Gajanan.Chinchwadkar@marklogic.com"}, {"username":"rhu", "name":"Ron Hu", "email":"ron.hu@marklogic.com"}], "attachments":[], "relationships":[{"type":"", "to":""}], "clones":[], "cloneOf":"", "support":{"headline":"", "supportDescription":"", "publishStatus":"Not Ready", "tickets":[], "customerImpact":{"level":"N/A", "title":""}, "workaround":""}, "tags":["search", "iagrawal"], "changeHistory":[{"time":"2013-02-19T05:04:47.910209-08:00", "updatedBy":{"username":"iagrawal", "name":"Isha Agrawal", "email":"iagrawal@marklogic.com"}, "change":{"assignTo":{"from":{"username":"iagrawal", "name":"Isha Agrawal", "email":"iagrawal@marklogic.com"}, "to":{"username":"rhu", "name":"Ron Hu", "email":"ron.hu@marklogic.com"}}}, "files":[], "show":true}, {"time":"2013-02-19T15:28:20.858553-08:00", "updatedBy":{"username":"rhu", "name":"Ron Hu", "email":"ron.hu@marklogic.com"}, "change":{"assignTo":{"from":{"username":"rhu", "name":"Ron Hu", "email":"ron.hu@marklogic.com"}, "to":{"username":"gchinchwadkar", "name":"Gajanan Chinchwadkar", "email":"Gajanan.Chinchwadkar@marklogic.com"}}}, "files":[], "show":true}, {"time":"2013-02-19T16:02:34.046398-08:00", "updatedBy":{"username":"gchinchwadkar", "name":"Gajanan Chinchwadkar", "email":"Gajanan.Chinchwadkar@marklogic.com"}, "change":{"status":{"from":"", "to":"Test"}, "assignTo":{"from":{"username":"gchinchwadkar", "name":"Gajanan Chinchwadkar", "email":"Gajanan.Chinchwadkar@marklogic.com"}, "to":{"username":"iagrawal", "name":"Isha Agrawal", "email":"iagrawal@marklogic.com"}}}, "files":[], "show":true, "comment":"I just backed-out a small enhancement from fields code. That fixed this."}, {"time":"2013-02-19T16:02:34.046398-08:00", "updatedBy":{"username":"gchinchwadkar", "name":"Gajanan Chinchwadkar", "email":"Gajanan.Chinchwadkar@marklogic.com"}, "change":{"assignTo":{"from":{"username":"gchinchwadkar", "name":"Gajanan Chinchwadkar", "email":"Gajanan.Chinchwadkar@marklogic.com"}, "to":{"username":"iagrawal", "name":"Isha Agrawal", "email":"iagrawal@marklogic.com"}}}, "files":[], "show":true}, {"time":"2013-02-20T03:12:50.376222-08:00", "updatedBy":{"username":"iagrawal", "name":"Isha Agrawal", "email":"iagrawal@marklogic.com"}, "change":{"status":{"from":"", "to":"Closed"}, "assignTo":{"from":{"username":"iagrawal", "name":"Isha Agrawal", "email":"iagrawal@marklogic.com"}, "to":{"username":"nobody", "name":"nobody nobody", "email":"nobody@marklogic.com"}}}, "files":[], "show":true, "comment":"As per above comment, the test bug6635.xml is passing now.Verified on ML Version 20130219-1800 sandbox run. Hence,closing the bug"}, {"time":"2013-02-20T03:12:50.376222-08:00", "updatedBy":{"username":"iagrawal", "name":"Isha Agrawal", "email":"iagrawal@marklogic.com"}, "change":{"assignTo":{"from":{"username":"iagrawal", "name":"Isha Agrawal", "email":"iagrawal@marklogic.com"}, "to":{"username":"nobody", "name":"nobody nobody", "email":"nobody@marklogic.com"}}}, "files":[], "show":true}], "updatedAt":"2013-02-20T03:12:50.376222-08:00", "fixedAt":"2013-02-19T16:02:34.046398-08:00", "fixedBy":{"username":"gchinchwadkar", "name":"Gajanan Chinchwadkar", "email":"Gajanan.Chinchwadkar@marklogic.com"}, "closedAt":"2013-02-20T03:12:50.376222-08:00", "closedBy":{"username":"iagrawal", "name":"Isha Agrawal", "email":"iagrawal@marklogic.com"}, "renderDescriptionAs":"normal"}
{"id":20033, "kind":"Bug", "createdAt":"2012-11-08T11:30:19.73283-08:00", "status":"Closed", "title":"Admin UI: forest-admin-form.xqy incorrectly greys out merge button", "category":"adminGUI", "severity":"Minor", "priority":{"level":"5", "title":""}, "submittedBy":{"username":"rpelton", "name":"Rick Pelton", "email":"rick.pelton@marklogic.com"}, "assignTo":{"username":"nobody", "name":"nobody nobody", "email":"nobody@marklogic.com"}, "description":"\r\nOn the Forest Config page of the Admin UI (forest-admin-form.xqy), the merge button is greyed out for Forests that are replica’s of DB replication (i.e. state = “open replica”).  This button should be enabled for db replica forests.\r\n\r\n \r\n\r\n \r\n", "samplequery":"", "sampledata":"", "version":"6.0-1", "tofixin":"6.0-3", "fixedin":"6.0-3", "platform":"all", "memory":"", "processors":"", "note":"", "subscribers":[{"username":"rpelton", "name":"Rick Pelton", "email":"rick.pelton@marklogic.com"}, {"username":"bmo", "name":"Brian Mo", "email":"brian.mo@marklogic.com"}, {"username":"wfeick", "name":"Wayne Feick", "email":"wfeick@marklogic.com"}, {"username":"gvaidees", "name":"Ganesh Vaideeswaran", "email":"Ganesh.Vaideeswaran@marklogic.com"}, {"username":"msarma", "name":"Meghalim Sarma", "email":"msarma@marklogic.com"}], "attachments":[], "relationships":[{"type":"", "to":""}], "clones":[20598], "cloneOf":"", "support":{"headline":"", "supportDescription":"", "publishStatus":"Never Publish", "tickets":[], "customerImpact":{"level":"Low", "title":"Minimal business impact or reasonable workaround is available"}, "workaround":""}, "tags":["adminGUI", "rpelton"], "changeHistory":[{"time":"2012-11-08T11:30:19.73283-08:00", "updatedBy":{"username":"rpelton", "name":"Rick Pelton", "email":"rick.pelton@marklogic.com"}, "change":{"assignTo":{"from":{"username":"rpelton", "name":"Rick Pelton", "email":"rick.pelton@marklogic.com"}, "to":{"username":"gvaidees", "name":"Ganesh Vaideeswaran", "email":"Ganesh.Vaideeswaran@marklogic.com"}}}, "files":[], "show":true}, {"time":"2012-12-06T14:26:17.493551-08:00", "updatedBy":{"username":"gvaidees", "name":"Ganesh Vaideeswaran", "email":"Ganesh.Vaideeswaran@marklogic.com"}, "change":{"assignTo":{"from":{"username":"gvaidees", "name":"Ganesh Vaideeswaran", "email":"Ganesh.Vaideeswaran@marklogic.com"}, "to":{"username":"bmo", "name":"Brian Mo", "email":"brian.mo@marklogic.com"}}}, "files":[], "show":true}, {"time":"2013-01-17T18:28:29.995281-08:00", "updatedBy":{"username":"gvaidees", "name":"Ganesh Vaideeswaran", "email":"Ganesh.Vaideeswaran@marklogic.com"}, "change":{}, "files":[], "show":true, "comment":"Wayne,\r\n\r\nDo you concur with this defect? If so, we will look at fixing this. Thanks"}, {"time":"2013-01-18T08:34:21.429283-08:00", "updatedBy":{"username":"rpelton", "name":"Rick Pelton", "email":"rick.pelton@marklogic.com"}, "change":{}, "files":[], "show":true, "comment":"Adding comments in email from Wayne on 11/8/2012 regarding this issue.\r\n\r\n\" ... It's fine to do merges on replica forests. They do them all the time on their own. If the button is greyed out, it's a bug. Please file and assign to Ganesh.\" -- Wayne.\r\n"}, {"time":"2013-01-25T12:19:01.619435-08:00", "updatedBy":{"username":"gvaidees", "name":"Ganesh Vaideeswaran", "email":"Ganesh.Vaideeswaran@marklogic.com"}, "change":{}, "files":[], "show":true, "comment":"Rick,\r\n\r\nIs the forest set to be read-only? Here is the logic I am seeing in the code (which seems to indicate that the merge button is grayed out, if forest is set to be read-only). I am not sure if merges are allowed if replica state is open and forest is read-only. Thanks.\r\n\r\nCode shown below - \r\n\r\n if ($enabled and ($state = (\"open\",\"wait replication\",\"async replicating\",\"sync replicating\"))) then (\r\n                    <a href=\"toggle-forest.xqy?section=forest&amp;forest={get-session-forest()}&amp;name={$value/as:forest-name}&amp;disable=true\">\r\n                      <img src=\"images/button-disable.gif\" width=\"76\" height=\"25\" alt=\"disable\" border=\"0\" align=\"right\"/></a>,\r\n                    if ($read-only) then (\r\n                    <img src=\"images/button-gray-clear.gif\" width=\"76\" height=\"25\" alt=\"clear\" border=\"0\" align=\"right\"/>,\r\n                    <img src=\"images/button-gray-merge.gif\" width=\"76\" height=\"25\" alt=\"merge\" border=\"0\" align=\"right\"/>\r\n                    ) \r\n\r\n"}, {"time":"2013-01-25T14:04:52.468876-08:00", "updatedBy":{"username":"rpelton", "name":"Rick Pelton", "email":"rick.pelton@marklogic.com"}, "change":{}, "files":[], "show":true, "comment":"Hi Ganesh, \r\n\r\nI think you need to look at the entire block of code that is relevant.  There are multiple ways that the merge button can be grayed out.\r\n\r\n         if ($enabled and ($state = (\"open\",\"wait replication\",\"async replicating\",\"sync replicating\"))) then (\r\n                    <a href=\"toggle-forest.xqy?section=forest&amp;forest={get-session-forest()}&amp;name={$value/as:forest-name}&amp;disable=true\">\r\n                      <img src=\"images/button-disable.gif\" width=\"76\" height=\"25\" alt=\"disable\" border=\"0\" align=\"right\"/></a>,\r\n                    if ($read-only) then (\r\n                        <img src=\"images/button-gray-clear.gif\" width=\"76\" height=\"25\" alt=\"clear\" border=\"0\" align=\"right\"/>,\r\n                        <img src=\"images/button-gray-merge.gif\" width=\"76\" height=\"25\" alt=\"merge\" border=\"0\" align=\"right\"/>\r\n                    ) \r\n                    else (\r\n                        <a href=\"clear-forest.xqy?section=forest&amp;forest={get-session-forest()}&amp;name={$value/as:forest-name}\">\r\n                          <img src=\"images/button-clear.gif\" width=\"76\" height=\"25\" alt=\"clear\" border=\"0\" align=\"right\"/></a>,\r\n                        <a href=\"merge-forest.xqy?section=forest&amp;forest={get-session-forest()}&amp;name={$value/as:forest-name}\">\r\n                          <img src=\"images/button-merge.gif\" width=\"76\" height=\"25\" alt=\"merge\" border=\"0\" align=\"right\"/></a>\r\n                    )\r\n          )\r\n          else if (not($enabled)) then (\r\n                    <a href=\"toggle-forest.xqy?section=forest&amp;forest={get-session-forest()}&amp;name={$value/as:forest-name}&amp;enable=true\">\r\n                      <img src=\"images/button-enable.gif\" width=\"76\" height=\"25\" alt=\"enable\" border=\"0\" align=\"right\"/></a>,\r\n                    <img src=\"images/button-gray-clear.gif\" width=\"76\" height=\"25\" alt=\"clear\" border=\"0\" align=\"right\"/>,\r\n                    <img src=\"images/button-gray-merge.gif\" width=\"76\" height=\"25\" alt=\"merge\" border=\"0\" align=\"right\"/> \r\n          )\r\n          else ( \r\n                      <img src=\"images/button-gray-disable.gif\" width=\"76\" height=\"25\" alt=\"disable\" border=\"0\" align=\"right\"/>,\r\n                    <img src=\"images/button-gray-clear.gif\" width=\"76\" height=\"25\" alt=\"clear\" border=\"0\" align=\"right\"/>,\r\n                    <img src=\"images/button-gray-merge.gif\" width=\"76\" height=\"25\" alt=\"merge\" border=\"0\" align=\"right\"/> \r\n          )                                \r\n\r\nIt is going through the default else condition (i.e. enabled and state = “open replica”).  The solution is most likely to just add “open replica” to the original sequence of acceptable states in the root if condition (i.e.  if ($enabled and ($state = (...)))\r\n\r\n"}, {"time":"2013-01-25T14:16:32.165013-08:00", "updatedBy":{"username":"gvaidees", "name":"Ganesh Vaideeswaran", "email":"Ganesh.Vaideeswaran@marklogic.com"}, "change":{}, "files":[], "show":true, "comment":"Thanks  Rick. I assumed \"open\" state in the condition meant \"open replica\". I will confirm this with Wayne. \r\n\r\nBut, I also wanted to make sure that the replica was not  read-only.\r\n\r\n"}, {"time":"2013-01-25T14:19:02.899869-08:00", "updatedBy":{"username":"wfeick", "name":"Wayne Feick", "email":"wfeick@marklogic.com"}, "change":{}, "files":[], "show":true, "comment":"You should be able to merge any forest that is \"open\", \"open replica\", or \"sync replicating\""}, {"time":"2013-01-25T14:19:54.525191-08:00", "updatedBy":{"username":"gvaidees", "name":"Ganesh Vaideeswaran", "email":"Ganesh.Vaideeswaran@marklogic.com"}, "change":{}, "files":[], "show":true, "comment":"Thanks Wayne. I will make the change. "}, {"time":"2013-01-25T14:29:48.403571-08:00", "updatedBy":{"username":"gvaidees", "name":"Ganesh Vaideeswaran", "email":"Ganesh.Vaideeswaran@marklogic.com"}, "change":{"status":{"from":"", "to":"Fix"}, "assignTo":{"from":{"username":"gvaidees", "name":"Ganesh Vaideeswaran", "email":"Ganesh.Vaideeswaran@marklogic.com"}, "to":{"username":"gvaidees", "name":"Ganesh Vaideeswaran", "email":"Ganesh.Vaideeswaran@marklogic.com"}}}, "files":[], "show":true}, {"time":"2013-01-25T14:29:48.403571-08:00", "updatedBy":{"username":"gvaidees", "name":"Ganesh Vaideeswaran", "email":"Ganesh.Vaideeswaran@marklogic.com"}, "change":{"assignTo":{"from":{"username":"gvaidees", "name":"Ganesh Vaideeswaran", "email":"Ganesh.Vaideeswaran@marklogic.com"}, "to":{"username":"gvaidees", "name":"Ganesh Vaideeswaran", "email":"Ganesh.Vaideeswaran@marklogic.com"}}}, "files":[], "show":true}, {"time":"2013-01-25T14:31:32.859603-08:00", "updatedBy":{"username":"gvaidees", "name":"Ganesh Vaideeswaran", "email":"Ganesh.Vaideeswaran@marklogic.com"}, "change":{"status":{"from":"", "to":"Test"}, "assignTo":{"from":{"username":"gvaidees", "name":"Ganesh Vaideeswaran", "email":"Ganesh.Vaideeswaran@marklogic.com"}, "to":{"username":"msarma", "name":"Meghalim Sarma", "email":"msarma@marklogic.com"}}}, "files":[], "show":true}, {"time":"2013-01-25T14:31:32.859603-08:00", "updatedBy":{"username":"gvaidees", "name":"Ganesh Vaideeswaran", "email":"Ganesh.Vaideeswaran@marklogic.com"}, "change":{"assignTo":{"from":{"username":"gvaidees", "name":"Ganesh Vaideeswaran", "email":"Ganesh.Vaideeswaran@marklogic.com"}, "to":{"username":"msarma", "name":"Meghalim Sarma", "email":"msarma@marklogic.com"}}}, "files":[], "show":true}, {"time":"2013-03-14T17:03:54.455618-07:00", "updatedBy":{"username":"msarma", "name":"Meghalim Sarma", "email":"msarma@marklogic.com"}, "change":{"assignTo":{"from":{"username":"msarma", "name":"Meghalim Sarma", "email":"msarma@marklogic.com"}, "to":{"username":"knagar", "name":"Kuldeep Nagar", "email":"Kuldeep.Nagar@marklogic.com"}}}, "files":[], "show":true}, {"time":"2013-03-26T11:14:38.796916-07:00", "updatedBy":{"username":"ayuwono", "name":"Aries Yuwono", "email":"ayuwono@marklogic.com"}, "change":{}, "files":[], "show":true, "comment":"Hi Kuldeep, here are the steps:\r\n1) Couple two clusters. Let's say they are clusterA and clusterB\r\n2) Create a DB and forest on clusterA. Let's say the name is TestDB\r\n3) Create a DB and forest on clusterB. Let's say the name is also TestDB\r\n4) On clusterA, setup a DB replication on TestDB between clusterA and clusterB\r\n5) Now TestDB on clusterB is a replica of TestDB on clusterA\r\n6) Load some docs on TestDB from clusterA\r\n7) On clusterB, go to TestDB forest page, and make sure that the \"merge\" button is enabled"}, {"time":"2013-03-28T00:58:08.403061-07:00", "updatedBy":{"username":"knagar", "name":"Kuldeep Nagar", "email":"Kuldeep.Nagar@marklogic.com"}, "change":{"status":{"from":"", "to":"Ship"}, "assignTo":{"from":{"username":"knagar", "name":"Kuldeep Nagar", "email":"Kuldeep.Nagar@marklogic.com"}, "to":{"username":"nobody", "name":"nobody nobody", "email":"nobody@marklogic.com"}}}, "files":[], "show":true, "comment":"Thanks Aries, verified passed and added a comment in Automation task for DB replication (Bug 19570)\r\n\r\n-Kuldeep."}], "updatedAt":"2013-03-28T00:58:08.403061-07:00", "fixedAt":"2013-01-25T14:31:32.859603-08:00", "fixedBy":{"username":"gvaidees", "name":"Ganesh Vaideeswaran", "email":"Ganesh.Vaideeswaran@marklogic.com"}, "shippedAt":"2013-03-28T00:58:08.403061-07:00", "shippedBy":{"username":"knagar", "name":"Kuldeep Nagar", "email":"Kuldeep.Nagar@marklogic.com"}, "renderDescriptionAs":"normal"}
{"id":20983, "kind":"Bug", "createdAt":"2013-03-01T07:05:04.524332-08:00", "status":"Closed", "title":"Creating scheduled backups in Admin UI should not allow invalid directories", "category":"adminGUI", "severity":"Minor", "priority":{"level":"2", "title":"Not required for product release"}, "submittedBy":{"username":"rjovanovich", "name":"Richard Jovanovich", "email":"richard.jovanovich@marklogic.com"}, "assignTo":{"username":"nobody", "name":"nobody nobody", "email":"nobody@marklogic.com"}, "description":"A user is allowed to create scheduled backups defining a backup directory that is prohibited by MarkLogic.\r\n\r\nFor instance, you can create a backup that specifies a backup directory of /var/opt/MarkLogic-Backup.  Even thought this is allowed, the backup will fail with the following error only when the backup is attempted.\r\n\r\nXDMP-BACKUPDATADIR: Backup pathname conflicts with data directory:\r\n\r\nSince this is a prohibition by the server, shouldn't we check the validity of the backup directory and throw an error in the Admin UI upon creation.  Currently the only indication of failure is the message in the logs, which could easily be missed.", "samplequery":"", "sampledata":"", "version":"6.0-2.3", "tofixin":"7.0-4", "fixedin":"7.0-4", "platform":"all", "memory":"", "processors":"", "note":"", "subscribers":[{"username":"rjovanovich", "name":"Richard Jovanovich", "email":"richard.jovanovich@marklogic.com"}, {"username":"atsoi", "name":"Arthur Tsoi", "email":"arthur.tsoi@marklogic.com"}, {"username":"rhu", "name":"Ron Hu", "email":"ron.hu@marklogic.com"}, {"username":"dgorbet", "name":"David Gorbet", "email":"David.Gorbet@marklogic.com"}, {"username":"gvaidees", "name":"Ganesh Vaideeswaran", "email":"Ganesh.Vaideeswaran@marklogic.com"}], "attachments":[], "relationships":[{"type":"", "to":""}], "clones":[25018], "cloneOf":"", "support":{"headline":"database backup returns XDMP-BACKUPDATADIR if backup path contains the prefix \"/var/opt/MarkLogic-Backup\"", "supportDescription":"database backup returns XDMP-BACKUPDATADIR if backup path begins with \"/var/opt/MarkLogic\" and it is not a directory under \"/var/opt/MarkLogic\"", "publishStatus":"Publish", "tickets":[], "customerImpact":{"level":"Low", "title":"Minimal business impact or reasonable workaround is available"}, "workaround":""}, "tags":["adminGUI", "rjovanovich"], "changeHistory":[{"time":"2013-03-01T07:05:04.524332-08:00", "updatedBy":{"username":"rjovanovich", "name":"Richard Jovanovich", "email":"richard.jovanovich@marklogic.com"}, "change":{"assignTo":{"from":{"username":"rjovanovich", "name":"Richard Jovanovich", "email":"richard.jovanovich@marklogic.com"}, "to":{"username":"gvaidees", "name":"Ganesh Vaideeswaran", "email":"Ganesh.Vaideeswaran@marklogic.com"}}}, "files":[], "show":true}, {"time":"2013-03-01T07:25:33.759699-08:00", "updatedBy":{"username":"gvaidees", "name":"Ganesh Vaideeswaran", "email":"Ganesh.Vaideeswaran@marklogic.com"}, "change":{}, "files":[], "show":true, "comment":"Ron,\r\n\r\nI think the server should do this check (or a method available to check for this in the UI) and then the UI has to call the \"validate\" method.\r\n\r\nIf you agree, once the server change is available, we will look at using it in the UI"}, {"time":"2013-03-01T07:25:33.759699-08:00", "updatedBy":{"username":"gvaidees", "name":"Ganesh Vaideeswaran", "email":"Ganesh.Vaideeswaran@marklogic.com"}, "change":{"assignTo":{"from":{"username":"gvaidees", "name":"Ganesh Vaideeswaran", "email":"Ganesh.Vaideeswaran@marklogic.com"}, "to":{"username":"rhu", "name":"Ron Hu", "email":"ron.hu@marklogic.com"}}}, "files":[], "show":true}, {"time":"2013-03-01T07:25:33.759699-08:00", "updatedBy":{"username":"gvaidees", "name":"Ganesh Vaideeswaran", "email":"Ganesh.Vaideeswaran@marklogic.com"}, "change":{"tofixin":{"from":"", "to":"6.0-4"}}, "files":[], "show":true}, {"time":"2013-03-01T07:47:14.180997-08:00", "updatedBy":{"username":"cjl", "name":"Christopher Lindblad", "email":"cjl@cerisent.com"}, "change":{}, "files":[], "show":true, "comment":"Since this is a request that the server be better at telling the user that they are doing something wrong, \r\nI think it is a minor bug I don't think it should have high priority."}, {"time":"2013-03-01T07:57:28.747556-08:00", "updatedBy":{"username":"gvaidees", "name":"Ganesh Vaideeswaran", "email":"Ganesh.Vaideeswaran@marklogic.com"}, "change":{}, "files":[], "show":true, "comment":"Chris, On hindsight, the UI can check with the server to see if directory exists and if not, display a warning. If so, the change can be constrained to the UI. Am I right?"}, {"time":"2013-03-01T08:50:19.34053-08:00", "updatedBy":{"username":"cjl", "name":"Christopher Lindblad", "email":"cjl@cerisent.com"}, "change":{}, "files":[], "show":true, "comment":"Backups are performed by forests on the d-nodes.\r\nFile system directories may be visible on the d-nodes that are not visible on the e-nodes and vice versa.\r\nSo it's not as simple as checking if a directory exists or not.\r\nThere is a function xdmp:database-backup-validate() that is used to validate backup parameters.\r\nBut since  this change can have subtle issues and would involve qa work we should think hard about whether we should do it in a patch to old releases."}, {"time":"2013-03-01T08:56:12.003877-08:00", "updatedBy":{"username":"gvaidees", "name":"Ganesh Vaideeswaran", "email":"Ganesh.Vaideeswaran@marklogic.com"}, "change":{}, "files":[], "show":true, "comment":"Chris,\r\n\r\nYes .. i was hoping there would be a validate method that UI could use. I will move this back to UI and make sure we (QA) talk to you when we decide to make the change.\r\n\r\n"}, {"time":"2013-03-01T16:26:37.97125-08:00", "updatedBy":{"username":"rhu", "name":"Ron Hu", "email":"ron.hu@marklogic.com"}, "change":{}, "files":[], "show":true, "comment":"This is a low priority bug.  Assign it to 7.0-1 per CJL's comment above.\r\n\r\nThe fix will involve both server work and App Service work.  Server team needs to provide an API to tell if a backup directory is valid or not.  Then Admin UI will call this API to decide if we should reject a user's request."}, {"time":"2013-03-01T16:26:37.97125-08:00", "updatedBy":{"username":"rhu", "name":"Ron Hu", "email":"ron.hu@marklogic.com"}, "change":{"assignTo":{"from":{"username":"rhu", "name":"Ron Hu", "email":"ron.hu@marklogic.com"}, "to":{"username":"atsoi", "name":"Arthur Tsoi", "email":"arthur.tsoi@marklogic.com"}}}, "files":[], "show":true}, {"time":"2013-03-01T16:26:37.97125-08:00", "updatedBy":{"username":"rhu", "name":"Ron Hu", "email":"ron.hu@marklogic.com"}, "change":{"tofixin":{"from":"6.0-4", "to":"7.0-1"}}, "files":[], "show":true}, {"time":"2013-10-03T15:30:45.237687-07:00", "updatedBy":{"username":"wfeick", "name":"Wayne Feick", "email":"wfeick@marklogic.com"}, "change":{}, "files":[], "show":true, "comment":"We have an API for this: xdmp:database-backup-validate().\r\n\r\nMoving to 7.0-2."}, {"time":"2013-10-03T15:30:45.237687-07:00", "updatedBy":{"username":"wfeick", "name":"Wayne Feick", "email":"wfeick@marklogic.com"}, "change":{"tofixin":{"from":"7.0-1", "to":"7.0-2"}}, "files":[], "show":true}, {"time":"2013-12-18T11:27:01.056357-08:00", "updatedBy":{"username":"atsoi", "name":"Arthur Tsoi", "email":"arthur.tsoi@marklogic.com"}, "change":{}, "files":[], "show":true, "comment":"David,\r\n\r\nThere is no server side change. \r\nCould you assign it to someone who works in Admin UI?\r\n\r\nArthur"}, {"time":"2013-12-18T11:27:01.056357-08:00", "updatedBy":{"username":"atsoi", "name":"Arthur Tsoi", "email":"arthur.tsoi@marklogic.com"}, "change":{"assignTo":{"from":{"username":"atsoi", "name":"Arthur Tsoi", "email":"arthur.tsoi@marklogic.com"}, "to":{"username":"dgorbet", "name":"David Gorbet", "email":"David.Gorbet@marklogic.com"}}}, "files":[], "show":true}, {"time":"2013-12-18T11:29:18.072896-08:00", "updatedBy":{"username":"dgorbet", "name":"David Gorbet", "email":"David.Gorbet@marklogic.com"}, "change":{}, "files":[], "show":true, "comment":"Traditionally (before we gave all the Admin bugs to Brian), developers who owned their features also did the admin UI for them. Right now with Brian gone we have no one in the front-end team who writes XQuery. If you can do this, please do, if not, then let me know and I'll try to find someone else. Thanks."}, {"time":"2013-12-18T11:29:18.072896-08:00", "updatedBy":{"username":"dgorbet", "name":"David Gorbet", "email":"David.Gorbet@marklogic.com"}, "change":{"assignTo":{"from":{"username":"dgorbet", "name":"David Gorbet", "email":"David.Gorbet@marklogic.com"}, "to":{"username":"atsoi", "name":"Arthur Tsoi", "email":"arthur.tsoi@marklogic.com"}}}, "files":[], "show":true}, {"time":"2013-12-18T15:44:42.697259-08:00", "updatedBy":{"username":"atsoi", "name":"Arthur Tsoi", "email":"arthur.tsoi@marklogic.com"}, "change":{}, "files":[], "show":true, "svn":{"repository":"/project/engsvn", "revision":"157599", "paths":["xdmp/branches/b7_0/src/Forest.cpp"], "affectedBugs":[]}, "comment":"bug:20983 backup should be allowed for backup directory /var/opt/MarkLogic-Backup"}, {"time":"2013-12-18T15:53:40.807736-08:00", "updatedBy":{"username":"atsoi", "name":"Arthur Tsoi", "email":"arthur.tsoi@marklogic.com"}, "change":{}, "files":[], "show":true, "comment":"Admin UI is already using database-backup-validate to check the backup path.\r\n\r\n\"/var/opt/MarkLogic-Backup\" is a valid backup path because it is not under /var/opt/MarkLogic.\r\n\r\nThe problem is the error checking in database-backup.\r\nIt should not return XDMP-BACKUPDATADIR for backup path \"/var/opt/MarkLogic-Backup\"."}, {"time":"2013-12-18T16:02:12.52109-08:00", "updatedBy":{"username":"atsoi", "name":"Arthur Tsoi", "email":"arthur.tsoi@marklogic.com"}, "change":{"status":{"from":"", "to":"Test"}, "assignTo":{"from":{"username":"atsoi", "name":"Arthur Tsoi", "email":"arthur.tsoi@marklogic.com"}, "to":{"username":"gvaidees", "name":"Ganesh Vaideeswaran", "email":"Ganesh.Vaideeswaran@marklogic.com"}}}, "files":[], "show":true, "comment":"Fixed.\r\n\r\nSo backup to \"/var/opt/MarLogic-Backup\" should be allowed.\r\nBut backup to \"/var/opt/MarkLogic/Backup\" should return XDMP-BACKUPDATADIR."}, {"time":"2013-12-18T16:02:12.52109-08:00", "updatedBy":{"username":"atsoi", "name":"Arthur Tsoi", "email":"arthur.tsoi@marklogic.com"}, "change":{"assignTo":{"from":{"username":"atsoi", "name":"Arthur Tsoi", "email":"arthur.tsoi@marklogic.com"}, "to":{"username":"gvaidees", "name":"Ganesh Vaideeswaran", "email":"Ganesh.Vaideeswaran@marklogic.com"}}}, "files":[], "show":true}, {"time":"2013-12-18T16:02:56.571549-08:00", "updatedBy":{"username":"gvaidees", "name":"Ganesh Vaideeswaran", "email":"Ganesh.Vaideeswaran@marklogic.com"}, "change":{"assignTo":{"from":{"username":"gvaidees", "name":"Ganesh Vaideeswaran", "email":"Ganesh.Vaideeswaran@marklogic.com"}, "to":{"username":"knagar", "name":"Kuldeep Nagar", "email":"Kuldeep.Nagar@marklogic.com"}}}, "files":[], "show":true}, {"time":"2013-12-22T23:31:11.717224-08:00", "updatedBy":{"username":"knagar", "name":"Kuldeep Nagar", "email":"Kuldeep.Nagar@marklogic.com"}, "change":{"status":{"from":"", "to":"Ship"}, "assignTo":{"from":{"username":"knagar", "name":"Kuldeep Nagar", "email":"Kuldeep.Nagar@marklogic.com"}, "to":{"username":"nobody", "name":"nobody nobody", "email":"nobody@marklogic.com"}}}, "files":[], "show":true, "comment":"Verified and added AdminUIBug20983 in regression.\r\n\r\nThanks\r\nKuldeep"}, {"time":"2014-01-05T22:37:55.536421-08:00", "updatedBy":{"username":"knagar", "name":"Kuldeep Nagar", "email":"Kuldeep.Nagar@marklogic.com"}, "change":{"status":{"from":"", "to":"Verify"}, "assignTo":{"from":{"username":"knagar", "name":"Kuldeep Nagar", "email":"Kuldeep.Nagar@marklogic.com"}, "to":{"username":"atsoi", "name":"Arthur Tsoi", "email":"arthur.tsoi@marklogic.com"}}}, "files":[], "show":true, "comment":"Hi Arthur, \r\n\r\n\r\nSorry to bring this back to your plate but I am facing issue on Mac build. This is working perfectly fine on Linux and Windows. \r\n\r\nOn Linux I am seeing below error on entering \"/var/opt/MarkLogic/Backup\" on forest backup page\r\n\r\nError: Backup pathname conflicts with data directory: /space/MarkLogic/Backup\r\n\r\nOn Windows I am getting below error on entering \" C:\\Program Files\\MarkLogic\\Backup\"\r\n\r\nError: Backup pathname conflicts with install directory: C:\\Program Files\\MarkLogic\\Backup\r\n\r\nHowever if I am trying same thing on Mac build I am not getting any error, it successfully takes backup to \"/Users/buildermac/Library/Application Support/MarkLogic/Backup\"\r\n\r\nPlease let me know if I am doing something wrong.\r\n\r\nThanks\r\nKuldeep"}, {"time":"2014-01-05T22:37:55.536421-08:00", "updatedBy":{"username":"knagar", "name":"Kuldeep Nagar", "email":"Kuldeep.Nagar@marklogic.com"}, "change":{"assignTo":{"from":{"username":"knagar", "name":"Kuldeep Nagar", "email":"Kuldeep.Nagar@marklogic.com"}, "to":{"username":"atsoi", "name":"Arthur Tsoi", "email":"arthur.tsoi@marklogic.com"}}}, "files":[], "show":true}, {"time":"2014-08-29T14:02:58.500693-07:00", "updatedBy":{"username":"atsoi", "name":"Arthur Tsoi", "email":"arthur.tsoi@marklogic.com"}, "change":{}, "files":[], "show":true, "comment":"Hi Kuldeep,\r\n\r\nThe data directory on Mac is \"/Users/buildermac/Library/Application Support/MarkLogic/Data\"\r\n\r\nSo you need to test with backup directory \"\"/Users/buildermac/Library/Application Support/MarkLogic/Data/Backup\".\r\n\r\nThanks,\r\nArthur"}, {"time":"2014-08-29T14:05:08.64668-07:00", "updatedBy":{"username":"atsoi", "name":"Arthur Tsoi", "email":"arthur.tsoi@marklogic.com"}, "change":{"status":{"from":"Verify", "to":"Test"}, "assignTo":{"from":{"username":"atsoi", "name":"Arthur Tsoi", "email":"arthur.tsoi@marklogic.com"}, "to":{"username":"knagar", "name":"Kuldeep Nagar", "email":"Kuldeep.Nagar@marklogic.com"}}}, "files":[], "show":true, "comment":"can you test it again with the correct directory?"}, {"time":"2014-08-29T14:05:08.64668-07:00", "updatedBy":{"username":"atsoi", "name":"Arthur Tsoi", "email":"arthur.tsoi@marklogic.com"}, "change":{"assignTo":{"from":{"username":"atsoi", "name":"Arthur Tsoi", "email":"arthur.tsoi@marklogic.com"}, "to":{"username":"knagar", "name":"Kuldeep Nagar", "email":"Kuldeep.Nagar@marklogic.com"}}}, "files":[], "show":true}, {"time":"2014-08-29T21:51:12.335969-07:00", "updatedBy":{"username":"knagar", "name":"Kuldeep Nagar", "email":"Kuldeep.Nagar@marklogic.com"}, "change":{"status":{"from":"Test", "to":"Ship"}, "assignTo":{"from":{"username":"knagar", "name":"Kuldeep Nagar", "email":"Kuldeep.Nagar@marklogic.com"}, "to":{"username":"nobody", "name":"nobody nobody", "email":"nobody@marklogic.com"}}}, "files":[], "show":true, "comment":"Hey Arthur,\r\n\r\nThanks for the info, now I seeing correct error, updated AdminUIBug20983 for regression.\r\n\r\nThanks\r\nKuldeep\r\n\r\n"}, {"time":"2014-09-12T22:39:04.512168-07:00", "updatedBy":{"username":"rpelton", "name":"Rick Pelton", "email":"rick.pelton@marklogic.com"}, "change":{"status":{"from":"Ship", "to":"Closed"}, "assignTo":{"from":{"username":"rpelton", "name":"Rick Pelton", "email":"rick.pelton@marklogic.com"}, "to":{"username":"nobody", "name":"nobody nobody", "email":"nobody@marklogic.com"}}}, "files":[], "show":true, "comment":"ga"}], "updatedAt":"2014-09-12T22:39:04.512168-07:00", "fixedAt":"2014-08-29T14:05:08.64668-07:00", "fixedBy":{"username":"atsoi", "name":"Arthur Tsoi", "email":"arthur.tsoi@marklogic.com"}, "shippedAt":"2014-08-29T21:51:12.335969-07:00", "shippedBy":{"username":"knagar", "name":"Kuldeep Nagar", "email":"Kuldeep.Nagar@marklogic.com"}, "closedAt":"2014-09-12T22:39:04.512168-07:00", "closedBy":{"username":"rpelton", "name":"Rick Pelton", "email":"rick.pelton@marklogic.com"}, "renderDescriptionAs":"normal"}
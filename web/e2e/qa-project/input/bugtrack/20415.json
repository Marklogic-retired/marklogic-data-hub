{"id":20415, "kind":"Bug", "createdAt":"2013-01-09T14:42:03.95708-08:00", "status":"Closed", "title":"REGR: REST server suppreses response body on PUT request", "category":"MarkLogic REST API", "severity":"Major", "priority":{"level":"5", "title":""}, "submittedBy":{"username":"vkorolev", "name":"Vitaly Korolev", "email":"vitaly.korolev@marklogic.com"}, "assignTo":{"username":"nobody", "name":"nobody nobody", "email":"nobody@marklogic.com"}, "description":"Some REST API endpoints return content in the message body. (e.g. /v1/config/transforms and /v1/config/resources) For example, transforms endpoint returns 'true' when transformation is successfully created. It seems that one of the recent check-ins changed this behavior and nothing is returned in the message body. According to Erik REST API is functioning correctly since function that creates the transform is the one that returns 'true'.\r\n\r\nHere is an example response with 'true' in the message body:\r\n<response xmlns=\"xdmp:http\">\r\n    <code>204</code>\r\n    <message>Transform Created</message>\r\n    <headers>\r\n      <server>MarkLogic</server>\r\n      <content-type>text/plain; charset=UTF-8</content-type>\r\n      <content-length>4</content-length>\r\n      <connection>close</connection>\r\n    </headers>\r\n  </response>\r\ntrue\r\n\r\nThe following sample queries can be used to quickly create a REST server and then create a transform in order to verify the missing message body.", "samplequery":"(: Create REST server.:)\r\nxquery version \"1.0-ml\";\r\nlet $payload := xdmp:quote(\r\n<rapi:rest-api xmlns:rapi=\"http://marklogic.com/rest-api\">\r\n    <rapi:name>rest-client-api-test</rapi:name>\r\n    <rapi:port>8888</rapi:port>\r\n</rapi:rest-api>\r\n)\r\nreturn\r\nxdmp:http-post(\"http://localhost:8002/v1/rest-apis\",\r\n     <options xmlns=\"xdmp:http\">\r\n       <authentication method=\"digest\">\r\n         <username>admin</username>\r\n         <password>admin</password>\r\n       </authentication>\r\n       <data>{$payload}</data>\r\n       <headers>\r\n         <content-type>application/xml</content-type>\r\n       </headers>\r\n     </options>)\r\n\r\n(: Create a simple transform.:)\r\nxquery version \"1.0-ml\";\r\nlet $payload := '\r\nxquery version \"1.0-ml\";\r\nmodule namespace example=\"http://marklogic.com/rest-api/transform/test\";\r\n \r\ndeclare function example:transform(\r\n  $context as map:map,\r\n  $params as map:map,\r\n  $content as document-node()\r\n) as document-node()\r\n{\r\n  document {\r\n    for $key in map:keys($context)\r\n    return element {xs:QName($key)} { map:get($context, $key) }\r\n  }\r\n};'\r\nlet $options :=\r\n     <options xmlns=\"xdmp:http\">\r\n       <authentication method=\"digest\">\r\n         <username>admin</username>\r\n         <password>admin</password>\r\n       </authentication>\r\n       <data>{$payload}</data>\r\n       <headers>\r\n         <content-type>application/xquery</content-type>\r\n       </headers>\r\n     </options>\r\nreturn xdmp:http-put( \"http://localhost:8888/v1/config/transforms/test\", $options )\r\n\r\n(: Remove REST server.:)\r\nxquery version \"1.0-ml\";\r\nlet $server-name := \"rest-client-api-test\"\r\nreturn xdmp:http-delete( fn:concat(\"http://localhost:8002/v1/rest-apis/\", $server-name, \"?include=content&amp;include=modules\") ,\r\n     <options xmlns=\"xdmp:http\">\r\n       <authentication method=\"digest\">\r\n         <username>admin</username>\r\n         <password>admin</password>\r\n       </authentication>\r\n     </options>)[1]", "sampledata":"", "version":"7.0-nightly", "tofixin":"7.0-1", "fixedin":"N/A", "platform":"all", "memory":"", "processors":"", "note":"", "subscribers":[{"username":"vkorolev", "name":"Vitaly Korolev", "email":"vitaly.korolev@marklogic.com"}, {"username":"ehennum", "name":"Erik Hennum", "email":"erik.hennum@marklogic.com"}, {"username":"hwu", "name":"Haitao Wu", "email":"haitao.wu@marklogic.com"}], "attachments":[], "relationships":[{"type":"", "to":""}], "clones":[], "cloneOf":"", "support":{"headline":"", "supportDescription":"", "publishStatus":"Not Ready", "tickets":[], "customerImpact":{"level":"N/A", "title":""}, "workaround":""}, "tags":["MarkLogic REST API", "vkorolev"], "changeHistory":[{"time":"2013-01-09T14:42:03.95708-08:00", "updatedBy":{"username":"vkorolev", "name":"Vitaly Korolev", "email":"vitaly.korolev@marklogic.com"}, "change":{"assignTo":{"from":{"username":"vkorolev", "name":"Vitaly Korolev", "email":"vitaly.korolev@marklogic.com"}, "to":{"username":"hwu", "name":"Haitao Wu", "email":"haitao.wu@marklogic.com"}}}, "files":[], "show":true}, {"time":"2013-02-20T12:08:28.854077-08:00", "updatedBy":{"username":"hwu", "name":"Haitao Wu", "email":"haitao.wu@marklogic.com"}, "change":{}, "files":[], "show":true, "comment":"Is this bug for 7.0-EA1 or 7.0-1? It has REGR in the title but the \"to-fix-in\" is set to 7.0-1.  "}, {"time":"2013-02-20T12:16:44.200589-08:00", "updatedBy":{"username":"vkorolev", "name":"Vitaly Korolev", "email":"vitaly.korolev@marklogic.com"}, "change":{}, "files":[], "show":true, "comment":"Should be EA1"}, {"time":"2013-02-20T12:16:44.200589-08:00", "updatedBy":{"username":"vkorolev", "name":"Vitaly Korolev", "email":"vitaly.korolev@marklogic.com"}, "change":{"tofixin":{"from":"7.0-1", "to":"7.0-ea1"}}, "files":[], "show":true}, {"time":"2013-02-20T12:34:16.422685-08:00", "updatedBy":{"username":"ehennum", "name":"Erik Hennum", "email":"erik.hennum@marklogic.com"}, "change":{}, "files":[], "show":true, "comment":"I was wrong in my previous assertion.  When the response is 204, the server application\r\nshould not emit a response body.   Please see the discussion in:\r\n\r\nhttp://bugtrack.marklogic.com/20553\r\n"}, {"time":"2013-02-20T12:34:16.422685-08:00", "updatedBy":{"username":"ehennum", "name":"Erik Hennum", "email":"erik.hennum@marklogic.com"}, "change":{"tofixin":{"from":"7.0-ea1", "to":"7.0-1"}}, "files":[], "show":true}, {"time":"2013-02-20T12:43:11.398563-08:00", "updatedBy":{"username":"vkorolev", "name":"Vitaly Korolev", "email":"vitaly.korolev@marklogic.com"}, "change":{"status":{"from":"", "to":"Closed"}, "assignTo":{"from":{"username":"vkorolev", "name":"Vitaly Korolev", "email":"vitaly.korolev@marklogic.com"}, "to":{"username":"nobody", "name":"nobody nobody", "email":"nobody@marklogic.com"}}}, "files":[], "show":true, "comment":"As described in bug 20553 this is not a bug. I'll update keys for corresponding tests."}, {"time":"2013-02-20T12:43:11.398563-08:00", "updatedBy":{"username":"vkorolev", "name":"Vitaly Korolev", "email":"vitaly.korolev@marklogic.com"}, "change":{"assignTo":{"from":{"username":"vkorolev", "name":"Vitaly Korolev", "email":"vitaly.korolev@marklogic.com"}, "to":{"username":"nobody", "name":"nobody nobody", "email":"nobody@marklogic.com"}}}, "files":[], "show":true}, {"time":"2013-02-20T16:36:59.16357-08:00", "updatedBy":{"username":"vkorolev", "name":"Vitaly Korolev", "email":"vitaly.korolev@marklogic.com"}, "change":{}, "files":[], "show":true, "svn":{"repository":"/project/engsvn", "revision":"132727", "paths":["qa/trunk/scripts/keys/rest-client-api-security-03.xml", "qa/trunk/scripts/keys/rest-client-api-security-02.xml", "qa/trunk/scripts/keys/rest-client-api-srg.xml", "qa/trunk/scripts/keys/rest-client-api-transforms-02.xml", "qa/trunk/scripts/keys/rest-client-api-resources-bugs.xml", "qa/trunk/scripts/keys/rest-client-api-transforms-03.xml", "qa/trunk/scripts/keys/rest-client-api-transforms-01.xml", "qa/trunk/scripts/keys/rest-client-api-security-04.xml", "qa/trunk/scripts/keys/rest-client-api-resources-03.xml", "qa/trunk/scripts/keys/rest-client-api-transforms-bugs.xml", "qa/trunk/scripts/keys/rest-client-api-security-01.xml", "qa/trunk/scripts/keys/rest-client-api-resources-01.xml"], "affectedBugs":[]}, "comment":"According to resolution of bug:20415 this is not an issue."}], "updatedAt":"2013-02-20T16:36:59.16357-08:00", "closedAt":"2013-02-20T12:43:11.398563-08:00", "closedBy":{"username":"vkorolev", "name":"Vitaly Korolev", "email":"vitaly.korolev@marklogic.com"}, "renderDescriptionAs":"normal", "renderSampleQueryAs":"normal"}
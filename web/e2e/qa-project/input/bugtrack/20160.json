{"id":20160, "kind":"Bug", "createdAt":"2012-11-29T02:21:17.627829-08:00", "status":"Closed", "title":"cts:score is being evaluated higher than what is expected", "category":"", "severity":"Critical", "priority":{"level":"5", "title":""}, "submittedBy":{"username":"iagrawal", "name":"Isha Agrawal", "email":"iagrawal@marklogic.com"}, "assignTo":{"username":"nobody", "name":"nobody nobody", "email":"nobody@marklogic.com"}, "description":"cts:score is being evaluated higher than what is expected.\r\n\r\nTest Name: bug6433.xml\r\nMl Version: 7.0-20121127\r\nMachine Name: rh6-intel64-51-test-3\r\nPath to Logs: /space/builder/builds/linux64/HEAD/logs.20121127.2\r\n\r\nSteps to reproduce:\r\n\r\n1. create new db say bug6433DB.\r\n2. create a new forest say bug6433.\r\n3. associated forest with the db.\r\n4. associate database with xdbc server.\r\n5. set add-word-query-included-element:\r\n\t\txquery version \"1.0-ml\";\r\n        declare namespace admin=\"http://marklogic.com/xdmp/admin\";\r\n        import module \"http://marklogic.com/xdmp/admin\" at \"/MarkLogic/admin.xqy\";\r\n        let $config := admin:get-configuration()\r\n        let $dbid := xdmp:database(\"bug6433DB\")\r\n        let $fieldspec :=   admin:database-included-element(\"\",\"lowrel\", .5 , \"\", \"\", \"\")\r\n        let $c := admin:database-add-word-query-included-element($config, $dbid,  $fieldspec)\r\n        let $fieldspec :=   admin:database-included-element(\"\",\"highrel\", 2.0 , \"\", \"\", \"\")\r\n        let $c := admin:database-add-word-query-included-element($c, $dbid,  $fieldspec)\r\n        return\r\n          admin:save-configuration($c)\r\n\r\n6. Run following query:\r\n\txdmp:document-insert(\"highrel.xml\", <root><highrel>foo</highrel></root>),\r\n\txdmp:document-insert(\"midrel.xml\", <root><midrel>foo</midrel></root>),\r\n\txdmp:document-insert(\"lowrel.xml\", <root><lowrel>foo</lowrel></root>);\r\n\tfor $r in cts:search(doc((\"highrel.xml\", \"midrel.xml\", \"lowrel.xml\")), \"foo\") return element result { element score {cts:score($r)}, element uri {fn:document-uri($r)}}\r\n\t\r\n\r\nResults returned by query:\r\n\t\r\n<result><score>23296</score><uri>highrel.xml</uri></result><result><score>19712</score><uri>midrel.xml</uri></result><result><score>14336</score><uri>lowrel.xml</uri></result>\r\n\r\nExpected result:\r\n<result><score>19712</score><uri>highrel.xml</uri></result><result><score>14336</score><uri>midrel.xml</uri></result><result><score>10752</score><uri>lowrel.xml</uri></result>\r\n\r\nNote: The following tests are also failing as the actual result have higher score : bug5129.xml,bug_scripts8.xml,bug6553.xml,quality.xml,bug6465.xml,bug4555.xml,bug4067.xml,bug13580.xml,bug6496.xml,bug_scripts9.xml,bug10698.xml", "samplequery":"", "sampledata":"", "version":"7.0-nightly", "tofixin":"7.0-ea1", "fixedin":"7.0-ea1", "platform":"linux(64-bit)", "memory":"", "processors":"", "note":"", "subscribers":[{"username":"iagrawal", "name":"Isha Agrawal", "email":"iagrawal@marklogic.com"}, {"username":"gchinchwadkar", "name":"Gajanan Chinchwadkar", "email":"Gajanan.Chinchwadkar@marklogic.com"}], "attachments":[], "relationships":[{"type":"", "to":""}], "clones":[], "cloneOf":"", "support":{"headline":"", "supportDescription":"", "publishStatus":"Not Ready", "tickets":[], "customerImpact":{"level":"N/A", "title":""}, "workaround":""}, "tags":["", "iagrawal"], "changeHistory":[{"time":"2012-11-29T02:21:17.627829-08:00", "updatedBy":{"username":"iagrawal", "name":"Isha Agrawal", "email":"iagrawal@marklogic.com"}, "change":{"assignTo":{"from":{"username":"iagrawal", "name":"Isha Agrawal", "email":"iagrawal@marklogic.com"}, "to":{"username":"gchinchwadkar", "name":"Gajanan Chinchwadkar", "email":"Gajanan.Chinchwadkar@marklogic.com"}}}, "files":[], "show":true}, {"time":"2012-12-02T09:36:43.256534-08:00", "updatedBy":{"username":"gchinchwadkar", "name":"Gajanan Chinchwadkar", "email":"Gajanan.Chinchwadkar@marklogic.com"}, "change":{}, "files":[], "show":true, "svn":{"repository":"/project/engsvn", "revision":"122360", "paths":["xdmp/trunk/src/Indexer.cpp"], "affectedBugs":[]}, "comment":"Fix for bug:20160.\n"}, {"time":"2012-12-02T09:41:32.853525-08:00", "updatedBy":{"username":"gchinchwadkar", "name":"Gajanan Chinchwadkar", "email":"Gajanan.Chinchwadkar@marklogic.com"}, "change":{"status":{"from":"", "to":"Test"}, "assignTo":{"from":{"username":"gchinchwadkar", "name":"Gajanan Chinchwadkar", "email":"Gajanan.Chinchwadkar@marklogic.com"}, "to":{"username":"iagrawal", "name":"Isha Agrawal", "email":"iagrawal@marklogic.com"}}}, "files":[], "show":true, "comment":"Test bug6433.xml: Passed\r\nTest bug5129.xml: Passed\r\n"}, {"time":"2012-12-02T09:41:32.853525-08:00", "updatedBy":{"username":"gchinchwadkar", "name":"Gajanan Chinchwadkar", "email":"Gajanan.Chinchwadkar@marklogic.com"}, "change":{"assignTo":{"from":{"username":"gchinchwadkar", "name":"Gajanan Chinchwadkar", "email":"Gajanan.Chinchwadkar@marklogic.com"}, "to":{"username":"iagrawal", "name":"Isha Agrawal", "email":"iagrawal@marklogic.com"}}}, "files":[], "show":true}, {"time":"2012-12-04T01:19:35.774355-08:00", "updatedBy":{"username":"iagrawal", "name":"Isha Agrawal", "email":"iagrawal@marklogic.com"}, "change":{"status":{"from":"", "to":"Ship"}, "assignTo":{"from":{"username":"iagrawal", "name":"Isha Agrawal", "email":"iagrawal@marklogic.com"}, "to":{"username":"nobody", "name":"nobody nobody", "email":"nobody@marklogic.com"}}}, "files":[], "show":true, "comment":"Verified on ML version 7.0-20121203. The tests are getting passed with correct results. Hence,shipping the bug."}], "updatedAt":"2012-12-04T01:19:35.774355-08:00", "fixedAt":"2012-12-02T09:41:32.853525-08:00", "fixedBy":{"username":"gchinchwadkar", "name":"Gajanan Chinchwadkar", "email":"Gajanan.Chinchwadkar@marklogic.com"}, "shippedAt":"2012-12-04T01:19:35.774355-08:00", "shippedBy":{"username":"iagrawal", "name":"Isha Agrawal", "email":"iagrawal@marklogic.com"}, "renderDescriptionAs":"normal"}
{"id":20896, "kind":"Bug", "createdAt":"2013-02-22T04:27:32.229878-08:00", "status":"Closed", "title":"Memory Mapped Structure not removed from disk ( Windows ) ", "category":"xdmp", "severity":"Performance", "priority":{"level":"3", "title":""}, "submittedBy":{"username":"ktune", "name":"Ken Tune", "email":"Ken.Tune@marklogic.com"}, "assignTo":{"username":"nobody", "name":"nobody nobody", "email":"nobody@marklogic.com"}, "description":"I've been trying to confirm that when the collection lexicon is disabled, it is removed from memory and from disk. This seems just fine on RedHat using 6.0-1.1.\r\n\r\nHowever using 6.0-2 on my laptop ( Windows ) I get mixed results.\r\n\r\nI have a four forest DB. I have enabled the collection lexicon. I then remove it. The forests automatically re-index ( I can see this - so I get new stands ) .\r\n\r\nI manually merge. My new stands ( I have just one per forest ) still contain files 702c7a5fff541f5e-string and 702c7a5fff541f5e-string- ( which is the collection lexicon ) . I can't tell if they're memory mapped or not on Windows ( is there a pmap equivalent  ? ) \r\n\r\nI don't seem to get this behaviour with one db / one forest - my results are mixed here. I have two dbs with more than one forest and they both exhibit the above behaviour.\r\n\r\nHappy to send through any additional materials requested.\r\n\r\nI've gone into this in detail as a customer has enabled the collection lexicon ( when they have v. large numbers of collections per document ) resulting in excessive memory usage. I've wanted to be sure that turning the collection lexicon off will resolve - my initial local attempts ( as above ) have meant I was uneasy that it would, but my experiments on RedHat subsequently were entirely successful.\r\n\r\nThe key thing is that the memory mapping disappears - but on Windows I can't tell, and the residual files mean I'm not sure.\r\n\r\nKen\r\n", "samplequery":"", "sampledata":"", "version":"6.0-2", "tofixin":"7.0-2", "fixedin":"N/A", "platform":"windows(64-bit)", "memory":"8Gb", "processors":"1", "note":"", "subscribers":[{"username":"ktune", "name":"Ken Tune", "email":"Ken.Tune@marklogic.com"}, {"username":"gchinchwadkar", "name":"Gajanan Chinchwadkar", "email":"Gajanan.Chinchwadkar@marklogic.com"}, {"username":"mary", "name":"Mary Holstege", "email":"mary@cerisent.com"}, {"username":"rhu", "name":"Ron Hu", "email":"ron.hu@marklogic.com"}, {"username":"hwu", "name":"Haitao Wu", "email":"haitao.wu@marklogic.com"}], "attachments":[], "relationships":[{"type":"", "to":""}], "clones":[], "cloneOf":"", "support":{"headline":"", "supportDescription":"", "publishStatus":"Not Ready", "tickets":[], "customerImpact":{"level":"N/A", "title":""}, "workaround":""}, "tags":["xdmp", "ktune"], "changeHistory":[{"time":"2013-02-22T12:05:11.308259-08:00", "updatedBy":{"username":"dsokolsky", "name":"Danny Sokolsky", "email":"dsokolsky@marklogic.com"}, "change":{"status":{"from":"", "to":"Verify"}, "assignTo":{"from":{"username":"dsokolsky", "name":"Danny Sokolsky", "email":"dsokolsky@marklogic.com"}, "to":{"username":"rhu", "name":"Ron Hu", "email":"ron.hu@marklogic.com"}}}, "files":[], "show":true}, {"time":"2013-02-22T12:05:11.308259-08:00", "updatedBy":{"username":"dsokolsky", "name":"Danny Sokolsky", "email":"dsokolsky@marklogic.com"}, "change":{"assignTo":{"from":{"username":"dsokolsky", "name":"Danny Sokolsky", "email":"dsokolsky@marklogic.com"}, "to":{"username":"rhu", "name":"Ron Hu", "email":"ron.hu@marklogic.com"}}}, "files":[], "show":true}, {"time":"2013-02-22T12:05:11.308259-08:00", "updatedBy":{"username":"dsokolsky", "name":"Danny Sokolsky", "email":"dsokolsky@marklogic.com"}, "change":{"tofixin":{"from":"", "to":"6.0-3"}}, "files":[], "show":true}, {"time":"2013-02-22T12:59:36.477541-08:00", "updatedBy":{"username":"rhu", "name":"Ron Hu", "email":"ron.hu@marklogic.com"}, "change":{"assignTo":{"from":{"username":"rhu", "name":"Ron Hu", "email":"ron.hu@marklogic.com"}, "to":{"username":"mary", "name":"Mary Holstege", "email":"mary@cerisent.com"}}}, "files":[], "show":true}, {"time":"2013-02-28T12:35:03.337934-08:00", "updatedBy":{"username":"rhu", "name":"Ron Hu", "email":"ron.hu@marklogic.com"}, "change":{"tofixin":{"from":"6.0-3", "to":"6.0-4"}}, "files":[], "show":true}, {"time":"2013-06-24T14:43:13.92874-07:00", "updatedBy":{"username":"dsokolsky", "name":"Danny Sokolsky", "email":"dsokolsky@marklogic.com"}, "change":{"assignTo":{"from":{"username":"dsokolsky", "name":"Danny Sokolsky", "email":"dsokolsky@marklogic.com"}, "to":{"username":"gchinchwadkar", "name":"Gajanan Chinchwadkar", "email":"Gajanan.Chinchwadkar@marklogic.com"}}}, "files":[], "show":true}, {"time":"2013-06-24T14:43:13.92874-07:00", "updatedBy":{"username":"dsokolsky", "name":"Danny Sokolsky", "email":"dsokolsky@marklogic.com"}, "change":{"tofixin":{"from":"6.0-4", "to":"7.0-1"}}, "files":[], "show":true}, {"time":"2013-08-30T13:09:23.909698-07:00", "updatedBy":{"username":"gchinchwadkar", "name":"Gajanan Chinchwadkar", "email":"Gajanan.Chinchwadkar@marklogic.com"}, "change":{}, "files":[], "show":true, "comment":"This is not a must for 7.0.1. We need to do some research to understand the behavior on windows. High chance is that there is nothing to fix for us."}, {"time":"2013-09-11T12:10:02.538446-07:00", "updatedBy":{"username":"gchinchwadkar", "name":"Gajanan Chinchwadkar", "email":"Gajanan.Chinchwadkar@marklogic.com"}, "change":{}, "files":[], "show":true, "comment":"Moving out of 7.0.1 radar."}, {"time":"2013-09-11T12:10:02.538446-07:00", "updatedBy":{"username":"gchinchwadkar", "name":"Gajanan Chinchwadkar", "email":"Gajanan.Chinchwadkar@marklogic.com"}, "change":{"tofixin":{"from":"7.0-1", "to":"7.0-2"}}, "files":[], "show":true}, {"time":"2013-11-12T11:49:46.312799-08:00", "updatedBy":{"username":"gchinchwadkar", "name":"Gajanan Chinchwadkar", "email":"Gajanan.Chinchwadkar@marklogic.com"}, "change":{}, "files":[], "show":true, "comment":"Ken,\r\n\r\nDo you still have a repro for this?"}, {"time":"2013-11-13T06:35:31.335175-08:00", "updatedBy":{"username":"gchinchwadkar", "name":"Gajanan Chinchwadkar", "email":"Gajanan.Chinchwadkar@marklogic.com"}, "change":{"assignTo":{"from":{"username":"gchinchwadkar", "name":"Gajanan Chinchwadkar", "email":"Gajanan.Chinchwadkar@marklogic.com"}, "to":{"username":"hwu", "name":"Haitao Wu", "email":"haitao.wu@marklogic.com"}}}, "files":[], "show":true}, {"time":"2013-11-14T07:10:29.557465-08:00", "updatedBy":{"username":"gchinchwadkar", "name":"Gajanan Chinchwadkar", "email":"Gajanan.Chinchwadkar@marklogic.com"}, "change":{"status":{"from":"", "to":"Closed"}, "assignTo":{"from":{"username":"gchinchwadkar", "name":"Gajanan Chinchwadkar", "email":"Gajanan.Chinchwadkar@marklogic.com"}, "to":{"username":"nobody", "name":"nobody nobody", "email":"nobody@marklogic.com"}}}, "files":[], "show":true, "comment":"Not reproducible. Please see the response from Ken. Suggested to Ken to reopen it if he sees it again.\r\n\r\nFrom: Ken Tune \r\nSent: Thursday, November 14, 2013 6:58 AM\r\nTo: Gajanan Chinchwadkar; Mary Holstege\r\nSubject: RE: Bug 20896 Change Notification\r\n\r\nGajanan\r\n\r\nI repeated my previous test using 6.0.4 ( previously 6.0.2 ) \r\n\r\nI have a four forest DB. I have enabled the collection lexicon. I then remove it. The forests automatically re-index ( I can see this - so I get new stands ) . \r\n \r\nI manually merge.\r\n\r\nThe collection lexicon disappears. It previously did not. So I guess I now canâ€™t reproduce. Fixed?\r\n\r\nKen"}, {"time":"2013-11-14T07:10:29.557465-08:00", "updatedBy":{"username":"gchinchwadkar", "name":"Gajanan Chinchwadkar", "email":"Gajanan.Chinchwadkar@marklogic.com"}, "change":{"assignTo":{"from":{"username":"gchinchwadkar", "name":"Gajanan Chinchwadkar", "email":"Gajanan.Chinchwadkar@marklogic.com"}, "to":{"username":"nobody", "name":"nobody nobody", "email":"nobody@marklogic.com"}}}, "files":[], "show":true}], "updatedAt":"2013-11-14T07:10:29.557465-08:00", "closedAt":"2013-11-14T07:10:29.557465-08:00", "closedBy":{"username":"gchinchwadkar", "name":"Gajanan Chinchwadkar", "email":"Gajanan.Chinchwadkar@marklogic.com"}, "renderDescriptionAs":"normal"}
{"id":20907, "kind":"Bug", "createdAt":"2013-02-22T13:59:54.852611-08:00", "status":"Closed", "title":"timeout when displaying thousands of protected collections", "category":"adminGUI", "severity":"Major", "priority":{"level":"5", "title":""}, "submittedBy":{"username":"jespinoza", "name":"Jose Espinoza", "email":"jespinoza@marklogic.com"}, "assignTo":{"username":"nobody", "name":"nobody nobody", "email":"nobody@marklogic.com"}, "description":"The Admin UI times out when there are several thousand collections while trying to display them in t his page:\r\n\r\nAdmin UI -> Security -> collections\r\n\r\nIt seems the algorithm does not scale for thousands of collections.", "samplequery":"", "sampledata":"", "version":"5.0-3", "tofixin":"5.0-6", "fixedin":"5.0-6", "platform":"linux(64-bit)", "memory":"", "processors":"", "note":"Reported by Kevin Fries of Catalyst as support case 12535.", "subscribers":[{"username":"jespinoza", "name":"Jose Espinoza", "email":"jespinoza@marklogic.com"}, {"username":"msarma", "name":"Meghalim Sarma", "email":"msarma@marklogic.com"}, {"username":"mdubinko", "name":"Micah  Dubinko", "email":"mdubinko@marklogic.com"}], "attachments":[], "relationships":[{"type":"", "to":""}], "clones":[20927], "cloneOf":"", "support":{"headline":"Administration UI times out with large number of collections", "supportDescription":"Viewing a large number of protected collection in the administration UI (under Security -> Collections) could result in browser timing out. In order to prevent such time out, only 250 collections will be displayed.", "publishStatus":"Publish", "tickets":[], "customerImpact":{"level":"Low", "title":"Minimal business impact or reasonable workaround is available"}, "workaround":""}, "tags":["adminGUI", "jespinoza"], "changeHistory":[{"time":"2013-02-22T14:53:46.641706-08:00", "updatedBy":{"username":"dsokolsky", "name":"Danny Sokolsky", "email":"dsokolsky@marklogic.com"}, "change":{"status":{"from":"", "to":"Verify"}, "assignTo":{"from":{"username":"dsokolsky", "name":"Danny Sokolsky", "email":"dsokolsky@marklogic.com"}, "to":{"username":"mdubinko", "name":"Micah  Dubinko", "email":"mdubinko@marklogic.com"}}}, "files":[], "show":true, "comment":"Note that this displays protected collections."}, {"time":"2013-02-22T14:53:46.641706-08:00", "updatedBy":{"username":"dsokolsky", "name":"Danny Sokolsky", "email":"dsokolsky@marklogic.com"}, "change":{"assignTo":{"from":{"username":"dsokolsky", "name":"Danny Sokolsky", "email":"dsokolsky@marklogic.com"}, "to":{"username":"mdubinko", "name":"Micah  Dubinko", "email":"mdubinko@marklogic.com"}}}, "files":[], "show":true}, {"time":"2013-02-22T14:53:46.641706-08:00", "updatedBy":{"username":"dsokolsky", "name":"Danny Sokolsky", "email":"dsokolsky@marklogic.com"}, "change":{"tofixin":{"from":"", "to":"5.0-6"}}, "files":[], "show":true}, {"time":"2013-02-22T15:00:41.220414-08:00", "updatedBy":{"username":"rpelton", "name":"Rick Pelton", "email":"rick.pelton@marklogic.com"}, "change":{}, "files":[], "show":true, "comment":"cloning to 6.0 branch"}, {"time":"2013-02-25T14:11:36.442904-08:00", "updatedBy":{"username":"jespinoza", "name":"Jose Espinoza", "email":"jespinoza@marklogic.com"}, "change":{}, "files":[], "show":true, "comment":"Customer is asking about this issue. Setting To-Fix-In to '5.0-5'.\r\n\r\nAlso, customer is asking how many collections it takes before it stops scaling."}, {"time":"2013-02-25T14:11:36.442904-08:00", "updatedBy":{"username":"jespinoza", "name":"Jose Espinoza", "email":"jespinoza@marklogic.com"}, "change":{"tofixin":{"from":"5.0-6", "to":"5.0-5"}}, "files":[], "show":true}, {"time":"2013-02-25T17:28:44.255493-08:00", "updatedBy":{"username":"rpelton", "name":"Rick Pelton", "email":"rick.pelton@marklogic.com"}, "change":{"tofixin":{"from":"5.0-5", "to":"5.0-6"}}, "files":[], "show":true}, {"time":"2013-07-15T21:02:12.530714-07:00", "updatedBy":{"username":"gvaidees", "name":"Ganesh Vaideeswaran", "email":"Ganesh.Vaideeswaran@marklogic.com"}, "change":{}, "files":[], "show":true, "svn":{"repository":"/project/engsvn", "revision":"146803", "paths":["xdmp/branches/b6_0/src/Admin/lib/collection-summary-form.xqy", "xdmp/branches/b6_0/src/Admin/lib/nav-format.xqy"], "affectedBugs":[]}, "comment":"Bug:20907 -  timeout when displaying thousands of protected collections"}, {"time":"2013-07-15T21:11:18.402202-07:00", "updatedBy":{"username":"gvaidees", "name":"Ganesh Vaideeswaran", "email":"Ganesh.Vaideeswaran@marklogic.com"}, "change":{}, "files":[], "show":true, "svn":{"repository":"/project/engsvn", "revision":"146806", "paths":["xdmp/branches/b5_0/src/Admin/lib/nav-format.xqy", "xdmp/branches/b5_0/src/Admin/lib/collection-summary-form.xqy"], "affectedBugs":[]}, "comment":"Bug:20907 -  timeout when displaying thousands of protected collections"}, {"time":"2013-07-15T21:11:29.410117-07:00", "updatedBy":{"username":"gvaidees", "name":"Ganesh Vaideeswaran", "email":"Ganesh.Vaideeswaran@marklogic.com"}, "change":{}, "files":[], "show":true, "comment":"Above commit is for 6.0-4 not 5.0-6"}, {"time":"2013-07-15T21:11:56.190294-07:00", "updatedBy":{"username":"gvaidees", "name":"Ganesh Vaideeswaran", "email":"Ganesh.Vaideeswaran@marklogic.com"}, "change":{"status":{"from":"", "to":"Test"}, "assignTo":{"from":{"username":"gvaidees", "name":"Ganesh Vaideeswaran", "email":"Ganesh.Vaideeswaran@marklogic.com"}, "to":{"username":"msarma", "name":"Meghalim Sarma", "email":"msarma@marklogic.com"}}}, "files":[], "show":true}, {"time":"2013-07-15T21:11:56.190294-07:00", "updatedBy":{"username":"gvaidees", "name":"Ganesh Vaideeswaran", "email":"Ganesh.Vaideeswaran@marklogic.com"}, "change":{"assignTo":{"from":{"username":"gvaidees", "name":"Ganesh Vaideeswaran", "email":"Ganesh.Vaideeswaran@marklogic.com"}, "to":{"username":"msarma", "name":"Meghalim Sarma", "email":"msarma@marklogic.com"}}}, "files":[], "show":true}, {"time":"2013-08-15T18:50:54.469794-07:00", "updatedBy":{"username":"msarma", "name":"Meghalim Sarma", "email":"msarma@marklogic.com"}, "change":{}, "files":[], "show":true, "comment":"Kuldeep can you verify this bugs. Steps below:\r\n\r\n1. Run these queries in QC to create 500 protected collections:\r\nxdmp:document-insert(\"/a.xml\",<doc>hello</doc>);\r\nfor $i in 1 to 500\r\nreturn xdmp:document-add-collections(\r\n    \"/a.xml\", \r\n    concat(\"http://examples-\",$i,\".com\")); \r\n \r\n(: make those 500 collections protected :)\r\nxquery version \"1.0-ml\";\r\nimport module namespace sec=\"http://marklogic.com/xdmp/security\" at \"/MarkLogic/security.xqy\";\r\nfor $i in 1 to 500\r\nreturn sec:protect-collection(concat(\"http://examples-\",$i,\".com\"), \r\n                       (xdmp:permission(\"app-user\", \"read\"), \r\n                        xdmp:permission(\"app-user\", \"insert\")))\r\n\r\n2. Go to Admin UI -> Security -> collections\r\nVerify that Admin GUI now displays 250 collections with an message indicating that not all collections are seen here (Only 250 of 506 collections displayed )\r\n\r\n3. Verify that http://<host>:8001/collection-summary.xqy?section=security&count=500 displays all the collections\r\n"}, {"time":"2013-08-15T18:50:54.469794-07:00", "updatedBy":{"username":"msarma", "name":"Meghalim Sarma", "email":"msarma@marklogic.com"}, "change":{"assignTo":{"from":{"username":"msarma", "name":"Meghalim Sarma", "email":"msarma@marklogic.com"}, "to":{"username":"knagar", "name":"Kuldeep Nagar", "email":"Kuldeep.Nagar@marklogic.com"}}}, "files":[], "show":true}, {"time":"2014-03-24T00:16:24.354186-07:00", "updatedBy":{"username":"knagar", "name":"Kuldeep Nagar", "email":"Kuldeep.Nagar@marklogic.com"}, "change":{"status":{"from":"", "to":"Ship"}, "assignTo":{"from":{"username":"knagar", "name":"Kuldeep Nagar", "email":"Kuldeep.Nagar@marklogic.com"}, "to":{"username":"nobody", "name":"nobody nobody", "email":"nobody@marklogic.com"}}}, "files":[], "show":true, "comment":"Verified and added AdminUIBug23151 for regression. However the default collections for b5_0 are 5 so changed the messages accordingly in test.\r\n\r\nThanks\r\nKuldeep"}, {"time":"2014-04-09T15:35:30.413526-07:00", "updatedBy":{"username":"rpelton", "name":"Rick Pelton", "email":"rick.pelton@marklogic.com"}, "change":{"status":{"from":"", "to":"Closed"}, "assignTo":{"from":{"username":"rpelton", "name":"Rick Pelton", "email":"rick.pelton@marklogic.com"}, "to":{"username":"nobody", "name":"nobody nobody", "email":"nobody@marklogic.com"}}}, "files":[], "show":true, "comment":"ga"}], "updatedAt":"2014-04-09T15:35:30.413526-07:00", "fixedAt":"2013-07-15T21:11:56.190294-07:00", "fixedBy":{"username":"gvaidees", "name":"Ganesh Vaideeswaran", "email":"Ganesh.Vaideeswaran@marklogic.com"}, "shippedAt":"2014-03-24T00:16:24.354186-07:00", "shippedBy":{"username":"knagar", "name":"Kuldeep Nagar", "email":"Kuldeep.Nagar@marklogic.com"}, "closedAt":"2014-04-09T15:35:30.413526-07:00", "closedBy":{"username":"rpelton", "name":"Rick Pelton", "email":"rick.pelton@marklogic.com"}, "renderDescriptionAs":"normal"}
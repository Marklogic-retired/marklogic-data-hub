{"id":20211, "kind":"Task", "createdAt":"2012-12-05T17:45:50.951793-08:00", "status":"Closed", "title":"Relax the requirement of UPDATE transaction mode when calling Session.insertContentCollectErrors().", "category":"XCC/Java", "severity":"Critical", "priority":{"level":"5", "title":""}, "days":null, "period":{"startDate":null, "endDate":null}, "submittedBy":{"username":"jchen", "name":"Jane Chen", "email":"jane.chen@marklogic.com"}, "assignTo":{"username":"nobody", "name":"nobody nobody", "email":"nobody@marklogic.com"}, "description":"Session.insertContentCollectErrors() requires that the session is in UPDATE transaction mode, otherwise it throws an exception.  It is desirable to relax that requirement.  If Session.insertContentCollectErrors() is called in AUTO mode, all successful insert requests will be committed, while failed ones will appear in the returned error list.", "samplequery":"", "sampledata":"", "version":"6.0-2", "tofixin":"6.0-3", "fixedin":"6.0-3", "platform":"all", "memory":"", "processors":"", "note":"", "subscribers":[{"username":"jchen", "name":"Jane Chen", "email":"jane.chen@marklogic.com"}, {"username":"ali", "name":"Aries Li", "email":"ali@marklogic.com"}], "attachments":[], "includeInTaskList":false, "proceduralTasks":{"Requirements Task":[], "Functional Specification Task":[], "Test Specification Task":[], "Test Automation Task":[], "Documentation Task":[]}, "subTasks":[], "tags":["XCC/Java", "jchen"], "changeHistory":[{"time":"2012-12-05T17:45:50.951793-08:00", "updatedBy":{"username":"jchen", "name":"Jane Chen", "email":"jane.chen@marklogic.com"}, "change":{"assignTo":{"from":{"username":"jchen", "name":"Jane Chen", "email":"jane.chen@marklogic.com"}, "to":{"username":"jchen", "name":"Jane Chen", "email":"jane.chen@marklogic.com"}}}, "files":[], "show":true}, {"time":"2012-12-07T14:30:49.201435-08:00", "updatedBy":{"username":"jchen", "name":"Jane Chen", "email":"jane.chen@marklogic.com"}, "change":{}, "files":[], "show":true, "svn":{"repository":"/project/engsvn", "revision":"123156", "paths":["xdmp/trunk/src/UpdateBuiltins.h", "xdmp/trunk/src/XDBCServer.cpp", "xdmp/trunk/src/TransactionBuiltins.h", "xdmp/trunk/src/TransactionBuiltins.cpp", "xdmp/trunk/src/UpdateBuiltins.cpp"], "affectedBugs":[]}, "comment":"Bug:20211 - Add support to tolerate errors in multiInserts.\n"}, {"time":"2012-12-07T16:01:08.518419-08:00", "updatedBy":{"username":"jchen", "name":"Jane Chen", "email":"jane.chen@marklogic.com"}, "change":{}, "files":[], "show":true, "svn":{"repository":"/project/engsvn", "revision":"123165", "paths":["xcc/trunk/xcc/src/junit/com/marklogic/xcc/impl/handlers/TestContentRequestEncode.java", "xcc/trunk/mlcp/src/main/java/com/marklogic/contentpump/ConfigConstants.java", "xcc/trunk/mlcp/src/main/java/com/marklogic/contentpump/ContentPump.java", "xcc/trunk/mapreduce/src/java/com/marklogic/mapreduce/MarkLogicConstants.java", "xcc/trunk/xcc/src/java/com/marklogic/xcc/impl/SessionImpl.java", "xcc/trunk/xcc/src/java/com/marklogic/xcc/impl/handlers/ContentInsertController.java", "xcc/trunk/mlcp/src/test/java/com/marklogic/contentpump/Constants.java", "xcc/trunk/mlcp/src/main/java/com/marklogic/contentpump/Command.java", "xcc/trunk/xcc/src/java/com/marklogic/xcc/Session.java", "xcc/trunk/api_tests/src/junit/com/marklogic/xcc/TestDocInsert.java"], "affectedBugs":[]}, "comment":"1) Bug:20211 - Relax the requirement of UPDATE transaction mode when calling Session.insertContentCollectErrors().\n2) Remove HADOOP_HOME as a config option.\n3) Add tolerate_errors as a config option.\n"}, {"time":"2012-12-07T16:05:56.885559-08:00", "updatedBy":{"username":"jchen", "name":"Jane Chen", "email":"jane.chen@marklogic.com"}, "change":{}, "files":[], "show":true, "comment":"Aries, I made the above changes so that we don't need to use multi-statement transaction by default when transaction size is 1.  Hopefully this should help the NOTXN issue.  Can you please pick up a nightly for both server and mlcp and try the test cases where you used to reproduce NOTXN?"}, {"time":"2012-12-07T16:05:56.885559-08:00", "updatedBy":{"username":"jchen", "name":"Jane Chen", "email":"jane.chen@marklogic.com"}, "change":{"assignTo":{"from":{"username":"jchen", "name":"Jane Chen", "email":"jane.chen@marklogic.com"}, "to":{"username":"ali", "name":"Aries Li", "email":"ali@marklogic.com"}}}, "files":[], "show":true}, {"time":"2012-12-07T16:10:48.673678-08:00", "updatedBy":{"username":"ali", "name":"Aries Li", "email":"ali@marklogic.com"}, "change":{}, "files":[], "show":true, "comment":"The nightly won't be available until tomorrow.\r\nMy local code based is messed up. Do you have a build at hand? I can test it later today. Otherwise, I won't be able to test it until next Wednesday."}, {"time":"2012-12-07T16:26:32.944715-08:00", "updatedBy":{"username":"jchen", "name":"Jane Chen", "email":"jane.chen@marklogic.com"}, "change":{"assignTo":{"from":{"username":"jchen", "name":"Jane Chen", "email":"jane.chen@marklogic.com"}, "to":{"username":"jchen", "name":"Jane Chen", "email":"jane.chen@marklogic.com"}}}, "files":[], "show":true}, {"time":"2012-12-07T17:25:36.51997-08:00", "updatedBy":{"username":"jchen", "name":"Jane Chen", "email":"jane.chen@marklogic.com"}, "change":{}, "files":[], "show":true, "comment":"Please just let me know which command/config is guaranteed to reproduce the NOTXN when you are done with the cluster and I'll give it a try instead."}, {"time":"2012-12-07T17:33:19.696597-08:00", "updatedBy":{"username":"jchen", "name":"Jane Chen", "email":"jane.chen@marklogic.com"}, "change":{}, "files":[], "show":true, "svn":{"repository":"/project/engsvn", "revision":"123181", "paths":["xcc/trunk/mapreduce/src/java/com/marklogic/mapreduce/ContentWriter.java"], "affectedBugs":[]}, "comment":"Bug:20211 - Add tolerate_errors as a config option.\n"}, {"time":"2012-12-07T20:12:24.868949-08:00", "updatedBy":{"username":"ali", "name":"Aries Li", "email":"ali@marklogic.com"}, "change":{}, "files":[], "show":true, "comment":"configurations to reproduce NOTXN\r\nxdbc server:\r\nkeep alive timeout 5\r\nthread 128 ( or less)\r\n\r\nmlcp 6.0-2:\r\nthread 160\r\nbatch 10\t\r\ntxn1"}, {"time":"2012-12-08T16:38:10.943829-08:00", "updatedBy":{"username":"jchen", "name":"Jane Chen", "email":"jane.chen@marklogic.com"}, "change":{}, "files":[], "show":true, "comment":"Does it matter which input directory is used?"}, {"time":"2012-12-09T22:28:15.228466-08:00", "updatedBy":{"username":"jchen", "name":"Jane Chen", "email":"jane.chen@marklogic.com"}, "change":{}, "files":[], "show":true, "svn":{"repository":"/project/engsvn", "revision":"123418", "paths":["xdmp/branches/b6_0/src/TransactionBuiltins.h", "xdmp/branches/b6_0/src/TransactionBuiltins.cpp", "xdmp/branches/b6_0/src/UpdateBuiltins.h", "xdmp/branches/b6_0/src/XDBCServer.cpp", "xdmp/branches/b6_0/src/UpdateBuiltins.cpp"], "affectedBugs":[]}, "comment":"Bug:20211 - Add support to tolerate errors in multiInserts.\n"}, {"time":"2012-12-09T22:34:34.876154-08:00", "updatedBy":{"username":"jchen", "name":"Jane Chen", "email":"jane.chen@marklogic.com"}, "change":{}, "files":[], "show":true, "svn":{"repository":"/project/engsvn", "revision":"123419", "paths":["xcc/branches/b6_0/xcc/src/java/com/marklogic/xcc/Session.java", "xcc/branches/b6_0/mapreduce/src/java/com/marklogic/mapreduce/MarkLogicConstants.java", "xcc/branches/b6_0/api_tests/src/junit/com/marklogic/xcc/TestDocInsert.java", "xcc/branches/b6_0/mlcp/src/test/java/com/marklogic/contentpump/Constants.java", "xcc/branches/b6_0/mlcp/src/main/java/com/marklogic/contentpump/ConfigConstants.java", "xcc/branches/b6_0/mlcp/src/main/java/com/marklogic/contentpump/Command.java", "xcc/branches/b6_0/mapreduce/src/java/com/marklogic/mapreduce/ContentWriter.java", "xcc/branches/b6_0/xcc/src/java/com/marklogic/xcc/impl/handlers/ContentInsertController.java", "xcc/branches/b6_0/xcc/src/java/com/marklogic/xcc/impl/SessionImpl.java", "xcc/branches/b6_0/xcc/src/junit/com/marklogic/xcc/impl/handlers/TestContentRequestEncode.java", "xcc/branches/b6_0/mlcp/src/main/java/com/marklogic/contentpump/ContentPump.java"], "affectedBugs":[]}, "comment":"1) Bug:20211 - Relax the requirement of UPDATE transaction mode when calling Session.insertContentCollectErrors().\n2) Remove HADOOP_HOME as a config option.\n3) Add tolerate_errors as a config option. \n"}, {"time":"2012-12-09T22:42:19.496538-08:00", "updatedBy":{"username":"jchen", "name":"Jane Chen", "email":"jane.chen@marklogic.com"}, "change":{}, "files":[], "show":true, "comment":"I ran cpox ingestion using the above config multiple times with the latest nightlies on trunk.  Never reproduced NOTXN.  Did ran into \"Premature EOF\" in the first few runs.  As each job got faster than the previous one, the last few runs were successful.  Client logs are kept in r01n01:/tmp/mlcp-*.log."}, {"time":"2012-12-13T17:33:08.381682-08:00", "updatedBy":{"username":"jchen", "name":"Jane Chen", "email":"jane.chen@marklogic.com"}, "change":{"status":{"from":"", "to":"Test"}, "assignTo":{"from":{"username":"jchen", "name":"Jane Chen", "email":"jane.chen@marklogic.com"}, "to":{"username":"lratcliff", "name":"Larry Ratcliff", "email":"lratcliff@marklogic.com"}}}, "files":[], "show":true, "comment":"The XDBC change is tested through JUnit test.  For mlcp, have an input directory with a mixture of good and invalid XML documents.  Use the following command to import them, and make sure that all valid documents are loaded:\r\n\r\nmlcp.sh import -transaction_size 1 -batch_size 2 -tolerate_errors ..."}, {"time":"2012-12-13T17:33:08.381682-08:00", "updatedBy":{"username":"jchen", "name":"Jane Chen", "email":"jane.chen@marklogic.com"}, "change":{"assignTo":{"from":{"username":"jchen", "name":"Jane Chen", "email":"jane.chen@marklogic.com"}, "to":{"username":"lratcliff", "name":"Larry Ratcliff", "email":"lratcliff@marklogic.com"}}}, "files":[], "show":true}, {"time":"2013-03-15T14:00:16.973097-07:00", "updatedBy":{"username":"kcoleman", "name":"Kim Coleman", "email":"kim.coleman@marklogic.com"}, "change":{}, "files":[], "show":true, "svn":{"repository":"/project/docsvn", "revision":"6411", "paths":["docs/branches/b6_0/fm/ingestion/content-pump.fm"], "affectedBugs":[]}, "comment":"Bug:20211 Document -tolerate_errors."}, {"time":"2013-04-02T17:11:28.828721-07:00", "updatedBy":{"username":"lratcliff", "name":"Larry Ratcliff", "email":"lratcliff@marklogic.com"}, "change":{"status":{"from":null, "to":"Ship"}, "assignTo":{"from":{"username":"lratcliff", "name":"Larry Ratcliff", "email":"lratcliff@marklogic.com"}, "to":{"username":"nobody", "name":"nobody nobody", "email":"nobody@marklogic.com"}}}, "files":[], "show":true, "comment":"Verified on build 6.0-20130402"}], "updatedAt":"2013-04-02T17:11:28.828721-07:00", "fixedAt":"2012-12-13T17:33:08.381682-08:00", "fixedBy":{"username":"jchen", "name":"Jane Chen", "email":"jane.chen@marklogic.com"}, "shippedAt":"2013-04-02T17:11:28.828721-07:00", "shippedBy":{"username":"lratcliff", "name":"Larry Ratcliff", "email":"lratcliff@marklogic.com"}}
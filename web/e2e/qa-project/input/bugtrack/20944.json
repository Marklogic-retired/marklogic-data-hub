{"id":20944, "kind":"Task", "createdAt":"2013-02-26T14:35:39.67944-08:00", "status":"Closed", "title":"[task] add super/sub-database related api", "category":"XQuery", "severity":"Major", "priority":{"level":"5", "title":""}, "days":null, "period":{"startDate":null, "endDate":null}, "submittedBy":{"username":"fxue", "name":"Fei Xue", "email":"Fei.Xue@marklogic.com"}, "assignTo":{"username":"nobody", "name":"nobody nobody", "email":"nobody@marklogic.com"}, "description":"Part of tier storage XQuery API.\r\nts:create/delete-sub/superdatabase\r\n\r\nmake use of admin apis to associate dbs with each other.\r\nBut should be able to pick up everything in database configuration.\r\nNo forest status or settings should be affected.", "samplequery":"", "sampledata":"", "version":"7.0-nightly", "tofixin":"7.0-ea2", "fixedin":"7.0-ea2", "platform":"all", "memory":"", "processors":"", "note":"", "subscribers":[{"username":"fxue", "name":"Fei Xue", "email":"Fei.Xue@marklogic.com"}, {"username":"rpolasani", "name":"Raghu Polasani", "email":"raghu.polasani@marklogic.com"}, {"username":"knagar", "name":"Kuldeep Nagar", "email":"Kuldeep.Nagar@marklogic.com"}, {"username":"skottam", "name":"Sravan Kottam", "email":"Sravan.Kottam@marklogic.com"}], "attachments":[], "includeInTaskList":false, "proceduralTasks":{"Requirements Task":[], "Functional Specification Task":[], "Test Specification Task":[], "Test Automation Task":[], "Documentation Task":[]}, "subTasks":[], "tags":["XQuery", "fxue"], "changeHistory":[{"time":"2013-02-26T14:35:39.67944-08:00", "updatedBy":{"username":"fxue", "name":"Fei Xue", "email":"Fei.Xue@marklogic.com"}, "change":{"assignTo":{"from":{"username":"fxue", "name":"Fei Xue", "email":"Fei.Xue@marklogic.com"}, "to":{"username":"fxue", "name":"Fei Xue", "email":"Fei.Xue@marklogic.com"}}}, "files":[], "show":true}, {"time":"2013-02-26T15:11:27.350802-08:00", "updatedBy":{"username":"jchen", "name":"Jane Chen", "email":"jane.chen@marklogic.com"}, "change":{}, "files":[], "show":true, "comment":"Let's add database-sub-databases and database-super-databases to the list."}, {"time":"2013-02-26T16:05:09.694657-08:00", "updatedBy":{"username":"fxue", "name":"Fei Xue", "email":"Fei.Xue@marklogic.com"}, "change":{}, "files":[], "show":true, "comment":"copying the spec here for easier reference\r\n\r\ndatabase-create-super-database (\r\n$dbid as xs:unsignedLong,\r\n$database-name as xs:string\r\n) as empty-sequence()\r\nFunction database-create-sub-database creates a database with the name $database-name and\r\nmake the created database the sub-database of the database designated by $dbid. The newly\r\ncreated database inherits the configuration of the original database. The supported values for\r\n$kind is “active” and “archive”. If $kind is “archive”, the newly created database will have the\r\nfollowing configuration set automatically: “index detection” – none, “expunge locks” – none,\r\n“reindexer enable” – false, “rebalancer enable” – false, “format compatibility” – 5.0.\r\ndatabase-create-sub-database (\r\n$dbid as xs:unsignedLong,\r\n$kind as xs:string,\r\n$database-name as xs:string,\r\n) as empty-sequence()\r\nFunction database-delete-super-database disassociates the super database designated by $delete-\r\ndbid with the sub-database designated by $dbid and deletes the super database. An error is\r\nthrown if the database designated by $delete-dbid is not a super database of the one designated\r\nby $dbid or contains other sub-databases than the one designated by $dbid.\r\ndatabase-delete-super-database (\r\n$dbid as xs:unsignedLong,\r\n$delete-dbid as xs:unsignedLong\r\n) as empty-sequence()\r\nFunction database-delete-sub-database disassociates the sub-database designated by $delete-dbid\r\nwith the super database designated by $dbid and deletes the sub-database. An error is thrown if\r\nthe database designated by $delete-dbid is not a sub-database of the one designated by $dbid.\r\nRequire that the database to be deleted doesn’t have any forests attached.\r\ndatabase-delete-sub-database (\r\n$dbid as xs:unsignedLong,\r\n$delete-dbid as xs:unsignedLong\r\n) as empty-sequence()\r\nFunction database-sub-databases returns a sequence of sub-databases of a super database\r\ndesignated by $database-id. Require that the database to be deleted doesn’t have any forests\r\nattached.\r\ndatabase-sub-databases (\r\n$database-id as xs:unsignedLong\r\n) as xs:unsignedLong*\r\nFunction database-super-databases returns the id of the super-database of a sub-database\r\ndesignated by $database-id.\r\ndatabase-super-database (\r\n$database-id as xs:unsignedLong\r\n) as xs:unsignedLong\r\n"}, {"time":"2013-02-27T18:28:18.316242-08:00", "updatedBy":{"username":"fxue", "name":"Fei Xue", "email":"Fei.Xue@marklogic.com"}, "change":{}, "files":[], "show":true, "comment":"Some notes:\r\n1. we do not support forest in a super database thus it is undefined behavior to delete a super forest whilst having data\r\n2. error will be thrown if trying to delete super db with more than one sub.\r\nthus user will not be able to delete a super db having sub overlapping with 2 or more other super db. This will be a known limitation but corner case. user will not be exposed the admin api of detach/attach subs to superdb."}, {"time":"2013-03-01T14:02:33.444391-08:00", "updatedBy":{"username":"fxue", "name":"Fei Xue", "email":"Fei.Xue@marklogic.com"}, "change":{}, "files":[], "show":true, "svn":{"repository":"/project/engsvn", "revision":"134387", "paths":["xdmp/trunk/src/Modules/MarkLogic/tieredstorage.xqy"], "affectedBugs":[]}, "comment":"Bug:20944 ts:database-super/sub-databases api done"}, {"time":"2013-03-01T14:26:46.395224-08:00", "updatedBy":{"username":"fxue", "name":"Fei Xue", "email":"Fei.Xue@marklogic.com"}, "change":{}, "files":[], "show":true, "comment":"I suppose we would want also to copy field/range index settings while doing database-create-super-database"}, {"time":"2013-03-01T16:13:36.0192-08:00", "updatedBy":{"username":"fxue", "name":"Fei Xue", "email":"Fei.Xue@marklogic.com"}, "change":{}, "files":[], "show":true, "svn":{"repository":"/project/engsvn", "revision":"134409", "paths":["xdmp/trunk/src/Modules/MarkLogic/tieredstorage.xqy"], "affectedBugs":[]}, "comment":"Bug:20944 ts:database-delete/create-super/sub-database"}, {"time":"2013-03-01T16:16:13.042991-08:00", "updatedBy":{"username":"fxue", "name":"Fei Xue", "email":"Fei.Xue@marklogic.com"}, "change":{}, "files":[], "show":true, "comment":"notes on error thrown:\r\n1) kind not in \"active\" or \"archive\" : TS-WRONGKIND , ** is not a kind\r\n2) trying to delete whilst having forests attached: TS-CANNOTDELETE, dbid has forest(s) attached\r\n3) trying to delete whilst associated with other super/sub db: TS-CANNOTDELETE, dbid has other super/sub-database(s)\r\n"}, {"time":"2013-03-01T16:34:03.10263-08:00", "updatedBy":{"username":"fxue", "name":"Fei Xue", "email":"Fei.Xue@marklogic.com"}, "change":{}, "files":[], "show":true, "comment":"An alternative could be automatically detach with all its super-db when trying to delete a sub-db. "}, {"time":"2013-03-01T16:51:56.990993-08:00", "updatedBy":{"username":"fxue", "name":"Fei Xue", "email":"Fei.Xue@marklogic.com"}, "change":{}, "files":[], "show":true, "svn":{"repository":"/project/engsvn", "revision":"134411", "paths":["xdmp/trunk/src/Modules/MarkLogic/tieredstorage.xqy"], "affectedBugs":[]}, "comment":"Bug:20944 add kind default"}, {"time":"2013-03-01T18:18:35.739653-08:00", "updatedBy":{"username":"fxue", "name":"Fei Xue", "email":"Fei.Xue@marklogic.com"}, "change":{"status":{"from":"", "to":"Test"}, "assignTo":{"from":{"username":"fxue", "name":"Fei Xue", "email":"Fei.Xue@marklogic.com"}, "to":{"username":"rpolasani", "name":"Raghu Polasani", "email":"raghu.polasani@marklogic.com"}}}, "files":[], "show":true, "comment":"7.0-20130302"}, {"time":"2013-03-01T18:18:35.739653-08:00", "updatedBy":{"username":"fxue", "name":"Fei Xue", "email":"Fei.Xue@marklogic.com"}, "change":{"assignTo":{"from":{"username":"fxue", "name":"Fei Xue", "email":"Fei.Xue@marklogic.com"}, "to":{"username":"rpolasani", "name":"Raghu Polasani", "email":"raghu.polasani@marklogic.com"}}}, "files":[], "show":true}, {"time":"2013-03-01T22:12:04.15045-08:00", "updatedBy":{"username":"jchen", "name":"Jane Chen", "email":"jane.chen@marklogic.com"}, "change":{"status":{"from":"", "to":"Fix"}, "assignTo":{"from":{"username":"jchen", "name":"Jane Chen", "email":"jane.chen@marklogic.com"}, "to":{"username":"fxue", "name":"Fei Xue", "email":"Fei.Xue@marklogic.com"}}}, "files":[], "show":true, "comment":"Fei,\r\n\r\nA few things missing:\r\n\r\n1) Check license.  I'm going to forward you a copy.\r\n2) Add privilege and check privilege.\r\n3) Add error messages."}, {"time":"2013-03-01T22:12:04.15045-08:00", "updatedBy":{"username":"jchen", "name":"Jane Chen", "email":"jane.chen@marklogic.com"}, "change":{"assignTo":{"from":{"username":"jchen", "name":"Jane Chen", "email":"jane.chen@marklogic.com"}, "to":{"username":"fxue", "name":"Fei Xue", "email":"Fei.Xue@marklogic.com"}}}, "files":[], "show":true}, {"time":"2013-04-01T17:27:15.679761-07:00", "updatedBy":{"username":"fxue", "name":"Fei Xue", "email":"Fei.Xue@marklogic.com"}, "change":{}, "files":[], "show":true, "svn":{"repository":"/project/engsvn", "revision":"138319", "paths":["xdmp/trunk/src/Config/security.xml", "xdmp/trunk/src/Modules/MarkLogic/tieredstorage.xqy", "xdmp/trunk/src/Messages/TS-en.xml"], "affectedBugs":[]}, "comment":"Bug:20944"}, {"time":"2013-04-02T16:02:33.561656-07:00", "updatedBy":{"username":"fxue", "name":"Fei Xue", "email":"Fei.Xue@marklogic.com"}, "change":{}, "files":[], "show":true, "svn":{"repository":"/project/engsvn", "revision":"138417", "paths":["xdmp/trunk/src/Modules/MarkLogic/tieredstorage.xqy", "xdmp/trunk/src/services/LockOrderEnforcer.cpp", "xdmp/trunk/src/Tree.h", "xdmp/trunk/src/Config/security.xml", "xdmp/trunk/src/Security.h", "xdmp/trunk/src/ServerInfo.h", "xdmp/trunk/src/List.h"], "affectedBugs":["21416"]}, "comment":"Bug:20944 Bug:21416 privilege creation"}, {"time":"2013-04-02T16:04:48.586038-07:00", "updatedBy":{"username":"fxue", "name":"Fei Xue", "email":"Fei.Xue@marklogic.com"}, "change":{"status":{"from":"", "to":"Test"}, "assignTo":{"from":{"username":"fxue", "name":"Fei Xue", "email":"Fei.Xue@marklogic.com"}, "to":{"username":"skottam", "name":"Sravan Kottam", "email":"Sravan.Kottam@marklogic.com"}}}, "files":[], "show":true, "comment":"Hi Sravan, this is part of tier storage. Close it if you don't want to track it in bugtrack."}, {"time":"2013-04-02T16:04:48.586038-07:00", "updatedBy":{"username":"fxue", "name":"Fei Xue", "email":"Fei.Xue@marklogic.com"}, "change":{"assignTo":{"from":{"username":"fxue", "name":"Fei Xue", "email":"Fei.Xue@marklogic.com"}, "to":{"username":"skottam", "name":"Sravan Kottam", "email":"Sravan.Kottam@marklogic.com"}}}, "files":[], "show":true}, {"time":"2013-04-04T12:49:37.704261-07:00", "updatedBy":{"username":"fxue", "name":"Fei Xue", "email":"Fei.Xue@marklogic.com"}, "change":{}, "files":[], "show":true, "svn":{"repository":"/project/docsvn", "revision":"6530", "paths":["docs/trunk/modules/tieredstorage.xml"], "affectedBugs":[]}, "comment":"Bug:20944 adding apidoc"}, {"time":"2013-04-04T13:07:54.099086-07:00", "updatedBy":{"username":"fxue", "name":"Fei Xue", "email":"Fei.Xue@marklogic.com"}, "change":{}, "files":[], "show":true, "svn":{"repository":"/project/engsvn", "revision":"138672", "paths":["xdmp/trunk/src/Modules/MarkLogic/tieredstorage.xqy", "xdmp/trunk/src/Modules/MarkLogic/admin.xqy"], "affectedBugs":[]}, "comment":"Bug:20944 adding admin:database-attach/detach-database"}, {"time":"2013-09-04T23:10:13.241046-07:00", "updatedBy":{"username":"knagar", "name":"Kuldeep Nagar", "email":"Kuldeep.Nagar@marklogic.com"}, "change":{}, "files":[], "show":true, "comment":"Hi Fei, \r\n\r\nIt seems this fix is causing regression as Bug - 22430 has started to appear again started from yesterday's build.\r\n\r\nPlease let me know if you want me to open a new bug for it or should I reopen 22430 for same.\r\n\r\nThanks\r\nKuldeep"}, {"time":"2013-09-04T23:10:13.241046-07:00", "updatedBy":{"username":"knagar", "name":"Kuldeep Nagar", "email":"Kuldeep.Nagar@marklogic.com"}, "change":{"assignTo":{"from":{"username":"knagar", "name":"Kuldeep Nagar", "email":"Kuldeep.Nagar@marklogic.com"}, "to":{"username":"fxue", "name":"Fei Xue", "email":"Fei.Xue@marklogic.com"}}}, "files":[], "show":true}, {"time":"2013-09-05T13:29:42.285342-07:00", "updatedBy":{"username":"fxue", "name":"Fei Xue", "email":"Fei.Xue@marklogic.com"}, "change":{}, "files":[], "show":true, "comment":"Hi the change that caused 22430 is bug 23886. assigning this back to sravan."}, {"time":"2013-09-05T13:29:42.285342-07:00", "updatedBy":{"username":"fxue", "name":"Fei Xue", "email":"Fei.Xue@marklogic.com"}, "change":{"assignTo":{"from":{"username":"fxue", "name":"Fei Xue", "email":"Fei.Xue@marklogic.com"}, "to":{"username":"skottam", "name":"Sravan Kottam", "email":"Sravan.Kottam@marklogic.com"}}}, "files":[], "show":true}, {"time":"2013-10-18T01:14:34.800293-07:00", "updatedBy":{"username":"skottam", "name":"Sravan Kottam", "email":"Sravan.Kottam@marklogic.com"}, "change":{"status":{"from":null, "to":"Ship"}, "assignTo":{"from":{"username":"skottam", "name":"Sravan Kottam", "email":"Sravan.Kottam@marklogic.com"}, "to":{"username":"nobody", "name":"nobody nobody", "email":"nobody@marklogic.com"}}}, "files":[], "show":true, "comment":"Moving this to ship , functional tests are covered by aries from rest api so will add xquery api tests in 7.0-2"}], "updatedAt":"2013-10-18T01:14:34.800293-07:00", "fixedAt":"2013-04-02T16:04:48.586038-07:00", "fixedBy":{"username":"fxue", "name":"Fei Xue", "email":"Fei.Xue@marklogic.com"}, "shippedAt":"2013-10-18T01:14:34.800293-07:00", "shippedBy":{"username":"skottam", "name":"Sravan Kottam", "email":"Sravan.Kottam@marklogic.com"}}
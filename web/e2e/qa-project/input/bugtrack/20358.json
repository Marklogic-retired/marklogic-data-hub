{"id":20358, "kind":"Bug", "createdAt":"2012-12-20T02:44:27.517133-08:00", "status":"Closed", "title":"cts:element-value-match() wildcard query breaks with certain collations", "category":"search", "severity":"Major", "priority":{"level":"5", "title":""}, "submittedBy":{"username":"ableasdale", "name":"Alex Bleasdale", "email":"alex.bleasdale@marklogic.com"}, "assignTo":{"username":"nobody", "name":"nobody nobody", "email":"nobody@marklogic.com"}, "description":"A detailed overview of this issue was provided in the original support case:\r\nhttps://help.marklogic.com/staff/Tickets/Ticket/View/12283\r\n\r\nI've reproduced the issue on rh5-intel64-3 (ML 5.0-4) on one of our lab machines; to examine these:\r\n\r\n1. Look at: http://rh5-intel64-3:8000/qconsole/\r\n(admin/admin)\r\n\r\n2. You should see 4 tabs:\r\n- Execute Query with Root Collation and Query with Codepoint Collation and look at the results for Query 5 (Adams, John*)\r\n- Execute Query With Bug (T00BB) and note that the results for query 5 yield one result rather than two", "samplequery":"", "sampledata":"", "version":"6.0-2", "tofixin":"6.0-3", "fixedin":"6.0-3", "platform":"linux(64-bit)", "memory":"", "processors":"", "note":"", "subscribers":[{"username":"ableasdale", "name":"Alex Bleasdale", "email":"alex.bleasdale@marklogic.com"}, {"username":"mary", "name":"Mary Holstege", "email":"mary@cerisent.com"}, {"username":"rpolasani", "name":"Raghu Polasani", "email":"raghu.polasani@marklogic.com"}], "attachments":[{"name":"Attached the Query Console workspace for reference - this contains the customer query which appears to still have issues", "uri":"root/support/bugtracking/attachments/20358/Case 12283 Repro.xml"}], "relationships":[{"type":"", "to":""}], "clones":[], "cloneOf":20316, "support":{"headline":"wildcard query breaks with certain collations", "supportDescription":"A wildcarded query yields different results than the default or codepoint collation when the collation \"http://marklogic.com/collation/en/S1/AS/T00BB\" is used.", "publishStatus":"Publish", "tickets":[], "customerImpact":{"level":"High", "title":"Significant business impact with no reasonable workaround"}, "workaround":""}, "tags":["search", "ableasdale"], "changeHistory":[{"time":"2012-12-20T02:44:27.517133-08:00", "updatedBy":{"username":"ableasdale", "name":"Alex Bleasdale", "email":"alex.bleasdale@marklogic.com"}, "change":{"assignTo":{"from":{"username":"ableasdale", "name":"Alex Bleasdale", "email":"alex.bleasdale@marklogic.com"}, "to":{"username":"mary", "name":"Mary Holstege", "email":"mary@cerisent.com"}}}, "files":[], "show":true}, {"time":"2012-12-21T18:52:20.748772-08:00", "updatedBy":{"username":"mary", "name":"Mary Holstege", "email":"mary@cerisent.com"}, "change":{}, "files":[], "show":true, "comment":"Simpler test case:\r\n\r\n\"IGNORABLES\",\r\ncts:matches(\"Adams, John*\", \"Adams, John Quincy\", true(), true(), \"http://marklogic.com/collation/en/S1/AS/T00BB\"),\r\ncts:matches(\"Adams, John*\", \"Adams, John\", true(), true(), \"http://marklogic.com/collation/en/S1/AS/T00BB\"),\r\n\"DEFAULT\",\r\ncts:matches(\"Adams, John*\", \"Adams, John Quincy\", true(), true(), \"http://marklogic.com/collation/\"),\r\ncts:matches(\"Adams, John*\", \"Adams, John\", true(), true(), \"http://marklogic.com/collation/\")\r\n\r\nReturns true, false, true, true (should all be true)"}, {"time":"2013-01-02T09:00:38.48692-08:00", "updatedBy":{"username":"mary", "name":"Mary Holstege", "email":"mary@cerisent.com"}, "change":{"tofixin":{"from":"", "to":"6.0-3"}}, "files":[], "show":true}, {"time":"2013-01-02T10:05:34.506199-08:00", "updatedBy":{"username":"mary", "name":"Mary Holstege", "email":"mary@cerisent.com"}, "change":{}, "files":[], "show":true, "svn":{"repository":"/project/engsvn", "revision":"126264", "paths":["xdmp/branches/b6_0/src/RuleBasedCollation.cpp"], "affectedBugs":[]}, "comment":"Bug:20358 special handling for '*' in collations with ignorables was broken"}, {"time":"2013-01-02T10:06:11.939956-08:00", "updatedBy":{"username":"mary", "name":"Mary Holstege", "email":"mary@cerisent.com"}, "change":{"status":{"from":"", "to":"Test"}, "assignTo":{"from":{"username":"mary", "name":"Mary Holstege", "email":"mary@cerisent.com"}, "to":{"username":"rpolasani", "name":"Raghu Polasani", "email":"raghu.polasani@marklogic.com"}}}, "files":[], "show":true, "comment":"Fixed 6.0-20130103"}, {"time":"2013-01-02T10:06:11.939956-08:00", "updatedBy":{"username":"mary", "name":"Mary Holstege", "email":"mary@cerisent.com"}, "change":{"assignTo":{"from":{"username":"mary", "name":"Mary Holstege", "email":"mary@cerisent.com"}, "to":{"username":"rpolasani", "name":"Raghu Polasani", "email":"raghu.polasani@marklogic.com"}}}, "files":[], "show":true}, {"time":"2013-03-21T23:32:05.223869-07:00", "updatedBy":{"username":"rpolasani", "name":"Raghu Polasani", "email":"raghu.polasani@marklogic.com"}, "change":{"assignTo":{"from":{"username":"rpolasani", "name":"Raghu Polasani", "email":"raghu.polasani@marklogic.com"}, "to":{"username":"jsolis", "name":"Julio Solis", "email":"Julio.Solis@marklogic.com"}}}, "files":[], "show":true}, {"time":"2013-03-29T11:33:57.565282-07:00", "updatedBy":{"username":"jsolis", "name":"Julio Solis", "email":"Julio.Solis@marklogic.com"}, "change":{"status":{"from":"", "to":"Ship"}, "assignTo":{"from":{"username":"jsolis", "name":"Julio Solis", "email":"Julio.Solis@marklogic.com"}, "to":{"username":"nobody", "name":"nobody nobody", "email":"nobody@marklogic.com"}}}, "files":[], "show":true, "comment":"Verified on MarkLogic-6.0-20130329.x86_64. New test case bug20358.xml added to test suite: bugs51.txt."}, {"time":"2013-04-22T16:33:01.060523-07:00", "updatedBy":{"username":"rpelton", "name":"Rick Pelton", "email":"rick.pelton@marklogic.com"}, "change":{"status":{"from":"", "to":"Closed"}, "assignTo":{"from":{"username":"rpelton", "name":"Rick Pelton", "email":"rick.pelton@marklogic.com"}, "to":{"username":"nobody", "name":"nobody nobody", "email":"nobody@marklogic.com"}}}, "files":[], "show":true}, {"time":"2013-05-02T09:02:21.511774-07:00", "updatedBy":{"username":"rpelton", "name":"Rick Pelton", "email":"rick.pelton@marklogic.com"}, "change":{}, "files":[], "show":true, "comment":"This is being reported as not fixed in 6.0-3 by the customer.  Support team will investigate."}, {"time":"2013-05-02T10:10:13.878243-07:00", "updatedBy":{"username":"ableasdale", "name":"Alex Bleasdale", "email":"alex.bleasdale@marklogic.com"}, "change":{}, "files":[], "show":true, "comment":"Just set up a repro of this: \r\nhttp://cluster-006:8000/qconsole/\r\n\r\nThere's a workspace called \"Case 12283 Repro\" on there - the database is 12283\r\n\r\nThe testcase for the bug on 6.0-3 returns:\r\nIGNORABLES true true DEFAULT true true\r\n\r\nThe customer provided example returns:\r\n(Default Collation)\r\n <query n=\"5\" string=\"Adams, John*\">\r\n      <match>Adams, John</match>\r\n      <match>Adams, John Quincy</match>\r\n    </query>\r\n\r\n(http://marklogic.com/collation/en/S1/AS/T00BB)\r\n<query n=\"5\" string=\"Adams, John*\">\r\n      <match>Adams, John Quincy</match>\r\n</query>\r\n\r\nShould these two searches return the same results?\r\n\r\nThanks in advance.\r\nBest,\r\nA"}, {"time":"2013-05-02T16:27:47.155987-07:00", "updatedBy":{"username":"mary", "name":"Mary Holstege", "email":"mary@cerisent.com"}, "change":{}, "files":[], "show":true, "comment":"You should repoen this bug, or make a new one. There are some slightly different internal functions that handle this, depending on whether they are getting things from on disk stands, in memory stands, or whatnot. I didn't fix all of them."}, {"time":"2013-05-03T00:57:30.953452-07:00", "updatedBy":{"username":"ableasdale", "name":"Alex Bleasdale", "email":"alex.bleasdale@marklogic.com"}, "change":{"status":{"from":"", "to":"Fix"}, "assignTo":{"from":{"username":"ableasdale", "name":"Alex Bleasdale", "email":"alex.bleasdale@marklogic.com"}, "to":{"username":"mary", "name":"Mary Holstege", "email":"mary@cerisent.com"}}}, "files":[], "show":true, "comment":"Hi Mary,\r\n\r\nI can confirm that your simpler test case was resolved in the 6.0-3 build but the original problem filed with the case seems to be there still...  \r\n\r\nAs discussed, I've reopened the case.  Please let me know if you need anything more from me.  "}, {"time":"2013-05-03T00:57:30.953452-07:00", "updatedBy":{"username":"ableasdale", "name":"Alex Bleasdale", "email":"alex.bleasdale@marklogic.com"}, "change":{"assignTo":{"from":{"username":"ableasdale", "name":"Alex Bleasdale", "email":"alex.bleasdale@marklogic.com"}, "to":{"username":"mary", "name":"Mary Holstege", "email":"mary@cerisent.com"}}}, "files":[], "show":true}, {"time":"2013-05-03T00:57:30.953452-07:00", "updatedBy":{"username":"ableasdale", "name":"Alex Bleasdale", "email":"alex.bleasdale@marklogic.com"}, "change":{"tofixin":{"from":"6.0-3", "to":"6.0-3.1"}}, "files":[], "show":true}, {"time":"2013-05-03T07:35:11.015107-07:00", "updatedBy":{"username":"rpelton", "name":"Rick Pelton", "email":"rick.pelton@marklogic.com"}, "change":{"status":{"from":"", "to":"Closed"}, "assignTo":{"from":{"username":"rpelton", "name":"Rick Pelton", "email":"rick.pelton@marklogic.com"}, "to":{"username":"nobody", "name":"nobody nobody", "email":"nobody@marklogic.com"}}}, "files":[], "show":true, "comment":"setting back to fiv 6.0-3 since there were code changes in that branch.  New bug (will be) created."}, {"time":"2013-05-03T07:35:11.015107-07:00", "updatedBy":{"username":"rpelton", "name":"Rick Pelton", "email":"rick.pelton@marklogic.com"}, "change":{"assignTo":{"from":{"username":"rpelton", "name":"Rick Pelton", "email":"rick.pelton@marklogic.com"}, "to":{"username":"nobody", "name":"nobody nobody", "email":"nobody@marklogic.com"}}}, "files":[], "show":true}, {"time":"2013-05-03T07:35:11.015107-07:00", "updatedBy":{"username":"rpelton", "name":"Rick Pelton", "email":"rick.pelton@marklogic.com"}, "change":{"tofixin":{"from":"6.0-3.1", "to":"6.0-3"}}, "files":[], "show":true}], "updatedAt":"2013-05-03T07:35:11.015107-07:00", "fixedAt":"2013-01-02T10:06:11.939956-08:00", "fixedBy":{"username":"mary", "name":"Mary Holstege", "email":"mary@cerisent.com"}, "shippedAt":"2013-03-29T11:33:57.565282-07:00", "shippedBy":{"username":"jsolis", "name":"Julio Solis", "email":"Julio.Solis@marklogic.com"}, "closedAt":"2013-05-03T07:35:11.015107-07:00", "closedBy":{"username":"rpelton", "name":"Rick Pelton", "email":"rick.pelton@marklogic.com"}, "renderDescriptionAs":"normal"}
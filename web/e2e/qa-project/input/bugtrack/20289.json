{"id":20289, "kind":"Bug", "createdAt":"2012-12-14T12:34:43.108747-08:00", "status":"Closed", "title":"Either sec:external-authentication-doc-permissions is returning the wrong role or sec:get-role-names is broken", "category":"security", "severity":"Major", "priority":{"level":"5", "title":""}, "submittedBy":{"username":"gfurbush", "name":"Gordon Furbush ", "email":"gfurbush@marklogic.com"}, "assignTo":{"username":"nobody", "name":"nobody nobody", "email":"nobody@marklogic.com"}, "description":"I do:\r\n\r\nsec:external-authentication-doc-permissions()\r\n\r\n=>\r\n\r\n<?xml version=\"1.0\" encoding=\"UTF-8\"?>\r\n<results warning=\"more than one root item\">\r\n  <sec:permission xmlns:sec=\"http://marklogic.com/xdmp/security\">\r\n    <sec:role-id>12859270053073389585</sec:role-id>\r\n    <sec:capability>read</sec:capability>\r\n  </sec:permission>\r\n  <sec:permission xmlns:sec=\"http://marklogic.com/xdmp/security\">\r\n    <sec:role-id>12859270053073389585</sec:role-id>\r\n    <sec:capability>update</sec:capability>\r\n  </sec:permission>\r\n  <sec:permission xmlns:sec=\"http://marklogic.com/xdmp/security\">\r\n    <sec:role-id>12859270053073389585</sec:role-id>\r\n    <sec:capability>insert</sec:capability>\r\n  </sec:permission>\r\n</results>\r\n\r\nThen:\r\n\r\n     sec:get-role-names((12859270053073389585))\r\n\r\n=>\r\n\r\n[1.0-ml] SEC-ROLEDNE: (err:FOER0000) Role does not exist: sec:role-id = 12859270053073389585\r\nStack Trace\r\n\r\nIn /MarkLogic/security.xqy on line 1093\r\nIn sec:get-role-names(12859270053073389585)\r\n$role-ids := xs:unsignedLong(\"12859270053073389585\")\r\n$assert := ()\r\n$col := \"http://marklogic.com/xdmp/security\"\r\n$r-id := xs:unsignedLong(\"12859270053073389585\")\r\n$role := ()\r\nAt line 6 column 6:\r\n4. at \"/MarkLogic/security.xqy\";\r\n5. \r\n6. sec:get-role-names(\r\n7. (12859270053073389585)\r\n8. )", "samplequery":"", "sampledata":"", "version":"7.0-nightly", "tofixin":"N/A", "fixedin":"N/A", "platform":"all", "memory":"", "processors":"", "note":"", "subscribers":[{"username":"gfurbush", "name":"Gordon Furbush ", "email":"gfurbush@marklogic.com"}, {"username":"atsoi", "name":"Arthur Tsoi", "email":"arthur.tsoi@marklogic.com"}], "attachments":[], "relationships":[{"type":"", "to":""}], "clones":[], "cloneOf":"", "support":{"headline":"", "supportDescription":"", "publishStatus":"Not Ready", "tickets":[], "customerImpact":{"level":"N/A", "title":""}, "workaround":""}, "tags":["security", "gfurbush"], "changeHistory":[{"time":"2012-12-14T12:34:43.108747-08:00", "updatedBy":{"username":"gfurbush", "name":"Gordon Furbush ", "email":"gfurbush@marklogic.com"}, "change":{"assignTo":{"from":{"username":"gfurbush", "name":"Gordon Furbush ", "email":"gfurbush@marklogic.com"}, "to":{"username":"atsoi", "name":"Arthur Tsoi", "email":"arthur.tsoi@marklogic.com"}}}, "files":[], "show":true}, {"time":"2012-12-14T12:40:21.141973-08:00", "updatedBy":{"username":"gfurbush", "name":"Gordon Furbush ", "email":"gfurbush@marklogic.com"}, "change":{"status":{"from":"", "to":"Closed"}, "assignTo":{"from":{"username":"gfurbush", "name":"Gordon Furbush ", "email":"gfurbush@marklogic.com"}, "to":{"username":"nobody", "name":"nobody nobody", "email":"nobody@marklogic.com"}}}, "files":[], "show":true, "comment":"Never mind.  Forgot to execute against Security DB."}, {"time":"2012-12-14T12:40:21.141973-08:00", "updatedBy":{"username":"gfurbush", "name":"Gordon Furbush ", "email":"gfurbush@marklogic.com"}, "change":{"assignTo":{"from":{"username":"gfurbush", "name":"Gordon Furbush ", "email":"gfurbush@marklogic.com"}, "to":{"username":"nobody", "name":"nobody nobody", "email":"nobody@marklogic.com"}}}, "files":[], "show":true}], "updatedAt":"2012-12-14T12:40:21.141973-08:00", "closedAt":"2012-12-14T12:40:21.141973-08:00", "closedBy":{"username":"gfurbush", "name":"Gordon Furbush ", "email":"gfurbush@marklogic.com"}, "renderDescriptionAs":"normal"}
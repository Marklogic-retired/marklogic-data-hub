{"id":20849, "kind":"Bug", "createdAt":"2013-02-20T11:55:31.104007-08:00", "status":"Closed", "title":"REGR: /v1/config/query returns invalid validation error message", "category":"MarkLogic REST API", "severity":"Major", "priority":{"level":"5", "title":""}, "submittedBy":{"username":"vkorolev", "name":"Vitaly Korolev", "email":"vitaly.korolev@marklogic.com"}, "assignTo":{"username":"nobody", "name":"nobody nobody", "email":"nobody@marklogic.com"}, "description":"To reproduce\r\n- Create REST server and users\r\n- Set validate-optioins to false\r\n- Add invalid options node\r\n- Set validate-options to true\r\n- Add another node to options with POST\r\n\r\nExpected error message:\r\n<rapi:message>RESTAPI-INVALIDCONTENT: (err:FOER0000) Invalid content: Operation results in invalid Options: XDMP-VALIDATEUNEXPECTED: (err:XQDY0027) validate strict { $opt } -- Invalid node: Found search:unknown-option but expected (search:additional-query|search:annotation|search:concurrency-level|search:constraint|search:ValuesAccessor|search:debug|search:default-suggestion-source|search:extract-metadata|search:fragment-scope|search:forest|search:grammar|search:operator|search:page-length|search:quality-weight|search:return-aggregates|search:return-constraints|search:return-facets|search:return-frequencies|search:return-metrics|search:return-plan|search:return-qtext|search:return-query|search:return-results|search:return-similar|search:return-values|search:search-option|search:searchable-expression|search:sort-order|search:suggestion-source|search:term|search:transform-results)* at /search:options/search:unknown-option using schema \"search.xsd\"search:unknown-option(search:additional-query|search:annotation|search:concurrency-level|search:constraint|search:ValuesAccessor|search:debug|search:default-suggestion-source|search:extract-metadata|search:fragment-scope|search:forest|search:grammar|search:operator|search:page-length|search:quality-weight|search:return-aggregates|search:return-constraints|search:return-facets|search:return-frequencies|search:return-metrics|search:return-plan|search:return-qtext|search:return-query|search:return-results|search:return-similar|search:return-values|search:search-option|search:searchable-expression|search:sort-order|search:suggestion-source|search:term|search:transform-results)*/search:options/search:unknown-option\"search.xsd\"</rapi:message>\r\n\r\nActual error message:\r\n<rapi:message>RESTAPI-INVALIDCONTENT: (err:FOER0000) Invalid content: Operation results in invalid Options: XDMP-VALIDATENODECL: (err:XQDY0084) validate strict { $opt } -- Missing element declaration: Expected declaration for node /search:options/search:unknown-option in non-lax mode using schema \"search.xsd\"/search:options/search:unknown-option\"search.xsd\"</rapi:message>", "samplequery":"", "sampledata":"", "version":"7.0-nightly", "tofixin":"7.0-ea1", "fixedin":"7.0-ea1", "platform":"all", "memory":"", "processors":"", "note":"7.0-20130219", "subscribers":[{"username":"vkorolev", "name":"Vitaly Korolev", "email":"vitaly.korolev@marklogic.com"}, {"username":"cgreer", "name":"Charles Greer", "email":"charles.greer@marklogic.com"}, {"username":"cwhitney", "name":"Colleen  Whitney", "email":"colleen.whitney@marklogic.com"}, {"username":"ehennum", "name":"Erik Hennum", "email":"erik.hennum@marklogic.com"}], "attachments":[], "relationships":[{"type":"", "to":""}], "clones":[], "cloneOf":"", "support":{"headline":"", "supportDescription":"", "publishStatus":"Not Ready", "tickets":[], "customerImpact":{"level":"N/A", "title":""}, "workaround":""}, "tags":["MarkLogic REST API", "vkorolev"], "changeHistory":[{"time":"2013-02-20T11:55:31.104007-08:00", "updatedBy":{"username":"vkorolev", "name":"Vitaly Korolev", "email":"vitaly.korolev@marklogic.com"}, "change":{"assignTo":{"from":{"username":"vkorolev", "name":"Vitaly Korolev", "email":"vitaly.korolev@marklogic.com"}, "to":{"username":"cgreer", "name":"Charles Greer", "email":"charles.greer@marklogic.com"}}}, "files":[], "show":true}, {"time":"2013-02-20T12:15:58.871539-08:00", "updatedBy":{"username":"cgreer", "name":"Charles Greer", "email":"charles.greer@marklogic.com"}, "change":{"status":{"from":"", "to":"Fix"}, "assignTo":{"from":{"username":"cgreer", "name":"Charles Greer", "email":"charles.greer@marklogic.com"}, "to":{"username":"cgreer", "name":"Charles Greer", "email":"charles.greer@marklogic.com"}}}, "files":[], "show":true, "comment":"verified.  will investigate fix."}, {"time":"2013-02-20T13:24:44.88162-08:00", "updatedBy":{"username":"cgreer", "name":"Charles Greer", "email":"charles.greer@marklogic.com"}, "change":{}, "files":[], "show":true, "comment":"OK, I've found where this change is."}, {"time":"2013-02-20T13:34:01.035923-08:00", "updatedBy":{"username":"cgreer", "name":"Charles Greer", "email":"charles.greer@marklogic.com"}, "change":{}, "files":[], "show":true, "comment":"Validating a document changes from 6.0 to ML7.  In 6.0 you get messages like the expected above, while in 7 it's changed to the actual.  I don't see any changes in the schema that seem to indicate this change, but you can verify it with \r\n\r\nimport module namespace search = \"http://marklogic.com/appservices/search\"\r\n    at \"/MarkLogic/appservices/search/search.xqy\";\r\n     \r\n     validate strict {\r\n<search:options><search:x/></search:options> }\r\n\r\nOn both systems.\r\n\r\nThe errors both seem semantically valid.  I'll circulate a query about validation changes.\r\n\r\n"}, {"time":"2013-02-20T16:28:18.074424-08:00", "updatedBy":{"username":"cgreer", "name":"Charles Greer", "email":"charles.greer@marklogic.com"}, "change":{}, "files":[], "show":true, "comment":"According to Mary this change is part of validation optimization.  I think we're ok to update the keys.\r\n"}, {"time":"2013-02-20T16:28:46.623782-08:00", "updatedBy":{"username":"cgreer", "name":"Charles Greer", "email":"charles.greer@marklogic.com"}, "change":{"status":{"from":"", "to":"Test"}, "assignTo":{"from":{"username":"cgreer", "name":"Charles Greer", "email":"charles.greer@marklogic.com"}, "to":{"username":"vkorolev", "name":"Vitaly Korolev", "email":"vitaly.korolev@marklogic.com"}}}, "files":[], "show":true, "comment":"This key can be updated."}, {"time":"2013-02-20T16:28:46.623782-08:00", "updatedBy":{"username":"cgreer", "name":"Charles Greer", "email":"charles.greer@marklogic.com"}, "change":{"assignTo":{"from":{"username":"cgreer", "name":"Charles Greer", "email":"charles.greer@marklogic.com"}, "to":{"username":"vkorolev", "name":"Vitaly Korolev", "email":"vitaly.korolev@marklogic.com"}}}, "files":[], "show":true}, {"time":"2013-02-20T18:13:35.172858-08:00", "updatedBy":{"username":"vkorolev", "name":"Vitaly Korolev", "email":"vitaly.korolev@marklogic.com"}, "change":{"status":{"from":"", "to":"Ship"}, "assignTo":{"from":{"username":"vkorolev", "name":"Vitaly Korolev", "email":"vitaly.korolev@marklogic.com"}, "to":{"username":"nobody", "name":"nobody nobody", "email":"nobody@marklogic.com"}}}, "files":[], "show":true, "comment":"Key updated in rest-client-api-config-05.xml"}, {"time":"2013-02-20T18:14:18.291963-08:00", "updatedBy":{"username":"vkorolev", "name":"Vitaly Korolev", "email":"vitaly.korolev@marklogic.com"}, "change":{}, "files":[], "show":true, "svn":{"repository":"/project/engsvn", "revision":"132748", "paths":["qa/trunk/scripts/keys/rest-client-api-config-05.xml"], "affectedBugs":[]}, "comment":"Updating the key according to bug:20849."}], "updatedAt":"2013-02-20T18:14:18.291963-08:00", "fixedAt":"2013-02-20T16:28:46.623782-08:00", "fixedBy":{"username":"cgreer", "name":"Charles Greer", "email":"charles.greer@marklogic.com"}, "shippedAt":"2013-02-20T18:13:35.172858-08:00", "shippedBy":{"username":"vkorolev", "name":"Vitaly Korolev", "email":"vitaly.korolev@marklogic.com"}, "renderDescriptionAs":"normal"}
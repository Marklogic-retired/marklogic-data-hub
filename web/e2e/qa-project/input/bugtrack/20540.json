{"id":20540, "kind":"Bug", "createdAt":"2013-01-21T13:56:22.496539-08:00", "closedAt":"2016-01-16T17:09:08.107Z", "status":"Closed", "title":"Bugtrack UI loads files from non-marklogic server", "category":"Bugtrack", "severity":"Major", "priority":{"level":"1", "title":"Required for product release"}, "submittedBy":{"username":"wfeick", "name":"Wayne Feick", "email":"wfeick@marklogic.com"}, "closedBy":{"name":"Ganesh Vaideeswaran", "email":"ganesh.vaideeswaran@marklogic.com", "username":"gvaidees"}, "assignTo":{"username":"nobody", "name":"nobody nobody", "email":"nobody@marklogic.com"}, "description":"I've noticed that sometimes the search page is slow to load, and it's stalling on an external, non-MarkLogic web site. Here's what I found in the page header...\r\n\r\n    <title>BugTrack Search</title>\r\n    <link rel=\"stylesheet\" href=\"http://yandex.st/dojo/1.6.1/dojo/resources/dojo.css\"/>\r\n    <link rel=\"stylesheet\" href=\"http://yandex.st/dojo/1.6.1/dojo/resources/dnd.css\"/>\r\n    <link rel=\"stylesheet\" href=\"http://yandex.st/dojo/1.6.1/dijit/themes/claro/claro.css\"/>\r\n    <link rel=\"stylesheet\" href=\"http://yandex.st/dojo/1.6.1/dojox/grid/resources/Grid.css\"/>\r\n    <link rel=\"stylesheet\" href=\"http://yandex.st/dojo/1.6.1/dojox/grid/resources/claroGrid.css\"/>\r\n    <link rel=\"stylesheet\" type=\"text/css\" href=\"http://yandex.st/dojo/1.6.1/dojox/widget/Toaster/Toaster.css\"/>\r\n\r\nWe should really serve that up locally. It's bad form that every bugtrack page load his this server on the internet.", "samplequery":"", "sampledata":"", "version":"Bugtrack-2.0", "tofixin":"Bugtrack-2.1", "fixedin":"N/A", "platform":"all", "memory":"", "processors":"", "note":"", "subscribers":[{"username":"wfeick", "name":"Wayne Feick", "email":"wfeick@marklogic.com"}, {"username":"jhoy", "name":"Joe Hoy", "email":"Joe.Hoy@marklogic.com"}], "attachments":[], "relationships":[{"type":"", "to":""}], "clones":[], "cloneOf":"", "support":{"headline":"", "supportDescription":"", "publishStatus":"Not Ready", "tickets":[], "customerImpact":{"level":"N/A", "title":""}, "workaround":""}, "tags":["Bugtrack", "wfeick"], "hasUnitTests":"no", "changeHistory":[{"time":"2013-01-21T13:56:22.496539-08:00", "updatedBy":{"username":"wfeick", "name":"Wayne Feick", "email":"wfeick@marklogic.com"}, "change":{"assignTo":{"from":{"username":"wfeick", "name":"Wayne Feick", "email":"wfeick@marklogic.com"}, "to":{"username":"jhoy", "name":"Joe Hoy", "email":"Joe.Hoy@marklogic.com"}}}, "files":[], "show":true}, {"time":"2013-01-23T13:14:25.64305-08:00", "updatedBy":{"username":"dsokolsky", "name":"Danny Sokolsky", "email":"dsokolsky@marklogic.com"}, "change":{"tofixin":{"from":"", "to":"Bugtrack-2.1"}}, "files":[], "show":true}, {"time":"2014-05-02T20:43:55.859445-07:00", "updatedBy":{"username":"gvaidees", "name":"Ganesh Vaideeswaran", "email":"Ganesh.Vaideeswaran@marklogic.com"}, "change":{}, "files":[], "show":true, "comment":"We can look at this. But, I would think that things get cached after the first lookup. And it is standard practice to use CDN to load standard libraries like dojo I think.\r\n\r\nIt is much easier to point to a version of dojo outside than copy the version locally everytime. \r\n\r\nFor now, leaving this as is to have a conversation"}, {"time":"2014-05-02T20:46:54.575784-07:00", "updatedBy":{"username":"wfeick", "name":"Wayne Feick", "email":"wfeick@marklogic.com"}, "change":{}, "files":[], "show":true, "comment":"Observed slowness and stalls on remote content suggest any CDN isn't doing a good job."}, {"time":"2014-05-06T20:46:28.940419-07:00", "updatedBy":{"username":"gvaidees", "name":"Ganesh Vaideeswaran", "email":"Ganesh.Vaideeswaran@marklogic.com"}, "change":{}, "files":[], "show":true, "comment":"I would think once the browser caches, you should be fine. No?"}, {"time":"2014-05-07T07:58:05.290909-07:00", "updatedBy":{"username":"jhoy", "name":"Joe Hoy", "email":"Joe.Hoy@marklogic.com"}, "change":{}, "files":[], "show":true, "comment":"Dojo libraries are definitely a pain, but we're stuck with them for the time being. Which browser are you using?"}, {"time":"2014-05-07T09:02:34.879762-07:00", "updatedBy":{"username":"wfeick", "name":"Wayne Feick", "email":"wfeick@marklogic.com"}, "change":{}, "files":[], "show":true, "comment":"chrome"}, {"time":"2014-09-09T16:30:01.93288-07:00", "updatedBy":{"username":"dmaddox", "name":"Daphne Maddox", "email":"Daphne.Maddox@marklogic.com"}, "change":{}, "files":[], "show":true, "comment":"When updating a bug, I see about ~4 turnaround time before the POST is processed and a redirect occurs.  After that, it takes over 6 seconds to load the scripts and none of them are being read from the browser cache despite the headers being set correctly on the CDN.\r\n\r\nWRT the 4 second delay in getting any response from the bugtrack server --  I can only guess, but perhaps there are a lot of indexes to write?\r\n\r\nFor the extra 6 seconds, there might be a couple things we could do to the script:\r\n\r\n    <script>\r\n\t\t\t\tdojoConfig = {\r\n\t\t\t\t\tisDebug: true,\r\n\t\t\t\t\tbaseUrl: '../ui/',\r\n\t\t\t\t\tparseOnLoad: true,\r\n\t\t\t\t\tdebugAtAllCosts: true,\r\n\t\t\t\t\tmodulePaths: {\r\n\t\t\t\t\t\tcontrol: 'control',\r\n\t\t\t\t\t\tutil: 'util',\r\n\t\t\t\t\t\twidget: 'widget',\r\n\t\t\t\t\t\tdojo:'https://ajax.googleapis.com/ajax/libs/dojo/1.6.2/dojo',\r\n\t\t\t\t\t\tdijit:'https://ajax.googleapis.com/ajax/libs/dojo/1.6.2/dijit',\r\n\t\t\t\t\t\tdojox:'https://ajax.googleapis.com/ajax/libs/dojo/1.6.2/dojox'\r\n\t\t\t\t\t}\r\n\t\t\t\t}\r\n\t\t\t\t\r\n            </script>\r\n    <script src=\"https://ajax.googleapis.com/ajax/libs/dojo/1.6.2/dojo/dojo.js\"></script>\r\n    <script>\r\n                dojo.require(\"control.searchbar.app\");\r\n                dojo.require(\"control.result.simple\"); \r\n                dojo.ready(function(){\r\n                    control.result.simple.init();\r\n                    control.searchbar.app.init(\"ssalsbur\");\r\n                });\r\n            </script>\r\n\r\n1) don't include any inline script until after this line:     <script src=\"https://ajax.googleapis.com/ajax/libs/dojo/1.6.2/dojo/dojo.js\"></script>\r\n\r\n(the browser will be happier to download static scripts if they are all listed before inline script)\r\n\r\n2) turn of isDebug: true and debugAtAllCosts\r\n\r\n3) Use the async loader that ships with dojo 1.6, described here: http://dojotoolkit.org/features/1.6/async-modules -- this page actually describes a loading method that would probably include rewriting the above 12 or so lines of code, and I suspect if one were to implement what's in here, the other two points could happen as part of that effort (or leaving debugging on until the bugtrack app is deployed to production?)\r\n\r\nMy guess is that some combination of the above would solve the caching issue and pretty much eliminate the 6 seconds after the redirect.\r\n"}, {"time":"2015-03-04T08:44:58.41359-08:00", "updatedBy":{"username":"jhoy", "name":"Joe Hoy", "email":"Joe.Hoy@marklogic.com"}, "change":{}, "files":[], "show":true, "comment":"Hi Daphne,\r\n\r\nI'll definitely look into turning off debug (and parser on load, which also seems to cause a performance hit).  \r\n\r\nHaving read the DOJO documentation, the inline \"dojoConfig\" setup apparently has to happen before the static script is loaded, bit odd - but then DOJO can be a bit odd... :)"}, {"time":"2016-01-16T17:09:08.107Z", "updatedBy":{"name":"Ganesh Vaideeswaran", "email":"ganesh.vaideeswaran@marklogic.com", "username":"gvaidees"}, "change":{"status":{"from":"Verify", "to":"Closed"}, "assignTo":{"from":{"username":"jhoy", "name":"Joe Hoy", "email":"Joe.Hoy@marklogic.com"}, "to":{"username":"nobody", "email":"nobody@marklogic.com", "name":"nobody nobody"}}, "fixedin":{"from":"", "to":"N/A"}, "hasUnitTests":{"to":"no"}}, "comment":"Solved with new bugtrack", "files":[], "renderCommentAs":"markdown"}], "updatedAt":"2016-01-16T17:09:08.107Z", "renderDescriptionAs":"normal"}
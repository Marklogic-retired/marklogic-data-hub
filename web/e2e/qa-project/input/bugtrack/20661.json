{"id":20661, "kind":"Bug", "createdAt":"2013-01-26T10:28:31.571111-08:00", "status":"Closed", "title":"Diff in reverse_query2.xml starting 01/03/2013 in 5.0 (Original bug 20484)", "category":"xdmp", "severity":"Major", "priority":{"level":"5", "title":""}, "submittedBy":{"username":"jchen", "name":"Jane Chen", "email":"jane.chen@marklogic.com"}, "assignTo":{"username":"nobody", "name":"nobody nobody", "email":"nobody@marklogic.com"}, "description":"Identified the change that caused this: 126280.  I had to run the following:\r\n \r\nmake tests tname=foo clean=yes\r\nmake ut tname=reverse_query2.xml\r\n\r\nThe failed tests are:\r\nrun reverse query against saved queries for docs 1 to 10\r\nrun reverse query against saved queries for docs 11 to 20\r\nrun reverse query against saved queries for docs 21 to 30", "samplequery":"", "sampledata":"", "version":"6.0-nightly", "tofixin":"6.0-3", "fixedin":"6.0-3", "platform":"all", "memory":"", "processors":"", "note":"", "subscribers":[{"username":"jchen", "name":"Jane Chen", "email":"jane.chen@marklogic.com"}, {"username":"wfeick", "name":"Wayne Feick", "email":"wfeick@marklogic.com"}, {"username":"mary", "name":"Mary Holstege", "email":"mary@cerisent.com"}, {"username":"rpolasani", "name":"Raghu Polasani", "email":"raghu.polasani@marklogic.com"}, {"username":"msrinivasan", "name":"Mahalakshmi Srinivasan", "email":"mahalakshmi.srinivasan@marklogic.com"}], "attachments":[{"name":"diff", "uri":"root/support/bugtracking/attachments/20600/reverse_query2.xml"}, {"name":"reverse_query2.xml", "uri":"root/support/bugtracking/attachments/20600/3388419026154864534-reverse_query2.xml"}], "relationships":[{"type":"", "to":""}], "clones":[], "cloneOf":20600, "support":{"headline":"", "supportDescription":"nightly", "publishStatus":"Never Publish", "tickets":[], "customerImpact":{"level":"N/A", "title":""}, "workaround":""}, "tags":["xdmp", "jchen"], "changeHistory":[{"time":"2013-01-26T10:28:31.571111-08:00", "updatedBy":{"username":"jchen", "name":"Jane Chen", "email":"jane.chen@marklogic.com"}, "change":{"assignTo":{"from":{"username":"jchen", "name":"Jane Chen", "email":"jane.chen@marklogic.com"}, "to":{"username":"jchen", "name":"Jane Chen", "email":"jane.chen@marklogic.com"}}}, "files":[], "show":true}, {"time":"2013-01-28T12:58:40.70987-08:00", "updatedBy":{"username":"rhu", "name":"Ron Hu", "email":"ron.hu@marklogic.com"}, "change":{"status":{"from":"", "to":"Fix"}, "assignTo":{"from":{"username":"rhu", "name":"Ron Hu", "email":"ron.hu@marklogic.com"}, "to":{"username":"jchen", "name":"Jane Chen", "email":"jane.chen@marklogic.com"}}}, "files":[], "show":true}, {"time":"2013-01-28T15:30:30.613119-08:00", "updatedBy":{"username":"jchen", "name":"Jane Chen", "email":"jane.chen@marklogic.com"}, "change":{}, "files":[], "show":true, "comment":"A sample of the diffs:\r\n\r\n<h:result-text><result doc=\"/docs/dir1/doc1.xml\" estimate=\"1544\" expected-estimate=\"1614\" count=\"1544\" expected-count=\"1614\">\r\n<m-f-a-q>Too many to display(70). Displaying first 10: n-q1-en-stemmed-case-insensitive-ordered-d0 n-q1-en-stemmed-case-insensitive-ordered-d1 n-q1-en-stemmed-case-insensitive-ordered-d2 n-q1-en-stemmed-case-insensitive-ordered-d3 n-q1-en-stemmed-case-insensitive-ordered-d4 n-q1-en-stemmed-case-insensitive-unordered-d0 n-q1-en-stemmed-case-insensitive-unordered-d1 n-q1-en-stemmed-case-insensitive-unordered-d2 n-q1-en-stemmed-case-insensitive-unordered-d3 n-q1-en-stemmed-case-insensitive-unordered-d4</m-f-a-q>\r\n<m-f-a-u-q>Too many to display(70). Displaying first 10: n-q1-en-stemmed-case-insensitive-ordered-d0 n-q1-en-stemmed-case-insensitive-ordered-d1 n-q1-en-stemmed-case-insensitive-ordered-d2 n-q1-en-stemmed-case-insensitive-ordered-d3 n-q1-en-stemmed-case-insensitive-ordered-d4 n-q1-en-stemmed-case-insensitive-unordered-d0 n-q1-en-stemmed-case-insensitive-unordered-d1 n-q1-en-stemmed-case-insensitive-unordered-d2 n-q1-en-stemmed-case-insensitive-unordered-d3 n-q1-en-stemmed-case-insensitive-unordered-d4</m-f-a-u-q>\r\n"}, {"time":"2013-01-28T15:44:02.180564-08:00", "updatedBy":{"username":"jchen", "name":"Jane Chen", "email":"jane.chen@marklogic.com"}, "change":{}, "files":[], "show":true, "comment":"A sample of the diffs:\r\n\r\n<h:result-text><result doc=\"/docs/dir1/doc1.xml\" estimate=\"1544\" expected-estimate=\"1614\" count=\"1544\" expected-count=\"1614\">\r\n<m-f-a-q>Too many to display(70). Displaying first 10: n-q1-en-stemmed-case-insensitive-ordered-d0 n-q1-en-stemmed-case-insensitive-ordered-d1 n-q1-en-stemmed-case-insensitive-ordered-d2 n-q1-en-stemmed-case-insensitive-ordered-d3 n-q1-en-stemmed-case-insensitive-ordered-d4 n-q1-en-stemmed-case-insensitive-unordered-d0 n-q1-en-stemmed-case-insensitive-unordered-d1 n-q1-en-stemmed-case-insensitive-unordered-d2 n-q1-en-stemmed-case-insensitive-unordered-d3 n-q1-en-stemmed-case-insensitive-unordered-d4</m-f-a-q>\r\n<m-f-a-u-q>Too many to display(70). Displaying first 10: n-q1-en-stemmed-case-insensitive-ordered-d0 n-q1-en-stemmed-case-insensitive-ordered-d1 n-q1-en-stemmed-case-insensitive-ordered-d2 n-q1-en-stemmed-case-insensitive-ordered-d3 n-q1-en-stemmed-case-insensitive-ordered-d4 n-q1-en-stemmed-case-insensitive-unordered-d0 n-q1-en-stemmed-case-insensitive-unordered-d1 n-q1-en-stemmed-case-insensitive-unordered-d2 n-q1-en-stemmed-case-insensitive-unordered-d3 n-q1-en-stemmed-case-insensitive-unordered-d4</m-f-a-u-q>\r\n"}, {"time":"2013-01-28T18:41:06.341337-08:00", "updatedBy":{"username":"jchen", "name":"Jane Chen", "email":"jane.chen@marklogic.com"}, "change":{}, "files":[], "show":true, "comment":"/docs/dir1/doc1.xml:\r\n<?xml version=\"1.0\" encoding=\"UTF-8\"?>\r\n<test txt=\"run\">run</test>\r\n\r\nAn expected query that is missing from the actual queries:\r\n<?xml version=\"1.0\" encoding=\"UTF-8\"?>\r\n<results warning=\"more than one root item\">/queries/n-q/n-q1-en-stemmed-case-insensitive-ordered-d0.xml<query>\r\n    <cts:near-query distance=\"0\" xmlns:cts=\"http://marklogic.com/cts\">\r\n      <cts:word-query>\r\n\t<cts:text xml:lang=\"en\">runs</cts:text>\r\n\t<cts:option>case-insensitive</cts:option>\r\n\t<cts:option>stemmed</cts:option>\r\n      </cts:word-query>\r\n      <cts:element-word-query>\r\n\t<cts:element>test</cts:element>\r\n\t<cts:element>text</cts:element>\r\n\t<cts:text xml:lang=\"en\">running</cts:text>\r\n\t<cts:option>case-insensitive</cts:option>\r\n\t<cts:option>stemmed</cts:option>\r\n      </cts:element-word-query>\r\n      <cts:option>ordered</cts:option>\r\n    </cts:near-query>\r\n  </query></results>"}, {"time":"2013-01-28T18:41:06.341337-08:00", "updatedBy":{"username":"jchen", "name":"Jane Chen", "email":"jane.chen@marklogic.com"}, "change":{"status":{"from":"", "to":"Verify"}, "assignTo":{"from":{"username":"jchen", "name":"Jane Chen", "email":"jane.chen@marklogic.com"}, "to":{"username":"jchen", "name":"Jane Chen", "email":"jane.chen@marklogic.com"}}}, "files":[], "show":true}, {"time":"2013-01-30T10:17:32.931463-08:00", "updatedBy":{"username":"jchen", "name":"Jane Chen", "email":"jane.chen@marklogic.com"}, "change":{}, "files":[], "show":true, "comment":"Without change 126280, the expression tree of the above near query:\r\n\r\n{{{0x7fbabb80d7e0, DOC, 10, 0}, [9]}}\r\n  {{{0x7fbabce70780, NEAR, 9, 0}, [2, 8]}, 0, ordered}\r\n    {{0x7fbabb80e310, WORD, 2, 1}, [1]}\r\n      {{{0x7fbabb80d420, FACT, 1, 1}, 1, 0}, 12309531786305946737, -element, -value}\r\n    {{0x7fbabb80e250, OR, 8, 1}, [5, 7]}\r\n      {{{0x7fbabb80e1f0, AND, 5, 1}, [4, 2]}, unordered}\r\n        {{0x7fbabc3d4e40, TERM, 4, 1}, 3}\r\n          {{{0x7fbabb80d740, FACT, 3, 0}, 1, 0}, 13413973886780092482, -element, -value}\r\n        {{0x7fbabb80e310, WORD, 2, 1}, [1]}\r\n          {{{0x7fbabb80d420, FACT, 1, 1}, 1, 0}, 12309531786305946737, -element, -value}\r\n      {{0x7fbabc3d4e20, TERM, 7, 1}, 6}\r\n        {{{0x7fbabb80d790, FACT, 6, 0}, 1, 0}, 10132198487908563266, -element, -value}\r\n\r\nWith change 126280, the expression tree of the same near query:\r\n\r\n   {{{0x7f10bb43edd0, DOC, 11, 0}, [10]}}\r\n     {{{0x7f10ec1af080, NEAR, 10, 0}, [2, 9]}, 0, ordered}\r\n       {{0x7f10bb43f280, WORD, 2, 1}, [1]}\r\n         {{{0x7f10bb43ea10, FACT, 1, 1}, 1, 0}, 12309531786305946737, -element, -value}\r\n       {{0x7f10bb43f3a0, OR, 9, 1}, [6, 8]}\r\n         {{{0x7f10bb43f1f0, AND, 6, 1}, [4, 5]}, unordered}\r\n           {{0x7f10badb4520, TERM, 4, 1}, 3}\r\n             {{{0x7f10bb43ed30, FACT, 3, 0}, 1, 0}, 13413973886780092482, -element, -value}\r\n           {{0x7f10bb43f160, WORD, 5, 1}, [1, 1]}\r\n             {{{0x7f10bb43ea10, FACT, 1, 1}, 1, 0}, 12309531786305946737, -element, -value}\r\n             {{{0x7f10bb43ea10, FACT, 1, 1}, 1, 0}, 12309531786305946737, -element, -value}\r\n         {{0x7f10badb4500, TERM, 8, 1}, 7}\r\n           {{{0x7f10bb43ed80, FACT, 7, 0}, 1, 0}, 10132198487908563266, -element, -value}\r\n"}, {"time":"2013-01-30T13:47:11.425304-08:00", "updatedBy":{"username":"jchen", "name":"Jane Chen", "email":"jane.chen@marklogic.com"}, "change":{}, "files":[], "show":true, "comment":"Forward query plan:\r\n\r\n<?xml version=\"1.0\" encoding=\"UTF-8\"?>\r\n<qry:query-plan xmlns:qry=\"http://marklogic.com/cts/query\">\r\n  <qry:info-trace>xdmp:eval(\"let $qry := doc(&amp;quot;/queries/n-q/n-q1-en-stemmed-case-insensit...\", (), &lt;options xmlns=\"xdmp:eval\"&gt;&lt;database&gt;17796426362271058211&lt;/database&gt;&lt;isolation&gt;different-tr...&lt;/options&gt;)</qry:info-trace>\r\n  <qry:info-trace>Analyzing path for search: fn:collection()/test</qry:info-trace>\r\n  <qry:info-trace>Step 1 is searchable: fn:collection()</qry:info-trace>\r\n  <qry:info-trace>Step 2 is searchable: test</qry:info-trace>\r\n  <qry:info-trace>Path is fully searchable.</qry:info-trace>\r\n  <qry:info-trace>Gathering constraints.</qry:info-trace>\r\n  <qry:word-trace text=\"runs\">\r\n    <qry:key>12309531786305946737</qry:key>\r\n  </qry:word-trace>\r\n  <qry:elem-word-trace text=\"running\" elem-name=\"test\" elem-uri=\"\">\r\n    <qry:key>13413973886780092482</qry:key>\r\n  </qry:elem-word-trace>\r\n  <qry:word-trace text=\"running\">\r\n    <qry:key>12309531786305946737</qry:key>\r\n  </qry:word-trace>\r\n  <qry:elem-word-trace text=\"running\" elem-name=\"text\" elem-uri=\"\">\r\n    <qry:key>10132198487908563266</qry:key>\r\n  </qry:elem-word-trace>\r\n  <qry:word-trace text=\"running\">\r\n    <qry:key>12309531786305946737</qry:key>\r\n  </qry:word-trace>\r\n  <qry:info-trace>Search query contributed 1 constraint: cts:near-query((cts:word-query(\"runs\", (\"case-insensitive\",\"stemmed\",\"lang=en\"), 1), cts:element-word-query((fn:QName(\"\", \"test\"), fn:QName(\"\", \"text\")), \"running\", (\"case-insensitive\",\"stemmed\",\"lang=en\"), 1)), 0, (\"ordered\"), 1)</qry:info-trace>\r\n  <qry:partial-plan>\r\n    <qry:near-two-queries weight=\"1\" ordered=\"true\" distance=\"0\">\r\n      <qry:word-query weight=\"1\" min-occurs=\"1\" max-occurs=\"4294967295\">\r\n\t<qry:KP pos=\"0\">\r\n\t  <qry:key>12309531786305946737</qry:key>\r\n\t</qry:KP>\r\n      </qry:word-query>\r\n      <qry:or-two-queries>\r\n\t<qry:and-two-queries>\r\n\t  <qry:term-query weight=\"1\">\r\n\t    <qry:key>13413973886780092482</qry:key>\r\n\t  </qry:term-query>\r\n\t  <qry:word-query weight=\"0\" min-occurs=\"1\" max-occurs=\"4294967295\">\r\n\t    <qry:KP pos=\"0\">\r\n\t      <qry:key>12309531786305946737</qry:key>\r\n\t    </qry:KP>\r\n\t    <qry:KP pos=\"0\">\r\n\t      <qry:key>12309531786305946737</qry:key>\r\n\t    </qry:KP>\r\n\t  </qry:word-query>\r\n\t</qry:and-two-queries>\r\n\t<qry:term-query weight=\"1\">\r\n\t  <qry:key>10132198487908563266</qry:key>\r\n\t</qry:term-query>\r\n      </qry:or-two-queries>\r\n    </qry:near-two-queries>\r\n  </qry:partial-plan>\r\n  <qry:info-trace>Executing search.</qry:info-trace>\r\n  <qry:final-plan>\r\n    <qry:and-query>\r\n      <qry:or-two-queries>\r\n\t<qry:term-query weight=\"0\">\r\n\t  <qry:key>5100589932691647462</qry:key>\r\n\t</qry:term-query>\r\n\t<qry:term-query weight=\"0\">\r\n\t  <qry:key>4264335197134104854</qry:key>\r\n\t</qry:term-query>\r\n      </qry:or-two-queries>\r\n      <qry:near-two-queries weight=\"1\" ordered=\"true\" distance=\"0\">\r\n\t<qry:word-query weight=\"1\" min-occurs=\"1\" max-occurs=\"4294967295\">\r\n\t  <qry:KP pos=\"0\">\r\n\t    <qry:key>12309531786305946737</qry:key>\r\n\t  </qry:KP>\r\n\t</qry:word-query>\r\n\t<qry:or-two-queries>\r\n\t  <qry:and-two-queries>\r\n\t    <qry:term-query weight=\"1\">\r\n\t      <qry:key>13413973886780092482</qry:key>\r\n\t    </qry:term-query>\r\n\t    <qry:word-query weight=\"0\" min-occurs=\"1\" max-occurs=\"4294967295\">\r\n\t      <qry:KP pos=\"0\">\r\n\t\t<qry:key>12309531786305946737</qry:key>\r\n\t      </qry:KP>\r\n\t      <qry:KP pos=\"0\">\r\n\t\t<qry:key>12309531786305946737</qry:key>\r\n\t      </qry:KP>\r\n\t    </qry:word-query>\r\n\t  </qry:and-two-queries>\r\n\t  <qry:term-query weight=\"1\">\r\n\t    <qry:key>10132198487908563266</qry:key>\r\n\t  </qry:term-query>\r\n\t</qry:or-two-queries>\r\n      </qry:near-two-queries>\r\n    </qry:and-query>\r\n  </qry:final-plan>\r\n  <qry:info-trace>Selected 12 fragments to filter</qry:info-trace>\r\n  <qry:result estimate=\"12\"/>\r\n</qry:query-plan>"}, {"time":"2013-01-30T22:56:48.574092-08:00", "updatedBy":{"username":"jchen", "name":"Jane Chen", "email":"jane.chen@marklogic.com"}, "change":{"status":{"from":"", "to":"Fix"}, "assignTo":{"from":{"username":"jchen", "name":"Jane Chen", "email":"jane.chen@marklogic.com"}, "to":{"username":"mary", "name":"Mary Holstege", "email":"mary@cerisent.com"}}}, "files":[], "show":true, "comment":"Tested Mary's patch and it fixed the issue.  So passing this on to Mary."}, {"time":"2013-01-30T22:56:48.574092-08:00", "updatedBy":{"username":"jchen", "name":"Jane Chen", "email":"jane.chen@marklogic.com"}, "change":{"assignTo":{"from":{"username":"jchen", "name":"Jane Chen", "email":"jane.chen@marklogic.com"}, "to":{"username":"mary", "name":"Mary Holstege", "email":"mary@cerisent.com"}}}, "files":[], "show":true}, {"time":"2013-01-31T07:40:36.251929-08:00", "updatedBy":{"username":"mary", "name":"Mary Holstege", "email":"mary@cerisent.com"}, "change":{"tofixin":{"from":"", "to":"6.0-3"}}, "files":[], "show":true}, {"time":"2013-01-31T07:52:53.741644-08:00", "updatedBy":{"username":"mary", "name":"Mary Holstege", "email":"mary@cerisent.com"}, "change":{}, "files":[], "show":true, "svn":{"repository":"/project/engsvn", "revision":"130139", "paths":["xdmp/branches/b6_0/src/SearchBuiltins.cpp"], "affectedBugs":[]}, "comment":"Bug:20661 port fix to 6.0 branch"}, {"time":"2013-01-31T07:54:00.856732-08:00", "updatedBy":{"username":"mary", "name":"Mary Holstege", "email":"mary@cerisent.com"}, "change":{"status":{"from":"", "to":"Test"}, "assignTo":{"from":{"username":"mary", "name":"Mary Holstege", "email":"mary@cerisent.com"}, "to":{"username":"rpolasani", "name":"Raghu Polasani", "email":"raghu.polasani@marklogic.com"}}}, "files":[], "show":true, "comment":"Fixed 6.0-20130201\r\n\r\nSee comments on original Bug:20600"}, {"time":"2013-01-31T07:54:00.856732-08:00", "updatedBy":{"username":"mary", "name":"Mary Holstege", "email":"mary@cerisent.com"}, "change":{"assignTo":{"from":{"username":"mary", "name":"Mary Holstege", "email":"mary@cerisent.com"}, "to":{"username":"rpolasani", "name":"Raghu Polasani", "email":"raghu.polasani@marklogic.com"}}}, "files":[], "show":true}, {"time":"2013-03-18T16:51:31.931704-07:00", "updatedBy":{"username":"msrinivasan", "name":"Mahalakshmi Srinivasan", "email":"mahalakshmi.srinivasan@marklogic.com"}, "change":{"assignTo":{"from":{"username":"msrinivasan", "name":"Mahalakshmi Srinivasan", "email":"mahalakshmi.srinivasan@marklogic.com"}, "to":{"username":"msrinivasan", "name":"Mahalakshmi Srinivasan", "email":"mahalakshmi.srinivasan@marklogic.com"}}}, "files":[], "show":true}, {"time":"2013-03-25T15:34:06.370775-07:00", "updatedBy":{"username":"msrinivasan", "name":"Mahalakshmi Srinivasan", "email":"mahalakshmi.srinivasan@marklogic.com"}, "change":{"status":{"from":"", "to":"Ship"}, "assignTo":{"from":{"username":"msrinivasan", "name":"Mahalakshmi Srinivasan", "email":"mahalakshmi.srinivasan@marklogic.com"}, "to":{"username":"nobody", "name":"nobody nobody", "email":"nobody@marklogic.com"}}}, "files":[], "show":true, "comment":"The test passes in regression as of build 6.0-20130324."}], "updatedAt":"2013-03-25T15:34:06.370775-07:00", "fixedAt":"2013-01-31T07:54:00.856732-08:00", "fixedBy":{"username":"mary", "name":"Mary Holstege", "email":"mary@cerisent.com"}, "shippedAt":"2013-03-25T15:34:06.370775-07:00", "shippedBy":{"username":"msrinivasan", "name":"Mahalakshmi Srinivasan", "email":"mahalakshmi.srinivasan@marklogic.com"}, "renderDescriptionAs":"normal"}
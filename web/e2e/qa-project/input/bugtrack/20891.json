{"id":20891, "kind":"Bug", "createdAt":"2013-02-21T19:48:29.938417-08:00", "status":"Closed", "title":"Wildcard space sensitive query not working correctly with three character word positions", "category":"search", "severity":"Minor", "priority":{"level":"5", "title":""}, "submittedBy":{"username":"dchander", "name":"Dinesh Chander", "email":"dinesh.chander@globallogic.com"}, "assignTo":{"username":"nobody", "name":"nobody nobody", "email":"nobody@marklogic.com"}, "description":"Reported by user in support case #12508\r\nSteps to reproduce\r\n1.) On an out-of-box installation, enable \"three character searches\" & \"three character word positions\" index on any database (e.g. Documents).\r\n2.) (: test document :)\r\nxdmp:document-insert(\"/test1.xml\", <test><author xmlns=\"urn:catalyst:case:qtest_0002\">abc 123</author></test>\r\n3.) (: search query :)\r\ncts:search(doc(), cts:query(<cts:element-word-query xmlns:cts=\"http://marklogic.com/cts\">\r\n<cts:element xmlns:_1=\"urn:catalyst:case:qtest_0002\">_1:author</cts:element><cts:text>abc?123</cts:text>\r\n<cts:option>whitespace-sensitive</cts:option></cts:element-word-query>), \"unfiltered\")\r\n\r\nExpected result\r\nThe query should return the document.\r\n\r\nActual result\r\nThe query is not returning the document.", "samplequery":"", "sampledata":"", "version":"6.0-2.2", "tofixin":"6.0-4", "fixedin":"6.0-4", "platform":"all", "memory":"", "processors":"", "note":"", "subscribers":[{"username":"dchander", "name":"Dinesh Chander", "email":"dinesh.chander@globallogic.com"}, {"username":"fxue", "name":"Fei Xue", "email":"Fei.Xue@marklogic.com"}, {"username":"mary", "name":"Mary Holstege", "email":"mary@cerisent.com"}, {"username":"rpolasani", "name":"Raghu Polasani", "email":"raghu.polasani@marklogic.com"}, {"username":"msrinivasan", "name":"Mahalakshmi Srinivasan", "email":"mahalakshmi.srinivasan@marklogic.com"}], "attachments":[], "relationships":[{"type":"", "to":""}], "clones":[20892, 22834], "cloneOf":"", "support":{"headline":"Wildcard space sensitive query not working correctly with three character word positions", "supportDescription":"When performing a wildcarded query with whitespace sensitive and character position on, character after the wildcard (? or  *) will be assigned wrong position, giving incorrect result.", "publishStatus":"Publish", "tickets":[], "customerImpact":{"level":"Low", "title":"Minimal business impact or reasonable workaround is available"}, "workaround":"Rewrite pattern with whitespace insensitive."}, "tags":["search", "dchander"], "changeHistory":[{"time":"2013-02-22T12:03:22.541465-08:00", "updatedBy":{"username":"dsokolsky", "name":"Danny Sokolsky", "email":"dsokolsky@marklogic.com"}, "change":{"status":{"from":"", "to":"Verify"}, "assignTo":{"from":{"username":"dsokolsky", "name":"Danny Sokolsky", "email":"dsokolsky@marklogic.com"}, "to":{"username":"mary", "name":"Mary Holstege", "email":"mary@cerisent.com"}}}, "files":[], "show":true}, {"time":"2013-02-22T12:03:22.541465-08:00", "updatedBy":{"username":"dsokolsky", "name":"Danny Sokolsky", "email":"dsokolsky@marklogic.com"}, "change":{"assignTo":{"from":{"username":"dsokolsky", "name":"Danny Sokolsky", "email":"dsokolsky@marklogic.com"}, "to":{"username":"mary", "name":"Mary Holstege", "email":"mary@cerisent.com"}}}, "files":[], "show":true}, {"time":"2013-02-22T12:03:22.541465-08:00", "updatedBy":{"username":"dsokolsky", "name":"Danny Sokolsky", "email":"dsokolsky@marklogic.com"}, "change":{"tofixin":{"from":"", "to":"6.0-3"}}, "files":[], "show":true}, {"time":"2013-02-22T14:56:48.845593-08:00", "updatedBy":{"username":"dsokolsky", "name":"Danny Sokolsky", "email":"dsokolsky@marklogic.com"}, "change":{}, "files":[], "show":true, "comment":"I think they also need word positions and a codepoint word lexicon for this to be accurate."}, {"time":"2013-02-28T12:06:39.564985-08:00", "updatedBy":{"username":"rhu", "name":"Ron Hu", "email":"ron.hu@marklogic.com"}, "change":{"tofixin":{"from":"6.0-3", "to":"6.0-4"}}, "files":[], "show":true}, {"time":"2013-06-12T16:52:55.992941-07:00", "updatedBy":{"username":"rpelton", "name":"Rick Pelton", "email":"rick.pelton@marklogic.com"}, "change":{}, "files":[], "show":true, "comment":"Hi Dinesh, \r\nCan you verify, given Danny's comments?\r\nThanks, \r\n"}, {"time":"2013-06-13T02:13:21.095876-07:00", "updatedBy":{"username":"dchander", "name":"Dinesh Chander", "email":"dinesh.chander@globallogic.com"}, "change":{}, "files":[], "show":true, "comment":"Hi Rick, Danny,\r\n\r\nYes it works correctly if I also enable word positions and a codepoint word lexicon.\r\nBut the issue is it works fine when I enable just one index \"three character searches\". The moment I add \"three character word positions\" it fails. Mary has also agreed that it's a bug.\r\n\r\n------------------------------------------------------------------------------------\r\nFrom: Mary Holstege [mailto:mary.holstege@marklogic.com] \r\nSent: Thursday, February 21, 2013 11:08 PM\r\nTo: Dinesh Chander\r\nSubject: Re: Help needed - case #12508: Oddities in Wildcard Character Searches\r\n\r\nOn Thu, 21 Feb 2013 08:36:16 -0800, Dinesh Chander <Dinesh.Chander@marklogic.com> wrote:\r\n\r\n> Hi Mary,\r\n>\r\n> Just to be sure, in the first case without the \"three character word positions\" the query is returning false positive. Does that mean it should be removed by the filter? I can see the document even with filtered search.\r\n>\r\n> Thanks,\r\n> Dinesh Chander\r\n\r\nHmmm.... oh, there is a whitespace-sensitive in there. I missed that before.\r\nSorry, that changes things. What it means is that, yes, there is a bug with the first query: it shouldn't be using positions for the three character keys.\r\n"}, {"time":"2013-06-24T15:05:32.572631-07:00", "updatedBy":{"username":"rhu", "name":"Ron Hu", "email":"ron.hu@marklogic.com"}, "change":{}, "files":[], "show":true, "comment":"reassign to Fei to balance workload."}, {"time":"2013-06-24T15:05:32.572631-07:00", "updatedBy":{"username":"rhu", "name":"Ron Hu", "email":"ron.hu@marklogic.com"}, "change":{"assignTo":{"from":{"username":"rhu", "name":"Ron Hu", "email":"ron.hu@marklogic.com"}, "to":{"username":"fxue", "name":"Fei Xue", "email":"Fei.Xue@marklogic.com"}}}, "files":[], "show":true}, {"time":"2013-06-24T15:05:32.572631-07:00", "updatedBy":{"username":"rhu", "name":"Ron Hu", "email":"ron.hu@marklogic.com"}, "change":{"tofixin":{"from":"6.0-4", "to":"6.0-5"}}, "files":[], "show":true}, {"time":"2013-06-25T15:17:20.926515-07:00", "updatedBy":{"username":"fxue", "name":"Fei Xue", "email":"Fei.Xue@marklogic.com"}, "change":{}, "files":[], "show":true, "svn":{"repository":"/project/engsvn", "revision":"145098", "paths":["xdmp/branches/b6_0/src/SearchBuiltins.cpp"], "affectedBugs":[]}, "comment":"bug:20891 stop use pos when ?/* and space/punct sensitive"}, {"time":"2013-06-25T15:17:57.367635-07:00", "updatedBy":{"username":"fxue", "name":"Fei Xue", "email":"Fei.Xue@marklogic.com"}, "change":{"status":{"from":"", "to":"Test"}, "assignTo":{"from":{"username":"fxue", "name":"Fei Xue", "email":"Fei.Xue@marklogic.com"}, "to":{"username":"rpolasani", "name":"Raghu Polasani", "email":"raghu.polasani@marklogic.com"}}}, "files":[], "show":true, "comment":"Fixed 6.0-4-20130626"}, {"time":"2013-06-25T15:17:57.367635-07:00", "updatedBy":{"username":"fxue", "name":"Fei Xue", "email":"Fei.Xue@marklogic.com"}, "change":{"assignTo":{"from":{"username":"fxue", "name":"Fei Xue", "email":"Fei.Xue@marklogic.com"}, "to":{"username":"rpolasani", "name":"Raghu Polasani", "email":"raghu.polasani@marklogic.com"}}}, "files":[], "show":true}, {"time":"2013-06-25T15:17:57.367635-07:00", "updatedBy":{"username":"fxue", "name":"Fei Xue", "email":"Fei.Xue@marklogic.com"}, "change":{"tofixin":{"from":"6.0-5", "to":"6.0-4"}}, "files":[], "show":true}, {"time":"2013-07-08T14:37:02.826177-07:00", "updatedBy":{"username":"fxue", "name":"Fei Xue", "email":"Fei.Xue@marklogic.com"}, "change":{}, "files":[], "show":true, "svn":{"repository":"/project/engsvn", "revision":"145994", "paths":["xdmp/branches/b6_0/src/SearchBuiltins.cpp"], "affectedBugs":[]}, "comment":"bug:20891 do not use position when just one word"}, {"time":"2013-07-13T11:28:11.397891-07:00", "updatedBy":{"username":"rpolasani", "name":"Raghu Polasani", "email":"raghu.polasani@marklogic.com"}, "change":{"assignTo":{"from":{"username":"rpolasani", "name":"Raghu Polasani", "email":"raghu.polasani@marklogic.com"}, "to":{"username":"msrinivasan", "name":"Mahalakshmi Srinivasan", "email":"mahalakshmi.srinivasan@marklogic.com"}}}, "files":[], "show":true}, {"time":"2013-07-16T14:49:37.100795-07:00", "updatedBy":{"username":"msrinivasan", "name":"Mahalakshmi Srinivasan", "email":"mahalakshmi.srinivasan@marklogic.com"}, "change":{"status":{"from":"", "to":"Ship"}, "assignTo":{"from":{"username":"msrinivasan", "name":"Mahalakshmi Srinivasan", "email":"mahalakshmi.srinivasan@marklogic.com"}, "to":{"username":"nobody", "name":"nobody nobody", "email":"nobody@marklogic.com"}}}, "files":[], "show":true, "comment":"Verified on build 6.0-20130715."}, {"time":"2013-08-12T18:02:27.272664-07:00", "updatedBy":{"username":"rpelton", "name":"Rick Pelton", "email":"rick.pelton@marklogic.com"}, "change":{"status":{"from":"", "to":"Closed"}, "assignTo":{"from":{"username":"rpelton", "name":"Rick Pelton", "email":"rick.pelton@marklogic.com"}, "to":{"username":"nobody", "name":"nobody nobody", "email":"nobody@marklogic.com"}}}, "files":[], "show":true}], "updatedAt":"2013-08-12T18:02:27.272664-07:00", "fixedAt":"2013-06-25T15:17:57.367635-07:00", "fixedBy":{"username":"fxue", "name":"Fei Xue", "email":"Fei.Xue@marklogic.com"}, "shippedAt":"2013-07-16T14:49:37.100795-07:00", "shippedBy":{"username":"msrinivasan", "name":"Mahalakshmi Srinivasan", "email":"mahalakshmi.srinivasan@marklogic.com"}, "closedAt":"2013-08-12T18:02:27.272664-07:00", "closedBy":{"username":"rpelton", "name":"Rick Pelton", "email":"rick.pelton@marklogic.com"}, "renderDescriptionAs":"normal"}
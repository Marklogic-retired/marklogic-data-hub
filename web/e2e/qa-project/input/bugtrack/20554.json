{"id":20554, "kind":"Bug", "createdAt":"2011-12-18T10:15:31.939573-08:00", "status":"Closed", "title":"Internal Error adding an HTTP application server", "category":"Admin API", "severity":"Major", "priority":{"level":"5", "title":""}, "submittedBy":{"username":"dfeldman", "name":"Damon Feldman", "email":"dfeldman@marklogic.com"}, "assignTo":{"username":"nobody", "name":"nobody nobody", "email":"nobody@marklogic.com"}, "description":"I added an application server and got this error:\r\n\r\n\r\nYou've encountered an error in the server. Please copy the text below, and email support (support@marklogic.com):\r\n500: Internal Server Error\r\nXDMP-AS: (err:XPTY0004) $value as node()? -- Invalid coercion: (<http-server xmlns:xsi=\"http://www.w3.org/2001/XMLSchema-instance\" xmlns=\"http://marklogic.com/xdmp/group\"><http-server-id>9566032335408920699</http-server-id><http-server...</http-server>, <http-server xmlns:xsi=\"http://www.w3.org/2001/XMLSchema-instance\" xmlns=\"http://marklogic.com/xdmp/group\"><http-server-id>9566032335408920699</http-server-id><http-server...</http-server>) as node()?\r\nIn /lib/group-config-validate.xqy on line 22\r\nIn invalidGroupConfig(<xs:schema targetNamespace=\"http://marklogic.com/xdmp/group\" xsi:schemaLocation=\"http://www.w3.org/2001/XMLSchema XMLSchema.xsd http://marklogic....\" attributeFormDefault=\"unqualified\" elementFormDefault=\"unqualified\" xmlns:xhtml=\"http://www.w3.org/1999/xhtml\" xmlns:xsi=\"http://www.w3.org/2001/XMLSchema-instance\" xmlns:xs=\"http://www.w3.org/2001/XMLSchema\" xmlns:admin=\"http://marklogic.com/xdmp/admin\" xmlns=\"http://marklogic.com/xdmp/group\"><xs:annotation><xs:documentation>&#10; Server configuration...</xs:schema>, \"http-server\", (<http-server xmlns:xsi=\"http://www.w3.org/2001/XMLSchema-instance\" xmlns=\"http://marklogic.com/xdmp/group\"><http-server-id>9566032335408920699</http-server-id><http-server...</http-server>, <http-server xmlns:xsi=\"http://www.w3.org/2001/XMLSchema-instance\" xmlns=\"http://marklogic.com/xdmp/group\"><http-server-id>9566032335408920699</http-server-id><http-server...</http-server>))\r\n$schemaroot = <xs:schema targetNamespace=\"http://marklogic.com/xdmp/group\" xsi:schemaLocation=\"http://www.w3.org/2001/XMLSchema XMLSchema.xsd http://marklogic....\" attributeFormDefault=\"unqualified\" elementFormDefault=\"unqualified\" xmlns:xhtml=\"http://www.w3.org/1999/xhtml\" xmlns:xsi=\"http://www.w3.org/2001/XMLSchema-instance\" xmlns:xs=\"http://www.w3.org/2001/XMLSchema\" xmlns:admin=\"http://marklogic.com/xdmp/admin\" xmlns=\"http://marklogic.com/xdmp/group\"><xs:annotation><xs:documentation>&#10; Server configuration...</xs:schema>\r\n$name = \"http-server\"\r\nIn /add-http-servers-go.xqy on line 492\r\n$confirm = \"0\"\r\n$cancel = \"\"\r\n$cancelconf = \"\"\r\n$schemaroot = <xs:schema targetNamespace=\"http://marklogic.com/xdmp/group\" xsi:schemaLocation=\"http://www.w3.org/2001/XMLSchema XMLSchema.xsd http://marklogic....\" attributeFormDefault=\"unqualified\" elementFormDefault=\"unqualified\" xmlns:xhtml=\"http://www.w3.org/1999/xhtml\" xmlns:xsi=\"http://www.w3.org/2001/XMLSchema-instance\" xmlns:xs=\"http://www.w3.org/2001/XMLSchema\" xmlns:admin=\"http://marklogic.com/xdmp/admin\" xmlns=\"http://marklogic.com/xdmp/group\"><xs:annotation><xs:documentation>&#10; Server configuration...</xs:schema>\r\n$datanode = <groups xsi:schemaLocation=\"http://marklogic.com/xdmp/group group.xsd\" timestamp=\"223122013363\" xmlns=\"http://marklogic.com/xdmp/group\" xmlns:xsi=\"http://www.w3.org/2001/XMLSchema-instance\"><group><group-name>Default</group-name><group-id>148180866296252...</groups>\r\n$group = xs:unsignedLong(\"14818086629625280497\")\r\n$http = xs:unsignedLong(\"9566032335408920699\")\r\n$webDAV = fn:false()\r\n$output = <groups xsi:schemaLocation=\"http://marklogic.com/xdmp/group group.xsd\" xmlns:xsi=\"http://www.w3.org/2001/XMLSchema-instance\" xmlns=\"http://marklogic.com/xdmp/group\"><group><group-name>Default</group-name><group-id>148180866296252...</groups>\r\n$outgrp = <group xmlns:xsi=\"http://www.w3.org/2001/XMLSchema-instance\" xmlns=\"http://marklogic.com/xdmp/group\"><group-name>Default</group-name><group-id>14818086629625280497</...</group>\r\n$servers = <http-servers xmlns:xsi=\"http://www.w3.org/2001/XMLSchema-instance\" xmlns=\"http://marklogic.com/xdmp/group\"><http-server><http-server-id>17380201469726512954</http-server-i...</http-servers>\r\n$serv = (<http-server xmlns:xsi=\"http://www.w3.org/2001/XMLSchema-instance\" xmlns=\"http://marklogic.com/xdmp/group\"><http-server-id>9566032335408920699</http-server-id><http-server...</http-server>, <http-server xmlns:xsi=\"http://www.w3.org/2001/XMLSchema-instance\" xmlns=\"http://marklogic.com/xdmp/group\"><http-server-id>9566032335408920699</http-server-id><http-server...</http-server>)\r\n\r\nThis occured after:\r\nInstalling CPF twice. The first time did not seem to take (I assumed I did not hit a final OK button).\r\nTrying to add an app server and having it fail, saying the port was probably already in use.\r\n\r\nI then tried to rename another app server and that worked fine.\r\nI then tried again to create this app server, and it worked this time. (I.e. the bug is not reproducable)", "samplequery":"", "sampledata":"", "version":"7.0-nightly", "tofixin":"7.0-ea1", "fixedin":"7.0-ea1", "platform":"windows(64-bit)", "memory":"", "processors":"", "note":"5.0-1.2", "subscribers":[{"username":"dfeldman", "name":"Damon Feldman", "email":"dfeldman@marklogic.com"}, {"username":"bmo", "name":"Brian Mo", "email":"brian.mo@marklogic.com"}, {"username":"cgreer", "name":"Charles Greer", "email":"charles.greer@marklogic.com"}, {"username":"wfeick", "name":"Wayne Feick", "email":"wfeick@marklogic.com"}, {"username":"vkorolev", "name":"Vitaly Korolev", "email":"vitaly.korolev@marklogic.com"}, {"username":"msarma", "name":"Meghalim Sarma", "email":"msarma@marklogic.com"}], "attachments":[], "relationships":[{"type":"", "to":""}], "clones":[], "cloneOf":15975, "support":{"headline":"", "supportDescription":"", "publishStatus":"Not Ready", "tickets":[], "customerImpact":{"level":"Low", "title":"Minimal business impact or reasonable workaround is available"}, "workaround":""}, "tags":["Admin API", "dfeldman"], "changeHistory":[{"time":"2011-12-19T10:09:12.692096-08:00", "updatedBy":{"username":"wwallach", "name":"Walt Wallach", "email":"wwallach@marklogic.com"}, "change":{"status":{"from":"", "to":"Verify"}, "assignTo":{"from":{"username":"wwallach", "name":"Walt Wallach", "email":"wwallach@marklogic.com"}, "to":{"username":"cgreer", "name":"Charles Greer", "email":"charles.greer@marklogic.com"}}}, "files":[], "show":true, "comment":"MOnitor this. We'll close if it doesn't recur."}, {"time":"2011-12-19T10:09:12.692096-08:00", "updatedBy":{"username":"wwallach", "name":"Walt Wallach", "email":"wwallach@marklogic.com"}, "change":{"assignTo":{"from":{"username":"wwallach", "name":"Walt Wallach", "email":"wwallach@marklogic.com"}, "to":{"username":"cgreer", "name":"Charles Greer", "email":"charles.greer@marklogic.com"}}}, "files":[], "show":true}, {"time":"2012-01-20T10:51:43.58892-08:00", "updatedBy":{"username":"cgreer", "name":"Charles Greer", "email":"charles.greer@marklogic.com"}, "change":{}, "files":[], "show":true, "comment":"Ganesh triage info:\r\nSee comments.  We haven't managed to reproduce this bug.  It has to do with getting the server into a problematic state with CPF, and hasn't appeared again after this initial submission.\r\n\r\nRecommendation: Up to you.  Should certainly be pushed to a later release, perhaps closed."}, {"time":"2012-01-20T11:12:07.123792-08:00", "updatedBy":{"username":"cgreer", "name":"Charles Greer", "email":"charles.greer@marklogic.com"}, "change":{"status":{"from":"", "to":"Closed"}, "assignTo":{"from":{"username":"cgreer", "name":"Charles Greer", "email":"charles.greer@marklogic.com"}, "to":{"username":"nobody", "name":"nobody nobody", "email":"nobody@marklogic.com"}}}, "files":[], "show":true, "comment":"Thanks Damon, you don't have to say that twice.  Every bit helps with the big triage underway."}, {"time":"2012-10-08T16:33:24.970433-07:00", "updatedBy":{"username":"rpelton", "name":"Rick Pelton", "email":"rick.pelton@marklogic.com"}, "change":{}, "files":[], "show":true, "comment":"Re-opening as this error has been seen in the field https://help.marklogic.com/staff/Tickets/Ticket/View/11935/"}, {"time":"2012-10-08T16:33:24.970433-07:00", "updatedBy":{"username":"rpelton", "name":"Rick Pelton", "email":"rick.pelton@marklogic.com"}, "change":{"status":{"from":"", "to":"Fix"}, "assignTo":{"from":{"username":"rpelton", "name":"Rick Pelton", "email":"rick.pelton@marklogic.com"}, "to":{"username":"nobody", "name":"nobody nobody", "email":"nobody@marklogic.com"}}}, "files":[], "show":true}, {"time":"2013-01-18T10:57:23.002361-08:00", "updatedBy":{"username":"gvaidees", "name":"Ganesh Vaideeswaran", "email":"Ganesh.Vaideeswaran@marklogic.com"}, "change":{"assignTo":{"from":{"username":"gvaidees", "name":"Ganesh Vaideeswaran", "email":"Ganesh.Vaideeswaran@marklogic.com"}, "to":{"username":"bmo", "name":"Brian Mo", "email":"brian.mo@marklogic.com"}}}, "files":[], "show":true}, {"time":"2013-01-18T10:57:23.002361-08:00", "updatedBy":{"username":"gvaidees", "name":"Ganesh Vaideeswaran", "email":"Ganesh.Vaideeswaran@marklogic.com"}, "change":{"tofixin":{"from":"5.0-3", "to":"5.0-6"}}, "files":[], "show":true}, {"time":"2013-01-21T14:25:26.29829-08:00", "updatedBy":{"username":"dgorbet", "name":"David Gorbet", "email":"David.Gorbet@marklogic.com"}, "change":{}, "files":[], "show":true, "comment":"Updated to Major per Triage"}, {"time":"2013-01-21T14:27:16.752898-08:00", "updatedBy":{"username":"dgorbet", "name":"David Gorbet", "email":"David.Gorbet@marklogic.com"}, "change":{}, "files":[], "show":true, "comment":"Should be easy to fix; should fix in 5.0-5. Come see Wayne if you disagree."}, {"time":"2013-01-21T14:27:16.752898-08:00", "updatedBy":{"username":"dgorbet", "name":"David Gorbet", "email":"David.Gorbet@marklogic.com"}, "change":{"tofixin":{"from":"5.0-6", "to":"5.0-5"}}, "files":[], "show":true}, {"time":"2013-01-21T22:18:53.355405-08:00", "updatedBy":{"username":"gvaidees", "name":"Ganesh Vaideeswaran", "email":"Ganesh.Vaideeswaran@marklogic.com"}, "change":{}, "files":[], "show":true, "comment":"Wayne,\r\n\r\nMore I look at the code I do not think replacing let with for is not the right fix. I tried to trace the calls (looking at the code) and am not sure if fix is that trivial. \r\n\r\nWe will keep looking."}, {"time":"2013-01-22T13:58:38.315847-08:00", "updatedBy":{"username":"bmo", "name":"Brian Mo", "email":"brian.mo@marklogic.com"}, "change":{}, "files":[], "show":true, "svn":{"repository":"/project/engsvn", "revision":"128798", "paths":["xdmp/trunk/src/Admin/add-http-servers-go.xqy"], "affectedBugs":[]}, "comment":"Bug:20554 - take first server"}, {"time":"2013-01-22T13:59:05.828111-08:00", "updatedBy":{"username":"bmo", "name":"Brian Mo", "email":"brian.mo@marklogic.com"}, "change":{"status":{"from":"", "to":"Test"}, "assignTo":{"from":{"username":"bmo", "name":"Brian Mo", "email":"brian.mo@marklogic.com"}, "to":{"username":"msarma", "name":"Meghalim Sarma", "email":"msarma@marklogic.com"}}}, "files":[], "show":true}, {"time":"2013-01-22T13:59:05.828111-08:00", "updatedBy":{"username":"bmo", "name":"Brian Mo", "email":"brian.mo@marklogic.com"}, "change":{"assignTo":{"from":{"username":"bmo", "name":"Brian Mo", "email":"brian.mo@marklogic.com"}, "to":{"username":"msarma", "name":"Meghalim Sarma", "email":"msarma@marklogic.com"}}}, "files":[], "show":true}, {"time":"2013-01-22T21:06:07.401488-08:00", "updatedBy":{"username":"msarma", "name":"Meghalim Sarma", "email":"msarma@marklogic.com"}, "change":{"assignTo":{"from":{"username":"msarma", "name":"Meghalim Sarma", "email":"msarma@marklogic.com"}, "to":{"username":"vkorolev", "name":"Vitaly Korolev", "email":"vitaly.korolev@marklogic.com"}}}, "files":[], "show":true}, {"time":"2013-01-24T14:28:37.002287-08:00", "updatedBy":{"username":"vkorolev", "name":"Vitaly Korolev", "email":"vitaly.korolev@marklogic.com"}, "change":{"tofixin":{"from":"5.0-5", "to":"7.0-ea1"}}, "files":[], "show":true}, {"time":"2013-01-30T15:28:42.285326-08:00", "updatedBy":{"username":"bmo", "name":"Brian Mo", "email":"brian.mo@marklogic.com"}, "change":{}, "files":[], "show":true, "comment":"The fix created another bug:  http://bugtrack.marklogic.com/20635\r\nReverting the fix"}, {"time":"2013-01-30T15:28:42.285326-08:00", "updatedBy":{"username":"bmo", "name":"Brian Mo", "email":"brian.mo@marklogic.com"}, "change":{"status":{"from":"", "to":"Fix"}, "assignTo":{"from":{"username":"bmo", "name":"Brian Mo", "email":"brian.mo@marklogic.com"}, "to":{"username":"bmo", "name":"Brian Mo", "email":"brian.mo@marklogic.com"}}}, "files":[], "show":true, "comment":"The fix created another bug:  http://bugtrack.marklogic.com/20635\r\nReverting the fix"}, {"time":"2013-01-30T15:28:42.285326-08:00", "updatedBy":{"username":"bmo", "name":"Brian Mo", "email":"brian.mo@marklogic.com"}, "change":{"assignTo":{"from":{"username":"bmo", "name":"Brian Mo", "email":"brian.mo@marklogic.com"}, "to":{"username":"bmo", "name":"Brian Mo", "email":"brian.mo@marklogic.com"}}}, "files":[], "show":true}, {"time":"2013-01-30T15:48:13.217846-08:00", "updatedBy":{"username":"bmo", "name":"Brian Mo", "email":"brian.mo@marklogic.com"}, "change":{}, "files":[], "show":true, "svn":{"repository":"/project/engsvn", "revision":"130044", "paths":["xdmp/trunk/src/Admin/add-http-servers-go.xqy"], "affectedBugs":[]}, "comment":"Bug:20554, 15975, 19671, 20635 - reverting bad fix"}, {"time":"2013-02-01T23:45:51.060419-08:00", "updatedBy":{"username":"gvaidees", "name":"Ganesh Vaideeswaran", "email":"Ganesh.Vaideeswaran@marklogic.com"}, "change":{}, "files":[], "show":true, "comment":"Sent a patch for review to BRian"}, {"time":"2013-02-08T14:42:45.681002-08:00", "updatedBy":{"username":"gvaidees", "name":"Ganesh Vaideeswaran", "email":"Ganesh.Vaideeswaran@marklogic.com"}, "change":{}, "files":[], "show":true, "svn":{"repository":"/project/engsvn", "revision":"131046", "paths":["xdmp/trunk/src/Admin/add-http-servers-go.xqy"], "affectedBugs":[]}, "comment":"Bug:20554 -  Internal Error adding an HTTP application server"}, {"time":"2013-02-08T14:43:38.03198-08:00", "updatedBy":{"username":"gvaidees", "name":"Ganesh Vaideeswaran", "email":"Ganesh.Vaideeswaran@marklogic.com"}, "change":{"status":{"from":"", "to":"Test"}, "assignTo":{"from":{"username":"gvaidees", "name":"Ganesh Vaideeswaran", "email":"Ganesh.Vaideeswaran@marklogic.com"}, "to":{"username":"msarma", "name":"Meghalim Sarma", "email":"msarma@marklogic.com"}}}, "files":[], "show":true, "comment":"Just make sure there are no regressions, since there does not seem to away to consistently reproduce this. Not sure when the code gets to a state where we have to deal with more than 2 servers while creating a http server. Added defensive code to get the first server, if we find more than one in the variable"}, {"time":"2013-02-08T14:43:38.03198-08:00", "updatedBy":{"username":"gvaidees", "name":"Ganesh Vaideeswaran", "email":"Ganesh.Vaideeswaran@marklogic.com"}, "change":{"assignTo":{"from":{"username":"gvaidees", "name":"Ganesh Vaideeswaran", "email":"Ganesh.Vaideeswaran@marklogic.com"}, "to":{"username":"msarma", "name":"Meghalim Sarma", "email":"msarma@marklogic.com"}}}, "files":[], "show":true}, {"time":"2013-02-08T15:11:39.766006-08:00", "updatedBy":{"username":"gvaidees", "name":"Ganesh Vaideeswaran", "email":"Ganesh.Vaideeswaran@marklogic.com"}, "change":{}, "files":[], "show":true, "svn":{"repository":"/project/engsvn", "revision":"131050", "paths":["xdmp/trunk/src/Admin/add-http-servers-go.xqy"], "affectedBugs":[]}, "comment":"Bug:20554 -  Internal Error adding an HTTP application server. Wayne suggested a better way to address the defect"}, {"time":"2013-02-19T21:56:11.691843-08:00", "updatedBy":{"username":"msarma", "name":"Meghalim Sarma", "email":"msarma@marklogic.com"}, "change":{}, "files":[], "show":true, "comment":"As Ganesh mentioned above, just make sure there are no regressions, since there does not seem to away to consistently reproduce this. If all Admin GUI tests dealing with AppServer creation are passing, ship this."}, {"time":"2013-02-19T21:56:11.691843-08:00", "updatedBy":{"username":"msarma", "name":"Meghalim Sarma", "email":"msarma@marklogic.com"}, "change":{"assignTo":{"from":{"username":"msarma", "name":"Meghalim Sarma", "email":"msarma@marklogic.com"}, "to":{"username":"knagar", "name":"Kuldeep Nagar", "email":"Kuldeep.Nagar@marklogic.com"}}}, "files":[], "show":true}, {"time":"2013-02-26T23:50:33.720381-08:00", "updatedBy":{"username":"knagar", "name":"Kuldeep Nagar", "email":"Kuldeep.Nagar@marklogic.com"}, "change":{"status":{"from":"", "to":"Ship"}, "assignTo":{"from":{"username":"knagar", "name":"Kuldeep Nagar", "email":"Kuldeep.Nagar@marklogic.com"}, "to":{"username":"nobody", "name":"nobody nobody", "email":"nobody@marklogic.com"}}}, "files":[], "show":true, "comment":"All Admin GUI tests dealing with AppServer creation are getting passed and also this got covered in AdminUIBug19298.\r\n\r\nThanks\r\nKuldeep"}], "updatedAt":"2013-02-26T23:50:33.720381-08:00", "closedAt":"2012-01-20T11:12:07.123792-08:00", "closedBy":{"username":"cgreer", "name":"Charles Greer", "email":"charles.greer@marklogic.com"}, "fixedAt":"2013-02-08T14:43:38.03198-08:00", "fixedBy":{"username":"gvaidees", "name":"Ganesh Vaideeswaran", "email":"Ganesh.Vaideeswaran@marklogic.com"}, "shippedAt":"2013-02-26T23:50:33.720381-08:00", "shippedBy":{"username":"knagar", "name":"Kuldeep Nagar", "email":"Kuldeep.Nagar@marklogic.com"}, "renderDescriptionAs":"normal"}
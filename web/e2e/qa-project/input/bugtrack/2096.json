{"id":2096, "kind":"Bug", "createdAt":"2005-08-17T12:52:17.148712-07:00", "status":"Closed", "title":"Improper recursion freezes or crashes server", "category":"xdmp", "severity":"Catastrophic", "priority":{"level":"5", "title":""}, "submittedBy":{"username":"mary", "name":"Mary Holstege", "email":"mary@cerisent.com"}, "assignTo":{"username":"nobody", "name":"nobody nobody", "email":"nobody@marklogic.com"}, "description":"The behaviour is different on 3.0 vs 3.1 branches (or it may be a windows/linux difference)\nOn 3.1 linux, query1 below will, after a couple of minutes, crash the server and query2 will \nproduce a stack overflow error in a timely fashion.\nOn 3.0/3.1 windows, query1 will freeze the server beyond the limits of my patience, \nand query2 (from cq) will give a \"connection closed by server\" error promptly, but the \nserver is still running fine.\n\nquery1:\ndefine function same-fragment ( $base as node()*, $results as node()* )\n   as xs:boolean\n{\n   if ( fn:empty($base) ) then fn:empty($results)\n   else if ( fn:empty($results) ) then fn:empty($base)\n   else \n      typeswitch ($base[1])\n         case element() return fn:true()\n         default return fn:true()\n      and\n      same-fragment( $base[2 to fn:count($base)], $results[2 to fn:count($base)] )\n}  (: same-fragment :)\n\nlet $foo:= doc(\"bib2.xml\")/comment()\nreturn same-fragment( $foo, $foo )\n\nquery2:\nsame definition for same-fragment\n\nlet $foo := (<!-- a -->, <!-- b -->, <!-- c --> )\nreturn same-fragment( $foo, $foo )\n\nNote that bib2.xml (from the XQuery testsuite) is a document such that\nthe doc(\"bib2.xml\")//comment() query returns three comments.", "samplequery":"", "sampledata":"", "version":"3.0-nightly", "tofixin":"3.0-3", "fixedin":"3.0-3", "platform":"all", "memory":"", "processors":"", "note":"", "subscribers":[{"username":"mary", "name":"Mary Holstege", "email":"mary@cerisent.com"}], "attachments":[], "clones":[], "cloneOf":"", "support":{"headline":"", "supportDescription":"", "publishStatus":"Not-ready never", "tickets":[], "customerImpact":{"level":"N/A", "title":""}, "workaround":""}, "tags":["xdmp", "mary"], "changeHistory":[{"time":"2005-08-22T16:59:34.407342-07:00", "updatedBy":{"username":"ian", "name":"Ian Small", "email":"ian@cerisent.com"}, "change":{"status":{"from":"", "to":"Fix"}, "assignTo":{"from":{"username":"ian", "name":"Ian Small", "email":"ian@cerisent.com"}, "to":{"username":"avnur", "name":"Ron Avnur", "email":"avnur@cerisent.com"}}}, "files":[], "show":true, "comment":"this is a required comment."}, {"time":"2005-08-30T19:54:31.970483-07:00", "updatedBy":{"username":"avnur", "name":"Ron Avnur", "email":"avnur@cerisent.com"}, "change":{"status":{"from":"", "to":"Test"}, "assignTo":{"from":{"username":"avnur", "name":"Ron Avnur", "email":"avnur@cerisent.com"}, "to":{"username":"rwang", "name":"Rachel Link", "email":"rwang@cerisent.com"}}}, "files":[], "show":true, "comment":"fixed.  can you test in rachel's absense?"}, {"time":"2005-08-31T13:15:16.126421-07:00", "updatedBy":{"username":"mary", "name":"Mary Holstege", "email":"mary@cerisent.com"}, "change":{"status":{"from":"", "to":"Fix"}, "assignTo":{"from":{"username":"mary", "name":"Mary Holstege", "email":"mary@cerisent.com"}, "to":{"username":"avnur", "name":"Ron Avnur", "email":"avnur@cerisent.com"}}}, "files":[], "show":true, "comment":"Sorry: it's still crashing with my version of the compiler."}, {"time":"2005-09-01T11:30:19.875431-07:00", "updatedBy":{"username":"avnur", "name":"Ron Avnur", "email":"avnur@cerisent.com"}, "change":{"status":{"from":"", "to":"Test"}, "assignTo":{"from":{"username":"avnur", "name":"Ron Avnur", "email":"avnur@cerisent.com"}, "to":{"username":"mary", "name":"Mary Holstege", "email":"mary@cerisent.com"}}}, "files":[], "show":true, "comment":"I think we're back to testing with the eval fix, no?"}, {"time":"2005-09-02T09:31:35.202956-07:00", "updatedBy":{"username":"mary", "name":"Mary Holstege", "email":"mary@cerisent.com"}, "change":{"status":{"from":"", "to":"Ship"}, "assignTo":{"from":{"username":"mary", "name":"Mary Holstege", "email":"mary@cerisent.com"}, "to":{"username":"nobody", "name":"nobody nobody", "email":"nobody@marklogic.com"}}}, "files":[], "show":true, "comment":"Looks good. "}], "updatedAt":"2005-09-02T09:31:35.202956-07:00", "fixedAt":"2005-09-01T11:30:19.875431-07:00", "fixedBy":{"username":"avnur", "name":"Ron Avnur", "email":"avnur@cerisent.com"}, "shippedAt":"2005-09-02T09:31:35.202956-07:00", "shippedBy":{"username":"mary", "name":"Mary Holstege", "email":"mary@cerisent.com"}, "renderDescriptionAs":"normal"}
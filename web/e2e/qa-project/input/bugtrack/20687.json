{"id":20687, "kind":"Bug", "createdAt":"2013-02-04T01:04:00.833797-08:00", "status":"Closed", "title":"segfault starting 6.0-2.1 after configuraing path range index", "category":"", "severity":"Major", "priority":{"level":"5", "title":""}, "submittedBy":{"username":"dchander", "name":"Dinesh Chander", "email":"dinesh.chander@globallogic.com"}, "assignTo":{"username":"nobody", "name":"nobody nobody", "email":"nobody@marklogic.com"}, "description":"Reported by Michael Blakeley in support case #12467\r\nIt seems that *two* union operators in a path range index are crashing the server (on both windows and linux).", "samplequery":"On a default 6.0-2.1 installation, create the following path range index\r\n(a|b|c)\r\n\r\n\r\nAttached are trace from both windows and linux installations.", "sampledata":"", "version":"6.0-2.1", "tofixin":"6.0-3", "fixedin":"6.0-3", "platform":"all", "memory":"", "processors":"", "note":"", "subscribers":[{"username":"dchander", "name":"Dinesh Chander", "email":"dinesh.chander@globallogic.com"}, {"username":"gchinchwadkar", "name":"Gajanan Chinchwadkar", "email":"Gajanan.Chinchwadkar@marklogic.com"}, {"username":"msrinivasan", "name":"Mahalakshmi Srinivasan", "email":"mahalakshmi.srinivasan@marklogic.com"}], "attachments":[{"name":"Segmentation fault on Linux", "uri":"root/support/bugtracking/attachments/20687/Linux.txt"}, {"name":"ACCESS_VIOLATION on windows", "uri":"root/support/bugtracking/attachments/20687/Windows.txt"}], "relationships":[{"type":"", "to":""}], "clones":[], "cloneOf":"", "support":{"headline":"6.0.2.x server crashes when a path index is configured with a union step at the leaf of the path", "supportDescription":"6.0.2.x server crashes when a path index is configured with a union step at the leaf of the path", "publishStatus":"Publish", "tickets":[], "customerImpact":{"level":"Medium", "title":"Requires significant or unnatural effort to work around issue or to prevent significant business impact"}, "workaround":"Use separate indexes instead of a union, if possible."}, "tags":["", "dchander"], "changeHistory":[{"time":"2013-02-04T01:04:00.833797-08:00", "updatedBy":{"username":"dchander", "name":"Dinesh Chander", "email":"dinesh.chander@globallogic.com"}, "change":{"assignTo":{"from":{"username":"dchander", "name":"Dinesh Chander", "email":"dinesh.chander@globallogic.com"}, "to":{"username":"gchinchwadkar", "name":"Gajanan Chinchwadkar", "email":"Gajanan.Chinchwadkar@marklogic.com"}}}, "files":[], "show":true}, {"time":"2013-02-04T09:07:27.697085-08:00", "updatedBy":{"username":"gchinchwadkar", "name":"Gajanan Chinchwadkar", "email":"Gajanan.Chinchwadkar@marklogic.com"}, "change":{}, "files":[], "show":true, "comment":"This bug reports a top-level union which is on the plate for ML7. It will not be made available in 6.0.3.\r\n\r\nHowever, the e-mail exchanges between support and  Michael were showing a leaf level union: /x/y/z/(a|b|c). The leaf level union must work in 6.0.1 onwards. Please work with Michael and get a repro from him. In my env. I did test his path and it did not crash.\r\n\r\n"}, {"time":"2013-02-04T20:35:26.432746-08:00", "updatedBy":{"username":"dchander", "name":"Dinesh Chander", "email":"dinesh.chander@globallogic.com"}, "change":{}, "files":[], "show":true, "comment":"Hi Gajanan,\r\n\r\nI have setup a repro on lab machine cluster-009.marklogic.com (admin/admin with ML v6.0-2.1). I have configured just one path range index \"/a/b/c/(d|e|f) rest default settings on Documents database)\".\r\n\r\nThanks,\r\nDinesh Chander"}, {"time":"2013-02-05T11:10:27.454189-08:00", "updatedBy":{"username":"gchinchwadkar", "name":"Gajanan Chinchwadkar", "email":"Gajanan.Chinchwadkar@marklogic.com"}, "change":{}, "files":[], "show":true, "comment":"Thanks Balkrishna.\r\n\r\nThis helps a lot. Please let the repro run for the next day or two until I fix this issue.\r\n\r\nRgds,\r\n\r\nGajanan"}, {"time":"2013-02-05T13:03:29.379507-08:00", "updatedBy":{"username":"gchinchwadkar", "name":"Gajanan Chinchwadkar", "email":"Gajanan.Chinchwadkar@marklogic.com"}, "change":{}, "files":[], "show":true, "comment":"I could reproduce this on b6_0-2.1 but not on latest private b6_0 build and HEAD. I guess it has been fixed after 6.0-2.1.\r\n\r\nNext I am going to test it on 6.0-2.2."}, {"time":"2013-02-05T13:24:34.675961-08:00", "updatedBy":{"username":"gchinchwadkar", "name":"Gajanan Chinchwadkar", "email":"Gajanan.Chinchwadkar@marklogic.com"}, "change":{}, "files":[], "show":true, "comment":"It does reproduce on 6.0-2.2.\r\n\r\nBalkrishna: I couldn't reproduce it on b6_0. Can you test a latest b6_0 binary? There is a good chance that we will get this fix in 6.0.3 without fixing anything specific at this point."}, {"time":"2013-02-05T13:25:39.780984-08:00", "updatedBy":{"username":"gchinchwadkar", "name":"Gajanan Chinchwadkar", "email":"Gajanan.Chinchwadkar@marklogic.com"}, "change":{}, "files":[], "show":true, "comment":"It does reproduce on 6.0-2.2.\r\n\r\nBalkrishna: I couldn't reproduce it on b6_0. Can you test a latest b6_0 binary? There is a good chance that we will get this fix in 6.0.3 without fixing anything specific at this point."}, {"time":"2013-02-05T14:12:47.255996-08:00", "updatedBy":{"username":"gchinchwadkar", "name":"Gajanan Chinchwadkar", "email":"Gajanan.Chinchwadkar@marklogic.com"}, "change":{}, "files":[], "show":true, "comment":"One more way to test is:\r\n\r\ncts:valid-index-path(\"/a/b/c/(d|e|f)\",false())"}, {"time":"2013-02-05T20:43:58.219402-08:00", "updatedBy":{"username":"dchander", "name":"Dinesh Chander", "email":"dinesh.chander@globallogic.com"}, "change":{}, "files":[], "show":true, "comment":"Hi Gajanan,\r\n\r\nI have tested with the latest nightly (6.0-20130205) and it seems to work fine. I am not getting any error with leaf level union.\r\n\r\nThanks,\r\nDinesh Chander"}, {"time":"2013-02-06T15:45:19.943104-08:00", "updatedBy":{"username":"gchinchwadkar", "name":"Gajanan Chinchwadkar", "email":"Gajanan.Chinchwadkar@marklogic.com"}, "change":{"status":{"from":"", "to":"Test"}, "assignTo":{"from":{"username":"gchinchwadkar", "name":"Gajanan Chinchwadkar", "email":"Gajanan.Chinchwadkar@marklogic.com"}, "to":{"username":"msrinivasan", "name":"Mahalakshmi Srinivasan", "email":"mahalakshmi.srinivasan@marklogic.com"}}}, "files":[], "show":true, "comment":"This is already working in 6.0.3 and HEAD. This may have been fixed as a part of some other bug. I didn't do any code changes for it."}, {"time":"2013-02-06T15:45:19.943104-08:00", "updatedBy":{"username":"gchinchwadkar", "name":"Gajanan Chinchwadkar", "email":"Gajanan.Chinchwadkar@marklogic.com"}, "change":{"assignTo":{"from":{"username":"gchinchwadkar", "name":"Gajanan Chinchwadkar", "email":"Gajanan.Chinchwadkar@marklogic.com"}, "to":{"username":"msrinivasan", "name":"Mahalakshmi Srinivasan", "email":"mahalakshmi.srinivasan@marklogic.com"}}}, "files":[], "show":true}, {"time":"2013-02-06T15:45:19.943104-08:00", "updatedBy":{"username":"gchinchwadkar", "name":"Gajanan Chinchwadkar", "email":"Gajanan.Chinchwadkar@marklogic.com"}, "change":{"tofixin":{"from":"", "to":"6.0-3"}}, "files":[], "show":true}, {"time":"2013-03-18T16:21:05.284768-07:00", "updatedBy":{"username":"msrinivasan", "name":"Mahalakshmi Srinivasan", "email":"mahalakshmi.srinivasan@marklogic.com"}, "change":{"status":{"from":"", "to":"Ship"}, "assignTo":{"from":{"username":"msrinivasan", "name":"Mahalakshmi Srinivasan", "email":"mahalakshmi.srinivasan@marklogic.com"}, "to":{"username":"nobody", "name":"nobody nobody", "email":"nobody@marklogic.com"}}}, "files":[], "show":true, "comment":"Moving this to 'ship' since there was some change done to make this work..although not as part of this bug. Verified on build 6.0-20130221"}, {"time":"2013-04-22T16:27:44.491359-07:00", "updatedBy":{"username":"rpelton", "name":"Rick Pelton", "email":"rick.pelton@marklogic.com"}, "change":{"status":{"from":"", "to":"Closed"}, "assignTo":{"from":{"username":"rpelton", "name":"Rick Pelton", "email":"rick.pelton@marklogic.com"}, "to":{"username":"nobody", "name":"nobody nobody", "email":"nobody@marklogic.com"}}}, "files":[], "show":true}], "updatedAt":"2013-04-22T16:27:44.491359-07:00", "fixedAt":"2013-02-06T15:45:19.943104-08:00", "fixedBy":{"username":"gchinchwadkar", "name":"Gajanan Chinchwadkar", "email":"Gajanan.Chinchwadkar@marklogic.com"}, "shippedAt":"2013-03-18T16:21:05.284768-07:00", "shippedBy":{"username":"msrinivasan", "name":"Mahalakshmi Srinivasan", "email":"mahalakshmi.srinivasan@marklogic.com"}, "closedAt":"2013-04-22T16:27:44.491359-07:00", "closedBy":{"username":"rpelton", "name":"Rick Pelton", "email":"rick.pelton@marklogic.com"}, "renderDescriptionAs":"normal", "renderSampleQueryAs":"normal"}
{"id":20795, "kind":"Bug", "createdAt":"2013-02-14T13:59:12.064779-08:00", "status":"Closed", "title":"remove-constraint does not work on NOT-IN query", "category":"Search API", "severity":"Major", "priority":{"level":"5", "title":""}, "submittedBy":{"username":"ayuwono", "name":"Aries Yuwono", "email":"ayuwono@marklogic.com"}, "assignTo":{"username":"nobody", "name":"nobody nobody", "email":"nobody@marklogic.com"}, "description":"Build: 7.0-20130213\r\n\r\nSteps:\r\n=====\r\n1) Run this query:\r\n\r\nxquery version \"1.0-ml\";\r\nimport module namespace search = \"http://marklogic.com/appservices/search\"\r\n    at \"/MarkLogic/appservices/search/search.xqy\";\r\n    \r\nlet $options :=\r\n<options xmlns=\"http://marklogic.com/appservices/search\">\r\n  <return-results>true</return-results>\r\n  <constraint name=\"keyword\">\r\n    <word>\r\n      <element ns=\"\" name=\"doc\"/>\r\n    </word>\r\n</constraint>\r\n</options>\r\n\r\nreturn \r\nsearch:remove-constraint('(keyword:summer OR time) NOT_IN \"summer time\"', \"keyword:summer\", $options)\r\n\r\nActual Result\r\n===========\r\nIt will not remove the constraint\r\n\r\nExpected Result\r\n=============\r\ntime NOT_IN \"summer time\"\r\n\r\nIf we have:\r\nsearch:remove-constraint('(keyword:summer OR time) AND \"summer time\"', \"keyword:summer\", $options)\r\nit will return:\r\ntime AND \"summer time\"", "samplequery":"", "sampledata":"", "version":"7.0-nightly", "tofixin":"7.0-ea1", "fixedin":"7.0-ea1", "platform":"all", "memory":"", "processors":"", "note":"", "subscribers":[{"username":"ayuwono", "name":"Aries Yuwono", "email":"ayuwono@marklogic.com"}, {"username":"cgreer", "name":"Charles Greer", "email":"charles.greer@marklogic.com"}, {"username":"cwhitney", "name":"Colleen  Whitney", "email":"colleen.whitney@marklogic.com"}], "attachments":[], "relationships":[{"type":"", "to":""}], "clones":[], "cloneOf":"", "support":{"headline":"", "supportDescription":"", "publishStatus":"Not Ready", "tickets":[], "customerImpact":{"level":"N/A", "title":""}, "workaround":""}, "tags":["Search API", "ayuwono"], "changeHistory":[{"time":"2013-02-14T13:59:12.064779-08:00", "updatedBy":{"username":"ayuwono", "name":"Aries Yuwono", "email":"ayuwono@marklogic.com"}, "change":{"assignTo":{"from":{"username":"ayuwono", "name":"Aries Yuwono", "email":"ayuwono@marklogic.com"}, "to":{"username":"cwhitney", "name":"Colleen  Whitney", "email":"colleen.whitney@marklogic.com"}}}, "files":[], "show":true}, {"time":"2013-02-14T14:49:24.273885-08:00", "updatedBy":{"username":"cwhitney", "name":"Colleen  Whitney", "email":"colleen.whitney@marklogic.com"}, "change":{}, "files":[], "show":true, "comment":"Downgrading from critical, and reassigning to Charles since he's the newly crowned king of the Search API."}, {"time":"2013-02-14T14:49:24.273885-08:00", "updatedBy":{"username":"cwhitney", "name":"Colleen  Whitney", "email":"colleen.whitney@marklogic.com"}, "change":{"assignTo":{"from":{"username":"cwhitney", "name":"Colleen  Whitney", "email":"colleen.whitney@marklogic.com"}, "to":{"username":"cgreer", "name":"Charles Greer", "email":"charles.greer@marklogic.com"}}}, "files":[], "show":true}, {"time":"2013-02-15T16:21:25.89262-08:00", "updatedBy":{"username":"cgreer", "name":"Charles Greer", "email":"charles.greer@marklogic.com"}, "change":{"status":{"from":"", "to":"Fix"}, "assignTo":{"from":{"username":"cgreer", "name":"Charles Greer", "email":"charles.greer@marklogic.com"}, "to":{"username":"cgreer", "name":"Charles Greer", "email":"charles.greer@marklogic.com"}}}, "files":[], "show":true, "comment":"I'll get this going now with tests and implementation."}, {"time":"2013-02-20T08:20:20.476242-08:00", "updatedBy":{"username":"cgreer", "name":"Charles Greer", "email":"charles.greer@marklogic.com"}, "change":{}, "files":[], "show":true, "comment":"I've identified this issue and written test cases for it, but there's a significant bit of digging in to understand why it's not working right now.  Pushing to EA-2."}, {"time":"2013-02-20T08:20:20.476242-08:00", "updatedBy":{"username":"cgreer", "name":"Charles Greer", "email":"charles.greer@marklogic.com"}, "change":{"tofixin":{"from":"7.0-ea1", "to":"7.0-ea2"}}, "files":[], "show":true}, {"time":"2013-02-20T08:28:27.506237-08:00", "updatedBy":{"username":"cgreer", "name":"Charles Greer", "email":"charles.greer@marklogic.com"}, "change":{}, "files":[], "show":true, "comment":"This does seem high-priority.  If I can triage past other bugs for EA-1 this would be a good one to get in, as it's new functionality for ML7 that would be good to have in product."}, {"time":"2013-02-20T14:47:32.363944-08:00", "updatedBy":{"username":"cgreer", "name":"Charles Greer", "email":"charles.greer@marklogic.com"}, "change":{}, "files":[], "show":true, "comment":"I've found that the issue is with impl:locate.  The more nested structure of not-in-query means that terms are not found within NOT_IN clauses."}, {"time":"2013-02-21T13:45:41.539827-08:00", "updatedBy":{"username":"cgreer", "name":"Charles Greer", "email":"charles.greer@marklogic.com"}, "change":{}, "files":[], "show":true, "comment":"I believe I have this implemented."}, {"time":"2013-02-22T10:34:22.239032-08:00", "updatedBy":{"username":"cgreer", "name":"Charles Greer", "email":"charles.greer@marklogic.com"}, "change":{}, "files":[], "show":true, "comment":"patch in review."}, {"time":"2013-03-06T15:49:57.414362-08:00", "updatedBy":{"username":"cgreer", "name":"Charles Greer", "email":"charles.greer@marklogic.com"}, "change":{}, "files":[], "show":true, "svn":{"repository":"/project/engsvn", "revision":"135308", "paths":["xdmp/trunk/src/Modules/MarkLogic/appservices/search/ast.xqy", "xdmp/trunk/src/Modules/MarkLogic/appservices/search/search-impl.xqy", "xdmp/trunk/src/Apps/test/appservices/search-unittest/parse-unittest.xqy", "xdmp/trunk/src/Apps/test/appservices/search-unittest/prune-unittest.xqy", "xdmp/trunk/src/Apps/test/appservices/search-unittest/snippet-unittest.xqy"], "affectedBugs":[]}, "comment":"bug:20795 remove-constraint for NOT_IN"}, {"time":"2013-03-06T16:29:33.066613-08:00", "updatedBy":{"username":"cgreer", "name":"Charles Greer", "email":"charles.greer@marklogic.com"}, "change":{}, "files":[], "show":true, "svn":{"repository":"/project/engsvn", "revision":"135322", "paths":["xdmp/branches/b7_0-ea1/src/Apps/test/appservices/search-unittest/snippet-unittest.xqy", "xdmp/branches/b7_0-ea1/src/Modules/MarkLogic/appservices/search/search-impl.xqy", "xdmp/branches/b7_0-ea1/src/Apps/test/appservices/search-unittest/parse-unittest.xqy", "xdmp/branches/b7_0-ea1/src/Apps/test/appservices/search-unittest/prune-unittest.xqy", "xdmp/branches/b7_0-ea1/src/Modules/MarkLogic/appservices/search/ast.xqy"], "affectedBugs":[]}, "comment":"    bug:20795 remove-constraint for NOT_IN"}, {"time":"2013-03-06T16:31:08.965684-08:00", "updatedBy":{"username":"cgreer", "name":"Charles Greer", "email":"charles.greer@marklogic.com"}, "change":{"status":{"from":"", "to":"Test"}, "assignTo":{"from":{"username":"cgreer", "name":"Charles Greer", "email":"charles.greer@marklogic.com"}, "to":{"username":"ayuwono", "name":"Aries Yuwono", "email":"ayuwono@marklogic.com"}}}, "files":[], "show":true, "comment":"Hi Aries, I got this into EA-1 just now.  Hopefully this will just make tests pass now that hadn't before."}, {"time":"2013-03-06T16:31:08.965684-08:00", "updatedBy":{"username":"cgreer", "name":"Charles Greer", "email":"charles.greer@marklogic.com"}, "change":{"assignTo":{"from":{"username":"cgreer", "name":"Charles Greer", "email":"charles.greer@marklogic.com"}, "to":{"username":"ayuwono", "name":"Aries Yuwono", "email":"ayuwono@marklogic.com"}}}, "files":[], "show":true}, {"time":"2013-03-06T16:31:08.965684-08:00", "updatedBy":{"username":"cgreer", "name":"Charles Greer", "email":"charles.greer@marklogic.com"}, "change":{"tofixin":{"from":"7.0-ea2", "to":"7.0-ea1"}}, "files":[], "show":true}, {"time":"2013-03-07T10:17:13.514114-08:00", "updatedBy":{"username":"ayuwono", "name":"Aries Yuwono", "email":"ayuwono@marklogic.com"}, "change":{"status":{"from":"", "to":"Ship"}, "assignTo":{"from":{"username":"ayuwono", "name":"Aries Yuwono", "email":"ayuwono@marklogic.com"}, "to":{"username":"nobody", "name":"nobody nobody", "email":"nobody@marklogic.com"}}}, "files":[], "show":true, "comment":"Verified passed on 03/07 build"}, {"time":"2013-03-07T10:17:13.514114-08:00", "updatedBy":{"username":"ayuwono", "name":"Aries Yuwono", "email":"ayuwono@marklogic.com"}, "change":{"assignTo":{"from":{"username":"ayuwono", "name":"Aries Yuwono", "email":"ayuwono@marklogic.com"}, "to":{"username":"nobody", "name":"nobody nobody", "email":"nobody@marklogic.com"}}}, "files":[], "show":true}], "updatedAt":"2013-03-07T10:17:13.514114-08:00", "fixedAt":"2013-03-06T16:31:08.965684-08:00", "fixedBy":{"username":"cgreer", "name":"Charles Greer", "email":"charles.greer@marklogic.com"}, "shippedAt":"2013-03-07T10:17:13.514114-08:00", "shippedBy":{"username":"ayuwono", "name":"Aries Yuwono", "email":"ayuwono@marklogic.com"}, "renderDescriptionAs":"normal"}
{"id":20725, "kind":"Bug", "createdAt":"2013-02-06T13:49:28.564329-08:00", "status":"Closed", "title":"/v1/rest-apis/ DELETE  returns SVC-SOCRECV error when attached forest has mount error", "category":"MarkLogic REST API", "severity":"Major", "priority":{"level":"5", "title":""}, "submittedBy":{"username":"sreddy", "name":"Sudhakar Reddy", "email":"sreddy@marklogic.com"}, "assignTo":{"username":"nobody", "name":"nobody nobody", "email":"nobody@marklogic.com"}, "description":"Create db with attached forest having mount error\r\n(provide non existing filesystem location for data dir while creating forest to induce mount error)\r\nAttach the Rest server to the db\r\nNow delete the server using below xqy code:\r\nxquery version \"1.0-ml\";\r\n\t\tlet $server-name := \"Server1\"\r\n\t\treturn xdmp:http-delete( fn:concat(\"http://cluster-003:8002/v1/rest-apis/\", $server-name, \"?include=content&amp;include=modules\") ,\r\n     <options xmlns=\"xdmp:http\">\r\n       <authentication method=\"digest\">\r\n         <username>admin</username>\r\n         <password>admin</password>\r\n       </authentication>\r\n     </options>)\r\n", "samplequery":"", "sampledata":"", "version":"6.0-nightly", "tofixin":"6.0-3", "fixedin":"6.0-3", "platform":"all", "memory":"", "processors":"", "note":"", "subscribers":[{"username":"sreddy", "name":"Sudhakar Reddy", "email":"sreddy@marklogic.com"}, {"username":"ehennum", "name":"Erik Hennum", "email":"erik.hennum@marklogic.com"}, {"username":"gvaidees", "name":"Ganesh Vaideeswaran", "email":"Ganesh.Vaideeswaran@marklogic.com"}, {"username":"vkorolev", "name":"Vitaly Korolev", "email":"vitaly.korolev@marklogic.com"}], "attachments":[], "relationships":[{"type":"", "to":""}], "clones":[20726], "cloneOf":"", "support":{"headline":"Management REST API reports  SVC-SOCRECV error when attempting to delete a database with an unavailable forest", "supportDescription":"Attempting to delete a database with an unavailable forest, the Management REST API reported a SVC-SOCRECV error.\r\n\r\nThe Management REST API  should only attempt to delete a database only when all of the database/s forests can be deleted.\r\n\r\n", "publishStatus":"Publish", "tickets":[], "customerImpact":{"level":"N/A", "title":""}, "workaround":""}, "tags":["MarkLogic REST API", "sreddy"], "changeHistory":[{"time":"2013-02-06T13:49:28.564329-08:00", "updatedBy":{"username":"sreddy", "name":"Sudhakar Reddy", "email":"sreddy@marklogic.com"}, "change":{"assignTo":{"from":{"username":"sreddy", "name":"Sudhakar Reddy", "email":"sreddy@marklogic.com"}, "to":{"username":"gvaidees", "name":"Ganesh Vaideeswaran", "email":"Ganesh.Vaideeswaran@marklogic.com"}}}, "files":[], "show":true}, {"time":"2013-02-06T13:51:56.195104-08:00", "updatedBy":{"username":"sreddy", "name":"Sudhakar Reddy", "email":"sreddy@marklogic.com"}, "change":{}, "files":[], "show":true, "comment":"Expected result - api should be able to delete the database regardless of the db status. Admin UI does allow to delete in this use case, so I believe same behavior applies to api as well.\r\nColleen - Correct me if I'm wrong. "}, {"time":"2013-02-06T14:24:19.286713-08:00", "updatedBy":{"username":"gvaidees", "name":"Ganesh Vaideeswaran", "email":"Ganesh.Vaideeswaran@marklogic.com"}, "change":{"assignTo":{"from":{"username":"gvaidees", "name":"Ganesh Vaideeswaran", "email":"Ganesh.Vaideeswaran@marklogic.com"}, "to":{"username":"ehennum", "name":"Erik Hennum", "email":"erik.hennum@marklogic.com"}}}, "files":[], "show":true}, {"time":"2013-02-06T14:24:19.286713-08:00", "updatedBy":{"username":"gvaidees", "name":"Ganesh Vaideeswaran", "email":"Ganesh.Vaideeswaran@marklogic.com"}, "change":{"tofixin":{"from":"", "to":"6.0-3"}}, "files":[], "show":true}, {"time":"2013-02-06T18:13:55.859273-08:00", "updatedBy":{"username":"cjl", "name":"Christopher Lindblad", "email":"cjl@cerisent.com"}, "change":{}, "files":[], "show":true, "comment":"In the admin gui when you delete a database it does not delete the forests attached to it.\r\nRight or wrong, the server does not allow a full delete of a forest with a mount error, \r\nand does not allow a config-only delete of a private forest,\r\nso it does not allow a delete of a private forest with a mount error.\r\n\r\nI suspect the REST interface deletes the forests as well as the databases,\r\nand it is failing because of that.\r\n\r\n"}, {"time":"2013-02-06T20:00:40.032115-08:00", "updatedBy":{"username":"gvaidees", "name":"Ganesh Vaideeswaran", "email":"Ganesh.Vaideeswaran@marklogic.com"}, "change":{}, "files":[], "show":true, "comment":"Sudhakar,\r\n\r\nCan you check what happens when you do not include include=content&amp;include=modules\r\n\r\nIrrespective, based on Chris's assessment, we will get an error. We can look at a better error rather than a SVC-SOCRECV if that makes sense."}, {"time":"2013-02-07T11:22:28.4606-08:00", "updatedBy":{"username":"sreddy", "name":"Sudhakar Reddy", "email":"sreddy@marklogic.com"}, "change":{}, "files":[], "show":true, "comment":"Without \"include=content&amp;include=modules\", it still returns SVC-SOCRECV error\r\nThis error is returned on cluster environment but in single host  the same query (with and without  \"include=content&amp;include=modules\") it returns FORESTMNT error"}, {"time":"2013-03-01T11:06:05.737947-08:00", "updatedBy":{"username":"cwhitney", "name":"Colleen  Whitney", "email":"colleen.whitney@marklogic.com"}, "change":{}, "files":[], "show":true, "comment":"It sounds like the API is attempting to delete the databases and underlying forests even when it's not supposed to.  Do we have tests on that endpoint that validates that it doesn't delete those unless specified?"}, {"time":"2013-03-01T11:53:27.000689-08:00", "updatedBy":{"username":"gvaidees", "name":"Ganesh Vaideeswaran", "email":"Ganesh.Vaideeswaran@marklogic.com"}, "change":{}, "files":[], "show":true, "comment":"Sudhakar,\r\n\r\nLet us (me or Colleen) chat about this and go over the scenario once more and look at your environment and assess what we should do with this.\r\n\r\nThere are other scenarios that we may have to chat about - atomicity of operation. If there is a forest error, should we still delete the DB?"}, {"time":"2013-03-01T11:53:27.000689-08:00", "updatedBy":{"username":"gvaidees", "name":"Ganesh Vaideeswaran", "email":"Ganesh.Vaideeswaran@marklogic.com"}, "change":{"tofixin":{"from":"6.0-3", "to":"6.0-4"}}, "files":[], "show":true}, {"time":"2013-03-01T13:43:23.775808-08:00", "updatedBy":{"username":"ehennum", "name":"Erik Hennum", "email":"erik.hennum@marklogic.com"}, "change":{"status":{"from":"", "to":"Test"}, "assignTo":{"from":{"username":"ehennum", "name":"Erik Hennum", "email":"erik.hennum@marklogic.com"}, "to":{"username":"vkorolev", "name":"Vitaly Korolev", "email":"vitaly.korolev@marklogic.com"}}}, "files":[], "show":true, "comment":"I incorrectly reported the revision on the Bug 20726 clone:\r\n\r\nSVN Info:\r\nRevision: 134379\r\nModified Files:\r\n\r\n    xdmp/branches/b6_0/src/Apps/common-api/endpoints/rest-apis/rest-api-item.xqy\r\n    xdmp/branches/b6_0/src/Modules/MarkLogic/rest-api/lib/bootstrap-util.xqy\r\n"}, {"time":"2013-03-01T13:43:23.775808-08:00", "updatedBy":{"username":"ehennum", "name":"Erik Hennum", "email":"erik.hennum@marklogic.com"}, "change":{"assignTo":{"from":{"username":"ehennum", "name":"Erik Hennum", "email":"erik.hennum@marklogic.com"}, "to":{"username":"vkorolev", "name":"Vitaly Korolev", "email":"vitaly.korolev@marklogic.com"}}}, "files":[], "show":true}, {"time":"2013-03-05T11:33:13.880443-08:00", "updatedBy":{"username":"sreddy", "name":"Sudhakar Reddy", "email":"sreddy@marklogic.com"}, "change":{"status":{"from":"", "to":"Fix"}, "assignTo":{"from":{"username":"sreddy", "name":"Sudhakar Reddy", "email":"sreddy@marklogic.com"}, "to":{"username":"ehennum", "name":"Erik Hennum", "email":"erik.hennum@marklogic.com"}}}, "files":[], "show":true}, {"time":"2013-03-05T11:33:13.880443-08:00", "updatedBy":{"username":"sreddy", "name":"Sudhakar Reddy", "email":"sreddy@marklogic.com"}, "change":{"assignTo":{"from":{"username":"sreddy", "name":"Sudhakar Reddy", "email":"sreddy@marklogic.com"}, "to":{"username":"ehennum", "name":"Erik Hennum", "email":"erik.hennum@marklogic.com"}}}, "files":[], "show":true}, {"time":"2013-03-05T15:36:55.147197-08:00", "updatedBy":{"username":"ehennum", "name":"Erik Hennum", "email":"erik.hennum@marklogic.com"}, "change":{"status":{"from":"", "to":"Test"}, "assignTo":{"from":{"username":"ehennum", "name":"Erik Hennum", "email":"erik.hennum@marklogic.com"}, "to":{"username":"sreddy", "name":"Sudhakar Reddy", "email":"sreddy@marklogic.com"}}}, "files":[], "show":true, "comment":"I could not reproduce this issue with the 6.0-20130305 nightly build on Linux or with a fresh build locally.\r\n\r\nWithout the include option, the REST server was deleted without issue.  With the include option, the response included a warning about the database, but the REST server was still deleted.\r\n\r\nAre more steps required to reproduce the problem?\r\n"}, {"time":"2013-03-05T15:36:55.147197-08:00", "updatedBy":{"username":"ehennum", "name":"Erik Hennum", "email":"erik.hennum@marklogic.com"}, "change":{"assignTo":{"from":{"username":"ehennum", "name":"Erik Hennum", "email":"erik.hennum@marklogic.com"}, "to":{"username":"sreddy", "name":"Sudhakar Reddy", "email":"sreddy@marklogic.com"}}}, "files":[], "show":true}, {"time":"2013-03-06T14:21:49.89216-08:00", "updatedBy":{"username":"sreddy", "name":"Sudhakar Reddy", "email":"sreddy@marklogic.com"}, "change":{}, "files":[], "show":true, "comment":"Yes Erik, you are right. I cannot reproduce the issue now. Shipping it"}, {"time":"2013-03-06T14:21:49.89216-08:00", "updatedBy":{"username":"sreddy", "name":"Sudhakar Reddy", "email":"sreddy@marklogic.com"}, "change":{"status":{"from":"", "to":"Ship"}, "assignTo":{"from":{"username":"sreddy", "name":"Sudhakar Reddy", "email":"sreddy@marklogic.com"}, "to":{"username":"nobody", "name":"nobody nobody", "email":"nobody@marklogic.com"}}}, "files":[], "show":true}, {"time":"2013-03-06T14:21:49.89216-08:00", "updatedBy":{"username":"sreddy", "name":"Sudhakar Reddy", "email":"sreddy@marklogic.com"}, "change":{"assignTo":{"from":{"username":"sreddy", "name":"Sudhakar Reddy", "email":"sreddy@marklogic.com"}, "to":{"username":"nobody", "name":"nobody nobody", "email":"nobody@marklogic.com"}}}, "files":[], "show":true}, {"time":"2013-03-29T09:50:50.869251-07:00", "updatedBy":{"username":"vkorolev", "name":"Vitaly Korolev", "email":"vitaly.korolev@marklogic.com"}, "change":{}, "files":[], "show":true, "svn":{"repository":"/project/engsvn", "revision":"138075", "paths":["qa/branches/b6_0/scripts/keys/rest-client-api-rest-apis-01.xml"], "affectedBugs":[]}, "comment":"Updated the key due to a change from bug:20725"}, {"time":"2013-04-22T16:27:15.434194-07:00", "updatedBy":{"username":"rpelton", "name":"Rick Pelton", "email":"rick.pelton@marklogic.com"}, "change":{"status":{"from":"", "to":"Closed"}, "assignTo":{"from":{"username":"rpelton", "name":"Rick Pelton", "email":"rick.pelton@marklogic.com"}, "to":{"username":"nobody", "name":"nobody nobody", "email":"nobody@marklogic.com"}}}, "files":[], "show":true}], "updatedAt":"2013-04-22T16:27:15.434194-07:00", "fixedAt":"2013-03-05T15:36:55.147197-08:00", "fixedBy":{"username":"ehennum", "name":"Erik Hennum", "email":"erik.hennum@marklogic.com"}, "shippedAt":"2013-03-06T14:21:49.89216-08:00", "shippedBy":{"username":"sreddy", "name":"Sudhakar Reddy", "email":"sreddy@marklogic.com"}, "closedAt":"2013-04-22T16:27:15.434194-07:00", "closedBy":{"username":"rpelton", "name":"Rick Pelton", "email":"rick.pelton@marklogic.com"}, "renderDescriptionAs":"normal"}
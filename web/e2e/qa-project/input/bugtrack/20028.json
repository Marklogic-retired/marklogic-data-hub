{"id":20028, "kind":"Bug", "createdAt":"2012-11-08T02:39:53.752797-08:00", "status":"Will not fix", "title":"Test \"EC2-aws.xml\" failing on 6.0 ec2 platform", "category":"xdmp", "severity":"Major", "priority":{"level":"2", "title":"Not required for product release"}, "submittedBy":{"username":"ksaxena", "name":"Kapil Saxena", "email":"kapil.saxena@marklogic.com"}, "assignTo":{"username":"nobody", "name":"nobody nobody", "email":"nobody@marklogic.com"}, "description":"TEST_1 : Modify instance kernel given instance ID.\r\nXQuery:\r\n      xquery version \"1.0-ml\";\r\n      import module namespace ec2mod = \"http://marklogic.com/ec2\" at \"/MarkLogic/ec2-2009-11-30.xqy\";\r\n      declare namespace back = \"http://ec2.amazonaws.com/doc/2009-11-30/\";\r\n      let $access-key := doc(\"/amazon-ec2-access-key\")/data(accessKey)\r\n      let $private-key := doc(\"/amazon-ec2-private-key\")/data(privateKey)\r\n      let $test-region := doc(\"/test-region\")/data(testRegion)\r\n      let $instance-id := doc(\"/ebs-instance-id\")/data(back:instanceId)\r\n      let $new-kernel-id := doc(\"/new-kernel-id\")\r\n      let $ret := ec2mod:modify-instance-kernel($access-key,$private-key,$test-region,$instance-id,$new-kernel-id)/back:ModifyInstanceAttributeResponse/back:return\r\n      return data($ret)\r\n    \r\nResult-Text:true\r\n<Expected-Result/>\r\n\r\n\r\n\r\nTEST_2: Describe instance kernel given instance ID.\r\nXQuery:\r\n      xquery version \"1.0-ml\";\r\n      import module namespace ec2mod = \"http://marklogic.com/ec2\" at \"/MarkLogic/ec2-2009-11-30.xqy\";\r\n      declare namespace back = \"http://ec2.amazonaws.com/doc/2009-11-30/\";\r\n      let $access-key := doc(\"/amazon-ec2-access-key\")/data(accessKey)\r\n      let $private-key := doc(\"/amazon-ec2-private-key\")/data(privateKey)\r\n      let $test-region := doc(\"/test-region\")/data(testRegion)\r\n      let $instance-id := doc(\"/ebs-instance-id\")/data(back:instanceId)\r\n      let $new-kernel-id := doc(\"/new-kernel-id\")\r\n      let $ret := ec2mod:describe-instance-kernel($access-key,$private-key,\r\n        $test-region,$instance-id)/back:DescribeInstanceAttributeResponse/back:kernel/back:value\r\n      return (data($ret) = data($new-kernel-id))\r\n\r\nResult-text: true\r\nExpected-result: false\r\n\t\r\n\t\r\n\t\r\n\t\r\nTEST_3: Start the instance.\r\nXQuery:\r\n    xquery version \"1.0-ml\";\r\n    import module namespace ec2mod = \"http://marklogic.com/ec2\" at \"/MarkLogic/ec2-2009-11-30.xqy\";\r\n    declare namespace back = \"http://ec2.amazonaws.com/doc/2009-11-30/\";\r\n    let $access-key := doc(\"/amazon-ec2-access-key\")/data(accessKey)\r\n    let $private-key := doc(\"/amazon-ec2-private-key\")/data(privateKey)\r\n    let $test-region := doc(\"/test-region\")/data(testRegion)\r\n    let $instance-id := doc(\"/ebs-instance-id\")/data(back:instanceId)\r\n    let $state := ec2mod:start-instances($access-key,$private-key,$test-region,$instance-id)/back:StartInstancesResponse/back:instancesSet/back:item/back:currentState/back:name\r\n    return (if ($state = \"pending\")\r\n            then xdmp:sleep(60000)\r\n            else xdmp:sleep(1),\r\n            data($state))\r\n    \r\nResult-text:pending\r\n<Expected-result/>", "samplequery":"", "sampledata":"", "version":"6.0-nightly", "tofixin":"6.0-5", "fixedin":"N/A", "platform":"EC2", "memory":"", "processors":"", "note":"", "subscribers":[{"username":"ksaxena", "name":"Kapil Saxena", "email":"kapil.saxena@marklogic.com"}, {"username":"dlee", "name":"David  Lee", "email":"David.Lee@marklogic.com"}, {"username":"rpolasani", "name":"Raghu Polasani", "email":"raghu.polasani@marklogic.com"}, {"username":"lratcliff", "name":"Larry Ratcliff", "email":"lratcliff@marklogic.com"}], "attachments":[], "relationships":[{"type":"", "to":""}], "clones":[], "cloneOf":"", "support":{"headline":"", "supportDescription":"", "publishStatus":"Not Ready", "tickets":[], "customerImpact":{"level":"N/A", "title":""}, "workaround":""}, "tags":["xdmp", "ksaxena"], "changeHistory":[{"time":"2012-11-08T02:39:53.752797-08:00", "updatedBy":{"username":"ksaxena", "name":"Kapil Saxena", "email":"kapil.saxena@marklogic.com"}, "change":{"assignTo":{"from":{"username":"ksaxena", "name":"Kapil Saxena", "email":"kapil.saxena@marklogic.com"}, "to":{"username":"dlee", "name":"David  Lee", "email":"David.Lee@marklogic.com"}}}, "files":[], "show":true}, {"time":"2012-11-08T08:06:54.412516-08:00", "updatedBy":{"username":"dlee", "name":"David  Lee", "email":"David.Lee@marklogic.com"}, "change":{}, "files":[], "show":true, "comment":"This test makes no sense.\r\nStarting an instance all instances start in the pending state.   It takes from 1 to several minutes for the state to change to something else.\r\n\r\nThe expected result SHOULD be pending but its also possible to be running .... \r\nSee the example \r\nhttp://docs.amazonwebservices.com/AWSEC2/latest/APIReference/ApiReference-query-StartInstances.html\r\n\r\nThe returned state is in fact \"pending\"\r\n\r\nForthermore the sleeps are arbitrary ... probably setting up for the next test but make no sense here.\r\n\r\n\r\nLooking here:\r\nhttp://docs.amazonwebservices.com/AWSEC2/latest/APIReference/ApiReference-query-DescribeInstances.html\r\n\r\nThe only states that should be considered error are \r\n\r\nshutting-down | terminated | stopping | stopped\r\n\r\nEither pending or running should be considered success"}, {"time":"2012-11-08T08:06:54.412516-08:00", "updatedBy":{"username":"dlee", "name":"David  Lee", "email":"David.Lee@marklogic.com"}, "change":{"assignTo":{"from":{"username":"dlee", "name":"David  Lee", "email":"David.Lee@marklogic.com"}, "to":{"username":"ksaxena", "name":"Kapil Saxena", "email":"kapil.saxena@marklogic.com"}}}, "files":[], "show":true}, {"time":"2012-11-08T08:15:29.088743-08:00", "updatedBy":{"username":"dlee", "name":"David  Lee", "email":"David.Lee@marklogic.com"}, "change":{}, "files":[], "show":true, "comment":"I only addressed the last test, there are 3 failing tests here for different reasons.  In order to investigate I will need the date files\r\n\r\n    let $access-key := doc(\"/amazon-ec2-access-key\")/data(accessKey)\r\n    let $private-key := doc(\"/amazon-ec2-private-key\")/data(privateKey)\r\n\r\n\r\nas well as the login user and password to AWS console.\r\n\r\nPlease provide by seperate email\r\n"}, {"time":"2012-11-08T08:15:29.088743-08:00", "updatedBy":{"username":"dlee", "name":"David  Lee", "email":"David.Lee@marklogic.com"}, "change":{"assignTo":{"from":{"username":"dlee", "name":"David  Lee", "email":"David.Lee@marklogic.com"}, "to":{"username":"dlee", "name":"David  Lee", "email":"David.Lee@marklogic.com"}}}, "files":[], "show":true}, {"time":"2012-11-08T13:21:17.029784-08:00", "updatedBy":{"username":"dlee", "name":"David  Lee", "email":"David.Lee@marklogic.com"}, "change":{}, "files":[], "show":true, "comment":"Talked to Ron Hu.  Defering to 6.0.3\r\nThese functions have been broken since 5.0 and I do not belive any customers are using them.\r\nThey functions actually appear to work and the problems are in the test cases which have been a long time unused so amazon has changed a bit since they were created.\r\nWe should definately fix these but it is most likely fixing test cases not code and low priority.\r\n"}, {"time":"2012-11-08T13:21:17.029784-08:00", "updatedBy":{"username":"dlee", "name":"David  Lee", "email":"David.Lee@marklogic.com"}, "change":{"tofixin":{"from":"6.0-2", "to":"6.0-3"}}, "files":[], "show":true}, {"time":"2013-01-24T13:41:04.077766-08:00", "updatedBy":{"username":"dsokolsky", "name":"Danny Sokolsky", "email":"dsokolsky@marklogic.com"}, "change":{}, "files":[], "show":true, "comment":"David, can you suggest a way to fix this test so it runs?"}, {"time":"2013-01-24T13:43:26.628442-08:00", "updatedBy":{"username":"dsokolsky", "name":"Danny Sokolsky", "email":"dsokolsky@marklogic.com"}, "change":{}, "files":[], "show":true, "comment":"And after you suggest a way to fix the test (or if you do not know), please assign this to Raghu"}, {"time":"2013-01-24T14:36:46.505649-08:00", "updatedBy":{"username":"dlee", "name":"David  Lee", "email":"David.Lee@marklogic.com"}, "change":{}, "files":[], "show":true, "comment":"I would like to question the core reason for these API's.\r\nThis level of API is unnecessary, IMHO.\r\nIt is taking up our resources testing things that are a moving target without a core business reason.  Before trying to investage the possible cause, I would like to suggest that we dont actually need this API in the first place.  Or atleast to the level of detail that was implemented.\r\n\r\nIs there any history to indicate why we need this particular function ?  I suggest it is a total waste of time to try to fix them.\r\nTake the first one :\r\n\r\nec2mod:modify-instance-kernel\r\n\r\nWhy would anyone want to do this ? Why are we testing this except for that it was written once ?\r\nWhat possible use is it to modify the instance kernel ? Its not something I have ever done on EC2 nor would suggest anyone doing.\r\nWe know that NOONE has been using this since before V5 as there are no open issues to my knowledge and it was broken before then.\r\n\r\nAssigning to Raghu to triage.\r\n\r\n\r\n"}, {"time":"2013-01-24T14:36:46.505649-08:00", "updatedBy":{"username":"dlee", "name":"David  Lee", "email":"David.Lee@marklogic.com"}, "change":{"assignTo":{"from":{"username":"dlee", "name":"David  Lee", "email":"David.Lee@marklogic.com"}, "to":{"username":"rpolasani", "name":"Raghu Polasani", "email":"raghu.polasani@marklogic.com"}}}, "files":[], "show":true}, {"time":"2013-03-28T15:54:36.665001-07:00", "updatedBy":{"username":"rpolasani", "name":"Raghu Polasani", "email":"raghu.polasani@marklogic.com"}, "change":{"tofixin":{"from":"6.0-3", "to":"6.0-4"}}, "files":[], "show":true}, {"time":"2013-07-12T19:29:31.04791-07:00", "updatedBy":{"username":"rpolasani", "name":"Raghu Polasani", "email":"raghu.polasani@marklogic.com"}, "change":{"assignTo":{"from":{"username":"rpolasani", "name":"Raghu Polasani", "email":"raghu.polasani@marklogic.com"}, "to":{"username":"lratcliff", "name":"Larry Ratcliff", "email":"lratcliff@marklogic.com"}}}, "files":[], "show":true}, {"time":"2013-07-12T19:29:31.04791-07:00", "updatedBy":{"username":"rpolasani", "name":"Raghu Polasani", "email":"raghu.polasani@marklogic.com"}, "change":{"tofixin":{"from":"6.0-4", "to":"6.0-5"}}, "files":[], "show":true}, {"time":"2013-08-29T20:50:35.220225-07:00", "updatedBy":{"username":"gvaidees", "name":"Ganesh Vaideeswaran", "email":"Ganesh.Vaideeswaran@marklogic.com"}, "change":{}, "files":[], "show":true, "comment":"We should probably WNF this"}, {"time":"2014-02-10T10:20:23.139847-08:00", "updatedBy":{"username":"lratcliff", "name":"Larry Ratcliff", "email":"lratcliff@marklogic.com"}, "change":{"assignTo":{"from":{"username":"lratcliff", "name":"Larry Ratcliff", "email":"lratcliff@marklogic.com"}, "to":{"username":"jsolis", "name":"Julio Solis", "email":"Julio.Solis@marklogic.com"}}}, "files":[], "show":true}, {"time":"2014-02-28T15:16:42.88216-08:00", "updatedBy":{"username":"jsolis", "name":"Julio Solis", "email":"Julio.Solis@marklogic.com"}, "change":{"status":{"from":"", "to":"Will not fix"}, "assignTo":{"from":{"username":"jsolis", "name":"Julio Solis", "email":"Julio.Solis@marklogic.com"}, "to":{"username":"nobody", "name":"nobody nobody", "email":"nobody@marklogic.com"}}}, "files":[], "show":true, "comment":"Moving this bug to WNF based on the comments that it's not a likely customer scenario and there is some complexity in trying to fix this test issue."}], "updatedAt":"2014-02-28T15:16:42.88216-08:00", "renderDescriptionAs":"normal"}
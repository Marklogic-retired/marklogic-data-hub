{"id":20384, "kind":"Bug", "createdAt":"2012-12-18T20:33:02.337658-08:00", "status":"Closed", "title":"Issue validating an element embedded in another element", "category":"Validation", "severity":"Major", "priority":{"level":"5", "title":""}, "submittedBy":{"username":"dchander", "name":"Dinesh Chander", "email":"dinesh.chander@globallogic.com"}, "assignTo":{"username":"nobody", "name":"nobody nobody", "email":"nobody@marklogic.com"}, "description":"Reported by user in case #12269\r\n-----------------------------------------------------------------------------------------------------------------------------------------------\r\n  While validating an element against a schema, I get an error\r\nwhilst I think it should pass.  I might have missed something\r\nhere, but it looks like a bug to me (besides it works on Saxon).\r\nThe simplest case I could come up with is the following:\r\n  - /tmp/top.xsd declares element t:top of type i:type\r\n  - /tmp/included.xsd declares type i:type\r\n  - i:type has a single child, called i:child (of type string)\r\n  When I try to validate the following, it passes (when evaluated\r\nin a database with a schema database containing both schemas):\r\n    validate {  <top xmlns=\"urn:top\" xmlns:i=\"urn:included\"> <i:child>hello</i:child>  </top> }\r\n\r\nbut when I try to validate the following instead, it fails:\r\n    validate {  <data> <top xmlns=\"urn:top\" xmlns:i=\"urn:included\">  <i:child>hello</i:child>  </top>    </data>/*   }\r\n\r\n  The error message:\r\n    [1.0-ml] XDMP-VALIDATENODECL: (err:XQDY0084) validate { <data><top xmlns=\"urn:top\" xmlns:i=\"urn:included\"><i:child>hello</i:child></top></data>/* } -- Missing element declaration: Expected declaration for node /data/t:top/*:child in non-lax mode using schema \"/tmp/top.xsd\" \r\n\r\n  The schemas are the following (wrapped in the corresponding xdmp:document-insert so you can directly evaluate them):\r\n xdmp:document-insert(  '/tmp/top.xsd', <xs:schema elementFormDefault=\"qualified\"  xmlns:xs=\"http://www.w3.org/2001/XMLSchema\" targetNamespace=\"urn:top\"  xmlns:i=\"urn:included\">\r\n      <xs:import namespace=\"urn:included\"  schemaLocation=\"included.xsd\"/>  <xs:element name=\"top\" type=\"i:type\"/> </xs:schema>   )\r\n\r\nxdmp:document-insert( '/tmp/included.xsd', <xs:schema elementFormDefault=\"qualified\" xmlns:xs=\"http://www.w3.org/2001/XMLSchema\"\r\n targetNamespace=\"urn:included\"> \r\n<xs:complexType name=\"type\"><xs:sequence><xs:element name=\"child\" type=\"xs:string\"/></xs:sequence> </xs:complexType></xs:schema>)\r\n\r\n  By the way, the following passes, so it really looks like it is related to validating an element embedded in another element:\r\n    validate {     <data> <top xmlns=\"urn:top\" xmlns:i=\"urn:included\"> <i:child>hello</i:child> </top> </data>/document { * } }\r\n\r\n  Did I miss something or is it a bug?  If it is a bug, is there any workaround other than copying the whole element? (the validation is done on every children of a wrapper element, there can be a lot of them and they are not tiny...)\r\n\r\n  Regards,\r\n-- \r\nFlorent Georges\r\n-----------------------------------------------------------------------------------------------------------------------------------------------", "samplequery":"", "sampledata":"", "version":"7.0-nightly", "tofixin":"7.0-1", "fixedin":"7.0-1", "platform":"all", "memory":"", "processors":"", "note":"", "subscribers":[{"username":"dchander", "name":"Dinesh Chander", "email":"dinesh.chander@globallogic.com"}, {"username":"mary", "name":"Mary Holstege", "email":"mary@cerisent.com"}, {"username":"rpolasani", "name":"Raghu Polasani", "email":"raghu.polasani@marklogic.com"}, {"username":"sverma", "name":"Shiva Verma", "email":"shiva.verma@marklogic.com"}], "attachments":[], "relationships":[{"type":"", "to":""}], "clones":[], "cloneOf":20307, "support":{"headline":"validation of a child of an element with no schema of its own may fail", "supportDescription":"If a schema involves multiple namespaces, and an instance of an element in that schema is embedded inside a wrapper element that has no schema of its own, attempts to validate the child may fail with XDMP-VALIDATENODECL errors. For example, if there is a schema for the namespace \"urn:top\" and it imports \"urn:included\", the following expression will fail to validate:\r\n\r\nvalidate { \r\n   <data> \r\n     <top xmlns=\"urn:top\" xmlns:i=\"urn:included\"> \r\n       <i:child>hello</i:child> \r\n     </top> \r\n   </data>/* \r\n} ", "publishStatus":"Publish", "tickets":[], "customerImpact":{"level":"Low", "title":"Minimal business impact or reasonable workaround is available"}, "workaround":"Deparent the element to be validated so that it is the root of its own data model instance, and then validate it:\r\nvalidate { document { \r\n   <data> \r\n     <top xmlns=\"urn:top\" xmlns:i=\"urn:included\"> \r\n       <i:child>hello</i:child> \r\n     </top> \r\n   </data>/* \r\n} }"}, "tags":["Validation", "dchander"], "changeHistory":[{"time":"2012-12-18T20:33:02.337658-08:00", "updatedBy":{"username":"dchander", "name":"Dinesh Chander", "email":"dinesh.chander@globallogic.com"}, "change":{"assignTo":{"from":{"username":"dchander", "name":"Dinesh Chander", "email":"dinesh.chander@globallogic.com"}, "to":{"username":"mary", "name":"Mary Holstege", "email":"mary@cerisent.com"}}}, "files":[], "show":true}, {"time":"2012-12-18T20:33:59.101224-08:00", "updatedBy":{"username":"dchander", "name":"Dinesh Chander", "email":"dinesh.chander@globallogic.com"}, "change":{}, "files":[], "show":true, "comment":"This issue is consistent across all ML versions (4.x, 5.x, 6.x)"}, {"time":"2012-12-22T14:25:24.32221-08:00", "updatedBy":{"username":"dsokolsky", "name":"Danny Sokolsky", "email":"dsokolsky@marklogic.com"}, "change":{"tofixin":{"from":"", "to":"5.0-5"}}, "files":[], "show":true}, {"time":"2013-01-04T11:53:37.264057-08:00", "updatedBy":{"username":"mary", "name":"Mary Holstege", "email":"mary@cerisent.com"}, "change":{"tofixin":{"from":"", "to":"7.0-ea1"}}, "files":[], "show":true}, {"time":"2013-01-04T11:56:10.851811-08:00", "updatedBy":{"username":"mary", "name":"Mary Holstege", "email":"mary@cerisent.com"}, "change":{}, "files":[], "show":true, "svn":{"repository":"/project/engsvn", "revision":"126574", "paths":["xdmp/trunk/src/Schema.cpp"], "affectedBugs":[]}, "comment":"Bug:20384 element decl for child in different namespace from parent, in tree with wrong root schema"}, {"time":"2013-01-04T12:00:55.363633-08:00", "updatedBy":{"username":"mary", "name":"Mary Holstege", "email":"mary@cerisent.com"}, "change":{"status":{"from":"", "to":"Test"}, "assignTo":{"from":{"username":"mary", "name":"Mary Holstege", "email":"mary@cerisent.com"}, "to":{"username":"rpolasani", "name":"Raghu Polasani", "email":"raghu.polasani@marklogic.com"}}}, "files":[], "show":true, "comment":"Fixed 7.0-20130105\r\n\r\nThere may be some flux in the schema testsuite results, but for me the results are slightly better overall. 207 failures in MS, 56 in Sun."}, {"time":"2013-01-04T12:00:55.363633-08:00", "updatedBy":{"username":"mary", "name":"Mary Holstege", "email":"mary@cerisent.com"}, "change":{"assignTo":{"from":{"username":"mary", "name":"Mary Holstege", "email":"mary@cerisent.com"}, "to":{"username":"rpolasani", "name":"Raghu Polasani", "email":"raghu.polasani@marklogic.com"}}}, "files":[], "show":true}, {"time":"2013-03-02T10:47:35.426096-08:00", "updatedBy":{"username":"rpolasani", "name":"Raghu Polasani", "email":"raghu.polasani@marklogic.com"}, "change":{"assignTo":{"from":{"username":"rpolasani", "name":"Raghu Polasani", "email":"raghu.polasani@marklogic.com"}, "to":{"username":"sverma", "name":"Shiva Verma", "email":"shiva.verma@marklogic.com"}}}, "files":[], "show":true}, {"time":"2013-03-05T22:33:17.275155-08:00", "updatedBy":{"username":"sverma", "name":"Shiva Verma", "email":"shiva.verma@marklogic.com"}, "change":{"status":{"from":"", "to":"Ship"}, "assignTo":{"from":{"username":"sverma", "name":"Shiva Verma", "email":"shiva.verma@marklogic.com"}, "to":{"username":"nobody", "name":"nobody nobody", "email":"nobody@marklogic.com"}}}, "files":[], "show":true, "comment":"Verified on 0305 build. Added to automated suite"}, {"time":"2013-03-05T22:33:17.275155-08:00", "updatedBy":{"username":"sverma", "name":"Shiva Verma", "email":"shiva.verma@marklogic.com"}, "change":{"assignTo":{"from":{"username":"sverma", "name":"Shiva Verma", "email":"shiva.verma@marklogic.com"}, "to":{"username":"nobody", "name":"nobody nobody", "email":"nobody@marklogic.com"}}}, "files":[], "show":true}], "updatedAt":"2013-03-05T22:33:17.275155-08:00", "fixedAt":"2013-01-04T12:00:55.363633-08:00", "fixedBy":{"username":"mary", "name":"Mary Holstege", "email":"mary@cerisent.com"}, "shippedAt":"2013-03-05T22:33:17.275155-08:00", "shippedBy":{"username":"sverma", "name":"Shiva Verma", "email":"shiva.verma@marklogic.com"}, "renderDescriptionAs":"normal"}
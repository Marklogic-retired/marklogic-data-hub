{"id":20621, "kind":"Bug", "createdAt":"2013-01-28T22:56:32.286086-08:00", "status":"Closed", "title":"Element <qry:annotation> is returned in xdmp:plan() on 7.0 which is not expected.", "category":"xdmp", "severity":"Major", "priority":{"level":"5", "title":""}, "submittedBy":{"username":"iagrawal", "name":"Isha Agrawal", "email":"iagrawal@marklogic.com"}, "assignTo":{"username":"nobody", "name":"nobody nobody", "email":"nobody@marklogic.com"}, "description":"Element <qry:annotation> is returned in xdmp:plan() on 7.0 which is not expected.\r\n\r\nTest failing: bug13831.xml\r\n\r\nXquery:\r\n\r\nxquery version \"1.0-ml\";\r\nxdmp:plan(fn:collection()/a[b=1]/c)\r\n\r\nActual result: \r\n\r\n<qry:query-plan xmlns:qry=\"http://marklogic.com/cts/query\">\r\n  <qry:info-trace>Analyzing path: fn:collection()/a[b = 1]/c</qry:info-trace>\r\n  <qry:info-trace>Step 1 is searchable: fn:collection()</qry:info-trace>\r\n  <qry:info-trace>Step 2 is searchable: a[b = 1]</qry:info-trace>\r\n  <qry:info-trace>Step 3 is searchable: c</qry:info-trace>\r\n  <qry:info-trace>Path is fully searchable.</qry:info-trace>\r\n  <qry:info-trace>Gathering constraints.</qry:info-trace>\r\n  <qry:info-trace>Step 2 predicate 1 contributed 1 constraint: b = 1</qry:info-trace>\r\n  <qry:partial-plan>\r\n    <qry:or-query>\r\n      <qry:and-two-queries>\r\n\t<qry:term-query weight=\"0\">\r\n\t  <qry:key>14087508160194890739</qry:key>\r\n\t  <qry:annotation>link-parent(element-child(a/b))</qry:annotation>\r\n\t</qry:term-query>\r\n\t<qry:term-query weight=\"0\">\r\n\t  <qry:key>18075691994223375674</qry:key>\r\n\t  <qry:annotation>element(b,value(\"1\"))</qry:annotation>\r\n\t</qry:term-query>\r\n      </qry:and-two-queries>\r\n      <qry:term-query weight=\"0\">\r\n\t<qry:key>3561845841132453938</qry:key>\r\n\t<qry:annotation>element-child(a/b)</qry:annotation>\r\n      </qry:term-query>\r\n      <qry:term-query weight=\"0\">\r\n\t<qry:key>17346763387436321475</qry:key>\r\n\t<qry:annotation>link-child(element(b))</qry:annotation>\r\n      </qry:term-query>\r\n      <qry:term-query weight=\"0\">\r\n\t<qry:key>754508687540144677</qry:key>\r\n\t<qry:annotation>descendant(element(b))</qry:annotation>\r\n      </qry:term-query>\r\n    </qry:or-query>\r\n  </qry:partial-plan>\r\n  <qry:info-trace>Step 2 predicate 1 contributed 1 constraint: b = 1</qry:info-trace>\r\n  <qry:partial-plan>\r\n    <qry:or-query>\r\n      <qry:and-two-queries>\r\n\t<qry:term-query weight=\"0\">\r\n\t  <qry:key>14087508160194890739</qry:key>\r\n\t  <qry:annotation>link-parent(element-child(a/b))</qry:annotation>\r\n\t</qry:term-query>\r\n\t<qry:term-query weight=\"0\">\r\n\t  <qry:key>18075691994223375674</qry:key>\r\n\t  <qry:annotation>element(b,value(\"1\"))</qry:annotation>\r\n\t</qry:term-query>\r\n      </qry:and-two-queries>\r\n      <qry:term-query weight=\"0\">\r\n\t<qry:key>3561845841132453938</qry:key>\r\n\t<qry:annotation>element-child(a/b)</qry:annotation>\r\n      </qry:term-query>\r\n      <qry:term-query weight=\"0\">\r\n\t<qry:key>17346763387436321475</qry:key>\r\n\t<qry:annotation>link-child(element(b))</qry:annotation>\r\n      </qry:term-query>\r\n      <qry:term-query weight=\"0\">\r\n\t<qry:key>754508687540144677</qry:key>\r\n\t<qry:annotation>descendant(element(b))</qry:annotation>\r\n      </qry:term-query>\r\n    </qry:or-query>\r\n  </qry:partial-plan>\r\n  <qry:info-trace>Executing search.</qry:info-trace>\r\n  <qry:final-plan>\r\n    <qry:and-query>\r\n      <qry:term-query weight=\"0\">\r\n\t<qry:key>7858867116540377232</qry:key>\r\n\t<qry:annotation>descendent(element(a))</qry:annotation>\r\n      </qry:term-query>\r\n      <qry:or-query>\r\n\t<qry:and-two-queries>\r\n\t  <qry:term-query weight=\"0\">\r\n\t    <qry:key>14087508160194890739</qry:key>\r\n\t    <qry:annotation>link-parent(element-child(a/b))</qry:annotation>\r\n\t  </qry:term-query>\r\n\t  <qry:term-query weight=\"0\">\r\n\t    <qry:key>18075691994223375674</qry:key>\r\n\t    <qry:annotation>element(b,value(\"1\"))</qry:annotation>\r\n\t  </qry:term-query>\r\n\t</qry:and-two-queries>\r\n\t<qry:term-query weight=\"0\">\r\n\t  <qry:key>3561845841132453938</qry:key>\r\n\t  <qry:annotation>element-child(a/b)</qry:annotation>\r\n\t</qry:term-query>\r\n\t<qry:term-query weight=\"0\">\r\n\t  <qry:key>17346763387436321475</qry:key>\r\n\t  <qry:annotation>link-child(element(b))</qry:annotation>\r\n\t</qry:term-query>\r\n\t<qry:term-query weight=\"0\">\r\n\t  <qry:key>754508687540144677</qry:key>\r\n\t  <qry:annotation>descendant(element(b))</qry:annotation>\r\n\t</qry:term-query>\r\n      </qry:or-query>\r\n      <qry:term-query weight=\"0\">\r\n\t<qry:key>14087508160272320054</qry:key>\r\n\t<qry:annotation>element-child(a/c)</qry:annotation>\r\n      </qry:term-query>\r\n    </qry:and-query>\r\n  </qry:final-plan>\r\n  <qry:info-trace>Selected 0 fragments</qry:info-trace>\r\n  <qry:result estimate=\"0\"/>\r\n</qry:query-plan>\r\n\r\nExpected Result:\r\n\r\n<qry:query-plan xmlns:qry=\"http://marklogic.com/cts/query\">\r\n  <qry:info-trace>Analyzing path: fn:collection()/a[b = 1]/c</qry:info-trace>\r\n  <qry:info-trace>Step 1 is searchable: fn:collection()</qry:info-trace>\r\n  <qry:info-trace>Step 2 is searchable: a[b = 1]</qry:info-trace>\r\n  <qry:info-trace>Step 3 is searchable: c</qry:info-trace>\r\n  <qry:info-trace>Path is fully searchable.</qry:info-trace>\r\n  <qry:info-trace>Gathering constraints.</qry:info-trace>\r\n  <qry:info-trace>Step 2 predicate 1 contributed 1 constraint: b = 1</qry:info-trace>\r\n  <qry:partial-plan>\r\n    <qry:or-query>\r\n      <qry:and-two-queries>\r\n\t<qry:term-query weight=\"0\">\r\n\t  <qry:key>14087508160194890739</qry:key>\r\n\t</qry:term-query>\r\n\t<qry:term-query weight=\"0\">\r\n\t  <qry:key>18075691994223375674</qry:key>\r\n\t</qry:term-query>\r\n      </qry:and-two-queries>\r\n      <qry:term-query weight=\"0\">\r\n\t<qry:key>3561845841132453938</qry:key>\r\n      </qry:term-query>\r\n      <qry:term-query weight=\"0\">\r\n\t<qry:key>17346763387436321475</qry:key>\r\n      </qry:term-query>\r\n      <qry:term-query weight=\"0\">\r\n\t<qry:key>754508687540144677</qry:key>\r\n      </qry:term-query>\r\n    </qry:or-query>\r\n  </qry:partial-plan>\r\n  <qry:info-trace>Step 2 predicate 1 contributed 1 constraint: b = 1</qry:info-trace>\r\n  <qry:partial-plan>\r\n    <qry:or-query>\r\n      <qry:and-two-queries>\r\n\t<qry:term-query weight=\"0\">\r\n\t  <qry:key>14087508160194890739</qry:key>\r\n\t</qry:term-query>\r\n\t<qry:term-query weight=\"0\">\r\n\t  <qry:key>18075691994223375674</qry:key>\r\n\t</qry:term-query>\r\n      </qry:and-two-queries>\r\n      <qry:term-query weight=\"0\">\r\n\t<qry:key>3561845841132453938</qry:key>\r\n      </qry:term-query>\r\n      <qry:term-query weight=\"0\">\r\n\t<qry:key>17346763387436321475</qry:key>\r\n      </qry:term-query>\r\n      <qry:term-query weight=\"0\">\r\n\t<qry:key>754508687540144677</qry:key>\r\n      </qry:term-query>\r\n    </qry:or-query>\r\n  </qry:partial-plan>\r\n  <qry:info-trace>Executing search.</qry:info-trace>\r\n  <qry:final-plan>\r\n    <qry:and-query>\r\n      <qry:term-query weight=\"0\">\r\n\t<qry:key>7858867116540377232</qry:key>\r\n      </qry:term-query>\r\n      <qry:or-query>\r\n\t<qry:and-two-queries>\r\n\t  <qry:term-query weight=\"0\">\r\n\t    <qry:key>14087508160194890739</qry:key>\r\n\t  </qry:term-query>\r\n\t  <qry:term-query weight=\"0\">\r\n\t    <qry:key>18075691994223375674</qry:key>\r\n\t  </qry:term-query>\r\n\t</qry:and-two-queries>\r\n\t<qry:term-query weight=\"0\">\r\n\t  <qry:key>3561845841132453938</qry:key>\r\n\t</qry:term-query>\r\n\t<qry:term-query weight=\"0\">\r\n\t  <qry:key>17346763387436321475</qry:key>\r\n\t</qry:term-query>\r\n\t<qry:term-query weight=\"0\">\r\n\t  <qry:key>754508687540144677</qry:key>\r\n\t</qry:term-query>\r\n      </qry:or-query>\r\n      <qry:term-query weight=\"0\">\r\n\t<qry:key>14087508160272320054</qry:key>\r\n      </qry:term-query>\r\n    </qry:and-query>\r\n  </qry:final-plan>\r\n  <qry:info-trace>Selected 0 fragments</qry:info-trace>\r\n  <qry:result estimate=\"0\"/>\r\n</qry:query-plan>\r\n\r\nThe difference in actual result and expected result:  Extra lines appearing in actaul result,few of them are given below:\r\n\r\n<qry:annotation>link-parent(element-child(a/b))</qry:annotation>\r\n....\r\n<qry:annotation>element(b,value(\"1\"))</qry:annotation>\r\n....\r\n<qry:annotation>element-child(a/b)</qry:annotation>\r\n....\r\n<qry:annotation>link-child(element(b))</qry:annotation>\r\n....\r\n<qry:annotation>descendant(element(b))</qry:annotation>\r\n", "samplequery":"", "sampledata":"", "version":"7.0-nightly", "tofixin":"7.0-ea2", "fixedin":"7.0-ea2", "platform":"all", "memory":"", "processors":"", "note":"", "subscribers":[{"username":"iagrawal", "name":"Isha Agrawal", "email":"iagrawal@marklogic.com"}, {"username":"fxue", "name":"Fei Xue", "email":"Fei.Xue@marklogic.com"}, {"username":"msrinivasan", "name":"Mahalakshmi Srinivasan", "email":"mahalakshmi.srinivasan@marklogic.com"}, {"username":"sverma", "name":"Shiva Verma", "email":"shiva.verma@marklogic.com"}, {"username":"rpolasani", "name":"Raghu Polasani", "email":"raghu.polasani@marklogic.com"}], "attachments":[], "relationships":[{"type":"", "to":""}], "clones":[], "cloneOf":"", "support":{"headline":"", "supportDescription":"", "publishStatus":"Not Ready", "tickets":[], "customerImpact":{"level":"N/A", "title":""}, "workaround":""}, "tags":["xdmp", "iagrawal"], "changeHistory":[{"time":"2013-01-28T22:56:32.286086-08:00", "updatedBy":{"username":"iagrawal", "name":"Isha Agrawal", "email":"iagrawal@marklogic.com"}, "change":{"assignTo":{"from":{"username":"iagrawal", "name":"Isha Agrawal", "email":"iagrawal@marklogic.com"}, "to":{"username":"fxue", "name":"Fei Xue", "email":"Fei.Xue@marklogic.com"}}}, "files":[], "show":true}, {"time":"2013-02-15T11:51:24.54658-08:00", "updatedBy":{"username":"rpolasani", "name":"Raghu Polasani", "email":"raghu.polasani@marklogic.com"}, "change":{}, "files":[], "show":true, "comment":"Isha, I think this is the new functionality Fei added in ML7 for xdmp:plan(). Please work with Maha on updating the keys.\r\n\r\n"}, {"time":"2013-02-15T11:51:24.54658-08:00", "updatedBy":{"username":"rpolasani", "name":"Raghu Polasani", "email":"raghu.polasani@marklogic.com"}, "change":{"assignTo":{"from":{"username":"rpolasani", "name":"Raghu Polasani", "email":"raghu.polasani@marklogic.com"}, "to":{"username":"iagrawal", "name":"Isha Agrawal", "email":"iagrawal@marklogic.com"}}}, "files":[], "show":true}, {"time":"2013-02-25T04:13:42.050194-08:00", "updatedBy":{"username":"iagrawal", "name":"Isha Agrawal", "email":"iagrawal@marklogic.com"}, "change":{}, "files":[], "show":true, "comment":"As per Fei:\r\n\r\nHi Isha,\r\n\r\nI think it would be better to update the change later. Perhaps after ea2 as there still might be change in place.\r\nThanks!\r\n\r\nFei\r\n"}, {"time":"2013-02-26T22:20:29.339446-08:00", "updatedBy":{"username":"rpolasani", "name":"Raghu Polasani", "email":"raghu.polasani@marklogic.com"}, "change":{}, "files":[], "show":true, "comment":"Fei, Can you move this back to Isha after you are done with all the changes so that she can update the key accordingly."}, {"time":"2013-02-26T22:20:29.339446-08:00", "updatedBy":{"username":"rpolasani", "name":"Raghu Polasani", "email":"raghu.polasani@marklogic.com"}, "change":{"assignTo":{"from":{"username":"rpolasani", "name":"Raghu Polasani", "email":"raghu.polasani@marklogic.com"}, "to":{"username":"fxue", "name":"Fei Xue", "email":"Fei.Xue@marklogic.com"}}}, "files":[], "show":true}, {"time":"2013-02-26T22:20:29.339446-08:00", "updatedBy":{"username":"rpolasani", "name":"Raghu Polasani", "email":"raghu.polasani@marklogic.com"}, "change":{"tofixin":{"from":"7.0-ea1", "to":"7.0-ea2"}}, "files":[], "show":true}, {"time":"2013-02-26T23:59:56.069629-08:00", "updatedBy":{"username":"iagrawal", "name":"Isha Agrawal", "email":"iagrawal@marklogic.com"}, "change":{}, "files":[], "show":true, "comment":"Updated key for test bug13831.xml for 7.0-ea1 and created task20952. Once Fei will confirm the changes for 7.0, will update the key accordingly then"}, {"time":"2013-04-04T16:00:10.389622-07:00", "updatedBy":{"username":"fxue", "name":"Fei Xue", "email":"Fei.Xue@marklogic.com"}, "change":{"status":{"from":"", "to":"Test"}, "assignTo":{"from":{"username":"fxue", "name":"Fei Xue", "email":"Fei.Xue@marklogic.com"}, "to":{"username":"iagrawal", "name":"Isha Agrawal", "email":"iagrawal@marklogic.com"}}}, "files":[], "show":true, "comment":"Moving this to your queue, Isha."}, {"time":"2013-04-04T16:00:10.389622-07:00", "updatedBy":{"username":"fxue", "name":"Fei Xue", "email":"Fei.Xue@marklogic.com"}, "change":{"assignTo":{"from":{"username":"fxue", "name":"Fei Xue", "email":"Fei.Xue@marklogic.com"}, "to":{"username":"iagrawal", "name":"Isha Agrawal", "email":"iagrawal@marklogic.com"}}}, "files":[], "show":true}, {"time":"2013-04-29T00:28:28.574739-07:00", "updatedBy":{"username":"iagrawal", "name":"Isha Agrawal", "email":"iagrawal@marklogic.com"}, "change":{"status":{"from":"", "to":"Closed"}, "assignTo":{"from":{"username":"iagrawal", "name":"Isha Agrawal", "email":"iagrawal@marklogic.com"}, "to":{"username":"nobody", "name":"nobody nobody", "email":"nobody@marklogic.com"}}}, "files":[], "show":true, "comment":"Updated keys as per new functionality changes.Hence,closing the bug"}, {"time":"2013-04-29T00:28:28.574739-07:00", "updatedBy":{"username":"iagrawal", "name":"Isha Agrawal", "email":"iagrawal@marklogic.com"}, "change":{"assignTo":{"from":{"username":"iagrawal", "name":"Isha Agrawal", "email":"iagrawal@marklogic.com"}, "to":{"username":"nobody", "name":"nobody nobody", "email":"nobody@marklogic.com"}}}, "files":[], "show":true}], "updatedAt":"2013-04-29T00:28:28.574739-07:00", "fixedAt":"2013-04-04T16:00:10.389622-07:00", "fixedBy":{"username":"fxue", "name":"Fei Xue", "email":"Fei.Xue@marklogic.com"}, "closedAt":"2013-04-29T00:28:28.574739-07:00", "closedBy":{"username":"iagrawal", "name":"Isha Agrawal", "email":"iagrawal@marklogic.com"}, "renderDescriptionAs":"normal"}
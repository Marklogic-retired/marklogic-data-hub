{"id":20926, "kind":"Bug", "createdAt":"2013-02-25T16:27:55.356013-08:00", "status":"Closed", "title":"REGR: v2 endpoints are not working with user with  \"manage-user\" role.", "category":"Config Management", "severity":"Critical", "priority":{"level":"5", "title":""}, "submittedBy":{"username":"msarma", "name":"Meghalim Sarma", "email":"msarma@marklogic.com"}, "assignTo":{"username":"nobody", "name":"nobody nobody", "email":"nobody@marklogic.com"}, "description":"Build used: 0225 7.0-EA1 build.\r\n\r\n\r\n1. Create a user \"manage\" with password \"manage\" who has \"manage-user\" role.\r\n2. Create a package \r\n\r\nxquery version \"1.0-ml\";\r\n\r\nlet $response := xdmp:http-post(\"http://localhost:8002/manage/v2/packages?pkgname=bug&amp;format=xml\",\r\n     <options xmlns=\"xdmp:http\">\r\n       <authentication method=\"digest\">\r\n           <username>manage</username>\r\n         <password>manage</password>\r\n       </authentication>\r\n        <headers>\r\n         <accept>application/xml</accept>\r\n       </headers>\r\n     </options>)\r\n      return $response\r\n\r\nYou will get 403 unauthorized with the error message \"You must have Administrative privileges to execute this request\"\r\n\r\n", "samplequery":"", "sampledata":"", "version":"7.0-nightly", "tofixin":"7.0-ea2", "fixedin":"7.0-ea2", "platform":"all", "memory":"", "processors":"", "note":"", "subscribers":[{"username":"msarma", "name":"Meghalim Sarma", "email":"msarma@marklogic.com"}, {"username":"aabbas", "name":"Adeel Abbas", "email":"Adeel.Abbas@marklogic.com"}, {"username":"nwalsh", "name":"Norman Walsh", "email":"norman.walsh@marklogic.com"}], "attachments":[], "relationships":[{"type":"", "to":""}], "clones":[], "cloneOf":"", "support":{"headline":"", "supportDescription":"", "publishStatus":"Not Ready", "tickets":[], "customerImpact":{"level":"N/A", "title":""}, "workaround":""}, "tags":["Config Management", "msarma"], "changeHistory":[{"time":"2013-02-25T16:27:55.356013-08:00", "updatedBy":{"username":"msarma", "name":"Meghalim Sarma", "email":"msarma@marklogic.com"}, "change":{"assignTo":{"from":{"username":"msarma", "name":"Meghalim Sarma", "email":"msarma@marklogic.com"}, "to":{"username":"nwalsh", "name":"Norman Walsh", "email":"norman.walsh@marklogic.com"}}}, "files":[], "show":true}, {"time":"2013-02-25T16:28:58.266139-08:00", "updatedBy":{"username":"msarma", "name":"Meghalim Sarma", "email":"msarma@marklogic.com"}, "change":{}, "files":[], "show":true, "comment":"This might be true for all v2 endpoint. I ran into the same issue with /manage/v2/packages/$pkgname/databases."}, {"time":"2013-02-25T17:07:14.303834-08:00", "updatedBy":{"username":"msarma", "name":"Meghalim Sarma", "email":"msarma@marklogic.com"}, "change":{}, "files":[], "show":true, "comment":"Changing the description as this issue is generic to all /manage/v2 endpoints"}, {"time":"2013-02-27T12:35:36.162796-08:00", "updatedBy":{"username":"dsokolsky", "name":"Danny Sokolsky", "email":"dsokolsky@marklogic.com"}, "change":{"tofixin":{"from":"7.0-ea1", "to":"7.0-ea2"}}, "files":[], "show":true}, {"time":"2013-04-18T13:57:19.068755-07:00", "updatedBy":{"username":"cwhitney", "name":"Colleen  Whitney", "email":"colleen.whitney@marklogic.com"}, "change":{}, "files":[], "show":true, "comment":"At the time when this was logged, \"all v2 endpoints\" = the new packaging endpoints.  \r\n\r\nI suspect that the bug is limited to the new packaging and possibly metering endpoints, and doesn't apply to the endpoints that existed in v1.  Perhaps Megha can say more about that."}, {"time":"2013-04-18T23:04:58.162417-07:00", "updatedBy":{"username":"msarma", "name":"Meghalim Sarma", "email":"msarma@marklogic.com"}, "change":{}, "files":[], "show":true, "comment":"Colleen I verified this taking today's build. I too thought that this was only applicable to new packaging endpoints. But looks like this issue is present to some endpoints which existed in 6.0 (/manage/v2/servers/$name?view=package). /manage/v2/databases/$name?view=package seems to be OK though."}, {"time":"2013-04-22T00:32:00.250278-07:00", "updatedBy":{"username":"jfuller", "name":"Jim Fuller", "email":"jim.fuller@marklogic.com"}, "change":{}, "files":[], "show":true, "comment":"I have unit tests that test for this in meters ... they were passing before I left on holiday.\r\n\r\nwill check again "}, {"time":"2013-04-24T09:25:57.435507-07:00", "updatedBy":{"username":"msarma", "name":"Meghalim Sarma", "email":"msarma@marklogic.com"}, "change":{}, "files":[], "show":true, "comment":"I am marking it as REGR as this impacts the endpoints which existed before as well (which were moved from Va to V2)\r\n\r\nOur ROC automated suite is broken because of this."}, {"time":"2013-04-25T11:09:19.032864-07:00", "updatedBy":{"username":"nwalsh", "name":"Norman Walsh", "email":"norman.walsh@marklogic.com"}, "change":{}, "files":[], "show":true, "comment":"See also bug:21747."}, {"time":"2013-04-25T15:52:19.302584-07:00", "updatedBy":{"username":"nwalsh", "name":"Norman Walsh", "email":"norman.walsh@marklogic.com"}, "change":{}, "files":[], "show":true, "svn":{"repository":"/project/engsvn", "revision":"140101", "paths":["xdmp/trunk/src/Modules/MarkLogic/package/lib/package-io.xqy", "xdmp/trunk/src/Modules/MarkLogic/manage/models/database-model.xqy", "xdmp/trunk/src/Modules/MarkLogic/package/lib/package-validate.xqy", "xdmp/trunk/src/Apps/common-api/endpoints/packages/default.xqy", "xdmp/trunk/src/Modules/MarkLogic/package/package.xqy", "xdmp/trunk/src/Modules/MarkLogic/package/lib/package-utils.xqy", "xdmp/trunk/src/Apps/test/appservices/package-unittest/create-unittest.xqy", "xdmp/trunk/src/Modules/MarkLogic/package/lib/package-amped.xqy", "xdmp/trunk/src/Config/security.xml", "xdmp/trunk/src/Modules/MarkLogic/package/lib/package-install.xqy"], "affectedBugs":[]}, "comment":"Fix bug:20926 make packaging work for users with the manage-admin role"}, {"time":"2013-04-25T15:52:47.049079-07:00", "updatedBy":{"username":"nwalsh", "name":"Norman Walsh", "email":"norman.walsh@marklogic.com"}, "change":{"status":{"from":"", "to":"Test"}, "assignTo":{"from":{"username":"nwalsh", "name":"Norman Walsh", "email":"norman.walsh@marklogic.com"}, "to":{"username":"msarma", "name":"Meghalim Sarma", "email":"msarma@marklogic.com"}}}, "files":[], "show":true, "comment":"Fixed for the manage-admin role, I believe."}, {"time":"2013-04-25T15:52:47.049079-07:00", "updatedBy":{"username":"nwalsh", "name":"Norman Walsh", "email":"norman.walsh@marklogic.com"}, "change":{"assignTo":{"from":{"username":"nwalsh", "name":"Norman Walsh", "email":"norman.walsh@marklogic.com"}, "to":{"username":"msarma", "name":"Meghalim Sarma", "email":"msarma@marklogic.com"}}}, "files":[], "show":true}, {"time":"2013-05-09T14:11:45.676116-07:00", "updatedBy":{"username":"msarma", "name":"Meghalim Sarma", "email":"msarma@marklogic.com"}, "change":{"status":{"from":"", "to":"Ship"}, "assignTo":{"from":{"username":"msarma", "name":"Meghalim Sarma", "email":"msarma@marklogic.com"}, "to":{"username":"nobody", "name":"nobody nobody", "email":"nobody@marklogic.com"}}}, "files":[], "show":true, "comment":"Verified on 0509 build that /manage/v2 endpoints work with manage-admin role. There is a separate bug that has been logged to track the issue of manage-user role not working yet.\r\n\r\nShipping this bug."}, {"time":"2013-05-09T14:11:45.676116-07:00", "updatedBy":{"username":"msarma", "name":"Meghalim Sarma", "email":"msarma@marklogic.com"}, "change":{"assignTo":{"from":{"username":"msarma", "name":"Meghalim Sarma", "email":"msarma@marklogic.com"}, "to":{"username":"nobody", "name":"nobody nobody", "email":"nobody@marklogic.com"}}}, "files":[], "show":true}], "updatedAt":"2013-05-09T14:11:45.676116-07:00", "fixedAt":"2013-04-25T15:52:47.049079-07:00", "fixedBy":{"username":"nwalsh", "name":"Norman Walsh", "email":"norman.walsh@marklogic.com"}, "shippedAt":"2013-05-09T14:11:45.676116-07:00", "shippedBy":{"username":"msarma", "name":"Meghalim Sarma", "email":"msarma@marklogic.com"}, "renderDescriptionAs":"normal"}
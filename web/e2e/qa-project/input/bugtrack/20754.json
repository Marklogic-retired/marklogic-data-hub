{"id":20754, "kind":"Bug", "createdAt":"2013-02-11T16:26:08.13074-08:00", "status":"Closed", "title":"Deleting a path-field throws XDMP-NONMIXEDCOMPLEXCONT", "category":"xdmp", "severity":"Major", "priority":{"level":"5", "title":""}, "submittedBy":{"username":"msrinivasan", "name":"Mahalakshmi Srinivasan", "email":"mahalakshmi.srinivasan@marklogic.com"}, "assignTo":{"username":"nobody", "name":"nobody nobody", "email":"nobody@marklogic.com"}, "description":"MarkLogic Version 7.0-20130211\r\n\r\n1. Create a path-field:\r\nxquery version \"1.0-ml\";\r\nimport module namespace admin = \"http://marklogic.com/xdmp/admin\" \r\n                                  at \"/MarkLogic/admin.xqy\";\r\ndeclare namespace db = \"http://marklogic.com/xdmp/database\";                          \r\n  let $config := admin:get-configuration()\r\n  let $dbid := xdmp:database(\"Documents\")\r\n  let $field-name1 := \"new\"\r\n    let $field-paths := admin:database-field-path(\"/y/z\",xs:double(2.0))\r\n\r\n  let $fieldspec1 :=  admin:database-path-field($field-name1,$field-paths) \r\n    \r\n    let $spec := admin:database-add-field($config, $dbid, $fieldspec1)\r\n      return admin:save-configuration($spec)\r\n\r\n2. Delete the created field:\r\n\r\nxquery version \"1.0-ml\";\r\n import module namespace admin = \"http://marklogic.com/xdmp/admin\" \r\n\t\t  at \"/MarkLogic/admin.xqy\";\r\n\t\t\r\n  let $config := admin:get-configuration()\r\n  let $dbid := xdmp:database(\"Documents\")\r\n  let $fieldspec := admin:database-field(\"new\", fn:true() )\r\nlet $x := admin:database-delete-field($config, $dbid, $fieldspec)\r\n\r\n  return admin:save-configuration($x)\r\n\r\nThis throws:\r\n[1.0-ml] XDMP-NONMIXEDCOMPLEXCONT: fn:data(<field xmlns=\"http://marklogic.com/xdmp/database\"><field-name>new</field-name><include-root>true</include-root><in...</field>) -- Node has complex type with non-mixed complex content\r\n\r\nStack Trace\r\nIn /MarkLogic/admin.xqy on line 5121\r\nIn xdmp:eval(\"xquery version &quot;1.0-ml&quot;;&#10; import module namespace ...\", (), <options xmlns=\"xdmp:eval\"><database>10052690033237343052</database><root>/opt/MarkLogic/qa...</options>)\r\nIn /MarkLogic/appservices/qconsole/qconsole-amped.xqy on line 180\r\nIn amped-qconsole:qconsole-eval(\"xquery version &quot;1.0-ml&quot;;&#10; import module namespace ...\", (), <options xmlns=\"xdmp:eval\"><database>10052690033237343052</database><root>/opt/MarkLogic/qa...</options>)\r\n\r\n$xquery := \"xquery version &quot;1.0-ml&quot;;&#10; import module namespace ...\"\r\n$vars := ()\r\n$options := <options xmlns=\"xdmp:eval\"><database>10052690033237343052</database><root>/opt/MarkLogic/qa...</options>", "samplequery":"", "sampledata":"", "version":"7.0-nightly", "tofixin":"7.0-ea1", "fixedin":"7.0-ea1", "platform":"all", "memory":"", "processors":"", "note":"", "subscribers":[{"username":"msrinivasan", "name":"Mahalakshmi Srinivasan", "email":"mahalakshmi.srinivasan@marklogic.com"}, {"username":"gchinchwadkar", "name":"Gajanan Chinchwadkar", "email":"Gajanan.Chinchwadkar@marklogic.com"}], "attachments":[], "relationships":[{"type":"", "to":""}], "clones":[], "cloneOf":"", "support":{"headline":"", "supportDescription":"", "publishStatus":"Not Ready", "tickets":[], "customerImpact":{"level":"N/A", "title":""}, "workaround":""}, "tags":["xdmp", "msrinivasan"], "changeHistory":[{"time":"2013-02-11T16:26:08.13074-08:00", "updatedBy":{"username":"msrinivasan", "name":"Mahalakshmi Srinivasan", "email":"mahalakshmi.srinivasan@marklogic.com"}, "change":{"assignTo":{"from":{"username":"msrinivasan", "name":"Mahalakshmi Srinivasan", "email":"mahalakshmi.srinivasan@marklogic.com"}, "to":{"username":"gchinchwadkar", "name":"Gajanan Chinchwadkar", "email":"Gajanan.Chinchwadkar@marklogic.com"}}}, "files":[], "show":true}, {"time":"2013-02-12T12:09:17.593915-08:00", "updatedBy":{"username":"msrinivasan", "name":"Mahalakshmi Srinivasan", "email":"mahalakshmi.srinivasan@marklogic.com"}, "change":{}, "files":[], "show":true, "comment":"I feel it's important to fix this bug before fixing any other path-fields related bug. Hence raising the 'severity' level."}, {"time":"2013-02-12T12:21:11.892432-08:00", "updatedBy":{"username":"gchinchwadkar", "name":"Gajanan Chinchwadkar", "email":"Gajanan.Chinchwadkar@marklogic.com"}, "change":{}, "files":[], "show":true, "comment":"The api admin:database-delete-field() takes field names and not XML structures. In your query the admin:database-field() is unnecessary.\r\nIt is causing you to send field structures where field-names are expected as string*.\r\n\r\nThis works:\r\n====\r\n import module namespace admin = \"http://marklogic.com/xdmp/admin\"\r\n    at \"/MarkLogic/admin.xqy\";\r\n   \r\n  let $config := admin:get-configuration()\r\n  let $dbid := xdmp:database(\"Documents\")\r\n  let $x := admin:database-delete-field($config, $dbid, \"new\")\r\n   return admin:save-configuration($x)"}, {"time":"2013-02-12T12:21:11.892432-08:00", "updatedBy":{"username":"gchinchwadkar", "name":"Gajanan Chinchwadkar", "email":"Gajanan.Chinchwadkar@marklogic.com"}, "change":{"status":{"from":"", "to":"Test"}, "assignTo":{"from":{"username":"gchinchwadkar", "name":"Gajanan Chinchwadkar", "email":"Gajanan.Chinchwadkar@marklogic.com"}, "to":{"username":"msrinivasan", "name":"Mahalakshmi Srinivasan", "email":"mahalakshmi.srinivasan@marklogic.com"}}}, "files":[], "show":true}, {"time":"2013-02-12T12:21:11.892432-08:00", "updatedBy":{"username":"gchinchwadkar", "name":"Gajanan Chinchwadkar", "email":"Gajanan.Chinchwadkar@marklogic.com"}, "change":{"assignTo":{"from":{"username":"gchinchwadkar", "name":"Gajanan Chinchwadkar", "email":"Gajanan.Chinchwadkar@marklogic.com"}, "to":{"username":"msrinivasan", "name":"Mahalakshmi Srinivasan", "email":"mahalakshmi.srinivasan@marklogic.com"}}}, "files":[], "show":true}, {"time":"2013-02-12T12:31:45.711711-08:00", "updatedBy":{"username":"msrinivasan", "name":"Mahalakshmi Srinivasan", "email":"mahalakshmi.srinivasan@marklogic.com"}, "change":{"status":{"from":"", "to":"Closed"}, "assignTo":{"from":{"username":"msrinivasan", "name":"Mahalakshmi Srinivasan", "email":"mahalakshmi.srinivasan@marklogic.com"}, "to":{"username":"nobody", "name":"nobody nobody", "email":"nobody@marklogic.com"}}}, "files":[], "show":true, "comment":"Verified and agreed that it is not a bug. Thanks!!"}], "updatedAt":"2013-02-12T12:31:45.711711-08:00", "fixedAt":"2013-02-12T12:21:11.892432-08:00", "fixedBy":{"username":"gchinchwadkar", "name":"Gajanan Chinchwadkar", "email":"Gajanan.Chinchwadkar@marklogic.com"}, "closedAt":"2013-02-12T12:31:45.711711-08:00", "closedBy":{"username":"msrinivasan", "name":"Mahalakshmi Srinivasan", "email":"mahalakshmi.srinivasan@marklogic.com"}, "renderDescriptionAs":"normal"}
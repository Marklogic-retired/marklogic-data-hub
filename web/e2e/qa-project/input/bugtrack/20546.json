{"id":20546, "kind":"Bug", "createdAt":"2012-09-13T10:11:25.025905-07:00", "status":"Closed", "title":"Cancelling the database restore is throwing an error  XDMP-FORESTERR", "category":"Backup/Restore", "severity":"Minor", "priority":{"level":"1", "title":"Required for product release"}, "submittedBy":{"username":"skottam", "name":"Sravan Kottam", "email":"Sravan.Kottam@marklogic.com"}, "assignTo":{"username":"nobody", "name":"nobody nobody", "email":"nobody@marklogic.com"}, "description":"\r\nTake a backup with journal archiving\r\nLoad  Medline  i.e.  11 299 104 docs\r\nDo a database clear         \r\nNow do a database restore\r\nWait for some time to run restore  and then do restore cancel.\r\n\r\nActual :\r\n\r\nI see the following in the errorlog.txt\r\n\r\n2012-09-12 16:10:35.426 Debug: InMemoryStand /var/opt/MarkLogic/Forests/App-Services/00000005, disk=15MB, memory=655MB, list=512MB, tree=128MB, rangeIndex=16MB, reverseIndex=16MB\r\n2012-09-12 16:10:35.943 Info: Canceling 2-forest database restore from /tmp/20120912-1236522621970, jobid=15859056571242380382\r\n2012-09-12 16:10:35.943 Info: Canceling restore of forest one from /tmp/20120912-1236522621970, jobid=15859056571242380382\r\n2012-09-12 16:10:35.943 Info: Canceling restore of forest two from /tmp/20120912-1236522621970, jobid=15859056571242380382\r\n2012-09-12 16:10:35.946 Info: Canceled restore of forest one from /tmp/20120912-1236522621970, jobid=15859056571242380382\r\n2012-09-12 16:10:35.978 Info: Canceled restore of forest two from /tmp/20120912-1236522621970, jobid=15859056571242380382\r\n2012-09-12 16:10:38.113 Debug: Deleted 982 MB in 1 sec at 51406 MB/sec /space/RestoredForests/one\r\n2012-09-12 16:10:38.216 Debug: Deleted 1151 MB in 1 sec at 11133 MB/sec /space/RestoredForests/two\r\n2012-09-12 16:10:38.689 Alert: XDMP-FORESTERR: Error in merge of forest one: SVC-FILOPN: File open error: open '/space/RestoredForests/one/00000003/StopKeySet': No such file or directory\r\n2012-09-12 16:10:38.689 Debug: ~Forest 10541708130472801599 one /space/RestoredForests/one\r\n2012-09-12 16:10:38.691 Debug: ~OnDiskStand /space/RestoredForests/one/00000000\r\n2012-09-12 16:10:38.741 Debug: ~OnDiskStand /space/RestoredForests/one/00000001\r\n2012-09-12 16:10:38.787 Debug: ~InMemoryStand /space/RestoredForests/one/00000002\r\n2012-09-12 16:10:39.020 Alert: XDMP-FORESTERR: Error in merge of forest two: SVC-FILOPN: File open error: open '/space/RestoredForests/two/00000003/873c21a08066baac-37c6e3905909f64e+string': No such file or directory\r\n2012-09-12 16:10:39.021 Debug: ~Forest 7851963831586892359 two /space/RestoredForests/two\r\n2012-09-12 16:10:39.023 Debug: ~OnDiskStand /space/RestoredForests/two/00000000\r\n2012-09-12 16:10:39.042 Debug: ~OnDiskStand /space/RestoredForests/two/00000001\r\n2012-09-12 16:10:39.062 Debug: ~InMemoryStand /space/RestoredForests/two/00000002\r\n", "samplequery":"", "sampledata":"", "version":"7.0-nightly", "tofixin":"7.0-3", "fixedin":"7.0-3", "platform":"all", "memory":"", "processors":"", "note":"", "subscribers":[{"username":"skottam", "name":"Sravan Kottam", "email":"Sravan.Kottam@marklogic.com"}, {"username":"atsoi", "name":"Arthur Tsoi", "email":"arthur.tsoi@marklogic.com"}, {"username":"rpolasani", "name":"Raghu Polasani", "email":"raghu.polasani@marklogic.com"}, {"username":"mislam", "name":"Towhid Islam", "email":"Towhid.Islam@marklogic.com"}, {"username":"wfeick", "name":"Wayne Feick", "email":"wfeick@marklogic.com"}, {"username":"gvaidees", "name":"Ganesh Vaideeswaran", "email":"Ganesh.Vaideeswaran@marklogic.com"}], "attachments":[{"name":"Logs from 3 nodes", "uri":"root/support/bugtracking/attachments/20546/logs-012514-002848.tar.gz"}], "relationships":[{"type":"", "to":""}], "clones":[25017], "cloneOf":19299, "support":{"headline":"", "supportDescription":"", "publishStatus":"Never Publish", "tickets":[], "customerImpact":{"level":"N/A", "title":""}, "workaround":""}, "tags":["Backup/Restore", "skottam"], "changeHistory":[{"time":"2012-09-13T10:11:25.025905-07:00", "updatedBy":{"username":"skottam", "name":"Sravan Kottam", "email":"Sravan.Kottam@marklogic.com"}, "change":{"assignTo":{"from":{"username":"skottam", "name":"Sravan Kottam", "email":"Sravan.Kottam@marklogic.com"}, "to":{"username":"wfeick", "name":"Wayne Feick", "email":"wfeick@marklogic.com"}}}, "files":[], "show":true}, {"time":"2012-09-17T16:32:55.450849-07:00", "updatedBy":{"username":"wfeick", "name":"Wayne Feick", "email":"wfeick@marklogic.com"}, "change":{"assignTo":{"from":{"username":"wfeick", "name":"Wayne Feick", "email":"wfeick@marklogic.com"}, "to":{"username":"mislam", "name":"Towhid Islam", "email":"Towhid.Islam@marklogic.com"}}}, "files":[], "show":true}, {"time":"2012-11-26T10:30:55.017027-08:00", "updatedBy":{"username":"mislam", "name":"Towhid Islam", "email":"Towhid.Islam@marklogic.com"}, "change":{}, "files":[], "show":true, "comment":"Already fix in trunk.  No action taken for branch b6_0 or b5_0.  Waiting for bug triage committeeâ€™s decision."}, {"time":"2012-12-11T16:11:54.320046-08:00", "updatedBy":{"username":"rhu", "name":"Ron Hu", "email":"ron.hu@marklogic.com"}, "change":{}, "files":[], "show":true, "comment":"go ahead to fix in 5.0"}, {"time":"2012-12-12T12:02:28.651328-08:00", "updatedBy":{"username":"mislam", "name":"Towhid Islam", "email":"Towhid.Islam@marklogic.com"}, "change":{}, "files":[], "show":true, "svn":{"repository":"/project/engsvn", "revision":"123787", "paths":["xdmp/branches/b5_0/src/Forest.cpp"], "affectedBugs":[]}, "comment":"bug:19299 Move the cancellation of database restore inside a nutex operation"}, {"time":"2012-12-12T12:02:55.571623-08:00", "updatedBy":{"username":"mislam", "name":"Towhid Islam", "email":"Towhid.Islam@marklogic.com"}, "change":{"status":{"from":"", "to":"Test"}, "assignTo":{"from":{"username":"mislam", "name":"Towhid Islam", "email":"Towhid.Islam@marklogic.com"}, "to":{"username":"rpolasani", "name":"Raghu Polasani", "email":"raghu.polasani@marklogic.com"}}}, "files":[], "show":true}, {"time":"2012-12-12T12:02:55.571623-08:00", "updatedBy":{"username":"mislam", "name":"Towhid Islam", "email":"Towhid.Islam@marklogic.com"}, "change":{"assignTo":{"from":{"username":"mislam", "name":"Towhid Islam", "email":"Towhid.Islam@marklogic.com"}, "to":{"username":"rpolasani", "name":"Raghu Polasani", "email":"raghu.polasani@marklogic.com"}}}, "files":[], "show":true}, {"time":"2012-12-14T00:36:42.900974-08:00", "updatedBy":{"username":"rpolasani", "name":"Raghu Polasani", "email":"raghu.polasani@marklogic.com"}, "change":{"assignTo":{"from":{"username":"rpolasani", "name":"Raghu Polasani", "email":"raghu.polasani@marklogic.com"}, "to":{"username":"skottam", "name":"Sravan Kottam", "email":"Sravan.Kottam@marklogic.com"}}}, "files":[], "show":true}, {"time":"2013-01-09T17:13:56.723473-08:00", "updatedBy":{"username":"skottam", "name":"Sravan Kottam", "email":"Sravan.Kottam@marklogic.com"}, "change":{"status":{"from":"", "to":"Verify"}, "assignTo":{"from":{"username":"skottam", "name":"Sravan Kottam", "email":"Sravan.Kottam@marklogic.com"}, "to":{"username":"mislam", "name":"Towhid Islam", "email":"Towhid.Islam@marklogic.com"}}}, "files":[], "show":true, "comment":"I followed the steps and now I see the following error in 5.0-20130109 build\r\n\r\n\r\n2013-01-09 16:46:31.845 Info: Canceling 2-forest database restore from /space/backupdb/20130109-1202411541650, jobid=10089225287062959811\r\n2013-01-09 16:46:31.846 Info: Canceling restore of forest two from /space/backupdb/20130109-1202411541650, jobid=10089225287062959811\r\n2013-01-09 16:46:31.899 Info: Canceled restore of forest two from /space/backupdb/20130109-1202411541650, jobid=10089225287062959811\r\n2013-01-09 16:46:31.899 Info: Canceling restore of forest one from /space/backupdb/20130109-1202411541650, jobid=10089225287062959811\r\n2013-01-09 16:46:31.902 Debug: ~Forest 1326098049328777300 one /space/backup/RestoredForests/one\r\n2013-01-09 16:46:31.904 Debug: ~OnDiskStand /space/backup/RestoredForests/one/00000000\r\n2013-01-09 16:46:31.928 Debug: ~InMemoryStand /space/backup/RestoredForests/one/00000001\r\n2013-01-09 16:46:32.000 Info: Canceled restore of forest one from /space/backupdb/20130109-1202411541650, jobid=10089225287062959811\r\n2013-01-09 16:46:34.653 Debug: Deleted 161 MB in 1 sec at 874 MB/sec /space/backup/RestoredForests/two\r\n2013-01-09 16:46:34.826 Alert: XDMP-FORESTERR: Error in checkpoint of forest two: SVC-FILUTM: File utime error: utime '/space/backup/RestoredForests/two/00000000/Ordinals': No such file or directory\r\n\r\nOn my second attempt I see the following error\r\n\r\n2013-01-09 17:10:02.219 Debug: Deleted 281 MB in 1 sec at 1351 MB/sec /space/backup/RestoredForests/one\r\n2013-01-09 17:10:02.939 Alert: XDMP-FORESTERR: Error in merge of forest two: SVC-FILOPN: File open error: open '/space/backup/RestoredForests/two/00000001/TreeIndex': No such file or directory\r\n\r\n"}, {"time":"2013-01-09T17:13:56.723473-08:00", "updatedBy":{"username":"skottam", "name":"Sravan Kottam", "email":"Sravan.Kottam@marklogic.com"}, "change":{"assignTo":{"from":{"username":"skottam", "name":"Sravan Kottam", "email":"Sravan.Kottam@marklogic.com"}, "to":{"username":"mislam", "name":"Towhid Islam", "email":"Towhid.Islam@marklogic.com"}}}, "files":[], "show":true}, {"time":"2013-01-21T17:11:50.940947-08:00", "updatedBy":{"username":"mislam", "name":"Towhid Islam", "email":"Towhid.Islam@marklogic.com"}, "change":{}, "files":[], "show":true, "svn":{"repository":"/project/engsvn", "revision":"128633", "paths":["xdmp/branches/b5_0/src/Forest.cpp"], "affectedBugs":[]}, "comment":"bug:19299 Added test for checking the status of the cancel in one more place"}, {"time":"2013-01-21T17:18:28.486613-08:00", "updatedBy":{"username":"wfeick", "name":"Wayne Feick", "email":"wfeick@marklogic.com"}, "change":{"tofixin":{"from":"", "to":"7.0-ea1"}}, "files":[], "show":true}, {"time":"2013-02-07T12:48:39.220857-08:00", "updatedBy":{"username":"mislam", "name":"Towhid Islam", "email":"Towhid.Islam@marklogic.com"}, "change":{}, "files":[], "show":true, "svn":{"repository":"/project/engsvn", "revision":"130922", "paths":["xdmp/trunk/src/Forest.cpp"], "affectedBugs":[]}, "comment":"bug:20546 forward porting bug 19299"}, {"time":"2013-02-07T13:01:49.078154-08:00", "updatedBy":{"username":"mislam", "name":"Towhid Islam", "email":"Towhid.Islam@marklogic.com"}, "change":{"status":{"from":"", "to":"Test"}, "assignTo":{"from":{"username":"mislam", "name":"Towhid Islam", "email":"Towhid.Islam@marklogic.com"}, "to":{"username":"skottam", "name":"Sravan Kottam", "email":"Sravan.Kottam@marklogic.com"}}}, "files":[], "show":true}, {"time":"2013-02-07T13:01:49.078154-08:00", "updatedBy":{"username":"mislam", "name":"Towhid Islam", "email":"Towhid.Islam@marklogic.com"}, "change":{"assignTo":{"from":{"username":"mislam", "name":"Towhid Islam", "email":"Towhid.Islam@marklogic.com"}, "to":{"username":"skottam", "name":"Sravan Kottam", "email":"Sravan.Kottam@marklogic.com"}}}, "files":[], "show":true}, {"time":"2013-03-06T14:51:35.208523-08:00", "updatedBy":{"username":"skottam", "name":"Sravan Kottam", "email":"Sravan.Kottam@marklogic.com"}, "change":{"status":{"from":"", "to":"Verify"}, "assignTo":{"from":{"username":"skottam", "name":"Sravan Kottam", "email":"Sravan.Kottam@marklogic.com"}, "to":{"username":"mislam", "name":"Towhid Islam", "email":"Towhid.Islam@marklogic.com"}}}, "files":[], "show":true, "comment":"Verified on the latest nightly \r\n\r\nI see the following error in the errorlog.txt\r\n2013-03-06 14:45:36.250 Alert: XDMP-FORESTERR: Error in merge of forest two: SVC-FILOPN: File open error: open '/space/medline_forests/RestoredForests/two/00000008/StopKeySet': No such file or directory\r\n\r\nthe only difference between 6.0 and 7.0 test is I kept rebalancer ON"}, {"time":"2013-03-06T14:51:35.208523-08:00", "updatedBy":{"username":"skottam", "name":"Sravan Kottam", "email":"Sravan.Kottam@marklogic.com"}, "change":{"assignTo":{"from":{"username":"skottam", "name":"Sravan Kottam", "email":"Sravan.Kottam@marklogic.com"}, "to":{"username":"mislam", "name":"Towhid Islam", "email":"Towhid.Islam@marklogic.com"}}}, "files":[], "show":true}, {"time":"2013-03-07T16:35:00.839924-08:00", "updatedBy":{"username":"rhu", "name":"Ron Hu", "email":"ron.hu@marklogic.com"}, "change":{}, "files":[], "show":true, "comment":"Towhid,\r\nCan you verify it to see why we got the error message?"}, {"time":"2013-03-07T16:50:07.738853-08:00", "updatedBy":{"username":"mislam", "name":"Towhid Islam", "email":"Towhid.Islam@marklogic.com"}, "change":{}, "files":[], "show":true, "comment":"Hi Sravan,\r\nCould you please give the steps to recreate the bug including the rebalancer stuff?"}, {"time":"2013-03-11T17:05:59.927102-07:00", "updatedBy":{"username":"mislam", "name":"Towhid Islam", "email":"Towhid.Islam@marklogic.com"}, "change":{"status":{"from":"", "to":"Test"}, "assignTo":{"from":{"username":"mislam", "name":"Towhid Islam", "email":"Towhid.Islam@marklogic.com"}, "to":{"username":"skottam", "name":"Sravan Kottam", "email":"Sravan.Kottam@marklogic.com"}}}, "files":[], "show":true, "comment":"Sravan, I tested the scenario in 7.0-ea1_20130311. I got the following output which shows that the patch works fine in the ea and successfully cancel the restore. Could you please check it again with the latest build. Here is the extract from ErrorLog.txt\r\n\r\n2013-03-11 16:47:41.029 Info: Canceling 2-forest database restore from /space/backup/20130308-1127382070510, jobid=16575522230607781561\r\n2013-03-11 16:47:41.029 Info: Canceling restore of forest one from /space/backup/20130308-1127382070510, jobid=16575522230607781561\r\n2013-03-11 16:47:41.076 Debug: ~Forest 15751351809105362933 one /space/medlineF/RestoredForests/one\r\n2013-03-11 16:47:41.078 Debug: ~OnDiskStand /space/medlineF/RestoredForests/one/00000000\r\n2013-03-11 16:47:41.131 Debug: ~InMemoryStand /space/medlineF/RestoredForests/one/00000001\r\n2013-03-11 16:47:41.204 Info: Canceled restore of forest one from /space/backup/20130308-1127382070510, jobid=16575522230607781561\r\n2013-03-11 16:47:41.205 Info: Canceling restore of forest two from /space/backup/20130308-1127382070510, jobid=16575522230607781561\r\n2013-03-11 16:47:41.210 Debug: ~Forest 9356926518151584584 two /space/medlineF/RestoredForests/two\r\n2013-03-11 16:47:41.212 Debug: ~OnDiskStand /space/medlineF/RestoredForests/two/00000000\r\n2013-03-11 16:47:41.270 Debug: ~InMemoryStand /space/medlineF/RestoredForests/two/00000001\r\n2013-03-11 16:47:41.354 Info: Canceled restore of forest two from /space/backup/20130308-1127382070510, jobid=16575522230607781561\r\n2013-03-11 16:47:44.043 Info: Deleted 15 MB in 1 sec at 405 MB/sec /space/medlineF/RestoredForests/one/00000001\r\n2013-03-11 16:47:44.072 Debug: Deleted 317 MB in 1 sec at 10933 MB/sec /space/medlineF/RestoredForests/one\r\n2013-03-11 16:47:44.094 Info: Deleted 15 MB in 1 sec at 692 MB/sec /space/medlineF/RestoredForests/two/00000001\r\n2013-03-11 16:47:44.123 Debug: Deleted 317 MB in 1 sec at 10937 MB/sec /space/medlineF/RestoredForests/two\r\n\r\n"}, {"time":"2013-03-11T17:05:59.927102-07:00", "updatedBy":{"username":"mislam", "name":"Towhid Islam", "email":"Towhid.Islam@marklogic.com"}, "change":{"assignTo":{"from":{"username":"mislam", "name":"Towhid Islam", "email":"Towhid.Islam@marklogic.com"}, "to":{"username":"skottam", "name":"Sravan Kottam", "email":"Sravan.Kottam@marklogic.com"}}}, "files":[], "show":true}, {"time":"2013-03-12T14:52:47.983523-07:00", "updatedBy":{"username":"mislam", "name":"Towhid Islam", "email":"Towhid.Islam@marklogic.com"}, "change":{"status":{"from":"", "to":"Verify"}, "assignTo":{"from":{"username":"mislam", "name":"Towhid Islam", "email":"Towhid.Islam@marklogic.com"}, "to":{"username":"mislam", "name":"Towhid Islam", "email":"Towhid.Islam@marklogic.com"}}}, "files":[], "show":true, "comment":"Yes, now I am able to reproduce the problem. The problem can be reproduced if the cancel-restore is called minimum 20 minutes after the restoration call."}, {"time":"2013-03-12T14:52:47.983523-07:00", "updatedBy":{"username":"mislam", "name":"Towhid Islam", "email":"Towhid.Islam@marklogic.com"}, "change":{"assignTo":{"from":{"username":"mislam", "name":"Towhid Islam", "email":"Towhid.Islam@marklogic.com"}, "to":{"username":"mislam", "name":"Towhid Islam", "email":"Towhid.Islam@marklogic.com"}}}, "files":[], "show":true}, {"time":"2013-03-13T09:52:23.822365-07:00", "updatedBy":{"username":"rhu", "name":"Ron Hu", "email":"ron.hu@marklogic.com"}, "change":{}, "files":[], "show":true, "comment":"We are wrapping up 7.0-ea1.  Push it to 7.0-ea2."}, {"time":"2013-03-13T09:52:23.822365-07:00", "updatedBy":{"username":"rhu", "name":"Ron Hu", "email":"ron.hu@marklogic.com"}, "change":{"tofixin":{"from":"7.0-ea1", "to":"7.0-ea2"}}, "files":[], "show":true}, {"time":"2013-03-13T14:58:12.853801-07:00", "updatedBy":{"username":"mislam", "name":"Towhid Islam", "email":"Towhid.Islam@marklogic.com"}, "change":{}, "files":[], "show":true, "comment":"Stack Trace:\r\n\r\n\r\nBreakpoint 2, xdmp::Forest::error (this=0x7ffee2b8d4d0, what=0x35a1c6c \"merge\", e=...) at Forest.cpp:4432\r\n4432\t  Handle<ExceptionObject> hExc = new ExceptionObject(\"XDMP-FORESTERR\",data);\r\nMissing separate debuginfos, use: debuginfo-install cyrus-sasl-lib-2.1.23-31.fc17.x86_64 glibc-2.15-58.fc17.x86_64 keyutils-libs-1.5.5-2.fc17.x86_64 libgcc-4.7.2-2.fc17.x86_64 \r\n#0  xdmp::Forest::error (this=0x7ffee2b8d4d0, what=0x35a1c6c \"merge\", e=...) at Forest.cpp:4432\r\n#1  0x00000000024f479a in xdmp::Forest::merge (this=0x7ffee2b8d4d0, timestamp=0, maxSize=0, priority=svc::Thread::lowerPriority, force=false, singleStand=false) at Forest.cpp:9999\r\n#2  0x00000000024f0467 in xdmp::ForestMergeTask::run (this=0x7ffff3f2ad00) at Forest.cpp:9340\r\n#3  0x00000000031f01d9 in svc::PooledThread::run (this=0x7ffee85a3d90) at ThreadPool.cpp:146\r\n#4  0x00000000031ee683 in svc::Thread::top (this=0x7ffee85a3d90) at Thread.cpp:284\r\n#5  0x00000000031eeaf1 in svc::runThread (arg=0x7ffee85a3d90) at Thread.cpp:320\r\n#6  0x000000344ee07d14 in start_thread () from /lib64/libpthread.so.0\r\n#7  0x000000344eaf168d in clone () from /lib64/libc.so.6\r\n"}, {"time":"2013-04-30T12:11:54.524019-07:00", "updatedBy":{"username":"rhu", "name":"Ron Hu", "email":"ron.hu@marklogic.com"}, "change":{"tofixin":{"from":"7.0-ea2", "to":"7.0-ea3"}}, "files":[], "show":true}, {"time":"2013-05-23T19:05:17.240798-07:00", "updatedBy":{"username":"rhu", "name":"Ron Hu", "email":"ron.hu@marklogic.com"}, "change":{}, "files":[], "show":true, "comment":"push out?"}, {"time":"2013-05-23T19:05:17.240798-07:00", "updatedBy":{"username":"rhu", "name":"Ron Hu", "email":"ron.hu@marklogic.com"}, "change":{"assignTo":{"from":{"username":"rhu", "name":"Ron Hu", "email":"ron.hu@marklogic.com"}, "to":{"username":"wfeick", "name":"Wayne Feick", "email":"wfeick@marklogic.com"}}}, "files":[], "show":true}, {"time":"2013-05-23T19:59:59.633817-07:00", "updatedBy":{"username":"wfeick", "name":"Wayne Feick", "email":"wfeick@marklogic.com"}, "change":{"assignTo":{"from":{"username":"wfeick", "name":"Wayne Feick", "email":"wfeick@marklogic.com"}, "to":{"username":"atsoi", "name":"Arthur Tsoi", "email":"arthur.tsoi@marklogic.com"}}}, "files":[], "show":true}, {"time":"2013-05-23T19:59:59.633817-07:00", "updatedBy":{"username":"wfeick", "name":"Wayne Feick", "email":"wfeick@marklogic.com"}, "change":{"tofixin":{"from":"7.0-ea3", "to":"7.0-1"}}, "files":[], "show":true}, {"time":"2013-10-03T15:31:52.222285-07:00", "updatedBy":{"username":"wfeick", "name":"Wayne Feick", "email":"wfeick@marklogic.com"}, "change":{"tofixin":{"from":"7.0-1", "to":"7.0-2"}}, "files":[], "show":true}, {"time":"2013-12-12T10:39:02.469106-08:00", "updatedBy":{"username":"wfeick", "name":"Wayne Feick", "email":"wfeick@marklogic.com"}, "change":{}, "files":[], "show":true, "comment":"Arthur, I see that this is still marked fixed on b5_0 and b6_0. Once you figure out the issue, we'll want to reopen those bugs, merge the fix, and mark as fixed in the appropriate releases."}, {"time":"2013-12-16T11:14:24.790485-08:00", "updatedBy":{"username":"atsoi", "name":"Arthur Tsoi", "email":"arthur.tsoi@marklogic.com"}, "change":{}, "files":[], "show":true, "svn":{"repository":"/project/engsvn", "revision":"157302", "paths":["xdmp/branches/b7_0/src/Modules/MarkLogic/manage/lib/schema-util.xqy", "xdmp/branches/b7_0/src/Forest.cpp"], "affectedBugs":[]}, "comment":"bug:20546 fix error message when database restore is canceled"}, {"time":"2013-12-16T11:16:59.936656-08:00", "updatedBy":{"username":"atsoi", "name":"Arthur Tsoi", "email":"arthur.tsoi@marklogic.com"}, "change":{"status":{"from":"", "to":"Test"}, "assignTo":{"from":{"username":"atsoi", "name":"Arthur Tsoi", "email":"arthur.tsoi@marklogic.com"}, "to":{"username":"gvaidees", "name":"Ganesh Vaideeswaran", "email":"Ganesh.Vaideeswaran@marklogic.com"}}}, "files":[], "show":true, "comment":"fixed."}, {"time":"2013-12-16T11:16:59.936656-08:00", "updatedBy":{"username":"atsoi", "name":"Arthur Tsoi", "email":"arthur.tsoi@marklogic.com"}, "change":{"assignTo":{"from":{"username":"atsoi", "name":"Arthur Tsoi", "email":"arthur.tsoi@marklogic.com"}, "to":{"username":"gvaidees", "name":"Ganesh Vaideeswaran", "email":"Ganesh.Vaideeswaran@marklogic.com"}}}, "files":[], "show":true}, {"time":"2013-12-16T12:13:49.198092-08:00", "updatedBy":{"username":"gvaidees", "name":"Ganesh Vaideeswaran", "email":"Ganesh.Vaideeswaran@marklogic.com"}, "change":{"assignTo":{"from":{"username":"gvaidees", "name":"Ganesh Vaideeswaran", "email":"Ganesh.Vaideeswaran@marklogic.com"}, "to":{"username":"skottam", "name":"Sravan Kottam", "email":"Sravan.Kottam@marklogic.com"}}}, "files":[], "show":true}, {"time":"2014-01-20T13:15:38.070087-08:00", "updatedBy":{"username":"skottam", "name":"Sravan Kottam", "email":"Sravan.Kottam@marklogic.com"}, "change":{}, "files":[], "show":true, "comment":"Planning to use the stress run to verify this bug since I dont have a cluster  machine where I can run this test."}, {"time":"2014-01-21T22:33:44.609015-08:00", "updatedBy":{"username":"skottam", "name":"Sravan Kottam", "email":"Sravan.Kottam@marklogic.com"}, "change":{}, "files":[], "show":true, "comment":"I see the following in the errorlog \r\n2014-01-21 22:28:31.324 Info: Canceling restore of forest F1A-M from /space2/backup/20140120-2007091179060, jobid=2270739951595862367\r\n2014-01-21 22:28:31.324 Info: Canceling restore of forest F1B-M from /space2/backup/20140120-2007091179060, jobid=2270739951595862367\r\n2014-01-21 22:28:31.347 Info: Canceled restore of forest F1B-M from /space2/backup/20140120-2007091179060, jobid=2270739951595862367\r\n2014-01-21 22:28:31.362 Info: Canceled restore of forest F1A-M from /space2/backup/20140120-2007091179060, jobid=2270739951595862367\r\n2014-01-21 22:28:31.470 Info: Saved 316 MB in 7 sec at 48 MB/sec to /space2/data/RestoredForests/F1B-M/00000002\r\n2014-01-21 22:28:31.891 Info: Merging 918 MB from /space2/data/RestoredForests/F1B-M/00000003 and /space2/data/RestoredForests/F1B-M/00000002 to /space2/data/RestoredForests/F1B-M/00000005, timestamp=13903656150000000\r\n2014-01-21 22:28:33.257 Info: Saved 319 MB in 7 sec at 46 MB/sec to /space2/data/RestoredForests/F1A-M/00000002\r\n2014-01-21 22:28:33.621 Info: Merging 921 MB from /space2/data/RestoredForests/F1A-M/00000003 and /space2/data/RestoredForests/F1A-M/00000002 to /space2/data/RestoredForests/F1A-M/00000005, timestamp=13903656150000000\r\n2014-01-21 22:28:45.447 Critical: Indexed64FileSequentialReader::read: XDMP-READ: /space2/data/RestoredForests/F1B-M/00000003/ListData: Invalid read, read, position=268435444: Success\r\n2014-01-21 22:28:47.292 Error: PooledThread::run: XDMP-CANCELED: Canceled merge /space2/data/RestoredForests/F1B-M\r\n2014-01-21 22:28:48.561 Error: PooledThread::run: XDMP-CANCELED: Canceled merge /space2/data/RestoredForests/F1A-M\r\n\r\nWill try again with fresh install on my cluster to provide more information"}, {"time":"2014-01-21T22:33:48.532458-08:00", "updatedBy":{"username":"skottam", "name":"Sravan Kottam", "email":"Sravan.Kottam@marklogic.com"}, "change":{}, "files":[], "show":true, "comment":"I see the following in the errorlog \r\n2014-01-21 22:28:31.324 Info: Canceling restore of forest F1A-M from /space2/backup/20140120-2007091179060, jobid=2270739951595862367\r\n2014-01-21 22:28:31.324 Info: Canceling restore of forest F1B-M from /space2/backup/20140120-2007091179060, jobid=2270739951595862367\r\n2014-01-21 22:28:31.347 Info: Canceled restore of forest F1B-M from /space2/backup/20140120-2007091179060, jobid=2270739951595862367\r\n2014-01-21 22:28:31.362 Info: Canceled restore of forest F1A-M from /space2/backup/20140120-2007091179060, jobid=2270739951595862367\r\n2014-01-21 22:28:31.470 Info: Saved 316 MB in 7 sec at 48 MB/sec to /space2/data/RestoredForests/F1B-M/00000002\r\n2014-01-21 22:28:31.891 Info: Merging 918 MB from /space2/data/RestoredForests/F1B-M/00000003 and /space2/data/RestoredForests/F1B-M/00000002 to /space2/data/RestoredForests/F1B-M/00000005, timestamp=13903656150000000\r\n2014-01-21 22:28:33.257 Info: Saved 319 MB in 7 sec at 46 MB/sec to /space2/data/RestoredForests/F1A-M/00000002\r\n2014-01-21 22:28:33.621 Info: Merging 921 MB from /space2/data/RestoredForests/F1A-M/00000003 and /space2/data/RestoredForests/F1A-M/00000002 to /space2/data/RestoredForests/F1A-M/00000005, timestamp=13903656150000000\r\n2014-01-21 22:28:45.447 Critical: Indexed64FileSequentialReader::read: XDMP-READ: /space2/data/RestoredForests/F1B-M/00000003/ListData: Invalid read, read, position=268435444: Success\r\n2014-01-21 22:28:47.292 Error: PooledThread::run: XDMP-CANCELED: Canceled merge /space2/data/RestoredForests/F1B-M\r\n2014-01-21 22:28:48.561 Error: PooledThread::run: XDMP-CANCELED: Canceled merge /space2/data/RestoredForests/F1A-M\r\n\r\nWill try again with fresh install on my cluster to provide more information"}, {"time":"2014-01-25T00:29:22.33288-08:00", "updatedBy":{"username":"skottam", "name":"Sravan Kottam", "email":"Sravan.Kottam@marklogic.com"}, "change":{"status":{"from":"", "to":"Verify"}, "assignTo":{"from":{"username":"skottam", "name":"Sravan Kottam", "email":"Sravan.Kottam@marklogic.com"}, "to":{"username":"atsoi", "name":"Arthur Tsoi", "email":"arthur.tsoi@marklogic.com"}}}, "files":[], "show":true, "comment":"I see the following error in the errorlog , attaching the errorlog for further investigation\r\n\r\n014-01-25 00:20:54.567 Info: Canceling restore of forest F2 from /space/20140124-2128196831310, jobid=5362796321402432458\r\n2014-01-25 00:20:54.588 Info: Canceled restore of forest F2 from /space/20140124-2128196831310, jobid=5362796321402432458\r\n2014-01-25 00:20:56.995 Debug: Deleted 3551 MB in 1 sec at 12294 MB/sec /space/medline/RestoredForests/F2\r\n2014-01-25 00:20:57.564 Critical: Indexed32FileSequentialReader::read: XDMP-READ: /space/medline/RestoredForests/F2/0000000d/TreeData: Invalid read, length, position=268435296, key=0x000187d0, hdrWords=3, datWords=665, checksum=0xde398c30, ask=2660, got=148: Success\r\n2014-01-25 00:20:57.631 Error: PooledThread::run: XDMP-CANCELED: Canceled merge /space/medline/RestoredForests/F2\r\n2014-01-25 00:21:14.642 Error: PooledThread::run: XDMP-CANCELED: Canceled merge /space/medline/RestoredForests/F2\r\n2014-01-25 00:21:14.642 Debug: ~Forest 15112541704835858207 F2 /space/medline/RestoredForests/F2\r\n2014-01-25 00:21:14.645 Debug: ~OnDiskStand /space/medline/RestoredForests/F2/0000000d\r\n2014-01-25 00:21:14.668 Debug: ~OnDiskStand /space/medline/RestoredForests/F2/00000012\r\n2014-01-25 00:21:14.738 Debug: ~OnDiskStand /space/medline/RestoredForests/F2/00000011\r\n"}, {"time":"2014-01-25T00:29:22.33288-08:00", "updatedBy":{"username":"skottam", "name":"Sravan Kottam", "email":"Sravan.Kottam@marklogic.com"}, "change":{"assignTo":{"from":{"username":"skottam", "name":"Sravan Kottam", "email":"Sravan.Kottam@marklogic.com"}, "to":{"username":"atsoi", "name":"Arthur Tsoi", "email":"arthur.tsoi@marklogic.com"}}}, "files":[], "show":true}, {"time":"2014-01-25T00:32:46.201419-08:00", "updatedBy":{"username":"skottam", "name":"Sravan Kottam", "email":"Sravan.Kottam@marklogic.com"}, "change":{}, "files":[], "show":true, "comment":"able to reproduce with the same steps as in the bug i.e. cancelling restore after 10 mins is throwing the error."}, {"time":"2014-01-26T19:14:10.014085-08:00", "updatedBy":{"username":"gvaidees", "name":"Ganesh Vaideeswaran", "email":"Ganesh.Vaideeswaran@marklogic.com"}, "change":{}, "files":[], "show":true, "comment":"Wayne, is this a must for 7.0-2? Marked as minor"}, {"time":"2014-01-26T20:09:01.422376-08:00", "updatedBy":{"username":"wfeick", "name":"Wayne Feick", "email":"wfeick@marklogic.com"}, "change":{}, "files":[], "show":true, "comment":"No"}, {"time":"2014-01-26T20:09:01.422376-08:00", "updatedBy":{"username":"wfeick", "name":"Wayne Feick", "email":"wfeick@marklogic.com"}, "change":{"tofixin":{"from":"7.0-2", "to":"7.0-3"}}, "files":[], "show":true}, {"time":"2014-05-20T18:03:18.623835-07:00", "updatedBy":{"username":"atsoi", "name":"Arthur Tsoi", "email":"arthur.tsoi@marklogic.com"}, "change":{}, "files":[], "show":true, "svn":{"repository":"/project/engsvn", "revision":"168972", "paths":["xdmp/branches/b7_0/src/Forest.cpp"], "affectedBugs":[]}, "comment":"bug:20546 cancel restore should not log critical error"}, {"time":"2014-05-20T18:04:09.616572-07:00", "updatedBy":{"username":"atsoi", "name":"Arthur Tsoi", "email":"arthur.tsoi@marklogic.com"}, "change":{"status":{"from":"Verify", "to":"Test"}, "assignTo":{"from":{"username":"atsoi", "name":"Arthur Tsoi", "email":"arthur.tsoi@marklogic.com"}, "to":{"username":"skottam", "name":"Sravan Kottam", "email":"Sravan.Kottam@marklogic.com"}}}, "files":[], "show":true, "comment":"fixed"}, {"time":"2014-05-20T18:04:09.616572-07:00", "updatedBy":{"username":"atsoi", "name":"Arthur Tsoi", "email":"arthur.tsoi@marklogic.com"}, "change":{"assignTo":{"from":{"username":"atsoi", "name":"Arthur Tsoi", "email":"arthur.tsoi@marklogic.com"}, "to":{"username":"skottam", "name":"Sravan Kottam", "email":"Sravan.Kottam@marklogic.com"}}}, "files":[], "show":true}, {"time":"2014-06-03T10:14:43.789007-07:00", "updatedBy":{"username":"jsolis", "name":"Julio Solis", "email":"Julio.Solis@marklogic.com"}, "change":{"assignTo":{"from":{"username":"jsolis", "name":"Julio Solis", "email":"Julio.Solis@marklogic.com"}, "to":{"username":"jsolis", "name":"Julio Solis", "email":"Julio.Solis@marklogic.com"}}}, "files":[], "show":true}, {"time":"2014-06-04T11:48:55.326362-07:00", "updatedBy":{"username":"jsolis", "name":"Julio Solis", "email":"Julio.Solis@marklogic.com"}, "change":{"status":{"from":"Test", "to":"Ship"}, "assignTo":{"from":{"username":"jsolis", "name":"Julio Solis", "email":"Julio.Solis@marklogic.com"}, "to":{"username":"nobody", "name":"nobody nobody", "email":"nobody@marklogic.com"}}}, "files":[], "show":true, "comment":"Manually verified on build MarkLogic-7.0-20140603.x86_64. I loaded over 1.5 million documents and did back up with journal archiving. Then restored to a new db and canceled during restore. No XDMP-FORESTERR errors were observed and the cancel succeeded.\r\n"}], "updatedAt":"2014-06-04T11:48:55.326362-07:00", "fixedAt":"2014-05-20T18:04:09.616572-07:00", "fixedBy":{"username":"atsoi", "name":"Arthur Tsoi", "email":"arthur.tsoi@marklogic.com"}, "shippedAt":"2014-06-04T11:48:55.326362-07:00", "shippedBy":{"username":"jsolis", "name":"Julio Solis", "email":"Julio.Solis@marklogic.com"}, "renderDescriptionAs":"normal"}
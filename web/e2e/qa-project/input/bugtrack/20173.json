{"id":20173, "kind":"Bug", "createdAt":"2012-11-30T17:23:57.769612-08:00", "status":"Closed", "title":"error swallowed in mlcp when thread_count >1", "category":"mlcp", "severity":"Major", "priority":{"level":"5", "title":""}, "submittedBy":{"username":"ali", "name":"Aries Li", "email":"ali@marklogic.com"}, "assignTo":{"username":"nobody", "name":"nobody nobody", "email":"nobody@marklogic.com"}, "description":"This is a bug first reported by Clark Richey.\r\n\r\nThe problem is, if the forest's hostname is set to a host that is not resolvable, use mlcp to import document without setting thread_count to 1, the ERROR level log is swallowed.\r\n\r\nConfiguration to reproduce:\r\nlocal host name is “xxx.marklogic.com”. Forest has hostname “xxx.marklogic.com\"\r\nThen I disable DNS lookup on my host by modifying /etc/resolv.conf, so that “xx.marklogic.com\" can't be looked up.\r\n\r\nUse mlcp to connect to “localhost” to ingest data.\r\ne.g.,\r\nmarklogic-contentpump-1.0.2/bin/mlcp.sh IMPORT -password admin -username admin -host localhost -input_file_path /home/ali/tmp/sample-data/Achilles -port 5275 \r\nWithout setting thread_count to 1, I only saw INFO level logs, however, the INFO level log complains “Unable to obtain hostName”. No ERROR level  log shown.\r\n\r\nWhen setting thread_count to 1, in addition to the INFO level log “Unable to obtain hostName”, the ERROR level log shows up.\r\nERROR contentpump.ContentPump: Error running a ContentPump job\r\njava.lang.IllegalArgumentException: Default provider - Not a usable net address: xxx.marklogic.com:5275\r\n\r\n\r\n\r\n", "samplequery":"", "sampledata":"", "version":"6.0-2", "tofixin":"6.0-3", "fixedin":"6.0-3", "platform":"all", "memory":"", "processors":"", "note":"", "subscribers":[{"username":"ali", "name":"Aries Li", "email":"ali@marklogic.com"}], "attachments":[], "relationships":[{"type":"", "to":""}], "clones":[], "cloneOf":"", "support":{"headline":"Errors not logged in mlcp when thread_count >1", "supportDescription":"Some error messages are not logged by mlcp when thread_count >1\r\n", "publishStatus":"Publish", "tickets":[], "customerImpact":{"level":"N/A", "title":""}, "workaround":"Set thread_count to 1"}, "tags":["mlcp", "ali"], "changeHistory":[{"time":"2012-11-30T17:23:57.769612-08:00", "updatedBy":{"username":"ali", "name":"Aries Li", "email":"ali@marklogic.com"}, "change":{"assignTo":{"from":{"username":"ali", "name":"Aries Li", "email":"ali@marklogic.com"}, "to":{"username":"ali", "name":"Aries Li", "email":"ali@marklogic.com"}}}, "files":[], "show":true}, {"time":"2012-11-30T17:29:10.308477-08:00", "updatedBy":{"username":"ali", "name":"Aries Li", "email":"ali@marklogic.com"}, "change":{}, "files":[], "show":true, "comment":"Both cases of setting and without setting thread_count to 1 catch the exception of “Not a usable net address”, however, the LOG.error statement itself in the case of not setting thread_count to 1 refers to null object “mapperContext” (LocalJobRunner.java line 271). Therefore, the ERROR level log is not able be logged.\r\n\r\n            } catch (Throwable t) {\r\n                LOG.error(\"Error running task: \" + \r\n                                mapperContext.getTaskAttemptID(), t);\r\n            }\r\n"}, {"time":"2012-11-30T17:33:40.429074-08:00", "updatedBy":{"username":"ali", "name":"Aries Li", "email":"ali@marklogic.com"}, "change":{}, "files":[], "show":true, "svn":{"repository":"/project/engsvn", "revision":"122149", "paths":["xcc/branches/b6_0/mlcp/src/main/java/com/marklogic/contentpump/LocalJobRunner.java"], "affectedBugs":[]}, "comment":"Bug:20173\n-avoid referencing null object when doing LOG\n-log stacktrace"}, {"time":"2012-11-30T17:41:06.056553-08:00", "updatedBy":{"username":"ali", "name":"Aries Li", "email":"ali@marklogic.com"}, "change":{}, "files":[], "show":true, "svn":{"repository":"/project/engsvn", "revision":"122150", "paths":["xcc/branches/b6_0/mlcp/src/main/java/com/marklogic/contentpump/LocalJobRunner.java"], "affectedBugs":[]}, "comment":"Bug:20173\n-include taskid in error log"}, {"time":"2012-11-30T17:42:57.141842-08:00", "updatedBy":{"username":"ali", "name":"Aries Li", "email":"ali@marklogic.com"}, "change":{}, "files":[], "show":true, "svn":{"repository":"/project/engsvn", "revision":"122151", "paths":["xcc/trunk/mlcp/src/main/java/com/marklogic/contentpump/LocalJobRunner.java"], "affectedBugs":[]}, "comment":"Bug:20173\n-avoid referencing null object when doing LOG\n-include taskid and stacktrace in error log"}, {"time":"2012-11-30T17:47:31.032022-08:00", "updatedBy":{"username":"ali", "name":"Aries Li", "email":"ali@marklogic.com"}, "change":{"status":{"from":"", "to":"Test"}, "assignTo":{"from":{"username":"ali", "name":"Aries Li", "email":"ali@marklogic.com"}, "to":{"username":"lratcliff", "name":"Larry Ratcliff", "email":"lratcliff@marklogic.com"}}}, "files":[], "show":true, "comment":"Please compare the mlcp log between prior to this fix and with this fix."}, {"time":"2012-11-30T17:47:31.032022-08:00", "updatedBy":{"username":"ali", "name":"Aries Li", "email":"ali@marklogic.com"}, "change":{"assignTo":{"from":{"username":"ali", "name":"Aries Li", "email":"ali@marklogic.com"}, "to":{"username":"lratcliff", "name":"Larry Ratcliff", "email":"lratcliff@marklogic.com"}}}, "files":[], "show":true}, {"time":"2013-03-25T14:07:19.459694-07:00", "updatedBy":{"username":"lratcliff", "name":"Larry Ratcliff", "email":"lratcliff@marklogic.com"}, "change":{"status":{"from":"", "to":"Ship"}, "assignTo":{"from":{"username":"lratcliff", "name":"Larry Ratcliff", "email":"lratcliff@marklogic.com"}, "to":{"username":"nobody", "name":"nobody nobody", "email":"nobody@marklogic.com"}}}, "files":[], "show":true, "comment":"Verified on build 6.0-20130325"}, {"time":"2013-04-22T16:32:04.420922-07:00", "updatedBy":{"username":"rpelton", "name":"Rick Pelton", "email":"rick.pelton@marklogic.com"}, "change":{"status":{"from":"", "to":"Closed"}, "assignTo":{"from":{"username":"rpelton", "name":"Rick Pelton", "email":"rick.pelton@marklogic.com"}, "to":{"username":"nobody", "name":"nobody nobody", "email":"nobody@marklogic.com"}}}, "files":[], "show":true}], "updatedAt":"2013-04-22T16:32:04.420922-07:00", "fixedAt":"2012-11-30T17:47:31.032022-08:00", "fixedBy":{"username":"ali", "name":"Aries Li", "email":"ali@marklogic.com"}, "shippedAt":"2013-03-25T14:07:19.459694-07:00", "shippedBy":{"username":"lratcliff", "name":"Larry Ratcliff", "email":"lratcliff@marklogic.com"}, "closedAt":"2013-04-22T16:32:04.420922-07:00", "closedBy":{"username":"rpelton", "name":"Rick Pelton", "email":"rick.pelton@marklogic.com"}, "renderDescriptionAs":"normal"}
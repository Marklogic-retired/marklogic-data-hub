{"id":20623, "kind":"Bug", "createdAt":"2013-01-29T00:59:11.195488-08:00", "status":"Closed", "title":"ConcurrentModificationException in ConnectionCollector.run ", "category":"XCC/Java", "severity":"Major", "priority":{"level":"5", "title":""}, "submittedBy":{"username":"sanand", "name":"Sumit Anand", "email":"Sumit.Anand@marklogic.com"}, "assignTo":{"username":"nobody", "name":"nobody nobody", "email":"nobody@marklogic.com"}, "description":"Regression is failing on sandbox during xpath test suite. The machines throw an exception (see below example) and after it gets killed. It is intermittent, but very frequent.\r\n\r\nMachine : rh5-intel64-51-sbox-1\r\nPath to error log : /space/builder/builds/linux64/b6_0/logs.20130128.0\r\n\r\nHere what i see in qa-stdout.txt \r\n\r\nMon Jan 28 03:43:22 PST 2013: creating threads...\r\nMon Jan 28 03:43:22 PST 2013: starting...\r\nMon Jan 28 03:43:38 PST 2013: Reporting results...\r\nMon Jan 28 03:43:38 PST 2013: Writing results to /space/builder/builds/linux64/b6_0/qa/scripts/results/xpath_int_parent.xml\r\nxpath_int_parent.xml : Passed\r\nMon Jan 28 03:43:39 PST 2013: creating threads...\r\nMon Jan 28 03:43:39 PST 2013: starting...\r\nException in thread \"Thread-4\" java.util.ConcurrentModificationException\r\n        at java.util.LinkedHashMap$LinkedHashIterator.nextEntry(LinkedHashMap.java:390)\r\n        at java.util.LinkedHashMap$ValueIterator.next(LinkedHashMap.java:405)\r\n        at com.marklogic.xcc.ContentSourceFactory$ConnectionCollector.run(ContentSourceFactory.java:462)\r\ncom.marklogic.performance.SamplerException: java.lang.IllegalThreadStateException\r\n        at com.marklogic.performance.XCCSampler.sample(XCCSampler.java:162)\r\n        at com.marklogic.performance.Sampler.run(Sampler.java:104)\r\n        at java.lang.Thread.run(Thread.java:636)\r\nCaused by: java.lang.IllegalThreadStateException\r\n        at java.lang.Thread.start(Thread.java:612)\r\n        at com.marklogic.xcc.ContentSourceFactory$ConnectionCollector.checkAlive(ContentSourceFactory.java:477)\r\n        at com.marklogic.xcc.ContentSourceFactory.defaultConnectionProvider(ContentSourceFactory.java:350)\r\n        at com.marklogic.xcc.ContentSourceFactory.newContentSource(ContentSourceFactory.java:220)\r\n        at com.marklogic.xcc.ContentSourceFactory.newContentSource(ContentSourceFactory.java:244)\r\n        at com.marklogic.xcc.ContentSourceFactory.newContentSource(ContentSourceFactory.java:263)\r\n        at com.marklogic.performance.XCCSampler.sample(XCCSampler.java:156)\r\n        ... 2 more\r\n                           ", "samplequery":"", "sampledata":"", "version":"6.0-nightly", "tofixin":"6.0-3", "fixedin":"6.0-3", "platform":"all", "memory":"", "processors":"", "note":"", "subscribers":[{"username":"sanand", "name":"Sumit Anand", "email":"Sumit.Anand@marklogic.com"}, {"username":"jchen", "name":"Jane Chen", "email":"jane.chen@marklogic.com"}, {"username":"msrinivasan", "name":"Mahalakshmi Srinivasan", "email":"mahalakshmi.srinivasan@marklogic.com"}], "attachments":[], "relationships":[{"type":"", "to":""}], "clones":[], "cloneOf":"", "support":{"headline":"", "supportDescription":"", "publishStatus":"Never Publish", "tickets":[], "customerImpact":{"level":"N/A", "title":""}, "workaround":""}, "tags":["XCC/Java", "sanand"], "changeHistory":[{"time":"2013-01-29T00:59:11.195488-08:00", "updatedBy":{"username":"sanand", "name":"Sumit Anand", "email":"Sumit.Anand@marklogic.com"}, "change":{"assignTo":{"from":{"username":"sanand", "name":"Sumit Anand", "email":"Sumit.Anand@marklogic.com"}, "to":{"username":"msrinivasan", "name":"Mahalakshmi Srinivasan", "email":"mahalakshmi.srinivasan@marklogic.com"}}}, "files":[], "show":true}, {"time":"2013-01-29T06:21:28.86513-08:00", "updatedBy":{"username":"cjl", "name":"Christopher Lindblad", "email":"cjl@cerisent.com"}, "change":{"assignTo":{"from":{"username":"cjl", "name":"Christopher Lindblad", "email":"cjl@cerisent.com"}, "to":{"username":"jchen", "name":"Jane Chen", "email":"jane.chen@marklogic.com"}}}, "files":[], "show":true}, {"time":"2013-01-29T06:21:28.86513-08:00", "updatedBy":{"username":"cjl", "name":"Christopher Lindblad", "email":"cjl@cerisent.com"}, "change":{"tofixin":{"from":"", "to":"6.0-3"}}, "files":[], "show":true}, {"time":"2013-01-29T06:27:46.903447-08:00", "updatedBy":{"username":"cjl", "name":"Christopher Lindblad", "email":"cjl@cerisent.com"}, "change":{}, "files":[], "show":true, "comment":"ConcurrentModificationException in ConnectionCollector.run "}, {"time":"2013-01-29T10:42:25.855271-08:00", "updatedBy":{"username":"jchen", "name":"Jane Chen", "email":"jane.chen@marklogic.com"}, "change":{}, "files":[], "show":true, "svn":{"repository":"/project/engsvn", "revision":"129874", "paths":["xcc/branches/b6_0/xcc/src/java/com/marklogic/xcc/ContentSourceFactory.java"], "affectedBugs":[]}, "comment":"Bug:20623 - \n1) Avoid ConcurrentModificationException;\n2) Avoid IllegalThreadStateException.\n\n"}, {"time":"2013-01-29T10:43:23.684621-08:00", "updatedBy":{"username":"jchen", "name":"Jane Chen", "email":"jane.chen@marklogic.com"}, "change":{"status":{"from":"", "to":"Test"}, "assignTo":{"from":{"username":"jchen", "name":"Jane Chen", "email":"jane.chen@marklogic.com"}, "to":{"username":"msrinivasan", "name":"Mahalakshmi Srinivasan", "email":"mahalakshmi.srinivasan@marklogic.com"}}}, "files":[], "show":true}, {"time":"2013-01-29T10:43:23.684621-08:00", "updatedBy":{"username":"jchen", "name":"Jane Chen", "email":"jane.chen@marklogic.com"}, "change":{"assignTo":{"from":{"username":"jchen", "name":"Jane Chen", "email":"jane.chen@marklogic.com"}, "to":{"username":"msrinivasan", "name":"Mahalakshmi Srinivasan", "email":"mahalakshmi.srinivasan@marklogic.com"}}}, "files":[], "show":true}, {"time":"2013-03-18T16:05:33.435863-07:00", "updatedBy":{"username":"msrinivasan", "name":"Mahalakshmi Srinivasan", "email":"mahalakshmi.srinivasan@marklogic.com"}, "change":{}, "files":[], "show":true, "comment":"Sumit, giving this to you since you filed this bug."}, {"time":"2013-03-18T16:05:33.435863-07:00", "updatedBy":{"username":"msrinivasan", "name":"Mahalakshmi Srinivasan", "email":"mahalakshmi.srinivasan@marklogic.com"}, "change":{"assignTo":{"from":{"username":"msrinivasan", "name":"Mahalakshmi Srinivasan", "email":"mahalakshmi.srinivasan@marklogic.com"}, "to":{"username":"sanand", "name":"Sumit Anand", "email":"Sumit.Anand@marklogic.com"}}}, "files":[], "show":true}, {"time":"2013-03-22T02:01:14.253355-07:00", "updatedBy":{"username":"sanand", "name":"Sumit Anand", "email":"Sumit.Anand@marklogic.com"}, "change":{"status":{"from":"", "to":"Ship"}, "assignTo":{"from":{"username":"sanand", "name":"Sumit Anand", "email":"Sumit.Anand@marklogic.com"}, "to":{"username":"nobody", "name":"nobody nobody", "email":"nobody@marklogic.com"}}}, "files":[], "show":true, "comment":"Verified on build 20130321. This issue is no more producible, hence shipping it."}, {"time":"2013-03-22T02:01:14.253355-07:00", "updatedBy":{"username":"sanand", "name":"Sumit Anand", "email":"Sumit.Anand@marklogic.com"}, "change":{"assignTo":{"from":{"username":"sanand", "name":"Sumit Anand", "email":"Sumit.Anand@marklogic.com"}, "to":{"username":"nobody", "name":"nobody nobody", "email":"nobody@marklogic.com"}}}, "files":[], "show":true}], "updatedAt":"2013-03-22T02:01:14.253355-07:00", "fixedAt":"2013-01-29T10:43:23.684621-08:00", "fixedBy":{"username":"jchen", "name":"Jane Chen", "email":"jane.chen@marklogic.com"}, "shippedAt":"2013-03-22T02:01:14.253355-07:00", "shippedBy":{"username":"sanand", "name":"Sumit Anand", "email":"Sumit.Anand@marklogic.com"}, "renderDescriptionAs":"normal"}
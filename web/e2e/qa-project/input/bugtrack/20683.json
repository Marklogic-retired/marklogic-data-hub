{"id":20683, "kind":"Bug", "createdAt":"2013-02-01T04:09:19.923259-08:00", "status":"Closed", "title":"upgrade | element-word-query failing on upgraded environment for some particular index setting", "category":"Upgrade", "severity":"Major", "priority":{"level":"5", "title":""}, "submittedBy":{"username":"sverma", "name":"Shiva Verma", "email":"shiva.verma@marklogic.com"}, "assignTo":{"username":"nobody", "name":"nobody nobody", "email":"nobody@marklogic.com"}, "description":"STEPS:\r\n1. install 4.2-9.2 or 5.0-4\r\n2. create a DB and forest\r\n3. load data (as per load6.xml), let the indexing complete\r\n4. setup DB index configuration as per any config.xml attached(set any one index setting configuration)\r\n5. execute following query on pre-upgraded environment:\r\n<res> { cts:search(//MedlineCitation, cts:element-word-query((xs:QName(\"AbstractText\"),xs:QName(\"ArticleTitle\")), ( \"hematolymphoid\",\"seismologically\",\"leukemogenesis\")))/PMID } </res>\r\nRESULT:\r\n<res><PMID>11986236</PMID><PMID>11986950</PMID><PMID>11986952</PMID><PMID>11998893</PMID><PMID>12004082</PMID><PMID>12016311</PMID></res>\r\n\r\n6. upgrade to 5.0-20130131 nightly with re-indexing on\r\n7. let re-index finishes\r\n7. execute same query\r\n<res> { cts:search(//MedlineCitation, cts:element-word-query((xs:QName(\"AbstractText\"),xs:QName(\"ArticleTitle\")), ( \"hematolymphoid\",\"seismologically\",\"leukemogenesis\")))/PMID } </res>\r\nRESULT:\r\n<res><PMID>12004082</PMID></res>\r\n\r\n\r\nP.S. this scenario is failing on 5.0-4 -> 5.0-5 as well as 4.2-9.2 -> 5.0-5", "samplequery":"", "sampledata":"", "version":"5.0-nightly", "tofixin":"5.0-5", "fixedin":"5.0-5", "platform":"all", "memory":"", "processors":"", "note":"", "subscribers":[{"username":"sverma", "name":"Shiva Verma", "email":"shiva.verma@marklogic.com"}, {"username":"iagrawal", "name":"Isha Agrawal", "email":"iagrawal@marklogic.com"}, {"username":"mary", "name":"Mary Holstege", "email":"mary@cerisent.com"}, {"username":"rhu", "name":"Ron Hu", "email":"ron.hu@marklogic.com"}], "attachments":[{"name":"config_76.xml", "uri":"root/support/bugtracking/attachments/20683/config_76.xml"}, {"name":"config_68.xml", "uri":"root/support/bugtracking/attachments/20683/config_68.xml"}, {"name":"load6.xml", "uri":"root/support/bugtracking/attachments/20683/load6.xml"}, {"name":"config_100.xml", "uri":"root/support/bugtracking/attachments/20683/config_100.xml"}], "relationships":[{"type":"", "to":""}], "clones":[], "cloneOf":"", "support":{"headline":"", "supportDescription":"nightly", "publishStatus":"Never Publish", "tickets":[], "customerImpact":{"level":"N/A", "title":""}, "workaround":""}, "tags":["Upgrade", "sverma"], "changeHistory":[{"time":"2013-02-01T08:26:58.956631-08:00", "updatedBy":{"username":"sverma", "name":"Shiva Verma", "email":"shiva.verma@marklogic.com"}, "change":{}, "files":[], "show":true, "comment":"This is actually an automated test that try to set different combinations of index setting on any Database and then try to match its behavior with post upgrade behavior. \r\n\r\nThe cts:element-word-query is failing only for some of the combinations, and passing for others\r\n\r\nThere are a total of 128 combinations that we test but in 32 combinations this query is failing"}, {"time":"2013-02-01T08:41:34.39977-08:00", "updatedBy":{"username":"sverma", "name":"Shiva Verma", "email":"shiva.verma@marklogic.com"}, "change":{"assignTo":{"from":{"username":"sverma", "name":"Shiva Verma", "email":"shiva.verma@marklogic.com"}, "to":{"username":"rhu", "name":"Ron Hu", "email":"ron.hu@marklogic.com"}}}, "files":[], "show":true}, {"time":"2013-02-01T08:42:05.652634-08:00", "updatedBy":{"username":"sverma", "name":"Shiva Verma", "email":"shiva.verma@marklogic.com"}, "change":{"status":{"from":"", "to":"Verify"}, "assignTo":{"from":{"username":"sverma", "name":"Shiva Verma", "email":"shiva.verma@marklogic.com"}, "to":{"username":"rhu", "name":"Ron Hu", "email":"ron.hu@marklogic.com"}}}, "files":[], "show":true}, {"time":"2013-02-01T10:18:45.925735-08:00", "updatedBy":{"username":"rhu", "name":"Ron Hu", "email":"ron.hu@marklogic.com"}, "change":{"assignTo":{"from":{"username":"rhu", "name":"Ron Hu", "email":"ron.hu@marklogic.com"}, "to":{"username":"mary", "name":"Mary Holstege", "email":"mary@cerisent.com"}}}, "files":[], "show":true}, {"time":"2013-02-01T10:49:42.138599-08:00", "updatedBy":{"username":"rpolasani", "name":"Raghu Polasani", "email":"raghu.polasani@marklogic.com"}, "change":{}, "files":[], "show":true, "comment":"Mary, we will try to get the fast index option that is causing this regression."}, {"time":"2013-02-01T11:27:17.301207-08:00", "updatedBy":{"username":"mary", "name":"Mary Holstege", "email":"mary@cerisent.com"}, "change":{}, "files":[], "show":true, "comment":"When we say \"failing\" what do we mean exactly? Different estimates? Higher or lower? Estimate inconsistent with count(contains)?\r\n\r\n"}, {"time":"2013-02-02T09:46:11.434428-08:00", "updatedBy":{"username":"sverma", "name":"Shiva Verma", "email":"shiva.verma@marklogic.com"}, "change":{}, "files":[], "show":true, "comment":"'Failing' here means that the filtered results coming out of cts:search is less in upgraded environment then of same cts:search before upgrade\r\n\r\nfiltered results is less in upgraded environment for certain index setting, e.g. following index setting:\r\n<db:res xmlns:db=\"http://marklogic.com/xdmp/database\">\r\n  <fast-phrase-searches xmlns=\"http://marklogic.com/xdmp/database\">false</fast-phrase-searches>\r\n  <fast-reverse-searches xmlns=\"http://marklogic.com/xdmp/database\">true</fast-reverse-searches>\r\n  <fast-case-sensitive-searches xmlns=\"http://marklogic.com/xdmp/database\">true</fast-case-sensitive-searches>\r\n  <fast-diacritic-sensitive-searches xmlns=\"http://marklogic.com/xdmp/database\">true</fast-diacritic-sensitive-searches>\r\n  <fast-element-word-searches xmlns=\"http://marklogic.com/xdmp/database\">false</fast-element-word-searches>\r\n  <fast-element-phrase-searches xmlns=\"http://marklogic.com/xdmp/database\">true</fast-element-phrase-searches>\r\n  <fast-element-character-searches xmlns=\"http://marklogic.com/xdmp/database\">true</fast-element-character-searches>\r\n</db:res>\r\n"}, {"time":"2013-02-02T13:02:56.270011-08:00", "updatedBy":{"username":"mary", "name":"Mary Holstege", "email":"mary@cerisent.com"}, "change":{}, "files":[], "show":true, "comment":"This is more collateral damage from the fix for Bug:20011"}, {"time":"2013-02-02T13:03:44.865898-08:00", "updatedBy":{"username":"mary", "name":"Mary Holstege", "email":"mary@cerisent.com"}, "change":{}, "files":[], "show":true, "svn":{"repository":"/project/engsvn", "revision":"130392", "paths":["xdmp/trunk/src/SearchBuiltins.cpp"], "affectedBugs":[]}, "comment":"Bug:20683 more with element-word-query"}, {"time":"2013-02-02T13:08:44.706922-08:00", "updatedBy":{"username":"mary", "name":"Mary Holstege", "email":"mary@cerisent.com"}, "change":{}, "files":[], "show":true, "svn":{"repository":"/project/engsvn", "revision":"130393", "paths":["xdmp/branches/b6_0/src/SearchBuiltins.cpp"], "affectedBugs":[]}, "comment":"Bug:20683 more element-word-query fixes"}, {"time":"2013-02-02T13:25:19.798331-08:00", "updatedBy":{"username":"mary", "name":"Mary Holstege", "email":"mary@cerisent.com"}, "change":{}, "files":[], "show":true, "svn":{"repository":"/project/engsvn", "revision":"130394", "paths":["xdmp/branches/b5_0/src/SearchBuiltins.cpp"], "affectedBugs":["20011"]}, "comment":"Bug:20683 more element-word-query fixes, damage from fix for bug:20011"}, {"time":"2013-02-02T13:26:33.695974-08:00", "updatedBy":{"username":"mary", "name":"Mary Holstege", "email":"mary@cerisent.com"}, "change":{"status":{"from":"", "to":"Test"}, "assignTo":{"from":{"username":"mary", "name":"Mary Holstege", "email":"mary@cerisent.com"}, "to":{"username":"sverma", "name":"Shiva Verma", "email":"shiva.verma@marklogic.com"}}}, "files":[], "show":true, "comment":"I have tested several different combinations and they are now working.\r\nLet me know if there are still any problems.\r\nEstimates may be improved for some combinations when there are multiple element names in element-word-queries, however."}, {"time":"2013-02-02T13:26:33.695974-08:00", "updatedBy":{"username":"mary", "name":"Mary Holstege", "email":"mary@cerisent.com"}, "change":{"assignTo":{"from":{"username":"mary", "name":"Mary Holstege", "email":"mary@cerisent.com"}, "to":{"username":"sverma", "name":"Shiva Verma", "email":"shiva.verma@marklogic.com"}}}, "files":[], "show":true}, {"time":"2013-02-03T16:48:28.917784-08:00", "updatedBy":{"username":"mary", "name":"Mary Holstege", "email":"mary@cerisent.com"}, "change":{}, "files":[], "show":true, "svn":{"repository":"/project/engsvn", "revision":"130471", "paths":["xdmp/trunk/src/SearchBuiltins.cpp"], "affectedBugs":[]}, "comment":"Bug:20683 and yet more cases"}, {"time":"2013-02-04T07:57:59.379795-08:00", "updatedBy":{"username":"mary", "name":"Mary Holstege", "email":"mary@cerisent.com"}, "change":{}, "files":[], "show":true, "svn":{"repository":"/project/engsvn", "revision":"130548", "paths":["xdmp/branches/b6_0/src/SearchBuiltins.cpp"], "affectedBugs":[]}, "comment":"Bug:20683 and more e-w-q fixes for other settings"}, {"time":"2013-02-07T00:37:27.753008-08:00", "updatedBy":{"username":"iagrawal", "name":"Isha Agrawal", "email":"iagrawal@marklogic.com"}, "change":{"assignTo":{"from":{"username":"iagrawal", "name":"Isha Agrawal", "email":"iagrawal@marklogic.com"}, "to":{"username":"iagrawal", "name":"Isha Agrawal", "email":"iagrawal@marklogic.com"}}}, "files":[], "show":true}, {"time":"2013-02-07T00:46:39.702902-08:00", "updatedBy":{"username":"iagrawal", "name":"Isha Agrawal", "email":"iagrawal@marklogic.com"}, "change":{"status":{"from":"", "to":"Ship"}, "assignTo":{"from":{"username":"iagrawal", "name":"Isha Agrawal", "email":"iagrawal@marklogic.com"}, "to":{"username":"nobody", "name":"nobody nobody", "email":"nobody@marklogic.com"}}}, "files":[], "show":true, "comment":"Verified on ML version 20130205. All the tests are passing post upgrade in search upgrade testing. Hence,shipping the bug"}, {"time":"2013-02-07T00:46:39.702902-08:00", "updatedBy":{"username":"iagrawal", "name":"Isha Agrawal", "email":"iagrawal@marklogic.com"}, "change":{"assignTo":{"from":{"username":"iagrawal", "name":"Isha Agrawal", "email":"iagrawal@marklogic.com"}, "to":{"username":"nobody", "name":"nobody nobody", "email":"nobody@marklogic.com"}}}, "files":[], "show":true}, {"time":"2013-02-25T17:04:30.304306-08:00", "updatedBy":{"username":"rpelton", "name":"Rick Pelton", "email":"rick.pelton@marklogic.com"}, "change":{"status":{"from":"", "to":"Closed"}, "assignTo":{"from":{"username":"rpelton", "name":"Rick Pelton", "email":"rick.pelton@marklogic.com"}, "to":{"username":"nobody", "name":"nobody nobody", "email":"nobody@marklogic.com"}}}, "files":[], "show":true}], "updatedAt":"2013-02-25T17:04:30.304306-08:00", "fixedAt":"2013-02-02T13:26:33.695974-08:00", "fixedBy":{"username":"mary", "name":"Mary Holstege", "email":"mary@cerisent.com"}, "shippedAt":"2013-02-07T00:46:39.702902-08:00", "shippedBy":{"username":"iagrawal", "name":"Isha Agrawal", "email":"iagrawal@marklogic.com"}, "closedAt":"2013-02-25T17:04:30.304306-08:00", "closedBy":{"username":"rpelton", "name":"Rick Pelton", "email":"rick.pelton@marklogic.com"}, "renderDescriptionAs":"normal"}
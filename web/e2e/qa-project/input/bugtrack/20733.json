{"id":20733, "kind":"Bug", "createdAt":"2013-02-07T10:07:14.089907-08:00", "status":"Closed", "title":"REST writer should opt in to default read transform", "category":"MarkLogic REST API", "severity":"Minor", "priority":{"level":"5", "title":""}, "submittedBy":{"username":"ehennum", "name":"Erik Hennum", "email":"erik.hennum@marklogic.com"}, "assignTo":{"username":"nobody", "name":"nobody nobody", "email":"nobody@marklogic.com"}, "description":"Currently, if the REST admin specifies a default read transform, it is applied silently to all GET requests.\r\n\r\nIf the default read transform hides some of the data (the primary use case), the client can never get access to the hidden data via the REST API on that app server. In other words, not only is every GET lossy, but the client never knows that the GET is lossy.  \r\n\r\nThus, if a client with REST writer permission reads the expurgated document, modifies it, and writes the document back, the hidden data will be lost without notice.\r\n\r\nInstead, the default read transform should by default apply only to the REST reader.  The REST admin should either be able to set a property to apply the default transform to the REST writer or require the REST writer to name the transform explicitly on the GET request.\r\n ", "samplequery":"", "sampledata":"", "version":"6.0-nightly", "tofixin":"7.0-ea2", "fixedin":"7.0-ea2", "platform":"all", "memory":"", "processors":"", "note":"", "subscribers":[{"username":"ehennum", "name":"Erik Hennum", "email":"erik.hennum@marklogic.com"}, {"username":"achoudha", "name":"Ajay Choudhary", "email":"ajay.choudhary@marklogic.com"}, {"username":"vkorolev", "name":"Vitaly Korolev", "email":"vitaly.korolev@marklogic.com"}], "attachments":[{"name":"WS_Bug_20733-20June.xml", "uri":"root/support/bugtracking/attachments/20733/WS_Bug_20733-20June.xml"}, {"name":"Bug_20733_UseCase.xml", "uri":"root/support/bugtracking/attachments/20733/Bug_20733_UseCase.xml"}, {"name":"WS_Bug-207333_26June.xml", "uri":"root/support/bugtracking/attachments/20733/WS_Bug-207333_26June.xml"}], "relationships":[{"type":"", "to":""}], "clones":[], "cloneOf":"", "support":{"headline":"", "supportDescription":"", "publishStatus":"Not Ready", "tickets":[], "customerImpact":{"level":"N/A", "title":""}, "workaround":""}, "tags":["MarkLogic REST API", "ehennum"], "changeHistory":[{"time":"2013-02-07T10:07:14.089907-08:00", "updatedBy":{"username":"ehennum", "name":"Erik Hennum", "email":"erik.hennum@marklogic.com"}, "change":{"assignTo":{"from":{"username":"ehennum", "name":"Erik Hennum", "email":"erik.hennum@marklogic.com"}, "to":{"username":"ehennum", "name":"Erik Hennum", "email":"erik.hennum@marklogic.com"}}}, "files":[], "show":true}, {"time":"2013-02-12T09:10:52.895462-08:00", "updatedBy":{"username":"ehennum", "name":"Erik Hennum", "email":"erik.hennum@marklogic.com"}, "change":{}, "files":[], "show":true, "comment":"Per Justin, the resolution is for rest writer or rest admin to opt out of the default transform."}, {"time":"2013-03-28T16:26:07.88444-07:00", "updatedBy":{"username":"ehennum", "name":"Erik Hennum", "email":"erik.hennum@marklogic.com"}, "change":{"status":{"from":"", "to":"Fix"}, "assignTo":{"from":{"username":"ehennum", "name":"Erik Hennum", "email":"erik.hennum@marklogic.com"}, "to":{"username":"ehennum", "name":"Erik Hennum", "email":"erik.hennum@marklogic.com"}}}, "files":[], "show":true, "comment":"patch in review"}, {"time":"2013-03-29T11:31:51.469445-07:00", "updatedBy":{"username":"ehennum", "name":"Erik Hennum", "email":"erik.hennum@marklogic.com"}, "change":{}, "files":[], "show":true, "svn":{"repository":"/project/engsvn", "revision":"138107", "paths":["xdmp/trunk/src/Config/restapi.xsd", "xdmp/trunk/src/Apps/test/appservices/restapi-unittest/properties-unittest.xqy", "xdmp/trunk/src/Modules/MarkLogic/rest-api/lib/endpoint-util.xqy", "xdmp/trunk/src/Apps/test/appservices/restapi-unittest/tformhttp-unittest.xqy", "xdmp/trunk/src/Modules/MarkLogic/rest-api/endpoints/config.xqy"], "affectedBugs":[]}, "comment":"bug:20733 REST server configuration of default read transforms"}, {"time":"2013-03-29T11:34:15.103583-07:00", "updatedBy":{"username":"ehennum", "name":"Erik Hennum", "email":"erik.hennum@marklogic.com"}, "change":{}, "files":[], "show":true, "svn":{"repository":"/project/engsvn", "revision":"138110", "paths":["xdmp/trunk/src/Modules/MarkLogic/appservices/appbuilder/deploy-noxq.xqy"], "affectedBugs":[]}, "comment":"bug:20733 REST server configuration of default read transforms"}, {"time":"2013-03-29T13:46:20.510518-07:00", "updatedBy":{"username":"ehennum", "name":"Erik Hennum", "email":"erik.hennum@marklogic.com"}, "change":{}, "files":[], "show":true, "svn":{"repository":"/project/engsvn", "revision":"138129", "paths":["xdmp/trunk/src/Modules/MarkLogic/rest-api/models/document-model-common.xqy"], "affectedBugs":[]}, "comment":"bug:20733 REST server configuration of default read transforms"}, {"time":"2013-03-29T16:59:22.844009-07:00", "updatedBy":{"username":"ehennum", "name":"Erik Hennum", "email":"erik.hennum@marklogic.com"}, "change":{}, "files":[], "show":true, "comment":"Patch is in review for Java modification of the server configuration property "}, {"time":"2013-04-15T16:47:26.354129-07:00", "updatedBy":{"username":"ehennum", "name":"Erik Hennum", "email":"erik.hennum@marklogic.com"}, "change":{}, "files":[], "show":true, "svn":{"repository":"/project/engsvn", "revision":"139299", "paths":["client-api/java/trunk/src/test/java/com/marklogic/client/test/ServerConfigurationManagerTest.java", "client-api/java/trunk/src/main/java/com/marklogic/client/impl/ServerConfigurationManagerImpl.java", "client-api/java/trunk/src/main/java/com/marklogic/client/admin/ServerConfigurationManager.java"], "affectedBugs":[]}, "comment":"Bug:20733 Java client configuration of default read transforms"}, {"time":"2013-04-15T16:54:33.664207-07:00", "updatedBy":{"username":"ehennum", "name":"Erik Hennum", "email":"erik.hennum@marklogic.com"}, "change":{"status":{"from":"", "to":"Test"}, "assignTo":{"from":{"username":"ehennum", "name":"Erik Hennum", "email":"erik.hennum@marklogic.com"}, "to":{"username":"vkorolev", "name":"Vitaly Korolev", "email":"vitaly.korolev@marklogic.com"}}}, "files":[], "show":true, "comment":"REST and Java clients can now set a document-transform-all property on the REST server to true.  When true, a default transform modifies every document read regardless of user.  When false, a default transform does not modify documents read by a user with the rest-writer or rest-admin role.\r\n\r\nIn Java, this behaviour is controlled by the setDefaultDocumentReadTransformAll() method on the server configuration; however, testing at the REST layer should be sufficient.\r\n"}, {"time":"2013-04-15T16:54:33.664207-07:00", "updatedBy":{"username":"ehennum", "name":"Erik Hennum", "email":"erik.hennum@marklogic.com"}, "change":{"assignTo":{"from":{"username":"ehennum", "name":"Erik Hennum", "email":"erik.hennum@marklogic.com"}, "to":{"username":"vkorolev", "name":"Vitaly Korolev", "email":"vitaly.korolev@marklogic.com"}}}, "files":[], "show":true}, {"time":"2013-06-18T09:49:26.636717-07:00", "updatedBy":{"username":"vkorolev", "name":"Vitaly Korolev", "email":"vitaly.korolev@marklogic.com"}, "change":{}, "files":[], "show":true, "comment":"Ajay, please see if we need to modify our tests according to this bug."}, {"time":"2013-06-18T09:49:26.636717-07:00", "updatedBy":{"username":"vkorolev", "name":"Vitaly Korolev", "email":"vitaly.korolev@marklogic.com"}, "change":{"assignTo":{"from":{"username":"vkorolev", "name":"Vitaly Korolev", "email":"vitaly.korolev@marklogic.com"}, "to":{"username":"achoudha", "name":"Ajay Choudhary", "email":"ajay.choudhary@marklogic.com"}}}, "files":[], "show":true}, {"time":"2013-06-20T04:05:39.712323-07:00", "updatedBy":{"username":"achoudha", "name":"Ajay Choudhary", "email":"ajay.choudhary@marklogic.com"}, "change":{}, "files":[], "show":true, "comment":"Hi Erik,\r\n\r\nI tried testing the scenario explained in the bug. All the test steps executed have been written in attached test \"Bug_20733_UseCase.xml\".\r\n\r\nObservations: The change to <document-transform-all> property value to \"FALSE\" doesn't have any impact on transformed search results.\r\n\r\nNot sure if I am missing something in the attached test \"Bug_20733_UseCase.xml\". Can you please point me, if it is so?\r\n\r\nFurther, while worked on this bug I got below queries:\r\n\r\ni.  The default value of <document-transform-all> is \"TRUE\", is this expected?\r\nii. What is the significance of property <document-transform-out> ?\r\n"}, {"time":"2013-06-20T04:11:22.740711-07:00", "updatedBy":{"username":"achoudha", "name":"Ajay Choudhary", "email":"ajay.choudhary@marklogic.com"}, "change":{}, "files":[], "show":true, "comment":"Please, consider attachment \"Bug_20733_UseCase.xml\"\r\n and ignore attachment \"WS_Bug_20733-20June.xml\", this has been prematurely added."}, {"time":"2013-06-20T04:11:22.740711-07:00", "updatedBy":{"username":"achoudha", "name":"Ajay Choudhary", "email":"ajay.choudhary@marklogic.com"}, "change":{"assignTo":{"from":{"username":"achoudha", "name":"Ajay Choudhary", "email":"ajay.choudhary@marklogic.com"}, "to":{"username":"ehennum", "name":"Erik Hennum", "email":"erik.hennum@marklogic.com"}}}, "files":[], "show":true}, {"time":"2013-06-25T15:33:54.197874-07:00", "updatedBy":{"username":"ehennum", "name":"Erik Hennum", "email":"erik.hennum@marklogic.com"}, "change":{}, "files":[], "show":true, "comment":"Hi, Ajay:\r\n\r\nThe document-transform-out property is essential to the test.  This property specifies the name of the default read transform.  (You install the transform itself in the usual way.)  Please see:\r\n\r\n    http://docs.marklogic.com/guide/rest-dev/service#id_61169\r\n\r\nThe document-transform-all property is not expected to have any effect unless the document-transform-out property is set.\r\n\r\nThe default value of document-transform-all should be true for backward compatibility.\r\n\r\nIf you have any other questions, please feel free to follow up in email, copying Vitaly.\r\n\r\n\r\nThanks."}, {"time":"2013-06-25T15:33:54.197874-07:00", "updatedBy":{"username":"ehennum", "name":"Erik Hennum", "email":"erik.hennum@marklogic.com"}, "change":{"assignTo":{"from":{"username":"ehennum", "name":"Erik Hennum", "email":"erik.hennum@marklogic.com"}, "to":{"username":"achoudha", "name":"Ajay Choudhary", "email":"ajay.choudhary@marklogic.com"}}}, "files":[], "show":true}, {"time":"2013-06-26T11:30:00.366241-07:00", "updatedBy":{"username":"achoudha", "name":"Ajay Choudhary", "email":"ajay.choudhary@marklogic.com"}, "change":{}, "files":[], "show":true, "comment":"1. When document-transform-all is TRUE, default transform modifies every document regardless of user, i.e - User can be either of rest-[reader|writer|admin]\r\n2. When document-transform-all is FALSE, default transform doesn't modifies document by users rest-[writer|admin].\r\n3. When document-transform-all is FALSE, default transform still modifies document by rest-reader user.\r\n\r\nTest scenarios:\r\n-------------------\r\n1. Create rest-server\r\n2. Create rest-users\r\n3. Load documents.\r\n4. Install transform\r\n5. List default properties\r\n6. Apply installed transform with default properties\r\n7. Changes properties, i.e. document-transform-all -> true|false  and document-transform-out -> Installed transform name\r\n8. List properties to verify changes\r\n9. Get document with rest-[reader|writer|admin]\r\n\r\nAttached WS_Bug-207333_26June.xml is test for reference\r\n\r\nAbove scenarios should be  added to rest-client-api-transforms-bug20733.xml\r\n\r\n\r\n"}, {"time":"2013-08-30T03:39:06.07699-07:00", "updatedBy":{"username":"achoudha", "name":"Ajay Choudhary", "email":"ajay.choudhary@marklogic.com"}, "change":{}, "files":[], "show":true, "comment":"Working as expected. A test rest-client-api-transforms-bug20733.xml constituting this scenario has been added to regression."}, {"time":"2013-08-30T03:39:06.07699-07:00", "updatedBy":{"username":"achoudha", "name":"Ajay Choudhary", "email":"ajay.choudhary@marklogic.com"}, "change":{"status":{"from":"", "to":"Ship"}, "assignTo":{"from":{"username":"achoudha", "name":"Ajay Choudhary", "email":"ajay.choudhary@marklogic.com"}, "to":{"username":"nobody", "name":"nobody nobody", "email":"nobody@marklogic.com"}}}, "files":[], "show":true}, {"time":"2013-08-30T03:39:06.07699-07:00", "updatedBy":{"username":"achoudha", "name":"Ajay Choudhary", "email":"ajay.choudhary@marklogic.com"}, "change":{"assignTo":{"from":{"username":"achoudha", "name":"Ajay Choudhary", "email":"ajay.choudhary@marklogic.com"}, "to":{"username":"nobody", "name":"nobody nobody", "email":"nobody@marklogic.com"}}}, "files":[], "show":true}], "updatedAt":"2013-08-30T03:39:06.07699-07:00", "fixedAt":"2013-04-15T16:54:33.664207-07:00", "fixedBy":{"username":"ehennum", "name":"Erik Hennum", "email":"erik.hennum@marklogic.com"}, "shippedAt":"2013-08-30T03:39:06.07699-07:00", "shippedBy":{"username":"achoudha", "name":"Ajay Choudhary", "email":"ajay.choudhary@marklogic.com"}, "renderDescriptionAs":"normal"}
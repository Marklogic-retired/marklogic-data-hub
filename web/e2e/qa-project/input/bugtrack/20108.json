{"id":20108, "kind":"Bug", "createdAt":"2012-11-16T14:24:23.50549-08:00", "status":"Closed", "title":"session timeout after setting xa transaction timeout", "category":"", "severity":"Minor", "priority":{"level":"5", "title":""}, "submittedBy":{"username":"lling", "name":"Ling Ling", "email":"ling.ling@marklogic.com"}, "assignTo":{"username":"nobody", "name":"nobody nobody", "email":"nobody@marklogic.com"}, "description":"By running test TestXAOtherExceptions.java, we was getting \r\n\r\n-------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------\r\nTestsuite: com.marklogic.xa.TestXAOtherExceptions\r\nTests run: 1, Failures: 0, Errors: 1, Time elapsed: 8.561 sec\r\n\r\n------------- Standard Output --------------- \r\ntimeout = 1 \r\nInsert - XQueryException: = XDMP-EXTIME \r\nCommit - RollbackException: Could not commit transaction.\r\n------------- ---------------- ---------------\r\nTestcase: testGloabalTranCreatedCommitted(com.marklogic.xa.TestXAOtherExceptions):      Caused an ERROR\r\nTime limit exceeded\r\ncom.marklogic.xcc.exceptions.XQueryException: XDMP-EXTIME: Time limit exceeded\r\n [Session: user=admin, cb={default} [ContentSource: user=admin, cb={none} [provider: address=localhost/127.0.0.1:8686, pool=1/64]]]\r\n [Client: XCC/6.0-1, Server: XDBC/6.0-20121114] on line 4\r\n        at com.marklogic.xcc.impl.handlers.ServerExceptionHandler.handleResponse(ServerExceptionHandler.java:34)\r\n        at com.marklogic.xcc.impl.handlers.EvalRequestController.serverDialog(EvalRequestController.java:83)\r\n        at com.marklogic.xcc.impl.handlers.AbstractRequestController.runRequest(AbstractRequestController.java:84)\r\n        at com.marklogic.xcc.impl.SessionImpl.submitRequestInternal(SessionImpl.java:390)\r\n        at com.marklogic.xcc.impl.SessionImpl.submitRequest(SessionImpl.java:373)\r\n        at com.marklogic.xa.TestXAOtherExceptions.testGloabalTranCreatedCommitted(TestXAOtherExceptions.java:133)\r\n-------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------\r\n\r\nBut now I changed the line 133 and 134 to use \"session2\" instead of \"session\", the test ran fine. \r\n\r\nThis test is testing xa timeout. On line 58, xa (from session)  set the transaction timeout to be 1, then the request on line 85 throws the exception, which is expected, then line 101 tries to test catching another exception. Finally on line 131 it is trying to rollback the transaction and manually restart the server. The request to restart the server throws above exception(XDMP-EXTIME). If I use session2 to submit the restart request, the test ran fine, so I'm thinking maybe the effect of setting timeout last till line 133 or something. \r\n\r\n", "samplequery":"", "sampledata":"", "version":"6.0-nightly", "tofixin":"6.0-4", "fixedin":"6.0-4", "platform":"all", "memory":"", "processors":"", "note":"", "subscribers":[{"username":"lling", "name":"Ling Ling", "email":"ling.ling@marklogic.com"}, {"username":"jsnelson", "name":"John Snelson", "email":"jsnelson@marklogic.com"}], "attachments":[], "relationships":[{"type":"", "to":""}], "clones":[], "cloneOf":"", "support":{"headline":"", "supportDescription":"", "publishStatus":"Never Publish", "tickets":[], "customerImpact":{"level":"N/A", "title":""}, "workaround":""}, "tags":["", "lling"], "changeHistory":[{"time":"2012-11-16T14:24:23.50549-08:00", "updatedBy":{"username":"lling", "name":"Ling Ling", "email":"ling.ling@marklogic.com"}, "change":{"assignTo":{"from":{"username":"lling", "name":"Ling Ling", "email":"ling.ling@marklogic.com"}, "to":{"username":"jsnelson", "name":"John Snelson", "email":"jsnelson@marklogic.com"}}}, "files":[], "show":true}, {"time":"2013-02-28T11:52:28.076793-08:00", "updatedBy":{"username":"rhu", "name":"Ron Hu", "email":"ron.hu@marklogic.com"}, "change":{"tofixin":{"from":"6.0-3", "to":"6.0-4"}}, "files":[], "show":true}, {"time":"2013-05-20T02:15:18.073629-07:00", "updatedBy":{"username":"jsnelson", "name":"John Snelson", "email":"jsnelson@marklogic.com"}, "change":{"status":{"from":"", "to":"Test"}, "assignTo":{"from":{"username":"jsnelson", "name":"John Snelson", "email":"jsnelson@marklogic.com"}, "to":{"username":"lling", "name":"Ling Ling", "email":"ling.ling@marklogic.com"}}}, "files":[], "show":true, "comment":"This sounds like expected behaviour to me."}, {"time":"2013-05-20T02:15:18.073629-07:00", "updatedBy":{"username":"jsnelson", "name":"John Snelson", "email":"jsnelson@marklogic.com"}, "change":{"assignTo":{"from":{"username":"jsnelson", "name":"John Snelson", "email":"jsnelson@marklogic.com"}, "to":{"username":"lling", "name":"Ling Ling", "email":"ling.ling@marklogic.com"}}}, "files":[], "show":true}, {"time":"2013-07-22T14:02:36.496641-07:00", "updatedBy":{"username":"lling", "name":"Ling Ling", "email":"ling.ling@marklogic.com"}, "change":{"status":{"from":"", "to":"Closed"}, "assignTo":{"from":{"username":"lling", "name":"Ling Ling", "email":"ling.ling@marklogic.com"}, "to":{"username":"nobody", "name":"nobody nobody", "email":"nobody@marklogic.com"}}}, "files":[], "show":true}, {"time":"2013-07-22T14:02:36.496641-07:00", "updatedBy":{"username":"lling", "name":"Ling Ling", "email":"ling.ling@marklogic.com"}, "change":{"assignTo":{"from":{"username":"lling", "name":"Ling Ling", "email":"ling.ling@marklogic.com"}, "to":{"username":"nobody", "name":"nobody nobody", "email":"nobody@marklogic.com"}}}, "files":[], "show":true}], "updatedAt":"2013-07-22T14:02:36.496641-07:00", "fixedAt":"2013-05-20T02:15:18.073629-07:00", "fixedBy":{"username":"jsnelson", "name":"John Snelson", "email":"jsnelson@marklogic.com"}, "closedAt":"2013-07-22T14:02:36.496641-07:00", "closedBy":{"username":"lling", "name":"Ling Ling", "email":"ling.ling@marklogic.com"}, "renderDescriptionAs":"normal"}
{"id":20002, "kind":"Bug", "createdAt":"2012-11-05T21:52:31.236466-08:00", "status":"Closed", "title":"Error in Re-dployment of an app on port already in use", "category":"App Builder", "severity":"Major", "priority":{"level":"5", "title":""}, "submittedBy":{"username":"mbhatnag", "name":"Mayank Bhatnagar", "email":"Mayank.Bhatnagar@marklogic.com"}, "assignTo":{"username":"nobody", "name":"nobody nobody", "email":"nobody@marklogic.com"}, "description":"Build : 20121105\r\n\r\nPlatform : All\r\n\r\nSteps to reproduce :\r\n\r\n1.\tCreate an Oscar app and deploy it on port : 5074\r\n2.\tCreate a new Application MarkMail with database markmail and while configuring it go on deploy tab and select the radio button “Existing REST API Instance”\r\n        In the dropdown option of Oscar(5074) will be given , select it and deploy.\r\n3.\tThe app will be deployed and an error message will be given “Server error”.\r\n4.\tNow when you go and check the 8000 page you will see 2 app server on same port.\r\n\r\nExpected solution :\r\n\r\nWhile redeploying it should overwrite the existing app and only one app-server should exist on one port.\r\n\r\n\r\nNOTE : Attached with it is the ErrorLog in which the same scenario is produced but with geo-spatial data", "samplequery":"", "sampledata":"", "version":"6.0-1", "tofixin":"6.0-5", "fixedin":"6.0-5", "platform":"all", "memory":"", "processors":"", "note":"", "subscribers":[{"username":"mbhatnag", "name":"Mayank Bhatnagar", "email":"Mayank.Bhatnagar@marklogic.com"}, {"username":"cwhitney", "name":"Colleen  Whitney", "email":"colleen.whitney@marklogic.com"}, {"username":"ehennum", "name":"Erik Hennum", "email":"erik.hennum@marklogic.com"}, {"username":"msarma", "name":"Meghalim Sarma", "email":"msarma@marklogic.com"}, {"username":"sverma", "name":"Shiva Verma", "email":"shiva.verma@marklogic.com"}, {"username":"mdubinko", "name":"Micah  Dubinko", "email":"mdubinko@marklogic.com"}, {"username":"gvaidees", "name":"Ganesh Vaideeswaran", "email":"Ganesh.Vaideeswaran@marklogic.com"}, {"username":"jfuller", "name":"Jim Fuller", "email":"jim.fuller@marklogic.com"}, {"username":"gghai", "name":"Gaurav Ghai", "email":"Gaurav.ghai@marklogic.com"}], "attachments":[{"name":"ErrorLog", "uri":"root/support/bugtracking/attachments/20002/ErrorLog.txt"}, {"name":"New_ErrorLog", "uri":"root/support/bugtracking/attachments/20002/3835076450605903784-ErrorLog.txt"}, {"name":"Logs-BugReproducedOn20130730-HEAD", "uri":"root/support/bugtracking/attachments/20002/Logs-20002OnBuild20130730HEAD.zip"}, {"name":"VideoonBuild7.0-20130821", "uri":"root/support/bugtracking/attachments/20002/Bug20002.mp4"}], "relationships":[{"type":"", "to":""}], "clones":[24131], "cloneOf":"", "support":{"headline":"In Application Builder, Unpredictable behavior if you deploy a new application on a port that is already used ", "supportDescription":"In Application Builder, if you deploy a new application on an \"Existing REST API Instance\", behavior will be unpredictable. Here is an example - \r\n\r\n1.Create a database called \"foo\" and load content into it. Create an application using Application Builder against this database and deploy it on an available port, say 8003. Call the application \"foo_app\"\r\n2. Create another database called \"bar\" and load content into it. Create an application called \"bar_app\" using Application Builder and deploy it. During deployment, choose \"Existing REST API Instance\" and choose to deploy over \"foo_app (8003)\".\r\n\r\nAfter deployment when you run the application deployed on port 8003, you might see documents from the \"foo\" database instead of \"bar\". If you have constraints associated with geospatial indexes, you might see an error such as \"No element attribute pair geospatial index\"", "publishStatus":"Publish", "tickets":[], "customerImpact":{"level":"N/A", "title":""}, "workaround":"Make sure to deploy the application on a \"New REST API Instance\""}, "tags":["App Builder", "mbhatnag"], "changeHistory":[{"time":"2012-11-05T21:52:31.236466-08:00", "updatedBy":{"username":"mbhatnag", "name":"Mayank Bhatnagar", "email":"Mayank.Bhatnagar@marklogic.com"}, "change":{"assignTo":{"from":{"username":"mbhatnag", "name":"Mayank Bhatnagar", "email":"Mayank.Bhatnagar@marklogic.com"}, "to":{"username":"gvaidees", "name":"Ganesh Vaideeswaran", "email":"Ganesh.Vaideeswaran@marklogic.com"}}}, "files":[], "show":true}, {"time":"2012-11-05T21:55:20.628034-08:00", "updatedBy":{"username":"gvaidees", "name":"Ganesh Vaideeswaran", "email":"Ganesh.Vaideeswaran@marklogic.com"}, "change":{}, "files":[], "show":true, "comment":"Erik,\r\n\r\nCould this be related to the app server id changes (changes made to support porting of application from one DB to another). Thanks."}, {"time":"2012-11-05T21:55:20.628034-08:00", "updatedBy":{"username":"gvaidees", "name":"Ganesh Vaideeswaran", "email":"Ganesh.Vaideeswaran@marklogic.com"}, "change":{"assignTo":{"from":{"username":"gvaidees", "name":"Ganesh Vaideeswaran", "email":"Ganesh.Vaideeswaran@marklogic.com"}, "to":{"username":"ehennum", "name":"Erik Hennum", "email":"erik.hennum@marklogic.com"}}}, "files":[], "show":true}, {"time":"2012-11-05T22:14:11.076729-08:00", "updatedBy":{"username":"gvaidees", "name":"Ganesh Vaideeswaran", "email":"Ganesh.Vaideeswaran@marklogic.com"}, "change":{"tofixin":{"from":"", "to":"6.0-2"}}, "files":[], "show":true}, {"time":"2012-11-05T22:28:12.562839-08:00", "updatedBy":{"username":"gvaidees", "name":"Ganesh Vaideeswaran", "email":"Ganesh.Vaideeswaran@marklogic.com"}, "change":{}, "files":[], "show":true, "comment":"I think this is a setup issue based on what the log has.\r\n\r\nI tried the following and it worked - \r\n\r\n1. Create an Oscar example application on port 8003. It deployed successfully\r\n2. Create another Oscar example application and choose existing port 8003. It deployed successfully\r\n\r\nIt makes sense that both apps will show port 8003 since that is where it is deployed last.\r\n\r\nBased on the log, it seems like an Element Attribute pair geo index is not created where one is expected. Please talk to Megha if necessary\r\n\r\n<error:error xsi:schemaLocation=\"http://marklogic.com/xdmp/error error.xsd\" xmlns:error=\"http://marklogic.com/xdmp/error\" xmlns:xsi=\"http://www.w3.org/2001/XMLSchema-instance\">\r\n2012-11-05 09:23:30.889 Info: oscar1:   <error:code>XDMP-ELEMATTRPAIRGIDXNOTFOUND</error:code>\r\n2012-11-05 09:23:30.889 Info: oscar1:   <error:name/>\r\n2012-11-05 09:23:30.889 Info: oscar1:   <error:xquery-version>1.0-ml</error:xquery-version>\r\n2012-11-05 09:23:30.889 Info: oscar1:   <error:message>No element attribute pair geospatial index</error:message>\r\n2012-11-05 09:23:30.889 Info: oscar1:   <error:format-string>XDMP-ELEMATTRPAIRGIDXNOTFOUND: cts:element-attribute-pair-geospatial-boxes(fn:QName(\"\", \"ele-attr-pair-point\"), fn:QName(\"\", \"latitude\"), fn:QName(\"\", \"longitude\"), (xs:double(\"-89.99999999\"), xs:double(\"-88.1999999902\"), xs:double(\"-86.3999999904\"), ...), (xs:double(\"-179.99999999\"), xs:double(\"-176.3999999902\"), xs:double(\"-172.7999999904\"), ...), \"concurrent\", cts:and-query((), ()), xs:double(\"0\"), ()) -- No point element attribute pair geospatial index for fn:QName(\"\", \"ele-attr-pair-point\")/fn:QName(\"\", \"latitude\") fn:QName(\"\", \"ele-attr-pair-point\")/fn:QName(\"\", \"longitude\") wgs84</error:format-string>\r\n2012-11-05 09:23:30.889 Info: oscar1:   <error:retryable>false</error:retryable>\r\n2012-11-05 09:23:30.889 Info: oscar1:   <error:expr>cts:element-attribute-pair-geospatial-boxes(fn:QName(\"\", \"ele-attr-pair-point\"), fn:QName(\"\", \"latitude\"), fn:QName(\"\", \"longitude\"), (xs:double(\"-89.99999999\"), xs:double(\"-88.1999999902\"), xs:double(\"-86.3999999904\"), ...), (xs:double(\"-179.99999999\"), xs:double(\"-176.3999999902\"), xs:double(\"-172.7999999904\"), ...), \"concurrent\", cts:and-query((), ()), xs:double(\"0\"), ())</error:expr>\r\n2012-11-05 09:23:30.889 Info: oscar1:   <error:data>\r\n2012-11-05 09:23:30.889 Info: oscar1:     <error:datum>point</error:datum>\r\n2012-11-05 09:23:30.889 Info: oscar1:     <error:datum>fn:QName(\"\", \"ele-attr-pair-point\")</error:datum>\r\n2012-11-05 09:23:30.889 Info: oscar1:     <error:datum>fn:QName(\"\", \"latitude\")</error:datum>\r\n2012-11-05 09:23:30.889 Info: oscar1:     <error:datum>fn:QName(\"\", \"longitude\")</error:datum>\r\n2012-11-05 09:23:30.889 Info: oscar1:     <error:datum>wgs84</error:datum>\r\n2012-11-05 09:23:30.889 Info: oscar1:   </error:data>\r\n2012-11-05 09:23:30.889 Info: oscar1:   <error:stack>"}, {"time":"2012-11-05T22:28:12.562839-08:00", "updatedBy":{"username":"gvaidees", "name":"Ganesh Vaideeswaran", "email":"Ganesh.Vaideeswaran@marklogic.com"}, "change":{"assignTo":{"from":{"username":"gvaidees", "name":"Ganesh Vaideeswaran", "email":"Ganesh.Vaideeswaran@marklogic.com"}, "to":{"username":"mbhatnag", "name":"Mayank Bhatnagar", "email":"Mayank.Bhatnagar@marklogic.com"}}}, "files":[], "show":true}, {"time":"2012-11-05T23:52:58.904926-08:00", "updatedBy":{"username":"mbhatnag", "name":"Mayank Bhatnagar", "email":"Mayank.Bhatnagar@marklogic.com"}, "change":{}, "files":[], "show":true, "comment":"Hi Ganesh,\r\n\r\nYes you are correct and it will work fine as the Database (Oscar) is same in both the apps you deployed ,\r\nthe Issue occurs when we Deploy the app with different database on existing port. I have again produced the \r\nissue and attaching the ErrorLog for reference.\r\n\r\nThanks,\r\nMayank"}, {"time":"2012-11-05T23:52:58.904926-08:00", "updatedBy":{"username":"mbhatnag", "name":"Mayank Bhatnagar", "email":"Mayank.Bhatnagar@marklogic.com"}, "change":{"assignTo":{"from":{"username":"mbhatnag", "name":"Mayank Bhatnagar", "email":"Mayank.Bhatnagar@marklogic.com"}, "to":{"username":"ehennum", "name":"Erik Hennum", "email":"erik.hennum@marklogic.com"}}}, "files":[], "show":true}, {"time":"2012-11-05T23:53:41.886273-08:00", "updatedBy":{"username":"mbhatnag", "name":"Mayank Bhatnagar", "email":"Mayank.Bhatnagar@marklogic.com"}, "change":{"assignTo":{"from":{"username":"mbhatnag", "name":"Mayank Bhatnagar", "email":"Mayank.Bhatnagar@marklogic.com"}, "to":{"username":"gvaidees", "name":"Ganesh Vaideeswaran", "email":"Ganesh.Vaideeswaran@marklogic.com"}}}, "files":[], "show":true}, {"time":"2012-11-06T20:52:42.462026-08:00", "updatedBy":{"username":"gvaidees", "name":"Ganesh Vaideeswaran", "email":"Ganesh.Vaideeswaran@marklogic.com"}, "change":{}, "files":[], "show":true, "comment":"Can you please try this where we do not have a geo index on the app that is being redeployed.\r\n\r\nGaurav,\r\n\r\nWere you able to try it?"}, {"time":"2012-11-06T21:01:26.510338-08:00", "updatedBy":{"username":"gvaidees", "name":"Ganesh Vaideeswaran", "email":"Ganesh.Vaideeswaran@marklogic.com"}, "change":{}, "files":[], "show":true, "comment":"Can you also please check if this worked in 6.0-1? Thanks. "}, {"time":"2012-11-06T21:48:07.410508-08:00", "updatedBy":{"username":"gvaidees", "name":"Ganesh Vaideeswaran", "email":"Ganesh.Vaideeswaran@marklogic.com"}, "change":{}, "files":[], "show":true, "comment":"Jim, Micah,\r\n\r\nWhat is your take on this? Here is what I am seeing\r\n\r\n1. I deploy an example oscar app on 8003 (9 documents)\r\n2. I deploy another app (census_data) on the same port. You do not have to setup index or constraints. Just load the data and deploy on the same port\r\n\r\nI am seeing that the 9 documents from Oscar app is what is being displayed. \r\n\r\nLooks like the \"data\" database is still pointing to Oscars. Can you please provide your analysis, "}, {"time":"2012-11-06T21:48:07.410508-08:00", "updatedBy":{"username":"gvaidees", "name":"Ganesh Vaideeswaran", "email":"Ganesh.Vaideeswaran@marklogic.com"}, "change":{"assignTo":{"from":{"username":"gvaidees", "name":"Ganesh Vaideeswaran", "email":"Ganesh.Vaideeswaran@marklogic.com"}, "to":{"username":"mdubinko", "name":"Micah  Dubinko", "email":"mdubinko@marklogic.com"}}}, "files":[], "show":true}, {"time":"2012-11-07T07:21:48.454124-08:00", "updatedBy":{"username":"jfuller", "name":"Jim Fuller", "email":"jim.fuller@marklogic.com"}, "change":{}, "files":[], "show":true, "comment":"my initial analysis shows that in Apps/appbuilder/endpoints/deploy-noxq.xqy on line 159 we are invoking\r\n\r\ndeploy-util:noxq-deploy-generated-app($project, $existing)\r\n\r\nwhich seems to be doing nothing useful in this situation\r\n\r\nsomewhat serious, in trunk I see that this function (in Apps/appbuilder/lib/deploy-util.xqy) has some commented out code\r\n\r\ndeclare function util:noxq-deploy-generated-app(\r\n    $project as element(project),\r\n    $app-server as xs:string\r\n) as xs:string\r\n{\r\n  let $potential-app-servers := amped-build:appbuilder-get-potential-app-servers(\"http\")\r\n  let $app-server-config := $potential-app-servers[@name = $app-server]\r\n(:\r\n  let $zip := comp:do-compile($project, \"page\")\r\n  let $mdb-id := xs:unsignedLong($app-server-config/@mdb)\r\n  let $app-server-id := xs:unsignedLong($app-server-config/@id)\r\n  let $load := util:appbuilder-load-data($mdb-id, $zip)\r\n  let $deploy := amped-build:appbuilder-deploy-app-server($app-server-id, $project/@db-name)\r\n:)\r\n  return concat(\"http://\", xdmp:host-name(xdmp:host()), \":\", $app-server-config/@port, \"/\")\r\n};\r\n\r\nw/o wanting to cast any aspersions ... I recollect that Charles may have been around this area in the near past. \r\n\r\n\r\n\r\n\r\n"}, {"time":"2012-11-07T10:57:55.220146-08:00", "updatedBy":{"username":"mdubinko", "name":"Micah  Dubinko", "email":"mdubinko@marklogic.com"}, "change":{}, "files":[], "show":true, "comment":"The commented-out lines there are from until:deploy-generated-app (the old-skool version). They're no longer needed and should be removed, not commented out. IOW, a red herring on this particular issue."}, {"time":"2012-11-07T11:28:01.152554-08:00", "updatedBy":{"username":"mdubinko", "name":"Micah  Dubinko", "email":"mdubinko@marklogic.com"}, "change":{}, "files":[], "show":true, "comment":"And backing up a step, the 'expected' outcome above doesn't look right. The 8000 page is not the red UI. It's legitimately reporting that two projects were both last deployed on the same port. This is not critical.\r\n\r\nThe stack trace and Ganesh's comments are disconcerting, but not something we should potentially derail 6.0-2 over, as a trivial workaround exists. Recommend pushing it out."}, {"time":"2012-11-07T23:28:56.69716-08:00", "updatedBy":{"username":"gvaidees", "name":"Ganesh Vaideeswaran", "email":"Ganesh.Vaideeswaran@marklogic.com"}, "change":{}, "files":[], "show":true, "comment":"Jim, Micah,\r\n\r\nCan we recognize that a different app is being deployed on a port that is in use by an application and stop redeployment on the port? How easy is this fix?"}, {"time":"2012-11-08T04:20:14.123241-08:00", "updatedBy":{"username":"jfuller", "name":"Jim Fuller", "email":"jim.fuller@marklogic.com"}, "change":{}, "files":[], "show":true, "comment":"previously search options were deployed under a directory with a uuid for a name; we may have been able to use that to answer this question ... now this directory is named Default ... otherwise I don't see a 'safe' (canonical) way of determining this today w.o adding some 'moving parts'.\r\n\r\nfor vnext we could;\r\n\r\n  * use ticketing to say when something has been deployed\r\n  * we could add back uuid as either directory name or perhaps as an attribute on search options node ... might be useful to have this uuid verifiable (e.g. generated with a salt)\r\n  * we could start saving some state information of deployment history in project.xml file\r\n\r\nall of the above has consequences and varying levels of tidiness ... \r\n"}, {"time":"2012-11-08T07:41:32.068308-08:00", "updatedBy":{"username":"gvaidees", "name":"Ganesh Vaideeswaran", "email":"Ganesh.Vaideeswaran@marklogic.com"}, "change":{}, "files":[], "show":true, "comment":"Approved to move by support as well. David Gorbet agreed to move this."}, {"time":"2012-11-08T07:41:32.068308-08:00", "updatedBy":{"username":"gvaidees", "name":"Ganesh Vaideeswaran", "email":"Ganesh.Vaideeswaran@marklogic.com"}, "change":{"tofixin":{"from":"6.0-2", "to":"6.0-3"}}, "files":[], "show":true}, {"time":"2012-11-08T09:01:05.074555-08:00", "updatedBy":{"username":"ehennum", "name":"Erik Hennum", "email":"erik.hennum@marklogic.com"}, "change":{}, "files":[], "show":true, "comment":"In 6.0-1, the state for a REST server was saved in the modules database in a directory with the server id.\r\n\r\nThat made it impossible to copy a REST server (including a built app) to another cluster.\r\n\r\nFor REST servers (including built apps) _created_ on 6.0-2, the state is saved in a path with two\r\ndirectories:  the group name and, under that, the server name.\r\n\r\nSo, for REST servers created in 6.0-2, detecting existing apps using the same modules database\r\nshould be easy; however, I'm thinking they should be able to co-exist if the built app puts all\r\nresources in the same directory as the REST server.\r\n\r\nBut back to the main question.  If I understand correctly, the solution would be to check that the\r\nname is the same when deploying to an existing REST server.  To change the name of a REST\r\nserver, the old REST server must be deleted and a new REST server created. \r\n"}, {"time":"2012-11-08T10:33:04.428006-08:00", "updatedBy":{"username":"gvaidees", "name":"Ganesh Vaideeswaran", "email":"Ganesh.Vaideeswaran@marklogic.com"}, "change":{}, "files":[], "show":true, "comment":"Spoke with Erik. We should be able to check that GroupName/AppName combination associated with a port is the same during redeployment. If not, we will throw an error saying that the application on the port has to be deleted. I will create a separate defect for this and we will then work on closing this defect in 6.0-3. "}, {"time":"2012-11-08T11:15:40.146417-08:00", "updatedBy":{"username":"mdubinko", "name":"Micah  Dubinko", "email":"mdubinko@marklogic.com"}, "change":{}, "files":[], "show":true, "comment":"Probably we should say that the port is in use, and leave it to the user to decide whether to clear that port, or just pick a different one..."}, {"time":"2013-01-17T17:41:17.762638-08:00", "updatedBy":{"username":"gvaidees", "name":"Ganesh Vaideeswaran", "email":"Ganesh.Vaideeswaran@marklogic.com"}, "change":{}, "files":[], "show":true, "comment":"Jim,\r\n\r\nWe are triaging 6.0-3 and this will probably be a defect that we would have to fix ... just a heads up. 6.0-3 date is still being finalized"}, {"time":"2013-01-17T17:41:17.762638-08:00", "updatedBy":{"username":"gvaidees", "name":"Ganesh Vaideeswaran", "email":"Ganesh.Vaideeswaran@marklogic.com"}, "change":{"assignTo":{"from":{"username":"gvaidees", "name":"Ganesh Vaideeswaran", "email":"Ganesh.Vaideeswaran@marklogic.com"}, "to":{"username":"jfuller", "name":"Jim Fuller", "email":"jim.fuller@marklogic.com"}}}, "files":[], "show":true}, {"time":"2013-01-17T23:22:26.194143-08:00", "updatedBy":{"username":"jfuller", "name":"Jim Fuller", "email":"jim.fuller@marklogic.com"}, "change":{}, "files":[], "show":true, "comment":"ack, \r\n\r\nfurthermore, I agree with Micah last comment (Nov 8 2012 11:15) in that the fix would be us saying 'this port is in use, please choose another'\r\n\r\nthis is how I plan to address this defect.\r\n"}, {"time":"2013-01-29T01:34:02.937068-08:00", "updatedBy":{"username":"jfuller", "name":"Jim Fuller", "email":"jim.fuller@marklogic.com"}, "change":{"status":{"from":"", "to":"Fix"}, "assignTo":{"from":{"username":"jfuller", "name":"Jim Fuller", "email":"jim.fuller@marklogic.com"}, "to":{"username":"jfuller", "name":"Jim Fuller", "email":"jim.fuller@marklogic.com"}}}, "files":[], "show":true, "comment":"will fix this first in trunk then clone back to 6 branch"}, {"time":"2013-01-29T01:34:02.937068-08:00", "updatedBy":{"username":"jfuller", "name":"Jim Fuller", "email":"jim.fuller@marklogic.com"}, "change":{"tofixin":{"from":"6.0-3", "to":"7.0-1"}}, "files":[], "show":true}, {"time":"2013-04-19T14:06:01.449287-07:00", "updatedBy":{"username":"gvaidees", "name":"Ganesh Vaideeswaran", "email":"Ganesh.Vaideeswaran@marklogic.com"}, "change":{}, "files":[], "show":true, "comment":"Not sure if this is crticial for EA2. Existed in 6.0-3\r\n"}, {"time":"2013-04-19T14:06:01.449287-07:00", "updatedBy":{"username":"gvaidees", "name":"Ganesh Vaideeswaran", "email":"Ganesh.Vaideeswaran@marklogic.com"}, "change":{"tofixin":{"from":"7.0-1", "to":"7.0-ea3"}}, "files":[], "show":true}, {"time":"2013-06-14T18:59:21.105246-07:00", "updatedBy":{"username":"gvaidees", "name":"Ganesh Vaideeswaran", "email":"Ganesh.Vaideeswaran@marklogic.com"}, "change":{}, "files":[], "show":true, "comment":"Again, I am not sure if this is a critical defect since this is the way it has worked since 6.0. Reducing severity.\r\n\r\nMegha, hope you agree."}, {"time":"2013-06-25T05:53:56.256757-07:00", "updatedBy":{"username":"jfuller", "name":"Jim Fuller", "email":"jim.fuller@marklogic.com"}, "change":{"tofixin":{"from":"7.0-ea3", "to":"7.0-1"}}, "files":[], "show":true}, {"time":"2013-07-16T12:59:57.901079-07:00", "updatedBy":{"username":"gvaidees", "name":"Ganesh Vaideeswaran", "email":"Ganesh.Vaideeswaran@marklogic.com"}, "change":{}, "files":[], "show":true, "comment":"I believe with the recent changes to REST API structure, you cannot deploy on port that is already in use.\r\n\r\nSo, the 2nd app does not get deployed at all. You would not see this in the list of applications. I am looking to make the error that comes back better. It simple says \"application cannot be deployed. Look at server log\""}, {"time":"2013-07-16T14:31:34.534433-07:00", "updatedBy":{"username":"gvaidees", "name":"Ganesh Vaideeswaran", "email":"Ganesh.Vaideeswaran@marklogic.com"}, "change":{}, "files":[], "show":true, "svn":{"repository":"/project/engsvn", "revision":"146907", "paths":["xdmp/trunk/src/Modules/MarkLogic/appservices/appbuilder/deploy-noxq.xqy"], "affectedBugs":[]}, "comment":"Bug:20002 -  Error in Re-dployment of an app on port already in use"}, {"time":"2013-07-16T14:31:58.572978-07:00", "updatedBy":{"username":"gvaidees", "name":"Ganesh Vaideeswaran", "email":"Ganesh.Vaideeswaran@marklogic.com"}, "change":{"status":{"from":"", "to":"Test"}, "assignTo":{"from":{"username":"gvaidees", "name":"Ganesh Vaideeswaran", "email":"Ganesh.Vaideeswaran@marklogic.com"}, "to":{"username":"mbhatnag", "name":"Mayank Bhatnagar", "email":"Mayank.Bhatnagar@marklogic.com"}}}, "files":[], "show":true}, {"time":"2013-07-16T14:31:58.572978-07:00", "updatedBy":{"username":"gvaidees", "name":"Ganesh Vaideeswaran", "email":"Ganesh.Vaideeswaran@marklogic.com"}, "change":{"assignTo":{"from":{"username":"gvaidees", "name":"Ganesh Vaideeswaran", "email":"Ganesh.Vaideeswaran@marklogic.com"}, "to":{"username":"mbhatnag", "name":"Mayank Bhatnagar", "email":"Mayank.Bhatnagar@marklogic.com"}}}, "files":[], "show":true}, {"time":"2013-07-30T03:44:31.028957-07:00", "updatedBy":{"username":"mbhatnag", "name":"Mayank Bhatnagar", "email":"Mayank.Bhatnagar@marklogic.com"}, "change":{}, "files":[], "show":true, "comment":"Hi Ganesh,\r\n\r\nThe bug is still producible on HEAD and b6_0.\r\nI am able to deploy 2 apps on same port , no Error has been thrown\r\n\r\nBUILD : 20130730\r\n\r\nSteps to re-produce : \r\n1. Deploy an Oscar App\r\n2. Create a New Database\r\n3. Load the New Database with Non Oscar Data for example Shakespeare\r\n4. Create a Non Example app with Database as \"New Database\" and deploy it on the same port on which Oscar is deployed.\r\n\r\nExpected Output :\r\nEither the Oscar App should be completely replaced or an Error Message and not allowing to deploy app on same port\r\n\r\nActual Output : \r\nBoth Apps are deployed on same port and the resultant app is still pointing to Oscar database.\r\n\r\nNOTE : Attaching Snapshot and Logs in ZIP file for reference\r\n\r\n\r\n"}, {"time":"2013-07-30T03:44:31.028957-07:00", "updatedBy":{"username":"mbhatnag", "name":"Mayank Bhatnagar", "email":"Mayank.Bhatnagar@marklogic.com"}, "change":{"assignTo":{"from":{"username":"mbhatnag", "name":"Mayank Bhatnagar", "email":"Mayank.Bhatnagar@marklogic.com"}, "to":{"username":"gvaidees", "name":"Ganesh Vaideeswaran", "email":"Ganesh.Vaideeswaran@marklogic.com"}}}, "files":[], "show":true}, {"time":"2013-08-06T22:34:53.85303-07:00", "updatedBy":{"username":"gvaidees", "name":"Ganesh Vaideeswaran", "email":"Ganesh.Vaideeswaran@marklogic.com"}, "change":{"status":{"from":"", "to":"Fix"}, "assignTo":{"from":{"username":"gvaidees", "name":"Ganesh Vaideeswaran", "email":"Ganesh.Vaideeswaran@marklogic.com"}, "to":{"username":"gvaidees", "name":"Ganesh Vaideeswaran", "email":"Ganesh.Vaideeswaran@marklogic.com"}}}, "files":[], "show":true}, {"time":"2013-08-07T12:34:18.555491-07:00", "updatedBy":{"username":"gvaidees", "name":"Ganesh Vaideeswaran", "email":"Ganesh.Vaideeswaran@marklogic.com"}, "change":{}, "files":[], "show":true, "comment":"I cannot reproduce this. \r\n\r\n1. Deployed OSCAR app on 7998\r\n2. Created new DB called \"NewDB\"\r\n3. Loaded data into NewDB\r\n4. Deployed new app on 7998.\r\n\r\nGot the error that port is already in use by another application."}, {"time":"2013-08-07T12:34:18.555491-07:00", "updatedBy":{"username":"gvaidees", "name":"Ganesh Vaideeswaran", "email":"Ganesh.Vaideeswaran@marklogic.com"}, "change":{"status":{"from":"", "to":"Test"}, "assignTo":{"from":{"username":"gvaidees", "name":"Ganesh Vaideeswaran", "email":"Ganesh.Vaideeswaran@marklogic.com"}, "to":{"username":"mbhatnag", "name":"Mayank Bhatnagar", "email":"Mayank.Bhatnagar@marklogic.com"}}}, "files":[], "show":true}, {"time":"2013-08-07T12:34:18.555491-07:00", "updatedBy":{"username":"gvaidees", "name":"Ganesh Vaideeswaran", "email":"Ganesh.Vaideeswaran@marklogic.com"}, "change":{"assignTo":{"from":{"username":"gvaidees", "name":"Ganesh Vaideeswaran", "email":"Ganesh.Vaideeswaran@marklogic.com"}, "to":{"username":"mbhatnag", "name":"Mayank Bhatnagar", "email":"Mayank.Bhatnagar@marklogic.com"}}}, "files":[], "show":true}, {"time":"2013-08-23T05:41:07.080652-07:00", "updatedBy":{"username":"mbhatnag", "name":"Mayank Bhatnagar", "email":"Mayank.Bhatnagar@marklogic.com"}, "change":{}, "files":[], "show":true, "comment":"Hi Ganesh , \r\nI am still able to produce the issue, I am attaching a video to the bug explaning how I reproduced it on Build : 7.0-20130821\r\n"}, {"time":"2013-08-23T05:41:07.080652-07:00", "updatedBy":{"username":"mbhatnag", "name":"Mayank Bhatnagar", "email":"Mayank.Bhatnagar@marklogic.com"}, "change":{"assignTo":{"from":{"username":"mbhatnag", "name":"Mayank Bhatnagar", "email":"Mayank.Bhatnagar@marklogic.com"}, "to":{"username":"gvaidees", "name":"Ganesh Vaideeswaran", "email":"Ganesh.Vaideeswaran@marklogic.com"}}}, "files":[], "show":true}, {"time":"2013-08-27T17:28:38.010189-07:00", "updatedBy":{"username":"gvaidees", "name":"Ganesh Vaideeswaran", "email":"Ganesh.Vaideeswaran@marklogic.com"}, "change":{}, "files":[], "show":true, "comment":"I tried with latest build and cannot reproduce this. I tried both ports 7998 and 8003. \r\n\r\nMegha,\r\n\r\nCan you or Gaurav try this as well,"}, {"time":"2013-08-27T17:28:38.010189-07:00", "updatedBy":{"username":"gvaidees", "name":"Ganesh Vaideeswaran", "email":"Ganesh.Vaideeswaran@marklogic.com"}, "change":{"assignTo":{"from":{"username":"gvaidees", "name":"Ganesh Vaideeswaran", "email":"Ganesh.Vaideeswaran@marklogic.com"}, "to":{"username":"gghai", "name":"Gaurav Ghai", "email":"Gaurav.ghai@marklogic.com"}}}, "files":[], "show":true}, {"time":"2013-09-09T17:03:07.846445-07:00", "updatedBy":{"username":"gghai", "name":"Gaurav Ghai", "email":"Gaurav.ghai@marklogic.com"}, "change":{}, "files":[], "show":true, "comment":"Hi Mayank : I tried this one , so i think on App builder home page you see same port of both he app deployed is OK , is not an issue .\r\n\r\nIssue 2 , the result page should be showing the Shakespeare data in the result section instead of the oscar , is agree that is valid issue . \r\n\r\nIs you can confirm the case 2 is what you intended ,  i ll can show it to Ganesh . let me know .Thx"}, {"time":"2013-09-09T17:03:07.846445-07:00", "updatedBy":{"username":"gghai", "name":"Gaurav Ghai", "email":"Gaurav.ghai@marklogic.com"}, "change":{"status":{"from":"", "to":"Verify"}, "assignTo":{"from":{"username":"gghai", "name":"Gaurav Ghai", "email":"Gaurav.ghai@marklogic.com"}, "to":{"username":"mbhatnag", "name":"Mayank Bhatnagar", "email":"Mayank.Bhatnagar@marklogic.com"}}}, "files":[], "show":true}, {"time":"2013-09-09T17:03:07.846445-07:00", "updatedBy":{"username":"gghai", "name":"Gaurav Ghai", "email":"Gaurav.ghai@marklogic.com"}, "change":{"assignTo":{"from":{"username":"gghai", "name":"Gaurav Ghai", "email":"Gaurav.ghai@marklogic.com"}, "to":{"username":"mbhatnag", "name":"Mayank Bhatnagar", "email":"Mayank.Bhatnagar@marklogic.com"}}}, "files":[], "show":true}, {"time":"2013-09-10T23:45:43.776922-07:00", "updatedBy":{"username":"mbhatnag", "name":"Mayank Bhatnagar", "email":"Mayank.Bhatnagar@marklogic.com"}, "change":{}, "files":[], "show":true, "comment":"Hi Gaurav,\r\nIssue 1 : As per my understanding the user should not see(on AppBuilder home page) two apps deployed on single port as it will be confusing.\r\nIssue 2 : The deployed app must not show the content of previous app(Oscar in our case) when we have deployed new app with different content(Shakespeare in our case) on the port. \r\n\r\nThanks,\r\nMayank"}, {"time":"2013-09-10T23:45:43.776922-07:00", "updatedBy":{"username":"mbhatnag", "name":"Mayank Bhatnagar", "email":"Mayank.Bhatnagar@marklogic.com"}, "change":{"assignTo":{"from":{"username":"mbhatnag", "name":"Mayank Bhatnagar", "email":"Mayank.Bhatnagar@marklogic.com"}, "to":{"username":"gghai", "name":"Gaurav Ghai", "email":"Gaurav.ghai@marklogic.com"}}}, "files":[], "show":true}, {"time":"2013-09-11T10:43:45.965127-07:00", "updatedBy":{"username":"gghai", "name":"Gaurav Ghai", "email":"Gaurav.ghai@marklogic.com"}, "change":{}, "files":[], "show":true, "comment":"Thanks Mayank.\r\n\r\nAs i was informing yesterday , issue 1 , did came up in the past and my understand that is still okie. But i will check with Ganesh / Micah if they think we need to fix it .\r\n\r\nIssue 2 : Its a valid issue Shakespeare data should be seen in the result section of deployed app.\r\n\r\nGanesh : Passing it to you .I can walk you through in person for any further questions/queries on this on steps to reproduce. "}, {"time":"2013-09-11T10:43:45.965127-07:00", "updatedBy":{"username":"gghai", "name":"Gaurav Ghai", "email":"Gaurav.ghai@marklogic.com"}, "change":{"assignTo":{"from":{"username":"gghai", "name":"Gaurav Ghai", "email":"Gaurav.ghai@marklogic.com"}, "to":{"username":"gvaidees", "name":"Ganesh Vaideeswaran", "email":"Ganesh.Vaideeswaran@marklogic.com"}}}, "files":[], "show":true}, {"time":"2013-09-11T12:13:38.846382-07:00", "updatedBy":{"username":"gvaidees", "name":"Ganesh Vaideeswaran", "email":"Ganesh.Vaideeswaran@marklogic.com"}, "change":{}, "files":[], "show":true, "comment":"Issue 2 mentioned by gaurav seems bad. Signing this to you too see if micah or jim will have an answer. I have not assigned a priority, but seems like a 1. But the issue has existed for sometime and is not customer reported. So, can probably be moved."}, {"time":"2013-09-11T12:13:38.846382-07:00", "updatedBy":{"username":"gvaidees", "name":"Ganesh Vaideeswaran", "email":"Ganesh.Vaideeswaran@marklogic.com"}, "change":{"assignTo":{"from":{"username":"gvaidees", "name":"Ganesh Vaideeswaran", "email":"Ganesh.Vaideeswaran@marklogic.com"}, "to":{"username":"cwhitney", "name":"Colleen  Whitney", "email":"colleen.whitney@marklogic.com"}}}, "files":[], "show":true}, {"time":"2013-09-11T13:58:36.109969-07:00", "updatedBy":{"username":"cwhitney", "name":"Colleen  Whitney", "email":"colleen.whitney@marklogic.com"}, "change":{}, "files":[], "show":true, "comment":"This is a regression from behavior in pre-6.0 App Builder, and from my reading of the convoluted thread it sounds like it prevents the user from redeploying to the same App-Server.  \r\n\r\nI see a note from Jim early in the thread about a plan to fix on trunk and then clone back to 6.0.  It doesn't look like that happened.  I'm going to hand this back to Jim to own, since he was the deploy-meister in 6.0 and Micah is heavily loaded with semantics.  Please don't wait to create the clone (it's better to set this original bug to 6.0-5 and create the clone on 7.0-1).\r\n\r\nJim, I don't believe that the solution of not redeploying to that port is correct.  Mayank's expectation is correct; IMO, but you can start up a 5.0 instance to see what the behavior was prior to 6.  Unless there was an explicit decision to change the behavior that I'm not aware of."}, {"time":"2013-09-11T13:58:36.109969-07:00", "updatedBy":{"username":"cwhitney", "name":"Colleen  Whitney", "email":"colleen.whitney@marklogic.com"}, "change":{"assignTo":{"from":{"username":"cwhitney", "name":"Colleen  Whitney", "email":"colleen.whitney@marklogic.com"}, "to":{"username":"jfuller", "name":"Jim Fuller", "email":"jim.fuller@marklogic.com"}}}, "files":[], "show":true}, {"time":"2013-09-11T14:10:19.236203-07:00", "updatedBy":{"username":"gvaidees", "name":"Ganesh Vaideeswaran", "email":"Ganesh.Vaideeswaran@marklogic.com"}, "change":{}, "files":[], "show":true, "comment":"After watching the video, I see why I was not able to reproduce the issue before. I did not deploy to an existing REST instance, I simple reused the port and that gave me an error that port was already in use by another application.\r\n\r\nThe bug surfaces when you choose an existing REST Instance to deploy a new application.\r\n\r\nYou might have figured this out already!"}, {"time":"2013-09-12T09:29:41.850648-07:00", "updatedBy":{"username":"jfuller", "name":"Jim Fuller", "email":"jim.fuller@marklogic.com"}, "change":{"tofixin":{"from":"7.0-1", "to":"6.0-5"}}, "files":[], "show":true}, {"time":"2013-09-12T09:40:46.152403-07:00", "updatedBy":{"username":"jfuller", "name":"Jim Fuller", "email":"jim.fuller@marklogic.com"}, "change":{}, "files":[], "show":true, "comment":"to be clear (because your sentence seems to imply that I dropped this work w/o doing anything) I was instructed to not do this work.\r\n\r\nAs for the reasoning behind displaying an error vs overwriting; this was based on the fact that if you try to create a REST server via database settings page and then attempt to deploy onto a pre-existing REST server then one is confronted with an error stating you cannot deploy over an existing REST server. \r\n\r\n\r\n\r\n"}, {"time":"2013-09-12T09:46:14.943032-07:00", "updatedBy":{"username":"cwhitney", "name":"Colleen  Whitney", "email":"colleen.whitney@marklogic.com"}, "change":{}, "files":[], "show":true, "comment":"Jim, I wasn't implying anything other than that I can't see anything in the comment stream that indicates the work was done.  Apologies if I hit a hot button with that comment.\r\n\r\nRe: the reasoning, creating a second app server on top of one that is on an existing port is, I agree, incorrect...but in this case we're talking about redeploying an *application* on an existing server.  I think that's where the confusion is."}, {"time":"2013-09-23T09:51:03.257683-07:00", "updatedBy":{"username":"jfuller", "name":"Jim Fuller", "email":"jim.fuller@marklogic.com"}, "change":{}, "files":[], "show":true, "svn":{"repository":"/project/engsvn", "revision":"152099", "paths":["xdmp/branches/b6_0/src/Modules/MarkLogic/appservices/appbuilder/deploy-noxq.xqy"], "affectedBugs":[]}, "comment":"fix for bug:20002"}, {"time":"2013-09-23T09:51:43.274604-07:00", "updatedBy":{"username":"jfuller", "name":"Jim Fuller", "email":"jim.fuller@marklogic.com"}, "change":{"status":{"from":"", "to":"Test"}, "assignTo":{"from":{"username":"jfuller", "name":"Jim Fuller", "email":"jim.fuller@marklogic.com"}, "to":{"username":"gghai", "name":"Gaurav Ghai", "email":"Gaurav.ghai@marklogic.com"}}}, "files":[], "show":true, "comment":"applied 24131 fix to 6.05 branch, test should be the same"}, {"time":"2013-09-23T09:51:43.274604-07:00", "updatedBy":{"username":"jfuller", "name":"Jim Fuller", "email":"jim.fuller@marklogic.com"}, "change":{"assignTo":{"from":{"username":"jfuller", "name":"Jim Fuller", "email":"jim.fuller@marklogic.com"}, "to":{"username":"gghai", "name":"Gaurav Ghai", "email":"Gaurav.ghai@marklogic.com"}}}, "files":[], "show":true}, {"time":"2014-02-12T13:16:27.181654-08:00", "updatedBy":{"username":"gghai", "name":"Gaurav Ghai", "email":"Gaurav.ghai@marklogic.com"}, "change":{}, "files":[], "show":true, "comment":"  "}, {"time":"2014-02-12T13:16:27.181654-08:00", "updatedBy":{"username":"gghai", "name":"Gaurav Ghai", "email":"Gaurav.ghai@marklogic.com"}, "change":{"assignTo":{"from":{"username":"gghai", "name":"Gaurav Ghai", "email":"Gaurav.ghai@marklogic.com"}, "to":{"username":"mbhatnag", "name":"Mayank Bhatnagar", "email":"Mayank.Bhatnagar@marklogic.com"}}}, "files":[], "show":true}, {"time":"2014-02-25T01:50:23.852638-08:00", "updatedBy":{"username":"mbhatnag", "name":"Mayank Bhatnagar", "email":"Mayank.Bhatnagar@marklogic.com"}, "change":{"status":{"from":"", "to":"Ship"}, "assignTo":{"from":{"username":"mbhatnag", "name":"Mayank Bhatnagar", "email":"Mayank.Bhatnagar@marklogic.com"}, "to":{"username":"nobody", "name":"nobody nobody", "email":"nobody@marklogic.com"}}}, "files":[], "show":true, "comment":"Verified on Build : 6.0-20140225 \r\nThe app is now pointing to correct database.\r\nHence Shipping it."}, {"time":"2014-02-25T01:50:23.852638-08:00", "updatedBy":{"username":"mbhatnag", "name":"Mayank Bhatnagar", "email":"Mayank.Bhatnagar@marklogic.com"}, "change":{"assignTo":{"from":{"username":"mbhatnag", "name":"Mayank Bhatnagar", "email":"Mayank.Bhatnagar@marklogic.com"}, "to":{"username":"nobody", "name":"nobody nobody", "email":"nobody@marklogic.com"}}}, "files":[], "show":true}, {"time":"2014-03-24T07:33:49.067274-07:00", "updatedBy":{"username":"rpelton", "name":"Rick Pelton", "email":"rick.pelton@marklogic.com"}, "change":{"status":{"from":"", "to":"Closed"}, "assignTo":{"from":{"username":"rpelton", "name":"Rick Pelton", "email":"rick.pelton@marklogic.com"}, "to":{"username":"nobody", "name":"nobody nobody", "email":"nobody@marklogic.com"}}}, "files":[], "show":true, "comment":"ga\r\n"}], "updatedAt":"2014-03-24T07:33:49.067274-07:00", "fixedAt":"2013-09-23T09:51:43.274604-07:00", "fixedBy":{"username":"jfuller", "name":"Jim Fuller", "email":"jim.fuller@marklogic.com"}, "shippedAt":"2014-02-25T01:50:23.852638-08:00", "shippedBy":{"username":"mbhatnag", "name":"Mayank Bhatnagar", "email":"Mayank.Bhatnagar@marklogic.com"}, "closedAt":"2014-03-24T07:33:49.067274-07:00", "closedBy":{"username":"rpelton", "name":"Rick Pelton", "email":"rick.pelton@marklogic.com"}, "renderDescriptionAs":"normal"}
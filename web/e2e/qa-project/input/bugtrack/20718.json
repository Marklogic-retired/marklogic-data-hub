{"id":20718, "kind":"Bug", "createdAt":"2013-02-05T16:00:07.043477-08:00", "status":"Closed", "title":"Triples index reindexed on upgrade", "category":"", "severity":"Major", "priority":{"level":"5", "title":""}, "submittedBy":{"username":"sbuxton", "name":"Stephen Buxton", "email":"stephen.buxton@marklogic.com"}, "assignTo":{"username":"nobody", "name":"nobody nobody", "email":"nobody@marklogic.com"}, "description":"  I just tried to upgrade to the latest nightly, and I’m having problems.\r\n  This may not be related, but … it looks like the triples index is enabled by default.\r\n  I see this in the error log:\r\n \r\n2013-02-05 10:59:21.927 Info: Reindexed triple index 61200 fragments in 955 sec at 64 fragments/sec on forest MarkMailF2\r\n2013-02-05 10:59:21.934 Info: Reindexed triple index 62000 fragments in 956 sec at 65 fragments/sec on forest MarkMailF1\r\n2013-02-05 10:59:22.526 Info: Saved 204 MB in 14 sec at 15 MB/sec to /space/markmail/Forests/MarkMailF1/0000010a\r\n \r\n  I think this should be off by default on upgrade, to prevent surprises like this (I didn’t know I had any triples in that database!)\r\n", "samplequery":"", "sampledata":"", "version":"7.0-nightly", "tofixin":"7.0-ea2", "fixedin":"7.0-ea2", "platform":"all", "memory":"", "processors":"", "note":"", "subscribers":[{"username":"sbuxton", "name":"Stephen Buxton", "email":"stephen.buxton@marklogic.com"}, {"username":"jsnelson", "name":"John Snelson", "email":"jsnelson@marklogic.com"}, {"username":"rpolasani", "name":"Raghu Polasani", "email":"raghu.polasani@marklogic.com"}, {"username":"lling", "name":"Ling Ling", "email":"ling.ling@marklogic.com"}], "attachments":[], "relationships":[{"type":"", "to":""}], "clones":[], "cloneOf":"", "support":{"headline":"", "supportDescription":"", "publishStatus":"Not Ready", "tickets":[], "customerImpact":{"level":"N/A", "title":""}, "workaround":""}, "tags":["", "sbuxton"], "changeHistory":[{"time":"2013-02-05T16:00:07.043477-08:00", "updatedBy":{"username":"sbuxton", "name":"Stephen Buxton", "email":"stephen.buxton@marklogic.com"}, "change":{"assignTo":{"from":{"username":"sbuxton", "name":"Stephen Buxton", "email":"stephen.buxton@marklogic.com"}, "to":{"username":"jsnelson", "name":"John Snelson", "email":"jsnelson@marklogic.com"}}}, "files":[], "show":true}, {"time":"2013-02-06T02:47:14.046496-08:00", "updatedBy":{"username":"jsnelson", "name":"John Snelson", "email":"jsnelson@marklogic.com"}, "change":{}, "files":[], "show":true, "comment":"I can't reproduce this in a new database, and upgrade isn't supported in 7.0-ea1. I can't see any obvious reason why this should happen. Pushing to 7.0-1."}, {"time":"2013-02-06T02:47:14.046496-08:00", "updatedBy":{"username":"jsnelson", "name":"John Snelson", "email":"jsnelson@marklogic.com"}, "change":{"tofixin":{"from":"", "to":"7.0-1"}}, "files":[], "show":true}, {"time":"2013-02-06T18:10:38.547428-08:00", "updatedBy":{"username":"sbuxton", "name":"Stephen Buxton", "email":"stephen.buxton@marklogic.com"}, "change":{}, "files":[], "show":true, "comment":"More wierdness.\r\n\r\nI successfully completed the upgrade, enabled the triple index (which was UNchecked in the Admin UI), and I got:\r\n\r\n2013-02-06 17:42:29.621 Info: Reindexed triple index 2400 fragments in 37 sec at 65 fragments/sec on forest MarkMailF1\r\n2013-02-06 17:42:29.622 Info: Reindexed triple index 2200 fragments in 37 sec at 60 fragments/sec on forest MarkMailF2\r\n\r\nDifferent number of fragments.\r\n\r\nAnd if I do \r\n  cts:triples()\r\nfrom QC, I get nothing back - that means there are no triples in the database, yes?\r\n\r\nHappy to shelve this till I can reproduce something similar on a clean install, but I am curious.\r\n"}, {"time":"2013-02-06T19:34:13.67565-08:00", "updatedBy":{"username":"cjl", "name":"Christopher Lindblad", "email":"cjl@cerisent.com"}, "change":{}, "files":[], "show":true, "comment":"The way the reindexer works it will reindex all old fragments that have neither the \"off\" term nor the \"on\" term.\r\nNormally this is not a problem since we first do a new-version reindex upon upgrade.\r\nWe have done a new-version reindex in all previous releases, but we have not yet decided whether we will do it for this release.\r\n"}, {"time":"2013-02-21T07:31:12.685121-08:00", "updatedBy":{"username":"jsnelson", "name":"John Snelson", "email":"jsnelson@marklogic.com"}, "change":{}, "files":[], "show":true, "svn":{"repository":"/project/engsvn", "revision":"132861", "paths":["xdmp/trunk/src/StatusBuiltins.cpp", "xdmp/trunk/src/Forest.cpp"], "affectedBugs":[]}, "comment":"bug:20718 Don't reindex documents without triples when triple index settings change"}, {"time":"2013-02-21T07:32:00.753508-08:00", "updatedBy":{"username":"jsnelson", "name":"John Snelson", "email":"jsnelson@marklogic.com"}, "change":{"status":{"from":"", "to":"Test"}, "assignTo":{"from":{"username":"jsnelson", "name":"John Snelson", "email":"jsnelson@marklogic.com"}, "to":{"username":"rpolasani", "name":"Raghu Polasani", "email":"raghu.polasani@marklogic.com"}}}, "files":[], "show":true, "comment":"Fixed."}, {"time":"2013-02-21T07:32:00.753508-08:00", "updatedBy":{"username":"jsnelson", "name":"John Snelson", "email":"jsnelson@marklogic.com"}, "change":{"assignTo":{"from":{"username":"jsnelson", "name":"John Snelson", "email":"jsnelson@marklogic.com"}, "to":{"username":"rpolasani", "name":"Raghu Polasani", "email":"raghu.polasani@marklogic.com"}}}, "files":[], "show":true}, {"time":"2013-02-21T07:32:00.753508-08:00", "updatedBy":{"username":"jsnelson", "name":"John Snelson", "email":"jsnelson@marklogic.com"}, "change":{"tofixin":{"from":"7.0-1", "to":"7.0-ea2"}}, "files":[], "show":true}, {"time":"2013-05-03T14:37:58.535615-07:00", "updatedBy":{"username":"rpolasani", "name":"Raghu Polasani", "email":"raghu.polasani@marklogic.com"}, "change":{"assignTo":{"from":{"username":"rpolasani", "name":"Raghu Polasani", "email":"raghu.polasani@marklogic.com"}, "to":{"username":"lling", "name":"Ling Ling", "email":"ling.ling@marklogic.com"}}}, "files":[], "show":true}, {"time":"2013-05-08T10:36:17.926163-07:00", "updatedBy":{"username":"lling", "name":"Ling Ling", "email":"ling.ling@marklogic.com"}, "change":{}, "files":[], "show":true, "comment":"Hi John, as upgrade is not supported in EA1, is it supported in EA2? Do I need to test this with upgrade? Thx."}, {"time":"2013-05-08T10:44:20.056869-07:00", "updatedBy":{"username":"jsnelson", "name":"John Snelson", "email":"jsnelson@marklogic.com"}, "change":{}, "files":[], "show":true, "comment":"Upgrade is still not supported in EA2. I think the triple index will be fine, but it's other features I'm not sure about."}, {"time":"2013-05-08T11:08:50.631382-07:00", "updatedBy":{"username":"lling", "name":"Ling Ling", "email":"ling.ling@marklogic.com"}, "change":{}, "files":[], "show":true, "comment":"Thx! Then I'll test without upgrade, only change the triple index settings."}, {"time":"2013-05-08T18:18:40.406973-07:00", "updatedBy":{"username":"lling", "name":"Ling Ling", "email":"ling.ling@marklogic.com"}, "change":{}, "files":[], "show":true, "svn":{"repository":"/project/engsvn", "revision":"141153", "paths":["qa/trunk/scripts/keys/bug20718.xml", "qa/trunk/scripts/tests/bug20718.xml", "qa/trunk/scripts/list/00semantics.txt"], "affectedBugs":[]}, "comment":"bug:20718"}, {"time":"2013-05-08T18:20:32.95753-07:00", "updatedBy":{"username":"lling", "name":"Ling Ling", "email":"ling.ling@marklogic.com"}, "change":{"status":{"from":"", "to":"Ship"}, "assignTo":{"from":{"username":"lling", "name":"Ling Ling", "email":"ling.ling@marklogic.com"}, "to":{"username":"nobody", "name":"nobody nobody", "email":"nobody@marklogic.com"}}}, "files":[], "show":true, "comment":"when having mixed content or only rdf content, when turning triple index on to off, or off to on, there's reindexing, only to rdf fragments. When only having xml content, no reindexing is done. "}, {"time":"2013-05-08T18:20:32.95753-07:00", "updatedBy":{"username":"lling", "name":"Ling Ling", "email":"ling.ling@marklogic.com"}, "change":{"assignTo":{"from":{"username":"lling", "name":"Ling Ling", "email":"ling.ling@marklogic.com"}, "to":{"username":"nobody", "name":"nobody nobody", "email":"nobody@marklogic.com"}}}, "files":[], "show":true}], "updatedAt":"2013-05-08T18:20:32.95753-07:00", "fixedAt":"2013-02-21T07:32:00.753508-08:00", "fixedBy":{"username":"jsnelson", "name":"John Snelson", "email":"jsnelson@marklogic.com"}, "shippedAt":"2013-05-08T18:20:32.95753-07:00", "shippedBy":{"username":"lling", "name":"Ling Ling", "email":"ling.ling@marklogic.com"}, "renderDescriptionAs":"normal"}
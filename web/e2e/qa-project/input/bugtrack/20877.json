{"id":20877, "kind":"Bug", "createdAt":"2013-02-21T11:26:58.261479-08:00", "status":"Closed", "title":"search:search (search:parse really) throws an XDMP-AS if the search is only a keyword and has parenthesis around it", "category":"Search API", "severity":"Major", "priority":{"level":"5", "title":""}, "submittedBy":{"username":"dsokolsky", "name":"Danny Sokolsky", "email":"dsokolsky@marklogic.com"}, "assignTo":{"username":"nobody", "name":"nobody nobody", "email":"nobody@marklogic.com"}, "description":"If you have qtext that is surrounded by parenthesis, and inside the parens is only a \"keyword\" (like an operator), the search throws a 500 error.  Based on the principal of least surprise, I think this is supposed to do something smarter (like search for the terms in parens.  Here is a simple example (I am running 6.0-2.1):\r\n\r\nxquery version \"1.0-ml\";\r\n\r\nimport module namespace search =\r\n \"http://marklogic.com/appservices/search\"\r\n at \"/MarkLogic/appservices/search/search.xqy\";\r\n\r\n search:parse(\r\n '(AND)')\r\n=>\r\n[1.0-ml] XDMP-AS: (err:XPTY0004) impl:inner-expressions($ps, $subexpr, $rbp, $until) -- Invalid coercion: <unknown-starter name=\"joiner\">&lt;searchdev:tok type=&quot;joiner&quot; from=&quot;2&quot; xml...</unknown-starter> as schema-element(cts:query)\r\n\r\nStack Trace\r\nIn /MarkLogic/appservices/search/search-impl.xqy on line 425\r\nIn impl:inner-expressions(map:map(<map:map xmlns:xs=\"http://www.w3.org/2001/XMLSchema\" xmlns:xsi=\"http://www.w3.org/2001/XMLSchema-instance\" xmlns:map=\"http://marklogic.com/xdmp/map\"><map:entry key=\"toknum\"><map:value xsi:type=\"xs:integer\">3</map:...</map:map>...XDMP-XMLFUNC: (err:XQTY0105) Functions cannot be used in the content of an element constructor...), <unknown-starter name=\"joiner\">&lt;searchdev:tok type=&quot;joiner&quot; from=&quot;2&quot; xml...</unknown-starter>, 0, \")\")\r\nIn /MarkLogic/appservices/search/search-impl.xqy on line 422\r\nIn impl:expressions(map:map(<map:map xmlns:xs=\"http://www.w3.org/2001/XMLSchema\" xmlns:xsi=\"http://www.w3.org/2001/XMLSchema-instance\" xmlns:map=\"http://marklogic.com/xdmp/map\"><map:entry key=\"toknum\"><map:value xsi:type=\"xs:integer\">3</map:...</map:map>...XDMP-XMLFUNC: (err:XQTY0105) Functions cannot be used in the content of an element constructor...), 0, attribute{fn:QName(\"\", \"delimiter\")}{\")\"})\r\n\r\n$ps := map:map(<map:map xmlns:xs=\"http://www.w3.org/2001/XMLSchema\" xmlns:xsi=\"http://www.w3.org/2001/XMLSchema-instance\" ", "samplequery":"", "sampledata":"", "version":"6.0-1", "tofixin":"6.0-3", "fixedin":"6.0-3", "platform":"all", "memory":"", "processors":"", "note":"", "subscribers":[{"username":"dsokolsky", "name":"Danny Sokolsky", "email":"dsokolsky@marklogic.com"}, {"username":"ayuwono", "name":"Aries Yuwono", "email":"ayuwono@marklogic.com"}, {"username":"cgreer", "name":"Charles Greer", "email":"charles.greer@marklogic.com"}, {"username":"mdubinko", "name":"Micah  Dubinko", "email":"mdubinko@marklogic.com"}, {"username":"msarma", "name":"Meghalim Sarma", "email":"msarma@marklogic.com"}], "attachments":[], "relationships":[{"type":"", "to":""}], "clones":[21191], "cloneOf":"", "support":{"headline":"A search string that contains only a joiner (such as \"AND\") within parentheses throws a server error.", "supportDescription":"One can craft a search string that contains only a joiner (\"AND\" or \"OR\") that is within parentheses.  This combination of tokens causes the server to throw an error.", "publishStatus":"Publish", "tickets":[], "customerImpact":{"level":"N/A", "title":""}, "workaround":"Pre-process search strings to exclude '(AND)' and '(OR)'"}, "tags":["Search API", "dsokolsky"], "changeHistory":[{"time":"2013-02-21T11:26:58.261479-08:00", "updatedBy":{"username":"dsokolsky", "name":"Danny Sokolsky", "email":"dsokolsky@marklogic.com"}, "change":{"assignTo":{"from":{"username":"dsokolsky", "name":"Danny Sokolsky", "email":"dsokolsky@marklogic.com"}, "to":{"username":"mdubinko", "name":"Micah  Dubinko", "email":"mdubinko@marklogic.com"}}}, "files":[], "show":true}, {"time":"2013-02-21T11:34:02.002442-08:00", "updatedBy":{"username":"dsokolsky", "name":"Danny Sokolsky", "email":"dsokolsky@marklogic.com"}, "change":{}, "files":[], "show":true, "comment":"FWIW, anyone can take any app that uses search API and easily generate this exception."}, {"time":"2013-03-01T12:04:11.64553-08:00", "updatedBy":{"username":"cwhitney", "name":"Colleen  Whitney", "email":"colleen.whitney@marklogic.com"}, "change":{}, "files":[], "show":true, "comment":"Sounds like it needs to be evaluated for blast radius before we make a disposition for 6.0-3."}, {"time":"2013-03-13T16:04:06.54737-07:00", "updatedBy":{"username":"cgreer", "name":"Charles Greer", "email":"charles.greer@marklogic.com"}, "change":{}, "files":[], "show":true, "comment":"Agreed to take a look."}, {"time":"2013-03-13T16:04:06.54737-07:00", "updatedBy":{"username":"cgreer", "name":"Charles Greer", "email":"charles.greer@marklogic.com"}, "change":{"assignTo":{"from":{"username":"cgreer", "name":"Charles Greer", "email":"charles.greer@marklogic.com"}, "to":{"username":"cgreer", "name":"Charles Greer", "email":"charles.greer@marklogic.com"}}}, "files":[], "show":true}, {"time":"2013-03-15T14:05:02.60886-07:00", "updatedBy":{"username":"cgreer", "name":"Charles Greer", "email":"charles.greer@marklogic.com"}, "change":{"status":{"from":"", "to":"Fix"}, "assignTo":{"from":{"username":"cgreer", "name":"Charles Greer", "email":"charles.greer@marklogic.com"}, "to":{"username":"cgreer", "name":"Charles Greer", "email":"charles.greer@marklogic.com"}}}, "files":[], "show":true, "comment":"Verified, writing up review query now."}, {"time":"2013-03-19T11:31:05.837289-07:00", "updatedBy":{"username":"cgreer", "name":"Charles Greer", "email":"charles.greer@marklogic.com"}, "change":{}, "files":[], "show":true, "comment":"Patch in review."}, {"time":"2013-03-19T11:50:44.338602-07:00", "updatedBy":{"username":"cgreer", "name":"Charles Greer", "email":"charles.greer@marklogic.com"}, "change":{}, "files":[], "show":true, "svn":{"repository":"/project/engsvn", "revision":"137177", "paths":["xdmp/branches/b6_0/src/Apps/test/appservices/search-unittest/parse-unittest.xqy", "xdmp/branches/b6_0/src/Modules/MarkLogic/appservices/utils/tdop.xqy", "xdmp/branches/b6_0/src/Modules/MarkLogic/appservices/search/search-impl.xqy", "xdmp/branches/b6_0/src/Modules/MarkLogic/appservices/search/ast.xqy"], "affectedBugs":[]}, "comment":"bug:20877 search parse bug with invalid joiner"}, {"time":"2013-03-19T11:51:00.425961-07:00", "updatedBy":{"username":"cgreer", "name":"Charles Greer", "email":"charles.greer@marklogic.com"}, "change":{"status":{"from":"", "to":"Test"}, "assignTo":{"from":{"username":"cgreer", "name":"Charles Greer", "email":"charles.greer@marklogic.com"}, "to":{"username":"msarma", "name":"Meghalim Sarma", "email":"msarma@marklogic.com"}}}, "files":[], "show":true, "comment":"Hi Megha, this bug should be straightforward to test -- the included unit tests check for search:parse(\"(AND)\") and search:parse(\"(OR a)\")\r\n"}, {"time":"2013-03-19T11:51:00.425961-07:00", "updatedBy":{"username":"cgreer", "name":"Charles Greer", "email":"charles.greer@marklogic.com"}, "change":{"assignTo":{"from":{"username":"cgreer", "name":"Charles Greer", "email":"charles.greer@marklogic.com"}, "to":{"username":"msarma", "name":"Meghalim Sarma", "email":"msarma@marklogic.com"}}}, "files":[], "show":true}, {"time":"2013-03-19T15:09:20.743543-07:00", "updatedBy":{"username":"msarma", "name":"Meghalim Sarma", "email":"msarma@marklogic.com"}, "change":{"assignTo":{"from":{"username":"msarma", "name":"Meghalim Sarma", "email":"msarma@marklogic.com"}, "to":{"username":"ayuwono", "name":"Aries Yuwono", "email":"ayuwono@marklogic.com"}}}, "files":[], "show":true}, {"time":"2013-03-26T14:44:03.132723-07:00", "updatedBy":{"username":"ayuwono", "name":"Aries Yuwono", "email":"ayuwono@marklogic.com"}, "change":{"status":{"from":"", "to":"Ship"}, "assignTo":{"from":{"username":"ayuwono", "name":"Aries Yuwono", "email":"ayuwono@marklogic.com"}, "to":{"username":"nobody", "name":"nobody nobody", "email":"nobody@marklogic.com"}}}, "files":[], "show":true, "comment":"Verified passed 03/26"}, {"time":"2013-03-26T14:44:03.132723-07:00", "updatedBy":{"username":"ayuwono", "name":"Aries Yuwono", "email":"ayuwono@marklogic.com"}, "change":{"assignTo":{"from":{"username":"ayuwono", "name":"Aries Yuwono", "email":"ayuwono@marklogic.com"}, "to":{"username":"nobody", "name":"nobody nobody", "email":"nobody@marklogic.com"}}}, "files":[], "show":true}, {"time":"2013-04-22T16:23:11.658354-07:00", "updatedBy":{"username":"rpelton", "name":"Rick Pelton", "email":"rick.pelton@marklogic.com"}, "change":{"status":{"from":"", "to":"Closed"}, "assignTo":{"from":{"username":"rpelton", "name":"Rick Pelton", "email":"rick.pelton@marklogic.com"}, "to":{"username":"nobody", "name":"nobody nobody", "email":"nobody@marklogic.com"}}}, "files":[], "show":true}], "updatedAt":"2013-04-22T16:23:11.658354-07:00", "fixedAt":"2013-03-19T11:51:00.425961-07:00", "fixedBy":{"username":"cgreer", "name":"Charles Greer", "email":"charles.greer@marklogic.com"}, "shippedAt":"2013-03-26T14:44:03.132723-07:00", "shippedBy":{"username":"ayuwono", "name":"Aries Yuwono", "email":"ayuwono@marklogic.com"}, "closedAt":"2013-04-22T16:23:11.658354-07:00", "closedBy":{"username":"rpelton", "name":"Rick Pelton", "email":"rick.pelton@marklogic.com"}, "renderDescriptionAs":"normal"}
{"id":20830, "kind":"Bug", "createdAt":"2013-02-19T04:50:47.345112-08:00", "status":"Closed", "title":"database-add-field-word-lexicon throwing \"Name already exists\" if word lexicons are present", "category":"xdmp", "severity":"Major", "priority":{"level":"5", "title":""}, "submittedBy":{"username":"iagrawal", "name":"Isha Agrawal", "email":"iagrawal@marklogic.com"}, "assignTo":{"username":"nobody", "name":"nobody nobody", "email":"nobody@marklogic.com"}, "description":"database-add-field-word-lexicon throwing \"Name already exists\" if word lexicons are present\r\n\r\nTest name:bug6635.xml\r\nML version: 20130218\r\nMachine Name:rh5-intel64-70-build\r\nPath to Logs: /space/builder/builds/linux64/HEAD/logs.20130218.1/reg-results/\r\nPath to Diff: /space/builder/builds/linux64/HEAD/logs.20130218.1/reg-results/diffs/bug6635.xml\r\n\r\nSteps to reproduce:\r\n\r\n1.\tAfter creating forest and database, add word lexicons to the db.\r\n\r\nXquery for word lexicon:\r\n\r\nxquery version \"1.0-ml\";\r\n     import module namespace adm=\"http://marklogic.com/xdmp/admin\" at \"/MarkLogic/admin.xqy\";\r\n     declare variable $config := adm:get-configuration();\r\n     let $dbid := adm:database-get-id($config,\"bugDB6635\")\r\n     let $lex := adm:database-word-lexicon(\"http://marklogic.com/collation/codepoint\")\r\n     let $c := adm:database-add-word-lexicon($config,$dbid,$lex)\r\n     let $lex := adm:database-word-lexicon(\"http://marklogic.com/collation/en/S1\")\r\n     let $c := adm:database-add-word-lexicon($c,$dbid,$lex)\r\n     return adm:save-configuration($c)\r\n\r\n2.\tThen set the xdbc server's default collation to codepoint collation.\r\n\r\nxquery version \"1.0-ml\";\r\ndeclare namespace adm=\"http://marklogic.com/xdmp/admin\";\r\nimport module \"http://marklogic.com/xdmp/admin\" at \"/MarkLogic/admin.xqy\";\r\ndeclare variable $config := adm:get-configuration();\r\ndeclare variable $dbid := xdmp:database(\"bugDB6635\");\r\ndeclare variable $httpid := xdmp:server(\"QAxdbcServer\");\r\nlet $c := adm:appserver-set-collation($config,$httpid,\"http://marklogic.com/collation/codepoint\")\r\nreturn adm:save-configuration($c)\r\n\r\n3.\tNow add a field that has lexicon:\r\nXquery:\r\n\r\nxquery version \"1.0-ml\";\r\ndeclare namespace adm=\"http://marklogic.com/xdmp/admin\";\r\n        import module \"http://marklogic.com/xdmp/admin\" at \"/MarkLogic/admin.xqy\";\r\n\r\n        let $config := adm:get-configuration()\r\n        let $dbid := adm:database-get-id($config, \"bugDB6635\")\r\n        let $field-name := \"test\"\r\n        let $field := adm:database-field($field-name, fn:false())\r\n        let $c :=  adm:database-add-field($config, $dbid,  $field)\r\n        let $include := adm:database-included-element(\"\", \"bar\", 1.0, \"\", \"\", \"\")\r\n        let $c := adm:database-add-field-included-element($c,$dbid,\"test\",$include)\r\n        let $lexicon := adm:database-word-lexicon(\"http://marklogic.com/collation/codepoint\")\r\n        let $c := adm:database-add-field-word-lexicon($c,$dbid, $field-name,$lexicon)\r\n        let $lexicon := adm:database-word-lexicon(\"http://marklogic.com/collation/en/S1\")\r\n        let $c := adm:database-add-field-word-lexicon($c,$dbid, $field-name,$lexicon)\r\nreturn adm:save-configuration($c)\r\n\r\nActual Result: Name already exists\r\nExpected Result: Field should be added without any error", "samplequery":"", "sampledata":"", "version":"7.0-nightly", "tofixin":"7.0-ea1", "fixedin":"7.0-ea1", "platform":"all", "memory":"", "processors":"", "note":"", "subscribers":[{"username":"iagrawal", "name":"Isha Agrawal", "email":"iagrawal@marklogic.com"}, {"username":"gchinchwadkar", "name":"Gajanan Chinchwadkar", "email":"Gajanan.Chinchwadkar@marklogic.com"}], "attachments":[], "relationships":[{"type":"", "to":""}], "clones":[], "cloneOf":"", "support":{"headline":"", "supportDescription":"", "publishStatus":"Not Ready", "tickets":[], "customerImpact":{"level":"N/A", "title":""}, "workaround":""}, "tags":["xdmp", "iagrawal"], "changeHistory":[{"time":"2013-02-19T04:50:47.345112-08:00", "updatedBy":{"username":"iagrawal", "name":"Isha Agrawal", "email":"iagrawal@marklogic.com"}, "change":{"assignTo":{"from":{"username":"iagrawal", "name":"Isha Agrawal", "email":"iagrawal@marklogic.com"}, "to":{"username":"gchinchwadkar", "name":"Gajanan Chinchwadkar", "email":"Gajanan.Chinchwadkar@marklogic.com"}}}, "files":[], "show":true}, {"time":"2013-02-19T16:01:52.274991-08:00", "updatedBy":{"username":"gchinchwadkar", "name":"Gajanan Chinchwadkar", "email":"Gajanan.Chinchwadkar@marklogic.com"}, "change":{"status":{"from":"", "to":"Test"}, "assignTo":{"from":{"username":"gchinchwadkar", "name":"Gajanan Chinchwadkar", "email":"Gajanan.Chinchwadkar@marklogic.com"}, "to":{"username":"iagrawal", "name":"Isha Agrawal", "email":"iagrawal@marklogic.com"}}}, "files":[], "show":true, "comment":"I just backed-out a small enhancement from fields code. That fixed this."}, {"time":"2013-02-19T16:01:52.274991-08:00", "updatedBy":{"username":"gchinchwadkar", "name":"Gajanan Chinchwadkar", "email":"Gajanan.Chinchwadkar@marklogic.com"}, "change":{"assignTo":{"from":{"username":"gchinchwadkar", "name":"Gajanan Chinchwadkar", "email":"Gajanan.Chinchwadkar@marklogic.com"}, "to":{"username":"iagrawal", "name":"Isha Agrawal", "email":"iagrawal@marklogic.com"}}}, "files":[], "show":true}, {"time":"2013-02-20T03:11:36.65934-08:00", "updatedBy":{"username":"iagrawal", "name":"Isha Agrawal", "email":"iagrawal@marklogic.com"}, "change":{"status":{"from":"", "to":"Closed"}, "assignTo":{"from":{"username":"iagrawal", "name":"Isha Agrawal", "email":"iagrawal@marklogic.com"}, "to":{"username":"nobody", "name":"nobody nobody", "email":"nobody@marklogic.com"}}}, "files":[], "show":true, "comment":"As per above comment, the test bug6635.xml is passing now.Verified on ML Version 20130219-1800 sandbox run. Hence,closing the bug"}, {"time":"2013-02-20T03:11:36.65934-08:00", "updatedBy":{"username":"iagrawal", "name":"Isha Agrawal", "email":"iagrawal@marklogic.com"}, "change":{"assignTo":{"from":{"username":"iagrawal", "name":"Isha Agrawal", "email":"iagrawal@marklogic.com"}, "to":{"username":"nobody", "name":"nobody nobody", "email":"nobody@marklogic.com"}}}, "files":[], "show":true}], "updatedAt":"2013-02-20T03:11:36.65934-08:00", "fixedAt":"2013-02-19T16:01:52.274991-08:00", "fixedBy":{"username":"gchinchwadkar", "name":"Gajanan Chinchwadkar", "email":"Gajanan.Chinchwadkar@marklogic.com"}, "closedAt":"2013-02-20T03:11:36.65934-08:00", "closedBy":{"username":"iagrawal", "name":"Isha Agrawal", "email":"iagrawal@marklogic.com"}, "renderDescriptionAs":"normal"}
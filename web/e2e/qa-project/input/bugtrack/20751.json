{"id":20751, "kind":"Task", "createdAt":"2013-02-11T15:32:01.350334-08:00", "status":"Closed", "title":"Should be some way to get xdmp:plan style human-readable information from SQL MATCH clause", "category":"SQL", "severity":"Major", "priority":{"level":"5", "title":""}, "days":null, "period":{"startDate":null, "endDate":null}, "submittedBy":{"username":"mary", "name":"Mary Holstege", "email":"mary@cerisent.com"}, "assignTo":{"username":"nobody", "name":"nobody nobody", "email":"nobody@marklogic.com"}, "description":"Currently the trace event SQL Prepare will spit out a representation of the constraining query, but it only has keys in it. \r\nIt would be good to be able to get the same type of human readable rendering of the query that xdmp:plan gives.", "samplequery":"", "sampledata":"", "version":"7.0-nightly", "tofixin":"7.0-ea1", "fixedin":"7.0-ea1", "platform":"all", "memory":"", "processors":"", "note":"", "subscribers":[{"username":"mary", "name":"Mary Holstege", "email":"mary@cerisent.com"}, {"username":"rpolasani", "name":"Raghu Polasani", "email":"raghu.polasani@marklogic.com"}, {"username":"sthirumavalavan", "name":"Subhadra Thirumavalavan", "email":"subhadra.thirumavalavan@marklogic.com"}], "attachments":[], "includeInTaskList":false, "proceduralTasks":{"Requirements Task":[], "Functional Specification Task":[], "Test Specification Task":[], "Test Automation Task":[], "Documentation Task":[]}, "subTasks":[], "tags":["SQL", "mary"], "changeHistory":[{"time":"2013-02-11T15:32:01.350334-08:00", "updatedBy":{"username":"mary", "name":"Mary Holstege", "email":"mary@cerisent.com"}, "change":{"assignTo":{"from":{"username":"mary", "name":"Mary Holstege", "email":"mary@cerisent.com"}, "to":{"username":"mary", "name":"Mary Holstege", "email":"mary@cerisent.com"}}}, "files":[], "show":true}, {"time":"2013-02-14T17:34:18.595301-08:00", "updatedBy":{"username":"mary", "name":"Mary Holstege", "email":"mary@cerisent.com"}, "change":{}, "files":[], "show":true, "svn":{"repository":"/project/engsvn", "revision":"131844", "paths":["xdmp/trunk/src/RangeIndexes.cpp", "xdmp/trunk/src/SearchBuiltins.h", "xdmp/trunk/src/SQL.cpp", "xdmp/trunk/src/SearchBuiltins.cpp", "xdmp/trunk/src/View.cpp", "xdmp/trunk/src/Tree.h", "xdmp/trunk/src/GeospatialBuiltins.cpp", "xdmp/trunk/src/RangeIndexes.h", "xdmp/trunk/src/View.h", "xdmp/trunk/src/XQuery.cpp"], "affectedBugs":[]}, "comment":"Bug:20751 integrate plan improvements into SQL Prepare output"}, {"time":"2013-02-14T17:38:43.787783-08:00", "updatedBy":{"username":"mary", "name":"Mary Holstege", "email":"mary@cerisent.com"}, "change":{"status":{"from":"", "to":"Test"}, "assignTo":{"from":{"username":"mary", "name":"Mary Holstege", "email":"mary@cerisent.com"}, "to":{"username":"rpolasani", "name":"Raghu Polasani", "email":"raghu.polasani@marklogic.com"}}}, "files":[], "show":true, "comment":"Fixed 7.0-20130215\r\n\r\nI don't know if we need to test this per se. I don't think we test trace event output in general.  But moving to test just in case. \r\n\r\nWith this change, when you have SQL Prepare enabled, instead of getting the trace event style rendering of the constraining query, you'll get the annotated plan style rendering of the constraining query."}, {"time":"2013-02-14T17:38:43.787783-08:00", "updatedBy":{"username":"mary", "name":"Mary Holstege", "email":"mary@cerisent.com"}, "change":{"assignTo":{"from":{"username":"mary", "name":"Mary Holstege", "email":"mary@cerisent.com"}, "to":{"username":"rpolasani", "name":"Raghu Polasani", "email":"raghu.polasani@marklogic.com"}}}, "files":[], "show":true}, {"time":"2013-03-02T11:29:54.827676-08:00", "updatedBy":{"username":"rpolasani", "name":"Raghu Polasani", "email":"raghu.polasani@marklogic.com"}, "change":{"assignTo":{"from":{"username":"rpolasani", "name":"Raghu Polasani", "email":"raghu.polasani@marklogic.com"}, "to":{"username":"sthirumavalavan", "name":"Subhadra Thirumavalavan", "email":"subhadra.thirumavalavan@marklogic.com"}}}, "files":[], "show":true}, {"time":"2013-05-08T15:12:38.618419-07:00", "updatedBy":{"username":"sthirumavalavan", "name":"Subhadra Thirumavalavan", "email":"subhadra.thirumavalavan@marklogic.com"}, "change":{}, "files":[], "show":true, "comment":"2013-05-08 15:11:43.304 Info: [Event:id=SQL Prepare] key=0xb031b753cbb005d6 <qry:and-two-queries xmlns:qry=\"http://marklogic.com/cts/query\">\r\n2013-05-08 15:11:43.304 Info:   <qry:term-query weight=\"0\">\r\n2013-05-08 15:11:43.304 Info:     <qry:key>3834405825873964440</qry:key>\r\n2013-05-08 15:11:43.304 Info:     <qry:annotation>element(AllDataTypes)</qry:annotation>\r\n2013-05-08 15:11:43.304 Info:   </qry:term-query>\r\n2013-05-08 15:11:43.304 Info:   <qry:and-query>\r\n2013-05-08 15:11:43.304 Info:     <qry:term-query weight=\"0\">\r\n2013-05-08 15:11:43.304 Info:       <qry:key>14746794670567036969</qry:key>\r\n2013-05-08 15:11:43.304 Info:       <qry:annotation>element(col1_int)</qry:annotation>\r\n2013-05-08 15:11:43.304 Info:     </qry:term-query>\r\n2013-05-08 15:11:43.304 Info:     <qry:term-query weight=\"0\">\r\n2013-05-08 15:11:43.304 Info:       <qry:key>9056807392871945621</qry:key>\r\n2013-05-08 15:11:43.304 Info:       <qry:annotation>element(col2_unsignedInt)</qry:annotation>\r\n2013-05-08 15:11:43.304 Info:     </qry:term-query>\r\n2013-05-08 15:11:43.304 Info:     <qry:term-query weight=\"0\">\r\n2013-05-08 15:11:43.304 Info:       <qry:key>3685450271558850070</qry:key>\r\n2013-05-08 15:11:43.304 Info:       <qry:annotation>element(col3_date)</qry:annotation>\r\n2013-05-08 15:11:43.304 Info:     </qry:term-query>\r\n2013-05-08 15:11:43.304 Info:     <qry:term-query weight=\"0\">\r\n2013-05-08 15:11:43.304 Info:       <qry:key>17894821783040671233</qry:key>\r\n2013-05-08 15:11:43.304 Info:       <qry:annotation>element(col4_float)</qry:annotation>\r\n2013-05-08 15:11:43.304 Info:     </qry:term-query>\r\n2013-05-08 15:11:43.304 Info:     <qry:term-query weight=\"0\">\r\n2013-05-08 15:11:43.304 Info:       <qry:key>4599233465969326467</qry:key>\r\n2013-05-08 15:11:43.304 Info:       <qry:annotation>element(col5_decimal)</qry:annotation>\r\n2013-05-08 15:11:43.304 Info:     </qry:term-query>\r\n2013-05-08 15:11:43.304 Info:     <qry:term-query weight=\"0\">\r\n2013-05-08 15:11:43.304 Info:       <qry:key>7321790590565809615</qry:key>\r\n2013-05-08 15:11:43.304 Info:       <qry:annotation>element(col6_long)</qry:annotation>\r\n2013-05-08 15:11:43.304 Info:     </qry:term-query>\r\n2013-05-08 15:11:43.304 Info:     <qry:term-query weight=\"0\">\r\n2013-05-08 15:11:43.304 Info:       <qry:key>13935256579944844035</qry:key>\r\n2013-05-08 15:11:43.304 Info:       <qry:annotation>element(col7_unsignedLong)</qry:annotation>\r\n2013-05-08 15:11:43.304 Info:     </qry:term-query>\r\n2013-05-08 15:11:43.304 Info:     <qry:term-query weight=\"0\">\r\n2013-05-08 15:11:43.304 Info:       <qry:key>11901552683528268064</qry:key>\r\n2013-05-08 15:11:43.304 Info:       <qry:annotation>element(col8_double)</qry:annotation>\r\n2013-05-08 15:11:43.304 Info:     </qry:term-query>\r\n2013-05-08 15:11:43.304 Info:     <qry:term-query weight=\"0\">\r\n2013-05-08 15:11:43.304 Info:       <qry:key>11311050987614489737</qry:key>\r\n2013-05-08 15:11:43.304 Info:       <qry:annotation>element(col9_time)</qry:annotation>\r\n2013-05-08 15:11:43.304 Info:     </qry:term-query>\r\n2013-05-08 15:11:43.304 Info:     <qry:term-query weight=\"0\">\r\n2013-05-08 15:11:43.304 Info:       <qry:key>3051738631183262455</qry:key>\r\n2013-05-08 15:11:43.304 Info:       <qry:annotation>element(col10_dateTime)</qry:annotation>\r\n2013-05-08 15:11:43.304 Info:     </qry:term-query>\r\n2013-05-08 15:11:43.304 Info:     <qry:term-query weight=\"0\">\r\n2013-05-08 15:11:43.304 Info:       <qry:key>4040548384208208095</qry:key>\r\n2013-05-08 15:11:43.304 Info:       <qry:annotation>element(col11_gYear)</qry:annotation>\r\n2013-05-08 15:11:43.304 Info:     </qry:term-query>\r\n2013-05-08 15:11:43.304 Info:     <qry:term-query weight=\"0\">\r\n2013-05-08 15:11:43.304 Info:       <qry:key>6885753632918288452</qry:key>\r\n2013-05-08 15:11:43.304 Info:       <qry:annotation>element(col12_gYearMonth)</qry:annotation>\r\n2013-05-08 15:11:43.304 Info:     </qry:term-query>\r\n2013-05-08 15:11:43.304 Info:     <qry:term-query weight=\"0\">\r\n2013-05-08 15:11:43.304 Info:       <qry:key>11984550425194092440</qry:key>\r\n2013-05-08 15:11:43.304 Info:       <qry:annotation>element(col13_gMonth)</qry:annotation>\r\n2013-05-08 15:11:43.304 Info:     </qry:term-query>\r\n2013-05-08 15:11:43.304 Info:     <qry:term-query weight=\"0\">\r\n2013-05-08 15:11:43.304 Info:       <qry:key>310495898387650385</qry:key>\r\n2013-05-08 15:11:43.304 Info:       <qry:annotation>element(col14_gDay)</qry:annotation>\r\n2013-05-08 15:11:43.304 Info:     </qry:term-query>\r\n2013-05-08 15:11:43.304 Info:     <qry:term-query weight=\"0\">\r\n2013-05-08 15:11:43.304 Info:       <qry:key>327221946774960684</qry:key>\r\n2013-05-08 15:11:43.304 Info:       <qry:annotation>element(col15_yearMonthDuration)</qry:annotation>\r\n2013-05-08 15:11:43.304 Info:     </qry:term-query>\r\n2013-05-08 15:11:43.304 Info:     <qry:term-query weight=\"0\">\r\n2013-05-08 15:11:43.304 Info:       <qry:key>6916736928002286977</qry:key>\r\n2013-05-08 15:11:43.304 Info:       <qry:annotation>element(col16_dayTimeDuration)</qry:annotation>\r\n2013-05-08 15:11:43.304 Info:     </qry:term-query>\r\n2013-05-08 15:11:43.304 Info:     <qry:term-query weight=\"0\">\r\n2013-05-08 15:11:43.304 Info:       <qry:key>973777422857204833</qry:key>\r\n2013-05-08 15:11:43.304 Info:       <qry:annotation>element(col17_anyURI)</qry:annotation>\r\n2013-05-08 15:11:43.304 Info:     </qry:term-query>\r\n2013-05-08 15:11:43.304 Info:     <qry:term-query weight=\"0\">\r\n2013-05-08 15:11:43.304 Info:       <qry:key>4662061822003489361</qry:key>\r\n2013-05-08 15:11:43.304 Info:       <qry:annotation>element(col18_string)</qry:annotation>\r\n2013-05-08 15:11:43.304 Info:     </qry:term-query>\r\n2013-05-08 15:11:43.304 Info:   </qry:and-query>\r\n2013-05-08 15:11:43.304 Info: </qry:and-two-queries>\r\n2013-05-08 15:11:43.304 Info: [Event:id=SQL Prepare] tuples((col1_int[int]))\r\n2013-05-08 15:11:43.304 Info: [Event:id=SQL Prepare] cursor: view_ele tuples f=1 r=0 \r\n"}, {"time":"2013-05-08T15:15:49.984702-07:00", "updatedBy":{"username":"sthirumavalavan", "name":"Subhadra Thirumavalavan", "email":"subhadra.thirumavalavan@marklogic.com"}, "change":{}, "files":[], "show":true, "comment":"2013-05-08 15:14:50.405 Info: [Event:id=SQL Prepare] Select col18_string from view_ele where col18_string match 'string1'\r\n2013-05-08 15:14:50.405 Info: [Event:id=SQL Prepare] mlsBestIndex c[col18_string MATCH]@1  => [col18_string@1 omit]  cost=1 colmask=131072 [col18_string MATCH] \r\n2013-05-08 15:14:50.405 Info: [Event:id=SQL Prepare] colmask=131072 [col18_string MATCH] \r\n2013-05-08 15:14:50.405 Info: [Event:id=SQL Prepare] key=0x9b923895be7ac0b7 <qry:and-two-queries xmlns:qry=\"http://marklogic.com/cts/query\">\r\n2013-05-08 15:14:50.405 Info:   <qry:term-query weight=\"0\">\r\n2013-05-08 15:14:50.405 Info:     <qry:key>3834405825873964440</qry:key>\r\n2013-05-08 15:14:50.405 Info:     <qry:annotation>element(AllDataTypes)</qry:annotation>\r\n2013-05-08 15:14:50.405 Info:   </qry:term-query>\r\n2013-05-08 15:14:50.405 Info:   <qry:and-query>\r\n2013-05-08 15:14:50.405 Info:     <qry:or-two-queries>\r\n2013-05-08 15:14:50.405 Info:       <qry:term-query weight=\"1\">\r\n2013-05-08 15:14:50.405 Info: \t<qry:key>15699751344840727384</qry:key>\r\n2013-05-08 15:14:50.405 Info: \t<qry:annotation>element(col18_string,word(\"string1\"))</qry:annotation>\r\n2013-05-08 15:14:50.405 Info:       </qry:term-query>\r\n2013-05-08 15:14:50.405 Info:       <qry:and-two-queries>\r\n2013-05-08 15:14:50.405 Info: \t<qry:term-query weight=\"0\">\r\n2013-05-08 15:14:50.405 Info: \t  <qry:key>18081475384103226212</qry:key>\r\n2013-05-08 15:14:50.405 Info: \t</qry:term-query>\r\n2013-05-08 15:14:50.405 Info: \t<qry:term-query weight=\"1\">\r\n2013-05-08 15:14:50.405 Info: \t  <qry:key>7716986611159468568</qry:key>\r\n2013-05-08 15:14:50.405 Info: \t  <qry:annotation>word(\"string1\")</qry:annotation>\r\n2013-05-08 15:14:50.405 Info: \t</qry:term-query>\r\n2013-05-08 15:14:50.405 Info:       </qry:and-two-queries>\r\n2013-05-08 15:14:50.405 Info:     </qry:or-two-queries>\r\n2013-05-08 15:14:50.405 Info:     <qry:term-query weight=\"0\">\r\n2013-05-08 15:14:50.405 Info:       <qry:key>14746794670567036969</qry:key>\r\n2013-05-08 15:14:50.405 Info:       <qry:annotation>element(col1_int)</qry:annotation>\r\n2013-05-08 15:14:50.405 Info:     </qry:term-query>\r\n2013-05-08 15:14:50.405 Info:     <qry:term-query weight=\"0\">\r\n2013-05-08 15:14:50.405 Info:       <qry:key>9056807392871945621</qry:key>\r\n2013-05-08 15:14:50.405 Info:       <qry:annotation>element(col2_unsignedInt)</qry:annotation>\r\n2013-05-08 15:14:50.405 Info:     </qry:term-query>\r\n2013-05-08 15:14:50.405 Info:     <qry:term-query weight=\"0\">\r\n2013-05-08 15:14:50.405 Info:       <qry:key>3685450271558850070</qry:key>\r\n2013-05-08 15:14:50.405 Info:       <qry:annotation>element(col3_date)</qry:annotation>\r\n2013-05-08 15:14:50.405 Info:     </qry:term-query>\r\n2013-05-08 15:14:50.405 Info:     <qry:term-query weight=\"0\">\r\n2013-05-08 15:14:50.405 Info:       <qry:key>17894821783040671233</qry:key>\r\n2013-05-08 15:14:50.405 Info:       <qry:annotation>element(col4_float)</qry:annotation>\r\n2013-05-08 15:14:50.405 Info:     </qry:term-query>\r\n2013-05-08 15:14:50.405 Info:     <qry:term-query weight=\"0\">\r\n2013-05-08 15:14:50.405 Info:       <qry:key>4599233465969326467</qry:key>\r\n2013-05-08 15:14:50.405 Info:       <qry:annotation>element(col5_decimal)</qry:annotation>\r\n2013-05-08 15:14:50.405 Info:     </qry:term-query>\r\n2013-05-08 15:14:50.405 Info:     <qry:term-query weight=\"0\">\r\n2013-05-08 15:14:50.405 Info:       <qry:key>7321790590565809615</qry:key>\r\n2013-05-08 15:14:50.405 Info:       <qry:annotation>element(col6_long)</qry:annotation>\r\n2013-05-08 15:14:50.405 Info:     </qry:term-query>\r\n2013-05-08 15:14:50.405 Info:     <qry:term-query weight=\"0\">\r\n2013-05-08 15:14:50.405 Info:       <qry:key>13935256579944844035</qry:key>\r\n2013-05-08 15:14:50.405 Info:       <qry:annotation>element(col7_unsignedLong)</qry:annotation>\r\n2013-05-08 15:14:50.405 Info:     </qry:term-query>\r\n2013-05-08 15:14:50.405 Info:     <qry:term-query weight=\"0\">\r\n2013-05-08 15:14:50.405 Info:       <qry:key>11901552683528268064</qry:key>\r\n2013-05-08 15:14:50.405 Info:       <qry:annotation>element(col8_double)</qry:annotation>\r\n2013-05-08 15:14:50.405 Info:     </qry:term-query>\r\n2013-05-08 15:14:50.405 Info:     <qry:term-query weight=\"0\">\r\n2013-05-08 15:14:50.405 Info:       <qry:key>11311050987614489737</qry:key>\r\n2013-05-08 15:14:50.405 Info:       <qry:annotation>element(col9_time)</qry:annotation>\r\n2013-05-08 15:14:50.405 Info:     </qry:term-query>\r\n2013-05-08 15:14:50.405 Info:     <qry:term-query weight=\"0\">\r\n2013-05-08 15:14:50.405 Info:       <qry:key>3051738631183262455</qry:key>\r\n2013-05-08 15:14:50.405 Info:       <qry:annotation>element(col10_dateTime)</qry:annotation>\r\n2013-05-08 15:14:50.405 Info:     </qry:term-query>\r\n2013-05-08 15:14:50.405 Info:     <qry:term-query weight=\"0\">\r\n2013-05-08 15:14:50.405 Info:       <qry:key>4040548384208208095</qry:key>\r\n2013-05-08 15:14:50.405 Info:       <qry:annotation>element(col11_gYear)</qry:annotation>\r\n2013-05-08 15:14:50.405 Info:     </qry:term-query>\r\n2013-05-08 15:14:50.405 Info:     <qry:term-query weight=\"0\">\r\n2013-05-08 15:14:50.405 Info:       <qry:key>6885753632918288452</qry:key>\r\n2013-05-08 15:14:50.405 Info:       <qry:annotation>element(col12_gYearMonth)</qry:annotation>\r\n2013-05-08 15:14:50.405 Info:     </qry:term-query>\r\n2013-05-08 15:14:50.405 Info:     <qry:term-query weight=\"0\">\r\n2013-05-08 15:14:50.405 Info:       <qry:key>11984550425194092440</qry:key>\r\n2013-05-08 15:14:50.405 Info:       <qry:annotation>element(col13_gMonth)</qry:annotation>\r\n2013-05-08 15:14:50.405 Info:     </qry:term-query>\r\n2013-05-08 15:14:50.405 Info:     <qry:term-query weight=\"0\">\r\n2013-05-08 15:14:50.405 Info:       <qry:key>310495898387650385</qry:key>\r\n2013-05-08 15:14:50.405 Info:       <qry:annotation>element(col14_gDay)</qry:annotation>\r\n2013-05-08 15:14:50.405 Info:     </qry:term-query>\r\n2013-05-08 15:14:50.405 Info:     <qry:term-query weight=\"0\">\r\n2013-05-08 15:14:50.405 Info:       <qry:key>327221946774960684</qry:key>\r\n2013-05-08 15:14:50.405 Info:       <qry:annotation>element(col15_yearMonthDuration)</qry:annotation>\r\n2013-05-08 15:14:50.405 Info:     </qry:term-query>\r\n2013-05-08 15:14:50.405 Info:     <qry:term-query weight=\"0\">\r\n2013-05-08 15:14:50.405 Info:       <qry:key>6916736928002286977</qry:key>\r\n2013-05-08 15:14:50.405 Info:       <qry:annotation>element(col16_dayTimeDuration)</qry:annotation>\r\n2013-05-08 15:14:50.405 Info:     </qry:term-query>\r\n2013-05-08 15:14:50.405 Info:     <qry:term-query weight=\"0\">\r\n2013-05-08 15:14:50.405 Info:       <qry:key>973777422857204833</qry:key>\r\n2013-05-08 15:14:50.405 Info:       <qry:annotation>element(col17_anyURI)</qry:annotation>\r\n2013-05-08 15:14:50.405 Info:     </qry:term-query>\r\n2013-05-08 15:14:50.405 Info:     <qry:term-query weight=\"0\">\r\n2013-05-08 15:14:50.405 Info:       <qry:key>4662061822003489361</qry:key>\r\n2013-05-08 15:14:50.405 Info:       <qry:annotation>element(col18_string)</qry:annotation>\r\n2013-05-08 15:14:50.405 Info:     </qry:term-query>\r\n2013-05-08 15:14:50.405 Info:   </qry:and-query>\r\n2013-05-08 15:14:50.405 Info: </qry:and-two-queries>\r\n2013-05-08 15:14:50.405 Info: [Event:id=SQL Prepare] tuples((col18_string[string]))\r\n2013-05-08 15:14:50.406 Info: [Event:id=SQL Prepare] cursor: view_ele tuples f=1 r=0 \r\n"}, {"time":"2013-05-08T15:16:08.140189-07:00", "updatedBy":{"username":"sthirumavalavan", "name":"Subhadra Thirumavalavan", "email":"subhadra.thirumavalavan@marklogic.com"}, "change":{"status":{"from":null, "to":"Ship"}, "assignTo":{"from":{"username":"sthirumavalavan", "name":"Subhadra Thirumavalavan", "email":"subhadra.thirumavalavan@marklogic.com"}, "to":{"username":"nobody", "name":"nobody nobody", "email":"nobody@marklogic.com"}}}, "files":[], "show":true}, {"time":"2013-05-08T15:16:08.140189-07:00", "updatedBy":{"username":"sthirumavalavan", "name":"Subhadra Thirumavalavan", "email":"subhadra.thirumavalavan@marklogic.com"}, "change":{"assignTo":{"from":{"username":"sthirumavalavan", "name":"Subhadra Thirumavalavan", "email":"subhadra.thirumavalavan@marklogic.com"}, "to":{"username":"nobody", "name":"nobody nobody", "email":"nobody@marklogic.com"}}}, "files":[], "show":true}], "updatedAt":"2013-05-08T15:16:08.140189-07:00", "fixedAt":"2013-02-14T17:38:43.787783-08:00", "fixedBy":{"username":"mary", "name":"Mary Holstege", "email":"mary@cerisent.com"}, "shippedAt":"2013-05-08T15:16:08.140189-07:00", "shippedBy":{"username":"sthirumavalavan", "name":"Subhadra Thirumavalavan", "email":"subhadra.thirumavalavan@marklogic.com"}}
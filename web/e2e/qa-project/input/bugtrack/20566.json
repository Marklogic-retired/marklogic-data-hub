{"id":20566, "kind":"Bug", "createdAt":"2013-01-13T20:50:59.208797-08:00", "status":"Closed", "title":"Too much BinaryManager::decrementBinaryRefCount error in the logs", "category":"", "severity":"Minor", "priority":{"level":"5", "title":""}, "submittedBy":{"username":"dchander", "name":"Dinesh Chander", "email":"dinesh.chander@globallogic.com"}, "assignTo":{"username":"nobody", "name":"nobody nobody", "email":"nobody@marklogic.com"}, "description":"Reported by user in case #12137\r\n----------------------------------------------------------------------------------------------------------------------------------------------\r\n\r\nAttaching the ErrorLogs provided by the user. There seems to be a lot of BinaryManager::decrementBinaryRefCount error messages in the logs. It appears that the corresponding files does exist in the the system so the messages seems to be extra noise. We may need to reduce the log level on certain conditions.", "samplequery":"", "sampledata":"", "version":"7.0-nightly", "tofixin":"7.0-1", "fixedin":"7.0-1", "platform":"all", "memory":"", "processors":"", "note":"", "subscribers":[{"username":"dchander", "name":"Dinesh Chander", "email":"dinesh.chander@globallogic.com"}, {"username":"hwu", "name":"Haitao Wu", "email":"haitao.wu@marklogic.com"}, {"username":"msrinivasan", "name":"Mahalakshmi Srinivasan", "email":"mahalakshmi.srinivasan@marklogic.com"}], "attachments":[{"name":"ErrorLogs with Binary RefCounting trace event enabled", "uri":"root/support/bugtracking/attachments/20446/ErrorLogs.zip"}], "relationships":[{"type":"", "to":""}], "clones":[], "cloneOf":20565, "support":{"headline":"Too many BinaryManager::decrementBinaryRefCount errors in the logs", "supportDescription":"BinaryManager::decrementBinaryRefCount errors in the logs is noisy. These messages should be logged at a lower level (WARNING instead of ERROR).", "publishStatus":"Publish", "tickets":[], "customerImpact":{"level":"Low", "title":"Minimal business impact or reasonable workaround is available"}, "workaround":""}, "tags":["", "dchander"], "changeHistory":[{"time":"2013-01-13T20:50:59.208797-08:00", "updatedBy":{"username":"dchander", "name":"Dinesh Chander", "email":"dinesh.chander@globallogic.com"}, "change":{"assignTo":{"from":{"username":"dchander", "name":"Dinesh Chander", "email":"dinesh.chander@globallogic.com"}, "to":{"username":"hwu", "name":"Haitao Wu", "email":"haitao.wu@marklogic.com"}}}, "files":[], "show":true}, {"time":"2013-01-13T20:52:13.662068-08:00", "updatedBy":{"username":"hwu", "name":"Haitao Wu", "email":"haitao.wu@marklogic.com"}, "change":{"tofixin":{"from":"", "to":"5.0-5"}}, "files":[], "show":true}, {"time":"2013-01-14T11:48:34.064107-08:00", "updatedBy":{"username":"rpelton", "name":"Rick Pelton", "email":"rick.pelton@marklogic.com"}, "change":{}, "files":[], "show":true, "comment":"Is this really a bug?  Trace events are not supposed to be left on for extended periods of time.  Just for Debugging an issue."}, {"time":"2013-01-14T13:25:12.110295-08:00", "updatedBy":{"username":"hwu", "name":"Haitao Wu", "email":"haitao.wu@marklogic.com"}, "change":{}, "files":[], "show":true, "comment":"The error message is not a trace event in this case. It is an Error level log.  The support case suggests that sometime it should be logged at a lower level. I just need to figure out when this should be logged as Error and when as INFO or FINE."}, {"time":"2013-01-15T17:05:54.607635-08:00", "updatedBy":{"username":"hwu", "name":"Haitao Wu", "email":"haitao.wu@marklogic.com"}, "change":{}, "files":[], "show":true, "comment":"The log doesn't seem complete. For example, the first Error message is about the large binary with ID = 166d1a0f9ae7b25f.  A grep on the log file lists only two lines:\r\n\r\n[hwu@hwu Bug20446]$ grep 166d1a0f9ae7b25f BinaryManager-log-mrk3.txt \r\n2012-12-13 18:04:47.688 Error: BinaryManager::decrementBinaryRefCount  forest=XXX-mrk3-3, path=/data/MARKlogic/Forests/XXX-mrk3-3/Large/059/166d1a0f9ae7b25f\r\n2012-12-13 18:14:15.562 Info: [Event:id=Binary RefCounting] BinaryManager::incrementBinaryRefCount  forest=XXX-mrk3-3, path=/data/MARKlogic/Forests/XXX-mrk3-3/Large/059/166d1a0f9ae7b25f, caller=Stand::Stand\r\n\r\nThe first line is reported from a Stand destructor. There should be trace events about the same binary printed before that.\r\n\r\nDinesh, could you ask Mark run a grep for string \"166d1a0f9ae7b25f\" on all the ErrorLog files on that box and upload the output? "}, {"time":"2013-01-22T19:43:20.566173-08:00", "updatedBy":{"username":"dchander", "name":"Dinesh Chander", "email":"dinesh.chander@globallogic.com"}, "change":{}, "files":[], "show":true, "comment":"Hi Haitao,\r\n\r\nMark has provided us the requested information. I am copying the same below.\r\n\r\n---------------------------------------------------------------\r\nI grepped the logs on that box, here's a rough transcription of those 5 log messages:\r\n\r\nErrorLog_1.txt:2013-01-21 23:37:04.233 Error: BinaryManager::decrementBinaryRefCount forest=XXX-mrk3-3, path=/data/MARKlogic/Forests/XXX-mrk3-3/Large/059/166d1a0f9ae7b25f\r\nErrorLog_34.txt:2012-12-19 01:07:34.778 Info: [Event:id=Binary RefCounting] BinaryManager::incrementBinaryRefCount forest=XXX=mrk3-3, path=/data/MARKlogic/Forests/XXX-mrk3-3/Large/059/166d1a0f9ae7b25f, caller=Stand::Stand\r\nErrorLog_34.txt:2012-12-19 06:37:58.105 Info: [Event:id=Binary RefCounting] BinaryManager::decrementBinaryRefCount count=2, forest=XXX=mrk3-3, forestState=6, path=/data/MARKlogic/Forests/XXX-mrk3-3/Large/059/166d1a0f9ae7b25f, caller=Stand::~Stand\r\nErrorLog_40.txt:2012-12-13 18:04:47.688 Error: BinaryManager::decrementBinaryRefCount forest=XXX-mrk3-3, path=/data/MARKlogic/Forests/XXX-mrk3-3/Large/059/166d1a0f9ae7b25f\r\nErrorLog_40.txt:2012-12-13 18:14:15.562 Info: [Event:id=Binary RefCounting] BinaryManager::incrementBinaryRefCount forest=XXX-mrk3-3, path=/data/MARKlogic/Forests/XXX-mrk3-3/Large/059/166d1a0f9ae7b25f, caller=Stand::Stand\r\n---------------------------------------------------------------\r\n\r\nThanks,\r\nDinesh Chander"}, {"time":"2013-01-23T11:30:44.880804-08:00", "updatedBy":{"username":"hwu", "name":"Haitao Wu", "email":"haitao.wu@marklogic.com"}, "change":{}, "files":[], "show":true, "comment":"Unfortunately, this info still appears incomplete. The very first log (at 2012-12-13 18:04) is also from a Stand destructor.    And the second latest one (at 2012-12-19 06:37) suggests the ref count was 2 (before the decrementBinaryRefCount call). But the latest one (at 2013-01-21 23:37) suggests the ref count was already 0.  Did Mark turn off the trace event between 2012-12-19 and 2013-01-21?"}, {"time":"2013-01-23T11:45:08.287115-08:00", "updatedBy":{"username":"hwu", "name":"Haitao Wu", "email":"haitao.wu@marklogic.com"}, "change":{}, "files":[], "show":true, "svn":{"repository":"/project/engsvn", "revision":"129011", "paths":["xdmp/branches/b5_0/src/Stand.cpp"], "affectedBugs":[]}, "comment":"bug:20446 Too much BinaryManager::decrementBinaryRefCount error in the logs"}, {"time":"2013-01-23T11:48:47.089812-08:00", "updatedBy":{"username":"hwu", "name":"Haitao Wu", "email":"haitao.wu@marklogic.com"}, "change":{"tofixin":{"from":"", "to":"7.0-ea1"}}, "files":[], "show":true}, {"time":"2013-01-23T12:53:35.607285-08:00", "updatedBy":{"username":"hwu", "name":"Haitao Wu", "email":"haitao.wu@marklogic.com"}, "change":{}, "files":[], "show":true, "svn":{"repository":"/project/engsvn", "revision":"129022", "paths":["xdmp/trunk/src/Stand.cpp"], "affectedBugs":[]}, "comment":"bug:20566 Too much BinaryManager::decrementBinaryRefCount error in the logs"}, {"time":"2013-01-23T12:58:38.747614-08:00", "updatedBy":{"username":"hwu", "name":"Haitao Wu", "email":"haitao.wu@marklogic.com"}, "change":{"status":{"from":"", "to":"Test"}, "assignTo":{"from":{"username":"hwu", "name":"Haitao Wu", "email":"haitao.wu@marklogic.com"}, "to":{"username":"msrinivasan", "name":"Mahalakshmi Srinivasan", "email":"mahalakshmi.srinivasan@marklogic.com"}}}, "files":[], "show":true, "comment":"log level change; no additional test case is required."}, {"time":"2013-01-23T12:58:38.747614-08:00", "updatedBy":{"username":"hwu", "name":"Haitao Wu", "email":"haitao.wu@marklogic.com"}, "change":{"assignTo":{"from":{"username":"hwu", "name":"Haitao Wu", "email":"haitao.wu@marklogic.com"}, "to":{"username":"msrinivasan", "name":"Mahalakshmi Srinivasan", "email":"mahalakshmi.srinivasan@marklogic.com"}}}, "files":[], "show":true}, {"time":"2013-02-20T15:04:13.169706-08:00", "updatedBy":{"username":"msrinivasan", "name":"Mahalakshmi Srinivasan", "email":"mahalakshmi.srinivasan@marklogic.com"}, "change":{"status":{"from":"", "to":"Ship"}, "assignTo":{"from":{"username":"msrinivasan", "name":"Mahalakshmi Srinivasan", "email":"mahalakshmi.srinivasan@marklogic.com"}, "to":{"username":"nobody", "name":"nobody nobody", "email":"nobody@marklogic.com"}}}, "files":[], "show":true, "comment":"Moving to 'ship' as per Haitao's comments."}], "updatedAt":"2013-02-20T15:04:13.169706-08:00", "fixedAt":"2013-01-23T12:58:38.747614-08:00", "fixedBy":{"username":"hwu", "name":"Haitao Wu", "email":"haitao.wu@marklogic.com"}, "shippedAt":"2013-02-20T15:04:13.169706-08:00", "shippedBy":{"username":"msrinivasan", "name":"Mahalakshmi Srinivasan", "email":"mahalakshmi.srinivasan@marklogic.com"}, "renderDescriptionAs":"normal"}
{"id":20853, "kind":"Bug", "createdAt":"2013-02-20T13:36:16.013073-08:00", "status":"Closed", "title":"Having * before and at the beginning of a predicate does not include the path range index in xdmp:plan()", "category":"xdmp", "severity":"Minor", "priority":{"level":"5", "title":""}, "submittedBy":{"username":"msrinivasan", "name":"Mahalakshmi Srinivasan", "email":"mahalakshmi.srinivasan@marklogic.com"}, "assignTo":{"username":"nobody", "name":"nobody nobody", "email":"nobody@marklogic.com"}, "description":"MarkLogic Version 7.0-20130220\r\n\r\n1. Create a path range index: /w/*/*/z\r\n2. Run the query: xdmp:plan(/w/*[*/z='5'])\r\n\r\nThis does not include 'Comparison contributed string range value constraint: /w/*/*/z = \"5\"'. \r\n\r\nThis was discovered in query-opt-negative.xml Test 6c while validating the fix for bug 18756.\r\nGajanan, can you please move it to EA2 if you feel it's not urgent to be fixed in EA1?", "samplequery":"", "sampledata":"", "version":"7.0-nightly", "tofixin":"7.0-ea2", "fixedin":"7.0-ea2", "platform":"all", "memory":"", "processors":"", "note":"", "subscribers":[{"username":"msrinivasan", "name":"Mahalakshmi Srinivasan", "email":"mahalakshmi.srinivasan@marklogic.com"}, {"username":"gchinchwadkar", "name":"Gajanan Chinchwadkar", "email":"Gajanan.Chinchwadkar@marklogic.com"}], "attachments":[], "relationships":[{"type":"", "to":""}], "clones":[21258], "cloneOf":"", "support":{"headline":"", "supportDescription":"", "publishStatus":"Not Ready", "tickets":[], "customerImpact":{"level":"N/A", "title":""}, "workaround":""}, "tags":["xdmp", "msrinivasan"], "changeHistory":[{"time":"2013-02-20T13:36:16.013073-08:00", "updatedBy":{"username":"msrinivasan", "name":"Mahalakshmi Srinivasan", "email":"mahalakshmi.srinivasan@marklogic.com"}, "change":{"assignTo":{"from":{"username":"msrinivasan", "name":"Mahalakshmi Srinivasan", "email":"mahalakshmi.srinivasan@marklogic.com"}, "to":{"username":"gchinchwadkar", "name":"Gajanan Chinchwadkar", "email":"Gajanan.Chinchwadkar@marklogic.com"}}}, "files":[], "show":true}, {"time":"2013-02-20T13:38:43.929452-08:00", "updatedBy":{"username":"gchinchwadkar", "name":"Gajanan Chinchwadkar", "email":"Gajanan.Chinchwadkar@marklogic.com"}, "change":{}, "files":[], "show":true, "comment":"This can wait until 7.0 EA2."}, {"time":"2013-02-20T13:38:43.929452-08:00", "updatedBy":{"username":"gchinchwadkar", "name":"Gajanan Chinchwadkar", "email":"Gajanan.Chinchwadkar@marklogic.com"}, "change":{"tofixin":{"from":"7.0-ea1", "to":"7.0-ea2"}}, "files":[], "show":true}, {"time":"2013-03-01T17:21:58.708547-08:00", "updatedBy":{"username":"gchinchwadkar", "name":"Gajanan Chinchwadkar", "email":"Gajanan.Chinchwadkar@marklogic.com"}, "change":{"tofixin":{"from":"7.0-ea2", "to":"7.0-1"}}, "files":[], "show":true}, {"time":"2013-03-06T09:04:30.792386-08:00", "updatedBy":{"username":"gchinchwadkar", "name":"Gajanan Chinchwadkar", "email":"Gajanan.Chinchwadkar@marklogic.com"}, "change":{"tofixin":{"from":"7.0-1", "to":"7.0-ea2"}}, "files":[], "show":true}, {"time":"2013-03-15T11:56:04.013188-07:00", "updatedBy":{"username":"gchinchwadkar", "name":"Gajanan Chinchwadkar", "email":"Gajanan.Chinchwadkar@marklogic.com"}, "change":{}, "files":[], "show":true, "svn":{"repository":"/project/engsvn", "revision":"136885", "paths":["xdmp/trunk/src/XQuery.cpp"], "affectedBugs":[]}, "comment":"Fix for bug:20853.\n"}, {"time":"2013-03-15T12:25:19.685687-07:00", "updatedBy":{"username":"gchinchwadkar", "name":"Gajanan Chinchwadkar", "email":"Gajanan.Chinchwadkar@marklogic.com"}, "change":{}, "files":[], "show":true, "comment":"This bug is a can of worms. I just fixed a small set of cases but there are many other cases which need to be separately tested and filed as multiple bugs.\r\n\r\nThe following cases are working after this fix:\r\n1. xdmp:plan(/w/*/*[z='5'])/*:info-trace[9]\r\n2. xdmp:plan(/w/*[*/z='bletch']/k)/*:info-trace[9]\r\n3. xdmp:plan(/w/*[*//z=\"bletch\"])/*:info-trace[8]\r\n4. xdmp:plan(/w/*[*/z=\"bletch\"])/*:info-trace[8]\r\n5. xdmp:plan(/w/*[*/z=\"bletch\"]/k)/*:info-trace[9]\r\n\r\nFor case (3) the index should also have //z in the path.\r\n\r\nThe cases/situations that need to be tested and fixed individually are:\r\n6, xdmp:plan(/w/*/*[z=\"bletch\"]/k)\r\n7. The index can have have partial wildcards: for example, /w/*:p/*/z or /w/ml:*/p/z. In that case the queries having exactly the same kind of wild-card and the those that do not have wild-cards should be optimized.\r\n8. Attribute paths with child and descendant axes should be optimized.\r\n9. XQuery versions of all these queries should be optimized.\r\n\r\nThe query optimizations can be fixed only in major releases. So we should fix as many of these as possible in 7.0.1. Otherwise, they will get deferred to 8.0.1. I would suggest a common pattern of bug title for all these bugs: \"Optimize query XXXX with index YYYY\". That helps us in tracking that these are really not the bugs in conventional sense. Rather, these are small tasks for optimization."}, {"time":"2013-03-15T12:25:19.685687-07:00", "updatedBy":{"username":"gchinchwadkar", "name":"Gajanan Chinchwadkar", "email":"Gajanan.Chinchwadkar@marklogic.com"}, "change":{"status":{"from":"", "to":"Test"}, "assignTo":{"from":{"username":"gchinchwadkar", "name":"Gajanan Chinchwadkar", "email":"Gajanan.Chinchwadkar@marklogic.com"}, "to":{"username":"msrinivasan", "name":"Mahalakshmi Srinivasan", "email":"mahalakshmi.srinivasan@marklogic.com"}}}, "files":[], "show":true}, {"time":"2013-03-15T12:25:19.685687-07:00", "updatedBy":{"username":"gchinchwadkar", "name":"Gajanan Chinchwadkar", "email":"Gajanan.Chinchwadkar@marklogic.com"}, "change":{"assignTo":{"from":{"username":"gchinchwadkar", "name":"Gajanan Chinchwadkar", "email":"Gajanan.Chinchwadkar@marklogic.com"}, "to":{"username":"msrinivasan", "name":"Mahalakshmi Srinivasan", "email":"mahalakshmi.srinivasan@marklogic.com"}}}, "files":[], "show":true}, {"time":"2013-03-15T21:06:39.35775-07:00", "updatedBy":{"username":"gchinchwadkar", "name":"Gajanan Chinchwadkar", "email":"Gajanan.Chinchwadkar@marklogic.com"}, "change":{}, "files":[], "show":true, "svn":{"repository":"/project/engsvn", "revision":"136942", "paths":["xdmp/trunk/src/XQuery.cpp"], "affectedBugs":[]}, "comment":"Bug:20853.\n"}, {"time":"2013-05-10T16:03:03.318512-07:00", "updatedBy":{"username":"msrinivasan", "name":"Mahalakshmi Srinivasan", "email":"mahalakshmi.srinivasan@marklogic.com"}, "change":{"status":{"from":"", "to":"Ship"}, "assignTo":{"from":{"username":"msrinivasan", "name":"Mahalakshmi Srinivasan", "email":"mahalakshmi.srinivasan@marklogic.com"}, "to":{"username":"nobody", "name":"nobody nobody", "email":"nobody@marklogic.com"}}}, "files":[], "show":true, "comment":"Verified on build 7.0-20130510. Filed a separate bug for one specific case 22033."}], "updatedAt":"2013-05-10T16:03:03.318512-07:00", "fixedAt":"2013-03-15T12:25:19.685687-07:00", "fixedBy":{"username":"gchinchwadkar", "name":"Gajanan Chinchwadkar", "email":"Gajanan.Chinchwadkar@marklogic.com"}, "shippedAt":"2013-05-10T16:03:03.318512-07:00", "shippedBy":{"username":"msrinivasan", "name":"Mahalakshmi Srinivasan", "email":"mahalakshmi.srinivasan@marklogic.com"}, "renderDescriptionAs":"normal"}
{"id":20664, "kind":"Task", "createdAt":"2013-01-31T10:16:48.143999-08:00", "status":"Will not fix", "title":"schema_msft test || subtest wildZ007 in test-suite Wildcards_w3c is failing because of test-issues", "category":"Validation", "severity":"Minor", "priority":{"level":"2", "title":"Not required for product release"}, "days":null, "period":{"startDate":null, "endDate":null}, "submittedBy":{"username":"sverma", "name":"Shiva Verma", "email":"shiva.verma@marklogic.com"}, "assignTo":{"username":"nobody", "name":"nobody nobody", "email":"nobody@marklogic.com"}, "description":"\r\n\r\nThe subtest wildZ007 is failing with different errors on single node and cluster:\r\n\r\n==============================\r\nError on Single Node(inux-64): \r\n==============================\r\n<error:error xsi:schemaLocation=\"http://marklogic.com/xdmp/error error.xsd\" xmlns:error=\"http://marklogic.com/xdmp/error\" xmlns:xsi=\"http://www.w3.org/2001/XMLSchema-instance\">\r\n  <error:code>XDMP-VALIDATEUNEXPECTED</error:code>\r\n  <error:name>err:XQDY0027</error:name>\r\n  <error:xquery-version>1.0-ml</error:xquery-version>\r\n  <error:message>Invalid node</error:message>\r\n  <error:format-string>XDMP-VALIDATEUNEXPECTED: (err:XQDY0027) validate strict { $doc } -- Invalid node: Found @default-validation but expected () at fn:doc(\"/msData/wildcards/wildZ007.xml\")/*:stylesheet/@default-validation using schema \"/msData/wildcards/wildZ007.xsd\"</error:format-string>\r\n  <error:retryable>false</error:retryable>\r\n  <error:expr>validate strict { $doc }</error:expr>\r\n  <error:data>\r\n    <error:datum>@default-validation</error:datum>\r\n    <error:datum>()</error:datum>\r\n    <error:datum>fn:doc(\"/msData/wildcards/wildZ007.xml\")/*:stylesheet/@default-validation</error:datum>\r\n    <error:datum>\"/msData/wildcards/wildZ007.xsd\"</error:datum>\r\n  </error:data>\r\n  <error:stack>\r\n    <error:frame>\r\n      <error:line>4</error:line>\r\n      <error:column>0</error:column>\r\n      <error:operation>xdmp:eval(\"let $doc :=  doc(&amp;quot;/msData/wildcards/wildZ007.xml&amp;quot;)&amp;#10...\", (), &lt;options xmlns=\"xdmp:eval\"&gt;&lt;database&gt;1577673016644628879&lt;/database&gt;&lt;root&gt;/opt/MarkLogic/qa&lt;...&lt;/options&gt;)</error:operation>\r\n      <error:variables>\r\n\t<error:variable>\r\n\t  <error:name xmlns=\"\">doc</error:name>\r\n\t  <error:value>fn:doc(\"/msData/wildcards/wildZ007.xml\")</error:value>\r\n\t</error:variable>\r\n      </error:variables>\r\n      <error:xquery-version>1.0-ml</error:xquery-version>\r\n    </error:frame>\r\n    <error:frame>\r\n      <error:uri>/MarkLogic/appservices/qconsole/qconsole-amped.xqy</error:uri>\r\n      <error:line>171</error:line>\r\n      <error:column>4</error:column>\r\n      <error:operation>amped-qconsole:qconsole-eval(fn:doc(\"/queries/6728034590150957829.txt\"), (), &lt;options xmlns=\"xdmp:eval\"&gt;&lt;database&gt;1577673016644628879&lt;/database&gt;&lt;root&gt;/opt/MarkLogic/qa&lt;...&lt;/options&gt;)</error:operation>\r\n      <error:variables>\r\n\t<error:variable>\r\n\t  <error:name xmlns=\"http://marklogic.com/appservices/qconsole/util-amped\">xquery</error:name>\r\n\t  <error:value>\"let $doc :=  doc(&amp;quot;/msData/wildcards/wildZ007.xml&amp;quot;)&amp;#10...\"</error:value>\r\n\t</error:variable>\r\n\t<error:variable>\r\n\t  <error:name xmlns=\"http://marklogic.com/appservices/qconsole/util-amped\">vars</error:name>\r\n\t  <error:value>()</error:value>\r\n\t</error:variable>\r\n\t<error:variable>\r\n\t  <error:name xmlns=\"http://marklogic.com/appservices/qconsole/util-amped\">options</error:name>\r\n\t  <error:value>&lt;options xmlns=\"xdmp:eval\"&gt;&lt;database&gt;1577673016644628879&lt;/database&gt;&lt;root&gt;/opt/MarkLogic/qa&lt;...&lt;/options&gt;</error:value>\r\n\t</error:variable>\r\n      </error:variables>\r\n      <error:xquery-version>1.0-ml</error:xquery-version>\r\n    </error:frame>\r\n    <error:frame>\r\n      <error:uri>/qconsole/endpoints/eval.xqy</error:uri>\r\n      <error:line>314</error:line>\r\n      <error:column>29</error:column>\r\n      <error:variables>\r\n\t<error:variable>\r\n\t  <error:name xmlns=\"\">http-opts</error:name>\r\n\t  <error:value>&lt;rest:request xmlns:rest=\"http://marklogic.com/appservices/rest\"&gt;&lt;rest:param name=\"sid\" as=\"unsignedLong\"/&gt;&lt;rest:param name=\"dbid...&lt;/rest:request&gt;</error:value>\r\n\t</error:variable>\r\n\t<error:variable>\r\n\t  <error:name xmlns=\"\">set</error:name>\r\n\t  <error:value>()</error:value>\r\n\t</error:variable>\r\n\t<error:variable>\r\n\t  <error:name xmlns=\"\">params-map</error:name>\r\n\t  <error:value>map:map(&lt;map:map xmlns:xs=\"http://www.w3.org/2001/XMLSchema\" xmlns:xsi=\"http://www.w3.org/2001/XMLSchema-instance\" xmlns:map=\"http://marklogic.com/xdmp/map\"&gt;&lt;map:entry key=\"sid\"&gt;&lt;map:value xsi:type=\"xs:unsignedLong\"&gt;74588...&lt;/map:map&gt;)</error:value>\r\n\t</error:variable>\r\n\t<error:variable>\r\n\t  <error:name xmlns=\"\">result-type</error:name>\r\n\t  <error:value>\"xml\"</error:value>\r\n\t</error:variable>\r\n\t<error:variable>\r\n\t  <error:name xmlns=\"\">query-text</error:name>\r\n\t  <error:value>()</error:value>\r\n\t</error:variable>\r\n\t<error:variable>\r\n\t  <error:name xmlns=\"\">qid</error:name>\r\n\t  <error:value>xs:unsignedLong(\"6728034590150957829\")</error:value>\r\n\t</error:variable>\r\n\t<error:variable>\r\n\t  <error:name xmlns=\"\">sid</error:name>\r\n\t  <error:value>xs:unsignedLong(\"7458838668107463905\")</error:value>\r\n\t</error:variable>\r\n\t<error:variable>\r\n\t  <error:name xmlns=\"\">dbid</error:name>\r\n\t  <error:value>()</error:value>\r\n\t</error:variable>\r\n\t<error:variable>\r\n\t  <error:name xmlns=\"\">query</error:name>\r\n\t  <error:value>fn:doc(\"/queries/6728034590150957829.txt\")</error:value>\r\n\t</error:variable>\r\n\t<error:variable>\r\n\t  <error:name xmlns=\"\">profiling-allowed</error:name>\r\n\t  <error:value>fn:true()</error:value>\r\n\t</error:variable>\r\n\t<error:variable>\r\n\t  <error:name xmlns=\"\">options</error:name>\r\n\t  <error:value>&lt;options xmlns=\"xdmp:eval\"&gt;&lt;database&gt;1577673016644628879&lt;/database&gt;&lt;root&gt;/opt/MarkLogic/qa&lt;...&lt;/options&gt;</error:value>\r\n\t</error:variable>\r\n      </error:variables>\r\n      <error:xquery-version>1.0-ml</error:xquery-version>\r\n    </error:frame>\r\n  </error:stack>\r\n</error:error>\r\n\r\n==============================\r\nError on a 3-node cluster(linux-64)\r\n==============================\r\n<error:error xmlns:error=\"http://marklogic.com/xdmp/error\" xmlns:xsi=\"http://www.w3.org/2001/XMLSchema-instance\" xsi:schemaLocation=\"http://marklogic.com/xdmp/error error.xsd\">\r\n    <error:code>XDMP-LEXVAL</error:code>\r\n    <error:name/>\r\n    <error:xquery-version>1.0-ml</error:xquery-version>\r\n    <error:message>Invalid lexical value</error:message>\r\n    <error:format-string>XDMP-LEXVAL: xs:ID(\"http://www.w3.org/1999/XSL/Transform\") -- Invalid lexical value \"http://www.w3.org/1999/XSL/Transform\"</error:format-string>\r\n    <error:retryable>false</error:retryable>\r\n    <error:expr>xs:ID(\"http://www.w3.org/1999/XSL/Transform\")</error:expr>\r\n    <error:data>\r\n      <error:datum>\"http://www.w3.org/1999/XSL/Transform\"</error:datum>\r\n    </error:data>\r\n    <error:stack>\r\n      <error:frame>\r\n        <error:line>48</error:line>\r\n        <error:column>12</error:column>\r\n        <error:variables>\r\n          <error:variable>\r\n            <error:name>dir-root</error:name>\r\n            <error:value>\"/space/builder/builds/linux64/b5_0/qa/testdata/schema/xmlschema2...\"</error:value>\r\n          </error:variable>\r\n          <error:variable>\r\n            <error:name>test</error:name>\r\n            <error:value>\"Wildcards_w3c\"</error:value>\r\n          </error:variable>\r\n          <error:variable>\r\n            <error:name>test-driver</error:name>\r\n            <error:value>\"/space/builder/builds/linux64/b5_0/qa/testdata/schema/xmlschema2...\"</error:value>\r\n          </error:variable>\r\n          <error:variable>\r\n            <error:name>test-set</error:name>\r\n            <error:value>document{<testSet xsi:schemaLocation=\"http://www.w3.org/XML/2004/xml-schema-test-suite/ AnnotatedTSSch...\" name=\"MS-Wildcards2006-07-15\" contributor=\"Microsoft\" xmlns=\"http://www.w3.org/XML/2004/xml-schema-test-suite/\" xmlns:xlink=\"http://www.w3.org/1999/xlink\" xmlns:xsi=\"http://www.w3.org/2001/XMLSchema-instance\">&#10;<testGroup name=\"wildA001\">&#10;<annotation>&#10;<documenta...</testSet>}</error:value>\r\n          </error:variable>\r\n          <error:variable>\r\n            <error:name>test-grps</error:name>\r\n            <error:value>(<testGroup name=\"wildA001\" xmlns=\"http://www.w3.org/XML/2004/xml-schema-test-suite/\" xmlns:xlink=\"http://www.w3.org/1999/xlink\" xmlns:xsi=\"http://www.w3.org/2001/XMLSchema-instance\">&#10;<annotation>&#10;<documentation>TEST :Syntax Validation - a...</testGroup>, <testGroup name=\"wildA002\" xmlns=\"http://www.w3.org/XML/2004/xml-schema-test-suite/\" xmlns:xlink=\"http://www.w3.org/1999/xlink\" xmlns:xsi=\"http://www.w3.org/2001/XMLSchema-instance\">&#10;<annotation>&#10;<documentation>TEST :Syntax Validation - a...</testGroup>, <testGroup name=\"wildA003\" xmlns=\"http://www.w3.org/XML/2004/xml-schema-test-suite/\" xmlns:xlink=\"http://www.w3.org/1999/xlink\" xmlns:xsi=\"http://www.w3.org/2001/XMLSchema-instance\">&#10;<annotation>&#10;<documentation>TEST :Syntax Validation - a...</testGroup>, ...)</error:value>\r\n          </error:variable>\r\n          <error:variable>\r\n            <error:name>failures</error:name>\r\n            <error:value>4</error:value>\r\n          </error:variable>\r\n          <error:variable>\r\n            <error:name>total-xml-tests</error:name>\r\n            <error:value>xs:unsignedLong(\"115\")</error:value>\r\n          </error:variable>\r\n          <error:variable>\r\n            <error:name>test-grp</error:name>\r\n            <error:value><testGroup name=\"wildZ007\" xmlns=\"http://www.w3.org/XML/2004/xml-schema-test-suite/\" xmlns:xlink=\"http://www.w3.org/1999/xlink\" xmlns:xsi=\"http://www.w3.org/2001/XMLSchema-instance\">&#10;<annotation>&#10;<documentation>TEST :Syntax Validation - a...</testGroup></error:value>\r\n          </error:variable>\r\n          <error:variable>\r\n            <error:name>test-grp-name</error:name>\r\n            <error:value>attribute{fn:QName(\"\", \"name\")}{\"wildZ007\"}</error:value>\r\n          </error:variable>\r\n          <error:variable>\r\n            <error:name>xml-test</error:name>\r\n            <error:value><instanceTest name=\"wildZ007.v\" xmlns=\"http://www.w3.org/XML/2004/xml-schema-test-suite/\" xmlns:xlink=\"http://www.w3.org/1999/xlink\" xmlns:xsi=\"http://www.w3.org/2001/XMLSchema-instance\">&#10;<instanceDocument xlink:href=\"../msData/wildcards/wildZ007....</instanceTest></error:value>\r\n          </error:variable>\r\n          <error:variable>\r\n            <error:name>xml-test-uri</error:name>\r\n            <error:value>\"/msData/wildcards/wildZ007.xml\"</error:value>\r\n          </error:variable>\r\n          <error:variable>\r\n            <error:name>xml-test-name</error:name>\r\n            <error:value>attribute{fn:QName(\"\", \"name\")}{\"wildZ007.v\"}</error:value>\r\n          </error:variable>\r\n          <error:variable>\r\n            <error:name>xml</error:name>\r\n            <error:value>fn:doc(\"/msData/wildcards/wildZ007.xml\")/*:stylesheet</error:value>          </error:variable>\r\n          <error:variable>\r\n            <error:name>schema-doc-uri</error:name>\r\n            <error:value>\"/msData/wildcards/wildZ007.xsd\"</error:value>\r\n          </error:variable>\r\n          <error:variable>\r\n            <error:name>_</error:name>\r\n            <error:value>()</error:value>\r\n          </error:variable>\r\n          <error:variable>\r\n            <error:name>ns</error:name>\r\n            <error:value>fn:doc(\"/msData/wildcards/wildZ007.xsd\")/xs:schema/@targetNamespace</error:value>\r\n          </error:variable>\r\n          <error:variable>\r\n            <error:name>expected-result</error:name>\r\n            <error:value>attribute{fn:QName(\"\", \"validity\")}{\"valid\"}</error:value>\r\n          </error:variable>\r\n        </error:variables>\r\n        <error:xquery-version>1.0-ml</error:xquery-version>\r\n      </error:frame>\r\n    </error:stack>\r\n  </error:error>\r\n\r\n", "samplequery":"", "sampledata":"", "version":"5.0-nightly", "tofixin":"5.0-7", "fixedin":"N/A", "platform":"all", "memory":"", "processors":"", "note":"", "subscribers":[{"username":"sverma", "name":"Shiva Verma", "email":"shiva.verma@marklogic.com"}, {"username":"mary", "name":"Mary Holstege", "email":"mary@cerisent.com"}], "attachments":[{"name":"test file", "uri":"root/support/bugtracking/attachments/20664/schD7.xml"}, {"name":"schema", "uri":"root/support/bugtracking/attachments/20664/schD7_a.xsd"}, {"name":"schema2", "uri":"root/support/bugtracking/attachments/20664/schD7_c.xsd"}], "includeInTaskList":false, "proceduralTasks":{"Requirements Task":[], "Functional Specification Task":[], "Test Specification Task":[], "Test Automation Task":[], "Documentation Task":[]}, "subTasks":[], "tags":["Validation", "sverma"], "changeHistory":[{"time":"2013-01-31T10:16:48.143999-08:00", "updatedBy":{"username":"sverma", "name":"Shiva Verma", "email":"shiva.verma@marklogic.com"}, "change":{"assignTo":{"from":{"username":"sverma", "name":"Shiva Verma", "email":"shiva.verma@marklogic.com"}, "to":{"username":"sverma", "name":"Shiva Verma", "email":"shiva.verma@marklogic.com"}}}, "files":[], "show":true}, {"time":"2013-01-31T10:17:33.211581-08:00", "updatedBy":{"username":"sverma", "name":"Shiva Verma", "email":"shiva.verma@marklogic.com"}, "change":{"assignTo":{"from":{"username":"sverma", "name":"Shiva Verma", "email":"shiva.verma@marklogic.com"}, "to":{"username":"mary", "name":"Mary Holstege", "email":"mary@cerisent.com"}}}, "files":[], "show":true}, {"time":"2013-07-23T09:53:39.348249-07:00", "updatedBy":{"username":"mary", "name":"Mary Holstege", "email":"mary@cerisent.com"}, "change":{}, "files":[], "show":true, "comment":"The attached files actually have nothing to do with the failing case, which involves a schema for the XSLT namespace. The issue is that our default XSLT schema is getting applied when the document is loaded, and default attributes are being added that are not valid per the test schema. \r\n \r\nI believe the proper workaround/test setup is to add a dummy schema for the XSLT namespace: \r\n \r\nxdmp:document-insert(\"/null-schema.xsd\", \r\n<xs:schema xmlns=\"http://www.w3.org/1999/XSL/Transform\" xmlns:xs=\"http://www.w3.org/2001/XMLSchema\" version=\"1.0\" targetNamespace=\"http://www.w3.org/1999/XSL/Transform\" elementFormDefault=\"qualified\" attributeFormDefault=\"unqualified\"> \r\n</xs:schema>) \r\n \r\nThen modify the load.xqy script to reference the null schema at the top: \r\nimport schema namespace xsl=\"http://www.w3.org/1999/XSL/Transform\" at \"/null-schema.xsd\"; \r\n \r\nThen, I think everything should be OK."}, {"time":"2015-03-05T06:03:44.95731-08:00", "updatedBy":{"username":"mary", "name":"Mary Holstege", "email":"mary@cerisent.com"}, "change":{"status":{"from":"Fix", "to":"Will not fix"}, "assignTo":{"from":{"username":"mary", "name":"Mary Holstege", "email":"mary@cerisent.com"}, "to":{"username":"nobody", "name":"nobody nobody", "email":"nobody@marklogic.com"}}}, "files":[], "show":true, "comment":"EOL"}, {"time":"2015-03-05T06:03:44.95731-08:00", "updatedBy":{"username":"mary", "name":"Mary Holstege", "email":"mary@cerisent.com"}, "change":{"assignTo":{"from":{"username":"mary", "name":"Mary Holstege", "email":"mary@cerisent.com"}, "to":{"username":"nobody", "name":"nobody nobody", "email":"nobody@marklogic.com"}}}, "files":[], "show":true}], "updatedAt":"2015-03-05T06:03:44.95731-08:00", "parent":{"type":"", "parentId":"", "taskOrRfe":""}}
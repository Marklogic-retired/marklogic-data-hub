{"id":20210, "kind":"Bug", "createdAt":"2012-12-05T16:00:25.775002-08:00", "status":"Closed", "title":"REGR cts:field-values returns nothing if two elements defined.", "category":"xdmp", "severity":"Critical", "priority":{"level":"5", "title":""}, "submittedBy":{"username":"cgreer", "name":"Charles Greer", "email":"charles.greer@marklogic.com"}, "assignTo":{"username":"nobody", "name":"nobody nobody", "email":"nobody@marklogic.com"}, "description":"Appservices tests are failing for a field that contains two elements, e1 and e2.  The field used to produce values and now it does not.\r\n\r\ncts:field-values(\"range\")\r\n\r\nwhere range is defined to include {ns}e1 and {ns}e2.\r\n\r\nSee 'sample query' to reproduce on a fresh database.\r\nCharles\r\n", "samplequery":" {\r\n    let $collections := (\"collection1\",\"collection2\",\"collection3\",\"collection4\",\"collection5\",\"collection6\",\"collection7\",\"collection8\",\"collection9\",\"collection10\")\r\n    let $property-words := (\"Dubinko\",\"Brooks\",\"Mo\",\"Krauss\",\"Hennum\",\"Walsh\",\"Sarma\",\"Aven\",\"Greer\",\"Yuwono\") \r\n\r\n    let $seed-dateTime := fn:current-dateTime()\r\n    \r\n    for $i at $index in 1 to $count\r\n    let $uri := fn:concat(\"test\",$i,\".xml\")\r\n    \r\n    let $collvar := fn:round(xs:double($i div $count) * 10)\r\n    let $propvar := xdmp:random(9)\r\n    let $attvar :=  fn:round(xs:double($i div $count) * 100)\r\n    let $contentvar := fn:round(xs:double($i div $count) * 20)\r\n    let $datevar := fn:round(xs:double($i div $count) * 3)\r\n    let $dateval := $seed-dateTime + xs:dayTimeDuration(fn:concat(\"-P\",$datevar,\"D\"))\r\n    let $capsvar := if (math:fmod($i,2) eq 0) then \"c\" else \"C\"\r\n     \r\n    (: for field tests, we construct a situation where a xs:dateTime can live at one of two places, or not at all :)\r\n    let $whichloc := math:fmod($i,3)\r\n    \r\n    return (\r\n    xdmp:document-insert($uri,\r\n    <document>\r\n        <element-test attribute-test=\"{$attvar}\">{fn:concat($capsvar,\"ontent \",$contentvar)}</element-test>\r\n        <date xmlns=\"http://purl.org/dc/elements/1.1/\">{$dateval}</date>\r\n        { (: if whichloc is 0, don't emit anything :)\r\n          if ($whichloc eq 1) then <e1 xmlns=\"http://marklogic.com/ns\">{$dateval}</e1> else () }\r\n        { if ($whichloc eq 2) then <e2 xmlns=\"http://marklogic.com/ns\">{$dateval}</e2> else () }\r\n    </document>,\r\n    (),$collections[$collvar])\r\n    ,\r\n    xdmp:document-set-property($uri, <ordinal xmlns=\"http://marklogic.com/ns\">{$i}</ordinal>),\r\n    xdmp:document-set-property($uri,<string xmlns=\"http://marklogic.com/ns\">{$property-words[$propvar]}</string>)", "sampledata":"", "version":"7.0-nightly", "tofixin":"7.0-ea1", "fixedin":"7.0-ea1", "platform":"all", "memory":"", "processors":"", "note":"", "subscribers":[{"username":"cgreer", "name":"Charles Greer", "email":"charles.greer@marklogic.com"}, {"username":"gchinchwadkar", "name":"Gajanan Chinchwadkar", "email":"Gajanan.Chinchwadkar@marklogic.com"}, {"username":"msarma", "name":"Meghalim Sarma", "email":"msarma@marklogic.com"}, {"username":"ayuwono", "name":"Aries Yuwono", "email":"ayuwono@marklogic.com"}], "attachments":[], "relationships":[{"type":"", "to":""}], "clones":[], "cloneOf":"", "support":{"headline":"", "supportDescription":"", "publishStatus":"Never Publish", "tickets":[], "customerImpact":{"level":"N/A", "title":""}, "workaround":""}, "tags":["xdmp", "cgreer"], "changeHistory":[{"time":"2012-12-06T07:33:16.877774-08:00", "updatedBy":{"username":"cjl", "name":"Christopher Lindblad", "email":"cjl@cerisent.com"}, "change":{"status":{"from":"", "to":"Verify"}, "assignTo":{"from":{"username":"cjl", "name":"Christopher Lindblad", "email":"cjl@cerisent.com"}, "to":{"username":"gchinchwadkar", "name":"Gajanan Chinchwadkar", "email":"Gajanan.Chinchwadkar@marklogic.com"}}}, "files":[], "show":true}, {"time":"2012-12-06T07:33:16.877774-08:00", "updatedBy":{"username":"cjl", "name":"Christopher Lindblad", "email":"cjl@cerisent.com"}, "change":{"assignTo":{"from":{"username":"cjl", "name":"Christopher Lindblad", "email":"cjl@cerisent.com"}, "to":{"username":"gchinchwadkar", "name":"Gajanan Chinchwadkar", "email":"Gajanan.Chinchwadkar@marklogic.com"}}}, "files":[], "show":true}, {"time":"2012-12-06T07:33:16.877774-08:00", "updatedBy":{"username":"cjl", "name":"Christopher Lindblad", "email":"cjl@cerisent.com"}, "change":{"tofixin":{"from":"", "to":"7.0-ea1"}}, "files":[], "show":true}, {"time":"2012-12-06T08:00:03.077079-08:00", "updatedBy":{"username":"gchinchwadkar", "name":"Gajanan Chinchwadkar", "email":"Gajanan.Chinchwadkar@marklogic.com"}, "change":{}, "files":[], "show":true, "comment":"This is a regression due to path-fields project. The entire area of fields is being modified right now in b7_0. This will be fixed as soon as possible."}, {"time":"2012-12-08T08:43:36.376983-08:00", "updatedBy":{"username":"gchinchwadkar", "name":"Gajanan Chinchwadkar", "email":"Gajanan.Chinchwadkar@marklogic.com"}, "change":{}, "files":[], "show":true, "comment":"Can you please attach a sample document? I need to see the structure of the document."}, {"time":"2013-01-11T05:38:54.311967-08:00", "updatedBy":{"username":"gchinchwadkar", "name":"Gajanan Chinchwadkar", "email":"Gajanan.Chinchwadkar@marklogic.com"}, "change":{}, "files":[], "show":true, "comment":"Are these tests passing now? I have fixed a bunch of bugs in this area last week."}, {"time":"2013-01-11T09:39:37.915829-08:00", "updatedBy":{"username":"cgreer", "name":"Charles Greer", "email":"charles.greer@marklogic.com"}, "change":{}, "files":[], "show":true, "comment":"Yes!  All search tests just passed on a run."}, {"time":"2013-01-11T11:16:36.500429-08:00", "updatedBy":{"username":"gchinchwadkar", "name":"Gajanan Chinchwadkar", "email":"Gajanan.Chinchwadkar@marklogic.com"}, "change":{"status":{"from":"", "to":"Test"}, "assignTo":{"from":{"username":"gchinchwadkar", "name":"Gajanan Chinchwadkar", "email":"Gajanan.Chinchwadkar@marklogic.com"}, "to":{"username":"msarma", "name":"Meghalim Sarma", "email":"msarma@marklogic.com"}}}, "files":[], "show":true}, {"time":"2013-01-11T11:16:36.500429-08:00", "updatedBy":{"username":"gchinchwadkar", "name":"Gajanan Chinchwadkar", "email":"Gajanan.Chinchwadkar@marklogic.com"}, "change":{"assignTo":{"from":{"username":"gchinchwadkar", "name":"Gajanan Chinchwadkar", "email":"Gajanan.Chinchwadkar@marklogic.com"}, "to":{"username":"msarma", "name":"Meghalim Sarma", "email":"msarma@marklogic.com"}}}, "files":[], "show":true}, {"time":"2013-02-19T21:52:03.559328-08:00", "updatedBy":{"username":"msarma", "name":"Meghalim Sarma", "email":"msarma@marklogic.com"}, "change":{"assignTo":{"from":{"username":"msarma", "name":"Meghalim Sarma", "email":"msarma@marklogic.com"}, "to":{"username":"ayuwono", "name":"Aries Yuwono", "email":"ayuwono@marklogic.com"}}}, "files":[], "show":true}, {"time":"2013-02-27T16:49:52.954819-08:00", "updatedBy":{"username":"ayuwono", "name":"Aries Yuwono", "email":"ayuwono@marklogic.com"}, "change":{"status":{"from":"", "to":"Ship"}, "assignTo":{"from":{"username":"ayuwono", "name":"Aries Yuwono", "email":"ayuwono@marklogic.com"}, "to":{"username":"nobody", "name":"nobody nobody", "email":"nobody@marklogic.com"}}}, "files":[], "show":true, "comment":"Verified passed on 02/26 build"}, {"time":"2013-02-27T16:49:52.954819-08:00", "updatedBy":{"username":"ayuwono", "name":"Aries Yuwono", "email":"ayuwono@marklogic.com"}, "change":{"assignTo":{"from":{"username":"ayuwono", "name":"Aries Yuwono", "email":"ayuwono@marklogic.com"}, "to":{"username":"nobody", "name":"nobody nobody", "email":"nobody@marklogic.com"}}}, "files":[], "show":true}], "updatedAt":"2013-02-27T16:49:52.954819-08:00", "fixedAt":"2013-01-11T11:16:36.500429-08:00", "fixedBy":{"username":"gchinchwadkar", "name":"Gajanan Chinchwadkar", "email":"Gajanan.Chinchwadkar@marklogic.com"}, "shippedAt":"2013-02-27T16:49:52.954819-08:00", "shippedBy":{"username":"ayuwono", "name":"Aries Yuwono", "email":"ayuwono@marklogic.com"}, "renderDescriptionAs":"normal", "renderSampleQueryAs":"normal"}
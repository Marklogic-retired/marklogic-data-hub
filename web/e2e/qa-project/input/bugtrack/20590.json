{"id":20590, "kind":"Bug", "createdAt":"2013-01-25T13:14:47.486503-08:00", "status":"Closed", "title":"regression xcc test failed with \"Unrecognized SSL message, plaintext connection?\"", "category":"XCC/Java", "severity":"Major", "priority":{"level":"5", "title":""}, "submittedBy":{"username":"lling", "name":"Ling Ling", "email":"ling.ling@marklogic.com"}, "assignTo":{"username":"nobody", "name":"nobody nobody", "email":"nobody@marklogic.com"}, "description":"Below is the emails related.\r\n\r\n------------------------------------------------------------------\r\nFrom: Wayne Feick [wayne.feick@marklogic.com]\r\nSent: Friday, January 25, 2013 12:58 PM\r\nTo: Christopher Lindblad\r\nCc: Ling Ling; Jane Chen\r\nSubject: Re: XCC SSL diffs in regression\r\n\r\nMy change was about always have a version element in a certificate template / certificate request that has a value of 0. It used to be 2, which turned out to violate the RFC.\r\n\r\nIf it has anything to do with my fix, you'll have a <version>2</version> somewhere that needs to become <version>0</version>.\r\n\r\n\r\nOn 01/25/2013 12:49 PM, Christopher Lindblad wrote:\r\nI have added Wayne to this.\r\nIn revision 128364, for bug 19874, Wayne made a change to the PKI code.\r\nSince this is an SSL-related failure it may have something to do with it.\r\n\r\n\r\nFrom: Jane Chen\r\nSent: Monday, January 21, 2013 5:19 PM\r\nTo: Ling Ling\r\nSubject: RE: XCC SSL diffs in regression\r\n\r\nLing,\r\n\r\nNobody touched XCC b5-0 in the past 2 weeks.  Cjl touched AppServer.cpp on 1/18.  Change 128361.  Could be related to that.\r\n\r\nJane\r\n\r\nFrom: Ling Ling\r\nSent: Monday, January 21, 2013 5:10 PM\r\nTo: Jane Chen\r\nSubject: XCC SSL diffs in regression\r\n\r\nHi Jane,\r\n\r\nIn below regression\r\nhttps://regression-status.marklogic.com/new-app/reg-status.xqy?build-level=b5_0\r\nyou’ll find there’re 3 tests failed with\r\n\r\njava.lang.RuntimeException: SSL concurrency test failed after 0 requests.\r\n        at com.marklogic.xcc.TestBug9593.testBug(TestBug9593.java:56)\r\nCaused by: com.marklogic.xcc.exceptions.ServerConnectionException: Unrecognized SSL message, plaintext connection?\r\n\r\nFor example\r\nhttps://regression-status.marklogic.com/new-app/space2/diff-archive/b5_0/2013-01-21/linux-64-rh54-cluster-RH5.4/diffs/nullTEST-com.marklogic.xcc.TestBug9593.txt\r\nhttps://regression-status.marklogic.com/new-app/space2/diff-archive/b5_0/2013-01-21/linux-64-rh54-cluster-RH5.4/diffs/nullTEST-com.marklogic.xcc.TestPerformance.txt\r\nhttps://regression-status.marklogic.com/new-app/space2/diff-archive/b5_0/2013-01-21/linux-64-rh54-cluster-RH5.4/diffs/nullTEST-com.marklogic.xcc.TestSslConnection.txt\r\n\r\n\r\nThey are\r\nnullTEST-com.marklogic.xcc.TestBug9593.txt<https://regression-status.marklogic.com/new-app/summary.xqy?build-level=b5_0/2013-01-21&page-no=1&diff-name=nullTEST-com.marklogic.xcc.TestBug9593.txt>\r\nnullTEST-com.marklogic.xcc.TestPerformance.txt<https://regression-status.marklogic.com/new-app/summary.xqy?build-level=b5_0/2013-01-21&page-no=1&diff-name=nullTEST-com.marklogic.xcc.TestPerformance.txt>\r\nnullTEST-com.marklogic.xcc.TestSslConnection.txt<https://regression-status.marklogic.com/new-app/summary.xqy?build-level=b5_0/2013-01-21&page-no=1&diff-name=nullTEST-com.marklogic.xcc.TestSslConnection.txt>\r\n\r\nyou could find all these tests under\r\n\r\nb5_0/xcc/api_tests/src/junit/com/marklogic/xcc\r\n\r\nThe server setting you could find at\r\nhttp://lling.marklogic.com:8001/xdbc-server-admin.xqy?section=group&group=14261844903419594406&xdbc-server=2858630706739606635\r\n\r\nNot sure what has been changed here. Do you have any suggestions?\r\n\r\nThanks,\r\nLing\r\n", "samplequery":"", "sampledata":"", "version":"5.0-nightly", "tofixin":"5.0-5", "fixedin":"N/A", "platform":"all", "memory":"", "processors":"", "note":"", "subscribers":[{"username":"lling", "name":"Ling Ling", "email":"ling.ling@marklogic.com"}, {"username":"jchen", "name":"Jane Chen", "email":"jane.chen@marklogic.com"}, {"username":"rpolasani", "name":"Raghu Polasani", "email":"raghu.polasani@marklogic.com"}], "attachments":[], "relationships":[{"type":"", "to":""}], "clones":[], "cloneOf":"", "support":{"headline":"", "supportDescription":"", "publishStatus":"Not Ready", "tickets":[], "customerImpact":{"level":"N/A", "title":""}, "workaround":""}, "tags":["XCC/Java", "lling"], "changeHistory":[{"time":"2013-01-25T13:14:47.486503-08:00", "updatedBy":{"username":"lling", "name":"Ling Ling", "email":"ling.ling@marklogic.com"}, "change":{"assignTo":{"from":{"username":"lling", "name":"Ling Ling", "email":"ling.ling@marklogic.com"}, "to":{"username":"jchen", "name":"Jane Chen", "email":"jane.chen@marklogic.com"}}}, "files":[], "show":true}, {"time":"2013-01-26T11:08:27.629502-08:00", "updatedBy":{"username":"jchen", "name":"Jane Chen", "email":"jane.chen@marklogic.com"}, "change":{}, "files":[], "show":true, "comment":"Cannot reproduce.\r\n\r\nAll the above 3 tests passed for me against a 0126 b5_0 nightly.\r\n\r\nCan you reproduce it in your environment?  Could it be an issue with the regression test environment?"}, {"time":"2013-01-26T11:17:29.561672-08:00", "updatedBy":{"username":"jchen", "name":"Jane Chen", "email":"jane.chen@marklogic.com"}, "change":{"assignTo":{"from":{"username":"jchen", "name":"Jane Chen", "email":"jane.chen@marklogic.com"}, "to":{"username":"lling", "name":"Ling Ling", "email":"ling.ling@marklogic.com"}}}, "files":[], "show":true}, {"time":"2013-01-28T10:17:58.353884-08:00", "updatedBy":{"username":"lling", "name":"Ling Ling", "email":"ling.ling@marklogic.com"}, "change":{}, "files":[], "show":true, "comment":"I'll go test it in our regression machine later today when all the regression test finishes. Thanks"}, {"time":"2013-01-28T17:18:27.138724-08:00", "updatedBy":{"username":"lling", "name":"Ling Ling", "email":"ling.ling@marklogic.com"}, "change":{}, "files":[], "show":true, "comment":"reproduced it in regression machine. All jar files are up to date. "}, {"time":"2013-01-28T17:28:33.624027-08:00", "updatedBy":{"username":"jchen", "name":"Jane Chen", "email":"jane.chen@marklogic.com"}, "change":{}, "files":[], "show":true, "comment":"Doe it only reproduce on the regression machine?  Does it reproduce on your desktop?"}, {"time":"2013-01-29T11:20:03.101177-08:00", "updatedBy":{"username":"lling", "name":"Ling Ling", "email":"ling.ling@marklogic.com"}, "change":{}, "files":[], "show":true, "comment":"Yes, only in regression machine, not on my machine."}, {"time":"2013-01-29T11:28:13.017898-08:00", "updatedBy":{"username":"jchen", "name":"Jane Chen", "email":"jane.chen@marklogic.com"}, "change":{}, "files":[], "show":true, "comment":"We are looking to see what has changed on the regression machine."}, {"time":"2013-01-29T11:28:13.017898-08:00", "updatedBy":{"username":"jchen", "name":"Jane Chen", "email":"jane.chen@marklogic.com"}, "change":{"assignTo":{"from":{"username":"jchen", "name":"Jane Chen", "email":"jane.chen@marklogic.com"}, "to":{"username":"jchen", "name":"Jane Chen", "email":"jane.chen@marklogic.com"}}}, "files":[], "show":true}, {"time":"2013-01-30T09:37:42.480112-08:00", "updatedBy":{"username":"jchen", "name":"Jane Chen", "email":"jane.chen@marklogic.com"}, "change":{}, "files":[], "show":true, "comment":"Some update:\r\n\r\nbug19874.xml is a negative test that checks for error if certificate version is not 0. I’ve updated remaining tests i.e. dbrep-https-replica.xml and ssl-perf-setup.xml.\r\n\r\n-- \r\nRegards, \r\nKapil Saxena\r\nCell: +91-9953088880\r\nEmail: kapil.saxena@marklogic.com\r\n \r\n\r\nFrom: Wayne Feick [mailto:wayne.feick@marklogic.com] \r\nSent: 30 January 2013 11:29\r\nTo: Jane Chen\r\nCc: Shiva Verma; Mahalakshmi Srinivasan; Server-QA\r\nSubject: Re: Bug 20590.\r\n\r\nI don't know if it's relevant, but the the following test files still use version 2 in their certificate requests in the b5_0 qa tree: bug19874.xml, dbrep-https-replica.xml, ssl-perf-setup.xml.\r\n% grep -n x509:version *.xml \r\nappservices_performance_ssl_setup.xml:24:    <x509:version>0</x509:version>\r\nbug18932.xml:24:    <x509:version>0</x509:version>\r\nbug19874.xml:24:    <x509:version>2</x509:version>\r\nbug19874.xml:65:    <x509:version>0</x509:version>\r\nbug7291.xml:16:               <x509:version> 0 </x509:version>\r\nbug7501.xml:25:      <x509:version>0</x509:version>\r\nbug7501.xml:68:      <x509:version>0</x509:version>\r\nbug7501.xml:111:      <x509:version>0</x509:version>\r\nbug7696.xml:16:               <x509:version> 0 </x509:version>\r\nbug9705.xml:23: <x509:version>0</x509:version>\r\ndbrep-https-replica.xml:45:                       <x509:version>2</x509:version>\r\nssl1.xml:24:    <x509:version>0</x509:version>\r\nssl-perf-setup.xml:24:      <x509:version>2</x509:version>\r\nurl-rewriter-ssl.xml:24:      <x509:version>0</x509:version>\r\n\r\nOn 01/29/2013 09:39 PM, Jane Chen wrote:\r\nShiva, \r\n\r\nThanks for your reply.\r\n\r\nCan you run the same tests against a 01/18's 5.0 nightly on that regression machine?  \r\n\r\nJane\r\n________________________________________\r\nFrom: Shiva Verma\r\nSent: Tuesday, January 29, 2013 9:35 PM\r\nTo: Jane Chen\r\nCc: Mahalakshmi Srinivasan; Server-QA; Wayne Feick\r\nSubject: RE: Bug 20590.\r\nHi Jane\r\n \r\nIs the changes still need to be tested, please suggest the changes, we can test it on regression on this machine\r\n \r\nThanks\r\nShiva\r\nFrom: Jane Chen \r\nSent: 30 January 2013 02:01\r\nTo: Mahalakshmi Srinivasan; Server-QA; Wayne Feick\r\nSubject: RE: Bug 20590.\r\n \r\nSince this can only be reproduced on the regression machine, can we stop the regression, and try the tests with the change reverted?\r\n \r\nJane\r\n \r\nFrom: Mahalakshmi Srinivasan \r\nSent: Tuesday, January 29, 2013 12:04 PM\r\nTo: Jane Chen; Server-QA; Wayne Feick\r\nSubject: RE: Bug 20590.\r\n \r\nHi Jane,\r\n \r\nThere was a bug fix for incorrect x509 version in generated certificates on Jan 18th. Please see bug 19874. This could be the reason for the regression you are seeing.\r\n \r\nThanks,\r\nMaha.\r\n \r\nFrom: Jane Chen \r\nSent: Tuesday, January 29, 2013 11:35 AM\r\nTo: Server-QA; Wayne Feick\r\nSubject: Bug 20590.\r\n \r\nThere’s an SSL related regression that started happening on 1/19/2013.  The regression can only be reproduced on the regression machine rh6-intel64-43-test-1.marklogic.com.  Can anyone recall what has changed on that machine?\r\n \r\nWayne, can you think of anything environment related that may have an impact on SSL connections?\r\n \r\nThanks,\r\nJane "}, {"time":"2013-01-30T13:03:13.061709-08:00", "updatedBy":{"username":"jchen", "name":"Jane Chen", "email":"jane.chen@marklogic.com"}, "change":{}, "files":[], "show":true, "comment":"Ling, Megha told me that several failed tests ran fine last night after they updated the certificate template.  Please make sure all are applied and up to date in the QA tree on the regression machine."}, {"time":"2013-01-30T13:03:13.061709-08:00", "updatedBy":{"username":"jchen", "name":"Jane Chen", "email":"jane.chen@marklogic.com"}, "change":{"assignTo":{"from":{"username":"jchen", "name":"Jane Chen", "email":"jane.chen@marklogic.com"}, "to":{"username":"lling", "name":"Ling Ling", "email":"ling.ling@marklogic.com"}}}, "files":[], "show":true}, {"time":"2013-01-30T16:44:24.473412-08:00", "updatedBy":{"username":"lling", "name":"Ling Ling", "email":"ling.ling@marklogic.com"}, "change":{}, "files":[], "show":true, "comment":"As previous I didn't update my xcc, so I updated it and tried other server builds\r\n\r\nThe tests passed on old xcc with nightly server build\r\nThe tests failed on updated xcc and nightly server build\r\nTest tests passed on updated xcc and 01/18/13 server build\r\nTest tests failed on updated xcc and 01/19/13 server build\r\n\r\nwe have backed the changes made in bug 19874, but the tests still failed\r\nTests failed on updated xcc and 1/19/13 build with changes reverted"}, {"time":"2013-01-30T16:44:24.473412-08:00", "updatedBy":{"username":"lling", "name":"Ling Ling", "email":"ling.ling@marklogic.com"}, "change":{"assignTo":{"from":{"username":"lling", "name":"Ling Ling", "email":"ling.ling@marklogic.com"}, "to":{"username":"jchen", "name":"Jane Chen", "email":"jane.chen@marklogic.com"}}}, "files":[], "show":true}, {"time":"2013-01-30T18:34:50.134847-08:00", "updatedBy":{"username":"jchen", "name":"Jane Chen", "email":"jane.chen@marklogic.com"}, "change":{}, "files":[], "show":true, "comment":"Turned out that the problem was /opt/MarkLogic/qa/add-ssl-cert-template.xqy is using x509 version 2, so the template creation failed, and the AppServer did not have an SSL certificate template and wasn't running in SSL mode at all.  Now after Raghu and I corrected the version in the file and attached the certificate template to the XCCSSLServer, the test passed fine.\r\n\r\nRaghu is going to check in the fix."}, {"time":"2013-01-30T18:34:50.134847-08:00", "updatedBy":{"username":"jchen", "name":"Jane Chen", "email":"jane.chen@marklogic.com"}, "change":{"status":{"from":"", "to":"Fix"}, "assignTo":{"from":{"username":"jchen", "name":"Jane Chen", "email":"jane.chen@marklogic.com"}, "to":{"username":"rpolasani", "name":"Raghu Polasani", "email":"raghu.polasani@marklogic.com"}}}, "files":[], "show":true}, {"time":"2013-01-30T18:34:50.134847-08:00", "updatedBy":{"username":"jchen", "name":"Jane Chen", "email":"jane.chen@marklogic.com"}, "change":{"assignTo":{"from":{"username":"jchen", "name":"Jane Chen", "email":"jane.chen@marklogic.com"}, "to":{"username":"rpolasani", "name":"Raghu Polasani", "email":"raghu.polasani@marklogic.com"}}}, "files":[], "show":true}, {"time":"2013-01-30T19:37:29.899526-08:00", "updatedBy":{"username":"rpolasani", "name":"Raghu Polasani", "email":"raghu.polasani@marklogic.com"}, "change":{}, "files":[], "show":true, "comment":"Ling, I have updated the test code to fix the certificate version on all branches(b6_0, b5_0 and trunk). Please close this bug if this test passes in tomorrow's regression."}, {"time":"2013-01-30T19:37:29.899526-08:00", "updatedBy":{"username":"rpolasani", "name":"Raghu Polasani", "email":"raghu.polasani@marklogic.com"}, "change":{"assignTo":{"from":{"username":"rpolasani", "name":"Raghu Polasani", "email":"raghu.polasani@marklogic.com"}, "to":{"username":"lling", "name":"Ling Ling", "email":"ling.ling@marklogic.com"}}}, "files":[], "show":true}, {"time":"2013-01-31T16:43:48.005474-08:00", "updatedBy":{"username":"lling", "name":"Ling Ling", "email":"ling.ling@marklogic.com"}, "change":{"status":{"from":"", "to":"Closed"}, "assignTo":{"from":{"username":"lling", "name":"Ling Ling", "email":"ling.ling@marklogic.com"}, "to":{"username":"nobody", "name":"nobody nobody", "email":"nobody@marklogic.com"}}}, "files":[], "show":true}, {"time":"2013-01-31T16:43:48.005474-08:00", "updatedBy":{"username":"lling", "name":"Ling Ling", "email":"ling.ling@marklogic.com"}, "change":{"assignTo":{"from":{"username":"lling", "name":"Ling Ling", "email":"ling.ling@marklogic.com"}, "to":{"username":"nobody", "name":"nobody nobody", "email":"nobody@marklogic.com"}}}, "files":[], "show":true}], "updatedAt":"2013-01-31T16:43:48.005474-08:00", "closedAt":"2013-01-31T16:43:48.005474-08:00", "closedBy":{"username":"lling", "name":"Ling Ling", "email":"ling.ling@marklogic.com"}, "renderDescriptionAs":"normal"}
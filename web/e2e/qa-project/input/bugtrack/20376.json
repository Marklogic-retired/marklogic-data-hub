{"id":20376, "kind":"Bug", "createdAt":"2011-11-30T06:16:04.347163-08:00", "status":"Closed", "title":"XSLT is too agressive about discarding whitespace-only text nodes", "category":"XSLT", "severity":"Major", "priority":{"level":"5", "title":""}, "submittedBy":{"username":"nwalsh", "name":"Norman Walsh", "email":"norman.walsh@marklogic.com"}, "assignTo":{"username":"nobody", "name":"nobody nobody", "email":"nobody@marklogic.com"}, "description":"This is possibly related to bug 12162. Or not, I can't be sure.\r\n\r\nThis query produces the result \"1, 0\". It should produce the result \"1, 1\".\r\n\r\nxquery version \"1.0-ml\";\r\n\r\ndeclare default function namespace \"http://www.w3.org/2005/xpath-functions\";\r\n\r\ndeclare option xdmp:mapping \"false\";\r\n\r\nlet $style := <xsl:stylesheet xmlns:xsl=\"http://www.w3.org/1999/XSL/Transform\"\r\n                version=\"2.0\">\r\n\r\n<xsl:output method=\"xml\" encoding=\"utf-8\" indent=\"no\"\r\n     omit-xml-declaration=\"yes\"/>\r\n\r\n<xsl:template match=\"/\">\r\n  <xsl:variable name=\"dummy\" select=\"/*/node()[2]\"/>\r\n\r\n  <xsl:variable name=\"nodes\" as=\"node()*\">\r\n    <xsl:analyze-string select=\"$dummy\" regex=\"\\n\">\r\n      <xsl:matching-substring>\r\n        <br/>\r\n      </xsl:matching-substring>\r\n      <xsl:non-matching-substring>\r\n        <xsl:value-of select=\".\"/>\r\n      </xsl:non-matching-substring>\r\n    </xsl:analyze-string>\r\n  </xsl:variable>\r\n\r\n  <result>\r\n    <xsl:value-of select=\"string-length($dummy)\"/>\r\n    <xsl:text>, </xsl:text>\r\n    <xsl:value-of select=\"count($nodes)\"/>\r\n  </result>\r\n</xsl:template>\r\n\r\n</xsl:stylesheet>\r\n\r\nlet $doc := document { <doc><a>one</a>{\" \"}<b>two</b></doc> }\r\n\r\nreturn\r\n  xdmp:xslt-eval($style, $doc)\r\n", "samplequery":"", "sampledata":"", "version":"6.0-2", "tofixin":"6.0-3", "fixedin":"6.0-3", "platform":"all", "memory":"", "processors":"", "note":"", "subscribers":[{"username":"nwalsh", "name":"Norman Walsh", "email":"norman.walsh@marklogic.com"}, {"username":"jsnelson", "name":"John Snelson", "email":"jsnelson@marklogic.com"}, {"username":"mary", "name":"Mary Holstege", "email":"mary@cerisent.com"}, {"username":"rpolasani", "name":"Raghu Polasani", "email":"raghu.polasani@marklogic.com"}, {"username":"msrinivasan", "name":"Mahalakshmi Srinivasan", "email":"mahalakshmi.srinivasan@marklogic.com"}], "attachments":[], "relationships":[{"type":"", "to":""}], "clones":[], "cloneOf":15827, "support":{"headline":"XSLT analyze-string discarding whitespace nodes from matching and non-matching children", "supportDescription":"The XSLT xsl:analyze-string instruction is incorrectly removing whitespace-only text nodes produced in executing the xsl:matching-substring and xsl:non-matching-substring elements.", "publishStatus":"Publish", "tickets":[], "customerImpact":{"level":"N/A", "title":""}, "workaround":""}, "tags":["XSLT", "nwalsh"], "changeHistory":[{"time":"2011-11-30T06:47:17.088052-08:00", "updatedBy":{"username":"jsnelson", "name":"John Snelson", "email":"jsnelson@marklogic.com"}, "change":{"assignTo":{"from":{"username":"jsnelson", "name":"John Snelson", "email":"jsnelson@marklogic.com"}, "to":{"username":"jsnelson", "name":"John Snelson", "email":"jsnelson@marklogic.com"}}}, "files":[], "show":true}, {"time":"2012-01-13T15:46:53.442171-08:00", "updatedBy":{"username":"rhu", "name":"Ron Hu", "email":"ron.hu@marklogic.com"}, "change":{"status":{"from":"", "to":"Verify"}, "assignTo":{"from":{"username":"rhu", "name":"Ron Hu", "email":"ron.hu@marklogic.com"}, "to":{"username":"jsnelson", "name":"John Snelson", "email":"jsnelson@marklogic.com"}}}, "files":[], "show":true}, {"time":"2012-12-13T03:01:13.609713-08:00", "updatedBy":{"username":"jsnelson", "name":"John Snelson", "email":"jsnelson@marklogic.com"}, "change":{}, "files":[], "show":true, "comment":"Looks related to bug 12162."}, {"time":"2012-12-13T03:01:13.609713-08:00", "updatedBy":{"username":"jsnelson", "name":"John Snelson", "email":"jsnelson@marklogic.com"}, "change":{"status":{"from":"", "to":"Test"}, "assignTo":{"from":{"username":"jsnelson", "name":"John Snelson", "email":"jsnelson@marklogic.com"}, "to":{"username":"mary", "name":"Mary Holstege", "email":"mary@cerisent.com"}}}, "files":[], "show":true}, {"time":"2012-12-13T03:01:13.609713-08:00", "updatedBy":{"username":"jsnelson", "name":"John Snelson", "email":"jsnelson@marklogic.com"}, "change":{"assignTo":{"from":{"username":"jsnelson", "name":"John Snelson", "email":"jsnelson@marklogic.com"}, "to":{"username":"mary", "name":"Mary Holstege", "email":"mary@cerisent.com"}}}, "files":[], "show":true}, {"time":"2013-01-03T14:31:40.980596-08:00", "updatedBy":{"username":"mary", "name":"Mary Holstege", "email":"mary@cerisent.com"}, "change":{"tofixin":{"from":"", "to":"6.0-3"}}, "files":[], "show":true}, {"time":"2013-01-03T14:39:37.228591-08:00", "updatedBy":{"username":"mary", "name":"Mary Holstege", "email":"mary@cerisent.com"}, "change":{}, "files":[], "show":true, "svn":{"repository":"/project/engsvn", "revision":"126403", "paths":["xdmp/branches/b6_0/src/RegexpBuiltins.cpp"], "affectedBugs":[]}, "comment":"Bug:20376 analyze-string discarding whitespace only text nodes"}, {"time":"2013-01-03T14:40:12.337095-08:00", "updatedBy":{"username":"mary", "name":"Mary Holstege", "email":"mary@cerisent.com"}, "change":{}, "files":[], "show":true, "comment":"Fixed 6.0-20130104"}, {"time":"2013-01-03T14:40:12.337095-08:00", "updatedBy":{"username":"mary", "name":"Mary Holstege", "email":"mary@cerisent.com"}, "change":{"assignTo":{"from":{"username":"mary", "name":"Mary Holstege", "email":"mary@cerisent.com"}, "to":{"username":"rpolasani", "name":"Raghu Polasani", "email":"raghu.polasani@marklogic.com"}}}, "files":[], "show":true}, {"time":"2013-03-18T16:48:52.003041-07:00", "updatedBy":{"username":"msrinivasan", "name":"Mahalakshmi Srinivasan", "email":"mahalakshmi.srinivasan@marklogic.com"}, "change":{"assignTo":{"from":{"username":"msrinivasan", "name":"Mahalakshmi Srinivasan", "email":"mahalakshmi.srinivasan@marklogic.com"}, "to":{"username":"msrinivasan", "name":"Mahalakshmi Srinivasan", "email":"mahalakshmi.srinivasan@marklogic.com"}}}, "files":[], "show":true}, {"time":"2013-03-25T15:26:30.012338-07:00", "updatedBy":{"username":"msrinivasan", "name":"Mahalakshmi Srinivasan", "email":"mahalakshmi.srinivasan@marklogic.com"}, "change":{"status":{"from":"", "to":"Ship"}, "assignTo":{"from":{"username":"msrinivasan", "name":"Mahalakshmi Srinivasan", "email":"mahalakshmi.srinivasan@marklogic.com"}, "to":{"username":"nobody", "name":"nobody nobody", "email":"nobody@marklogic.com"}}}, "files":[], "show":true, "comment":"Verified on build 6.0-20130221"}, {"time":"2013-04-22T16:23:17.133112-07:00", "updatedBy":{"username":"rpelton", "name":"Rick Pelton", "email":"rick.pelton@marklogic.com"}, "change":{"status":{"from":"", "to":"Closed"}, "assignTo":{"from":{"username":"rpelton", "name":"Rick Pelton", "email":"rick.pelton@marklogic.com"}, "to":{"username":"nobody", "name":"nobody nobody", "email":"nobody@marklogic.com"}}}, "files":[], "show":true}], "updatedAt":"2013-04-22T16:23:17.133112-07:00", "fixedAt":"2012-12-13T03:01:13.609713-08:00", "fixedBy":{"username":"jsnelson", "name":"John Snelson", "email":"jsnelson@marklogic.com"}, "shippedAt":"2013-03-25T15:26:30.012338-07:00", "shippedBy":{"username":"msrinivasan", "name":"Mahalakshmi Srinivasan", "email":"mahalakshmi.srinivasan@marklogic.com"}, "closedAt":"2013-04-22T16:23:17.133112-07:00", "closedBy":{"username":"rpelton", "name":"Rick Pelton", "email":"rick.pelton@marklogic.com"}, "renderDescriptionAs":"normal"}
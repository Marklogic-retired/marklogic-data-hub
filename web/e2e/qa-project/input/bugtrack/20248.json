{"id":20248, "kind":"Bug", "createdAt":"2012-12-11T07:32:17.11829-08:00", "status":"Closed", "title":"cts:highlight does not work when a not-query is inside a near-query", "category":"search", "severity":"Minor", "priority":{"level":"5", "title":""}, "submittedBy":{"username":"rjovanovich", "name":"Richard Jovanovich", "email":"richard.jovanovich@marklogic.com"}, "assignTo":{"username":"nobody", "name":"nobody nobody", "email":"nobody@marklogic.com"}, "description":"Below is a test case that shows this behavior:\r\n\r\nlet $article := <article>Google Nexus S Android </article>\r\n \r\nlet $working-query := cts:near-query(\r\n(cts:and-not-query(cts:word-query(\"Android\"), cts:word-query(\"iphone\"))),1)\r\n \r\nlet $not-working-query := cts:near-query(\r\n(cts:word-query(\"Android\"), cts:not-query( cts:word-query(\"iphone\"))),1)\r\n \r\nlet $Works := cts:contains($article, $working-query)\r\nlet $DoesntWork := cts:contains($article, $not-working-query)\r\nreturn ($Works,$DoesntWork)\r\n=>\r\ntrue\r\ntrue\r\n \r\nBoth the queries match. Now replace cts:contains with cts:highlight.\r\n \r\nlet $Works := cts:highlight($article, $working-query, <span class=\"highlight\">{$cts:text}</span>)\r\nlet $DoesntWork := cts:highlight($article, $not-working-query, <span class=\"highlight\">{$cts:text}</span>)\r\nreturn ($Works,$DoesntWork)\r\n=>\r\n<article>Google Nexus S <span class=\"highlight\">Android</span> </article>\r\n<article>Google Nexus S Android </article>", "samplequery":"", "sampledata":"", "version":"5.0-3.3", "tofixin":"5.0-6", "fixedin":"5.0-6", "platform":"all", "memory":"", "processors":"", "note":"", "subscribers":[{"username":"rjovanovich", "name":"Richard Jovanovich", "email":"richard.jovanovich@marklogic.com"}, {"username":"gchinchwadkar", "name":"Gajanan Chinchwadkar", "email":"Gajanan.Chinchwadkar@marklogic.com"}, {"username":"rpolasani", "name":"Raghu Polasani", "email":"raghu.polasani@marklogic.com"}, {"username":"ksaxena", "name":"Kapil Saxena", "email":"kapil.saxena@marklogic.com"}], "attachments":[], "relationships":[{"type":"", "to":""}], "clones":[20249], "cloneOf":"", "support":{"headline":"cts:highlight false negatives occur when query has cts:not-query nested inside cts:near-query.", "supportDescription":"cts:highlight reports incorrect results when query has cts:not-query nested inside cts:near-query.", "workaround":"Redesign query to use cts:and-not-query instead of cts:not-query.", "publishStatus":"Publish", "tickets":["12222", " 12414"], "customerImpact":{"level":"Low", "title":"Minimal business impact or reasonable workaround is available"}}, "tags":["search", "rjovanovich"], "changeHistory":[{"time":"2012-12-11T07:32:17.11829-08:00", "updatedBy":{"username":"rjovanovich", "name":"Richard Jovanovich", "email":"richard.jovanovich@marklogic.com"}, "change":{"assignTo":{"from":{"username":"rjovanovich", "name":"Richard Jovanovich", "email":"richard.jovanovich@marklogic.com"}, "to":{"username":"gchinchwadkar", "name":"Gajanan Chinchwadkar", "email":"Gajanan.Chinchwadkar@marklogic.com"}}}, "files":[], "show":true}, {"time":"2013-01-15T13:13:15.643751-08:00", "updatedBy":{"username":"gchinchwadkar", "name":"Gajanan Chinchwadkar", "email":"Gajanan.Chinchwadkar@marklogic.com"}, "change":{}, "files":[], "show":true, "comment":"Discussed in server team meeting and decided to push it to 5.0.5. We will fix this in a later release."}, {"time":"2013-01-15T13:13:15.643751-08:00", "updatedBy":{"username":"gchinchwadkar", "name":"Gajanan Chinchwadkar", "email":"Gajanan.Chinchwadkar@marklogic.com"}, "change":{"tofixin":{"from":"5.0-5", "to":"5.0-6"}}, "files":[], "show":true}, {"time":"2013-02-13T07:23:10.290961-08:00", "updatedBy":{"username":"gchinchwadkar", "name":"Gajanan Chinchwadkar", "email":"Gajanan.Chinchwadkar@marklogic.com"}, "change":{}, "files":[], "show":true, "comment":"Waiting for b5_0 to open from 5.0.5. Bug fixed in other branches."}, {"time":"2013-03-04T13:26:05.200123-08:00", "updatedBy":{"username":"gchinchwadkar", "name":"Gajanan Chinchwadkar", "email":"Gajanan.Chinchwadkar@marklogic.com"}, "change":{}, "files":[], "show":true, "svn":{"repository":"/project/engsvn", "revision":"134822", "paths":["xdmp/branches/b5_0/src/SearchBuiltins.cpp"], "affectedBugs":[]}, "comment":"Fix for bug:20248.\n"}, {"time":"2013-03-04T13:28:08.226627-08:00", "updatedBy":{"username":"gchinchwadkar", "name":"Gajanan Chinchwadkar", "email":"Gajanan.Chinchwadkar@marklogic.com"}, "change":{"status":{"from":"", "to":"Test"}, "assignTo":{"from":{"username":"gchinchwadkar", "name":"Gajanan Chinchwadkar", "email":"Gajanan.Chinchwadkar@marklogic.com"}, "to":{"username":"rpolasani", "name":"Raghu Polasani", "email":"raghu.polasani@marklogic.com"}}}, "files":[], "show":true}, {"time":"2013-03-04T13:28:08.226627-08:00", "updatedBy":{"username":"gchinchwadkar", "name":"Gajanan Chinchwadkar", "email":"Gajanan.Chinchwadkar@marklogic.com"}, "change":{"assignTo":{"from":{"username":"gchinchwadkar", "name":"Gajanan Chinchwadkar", "email":"Gajanan.Chinchwadkar@marklogic.com"}, "to":{"username":"rpolasani", "name":"Raghu Polasani", "email":"raghu.polasani@marklogic.com"}}}, "files":[], "show":true}, {"time":"2013-03-07T00:58:01.202759-08:00", "updatedBy":{"username":"ksaxena", "name":"Kapil Saxena", "email":"kapil.saxena@marklogic.com"}, "change":{"assignTo":{"from":{"username":"ksaxena", "name":"Kapil Saxena", "email":"kapil.saxena@marklogic.com"}, "to":{"username":"ksaxena", "name":"Kapil Saxena", "email":"kapil.saxena@marklogic.com"}}}, "files":[], "show":true}, {"time":"2013-03-08T02:28:38.650191-08:00", "updatedBy":{"username":"ksaxena", "name":"Kapil Saxena", "email":"kapil.saxena@marklogic.com"}, "change":{"status":{"from":"", "to":"Ship"}, "assignTo":{"from":{"username":"ksaxena", "name":"Kapil Saxena", "email":"kapil.saxena@marklogic.com"}, "to":{"username":"nobody", "name":"nobody nobody", "email":"nobody@marklogic.com"}}}, "files":[], "show":true, "comment":"Verified and test bug20248.xml has been added."}, {"time":"2013-03-08T02:28:38.650191-08:00", "updatedBy":{"username":"ksaxena", "name":"Kapil Saxena", "email":"kapil.saxena@marklogic.com"}, "change":{"assignTo":{"from":{"username":"ksaxena", "name":"Kapil Saxena", "email":"kapil.saxena@marklogic.com"}, "to":{"username":"nobody", "name":"nobody nobody", "email":"nobody@marklogic.com"}}}, "files":[], "show":true}, {"time":"2014-04-09T16:10:11.229916-07:00", "updatedBy":{"username":"rpelton", "name":"Rick Pelton", "email":"rick.pelton@marklogic.com"}, "change":{"status":{"from":"", "to":"Closed"}, "assignTo":{"from":{"username":"rpelton", "name":"Rick Pelton", "email":"rick.pelton@marklogic.com"}, "to":{"username":"nobody", "name":"nobody nobody", "email":"nobody@marklogic.com"}}}, "files":[], "show":true, "comment":"ga"}], "updatedAt":"2014-04-09T16:10:11.229916-07:00", "fixedAt":"2013-03-04T13:28:08.226627-08:00", "fixedBy":{"username":"gchinchwadkar", "name":"Gajanan Chinchwadkar", "email":"Gajanan.Chinchwadkar@marklogic.com"}, "shippedAt":"2013-03-08T02:28:38.650191-08:00", "shippedBy":{"username":"ksaxena", "name":"Kapil Saxena", "email":"kapil.saxena@marklogic.com"}, "closedAt":"2014-04-09T16:10:11.229916-07:00", "closedBy":{"username":"rpelton", "name":"Rick Pelton", "email":"rick.pelton@marklogic.com"}, "renderDescriptionAs":"normal"}
{"id":20117, "kind":"Bug", "createdAt":"2012-11-19T12:31:41.072496-08:00", "status":"Will not fix", "title":"Multipart encoding is missing few things from the standard", "category":"xdmp", "severity":"Minor", "priority":{"level":"5", "title":""}, "submittedBy":{"username":"skottam", "name":"Sravan Kottam", "email":"Sravan.Kottam@marklogic.com"}, "assignTo":{"username":"nobody", "name":"nobody nobody", "email":"nobody@marklogic.com"}, "description":"Run the following query in Qconsole:\r\n\r\n xquery version \"1.0-ml\";\r\n        let $x:=xdmp:document-get(\"QA_HOME/testdata/foo.xml\")\r\n        let $y:= xdmp:document-get(\"QA_HOME/app/NFC.xsl\")\r\n        let $z:=text{xdmp:to-json((\"a\",fn:false()))}\r\n        let $boundary-string:=\"gc0p4Jq0M2Yt08jU534c0pgc0p4Jq0M2Yt08jU534c0pgc0p4Jq0M2Yt08jU534c0pgc0p4Jq0M2Yt08jU534c0pgc0p4Jq0M2Yt08jU534c0pgc0p4Jq0M2Yt08jU534c0pgc0p4Jq0M2Yt08jU534c0pgc0p4Jq0M2Yt08jU534c0pgc0p4Jq0M2Yt08jU534c0pgc0p4Jq0M2Yt08jU534c0p\"\r\n        let $mpe:= xdmp:multipart-encode(\r\n                $boundary-string,\r\n                <manifest><part><headers>\r\n                                <Content-Type>xml</Content-Type>\r\n                                <boundary>gc0p4Jq0M2Yt08jU534c0p</boundary>\r\n                                </headers>\r\n                          </part>\r\n                         <part><headers>\r\n                                <Content-Type>xsl</Content-Type>\r\n                                <Content-Length>329</Content-Length>\r\n                                </headers>\r\n                        </part><part/>\r\n                </manifest>,\r\n                ($x,$y,$z)\r\n                )\r\nreturn\r\n   $mpe\r\n\r\n\r\n\r\nRef to the standard: http://www.w3.org/Protocols/rfc1341/7_2_Multipart.html\r\n\r\n1. Note that the encapsulation boundary must occur at the beginning of a line, i.e., following a CRLF, and that that initial CRLF is considered to be part of the encapsulation boundary rather than part of the preceding part. The boundary must be followed immediately either by another CRLF and the header fields for the next part, or by two CRLFs, in which case there are no header fields for the next part (and it is therefore assumed to be of Content-Type text/plain).\r\n\r\nActual:\r\n\r\nI see a missing CRLF at the beginning of the encapsulation boundary.\r\n\r\n2. Encapsulation boundaries must not appear within the encapsulations, and must be no longer than 70 characters, not counting the two leading hyphens.\r\n\r\nActual:\r\n\r\nI am able to encode and decode with a boundary string greater than 70 characters.\r\n\r\n3. \tAs stated in the definition of the Content-Transfer-Encoding field, no encoding other than \"7bit\", \"8bit\", or \"binary\" is permitted for entities of type \"multipart\". The multipart delimiters and header fields are always 7-bit ASCII in any case, and data within the body parts can be encoded on a part-by-part basis, with Content-Transfer-Encoding fields for each appropriate body part\r\n\r\nActual:\r\nWhen I used boundary string as non ascii i.e. like \" \\u4eba\\u985e\\u793e\\u4f1a\\u306e\\u3059\\u3079\\u3066\\u306e\\u69cb\\u6210\\u54e1\\u306e\\u56fa\\u6709\\u306e\\u5c0a\\u53b3\\u3068\\u5e73\\u7b49\\u3067\\u8b72\\u308b\\u3053\\u3068\\u306e\\u3067\\u304d\\u306a\\u3044\\u6a29\\u5229\\u3068\\u3092\\u627f\\u8a8d\\u3059\\u308b\\u3053\\u3068\\u306f\" (japanies characters) or boundary string with white spaces then I am able to encode but failed to decode.", "samplequery":"", "sampledata":"", "version":"6.0-nightly", "tofixin":"N/A", "fixedin":"N/A", "platform":"all", "memory":"", "processors":"", "note":"", "subscribers":[{"username":"skottam", "name":"Sravan Kottam", "email":"Sravan.Kottam@marklogic.com"}, {"username":"wfeick", "name":"Wayne Feick", "email":"wfeick@marklogic.com"}, {"username":"hwu", "name":"Haitao Wu", "email":"haitao.wu@marklogic.com"}], "attachments":[], "relationships":[{"type":"", "to":""}], "clones":[22889], "cloneOf":"", "support":{"headline":"", "supportDescription":"", "publishStatus":"Not Ready", "tickets":[], "customerImpact":{"level":"N/A", "title":""}, "workaround":""}, "tags":["xdmp", "skottam"], "changeHistory":[{"time":"2012-11-19T12:31:41.072496-08:00", "updatedBy":{"username":"skottam", "name":"Sravan Kottam", "email":"Sravan.Kottam@marklogic.com"}, "change":{"assignTo":{"from":{"username":"skottam", "name":"Sravan Kottam", "email":"Sravan.Kottam@marklogic.com"}, "to":{"username":"wfeick", "name":"Wayne Feick", "email":"wfeick@marklogic.com"}}}, "files":[], "show":true}, {"time":"2013-01-21T13:51:24.294457-08:00", "updatedBy":{"username":"wfeick", "name":"Wayne Feick", "email":"wfeick@marklogic.com"}, "change":{"assignTo":{"from":{"username":"wfeick", "name":"Wayne Feick", "email":"wfeick@marklogic.com"}, "to":{"username":"hwu", "name":"Haitao Wu", "email":"haitao.wu@marklogic.com"}}}, "files":[], "show":true}, {"time":"2013-02-27T18:24:07.572271-08:00", "updatedBy":{"username":"rhu", "name":"Ron Hu", "email":"ron.hu@marklogic.com"}, "change":{"tofixin":{"from":"6.0-3", "to":"6.0-4"}}, "files":[], "show":true}, {"time":"2013-05-22T12:26:04.13132-07:00", "updatedBy":{"username":"hwu", "name":"Haitao Wu", "email":"haitao.wu@marklogic.com"}, "change":{"tofixin":{"from":"6.0-4", "to":"6.0-5"}}, "files":[], "show":true}, {"time":"2014-02-19T15:38:02.171153-08:00", "updatedBy":{"username":"hwu", "name":"Haitao Wu", "email":"haitao.wu@marklogic.com"}, "change":{"tofixin":{"from":"6.0-5", "to":"6.0-6"}}, "files":[], "show":true}, {"time":"2015-05-27T21:01:44.7475-07:00", "updatedBy":{"username":"gvaidees", "name":"Ganesh Vaideeswaran", "email":"Ganesh.Vaideeswaran@marklogic.com"}, "change":{"status":{"from":"Verify", "to":"Will not fix"}, "assignTo":{"from":{"username":"gvaidees", "name":"Ganesh Vaideeswaran", "email":"Ganesh.Vaideeswaran@marklogic.com"}, "to":{"username":"nobody", "name":"nobody nobody", "email":"nobody@marklogic.com"}}}, "files":[], "show":true, "comment":"Not requested by support"}, {"time":"2015-05-27T21:01:44.7475-07:00", "updatedBy":{"username":"gvaidees", "name":"Ganesh Vaideeswaran", "email":"Ganesh.Vaideeswaran@marklogic.com"}, "change":{"assignTo":{"from":{"username":"gvaidees", "name":"Ganesh Vaideeswaran", "email":"Ganesh.Vaideeswaran@marklogic.com"}, "to":{"username":"nobody", "name":"nobody nobody", "email":"nobody@marklogic.com"}}}, "files":[], "show":true}], "updatedAt":"2015-05-27T21:01:44.7475-07:00", "renderDescriptionAs":"normal"}
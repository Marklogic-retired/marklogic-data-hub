{"id":20657, "kind":"Bug", "createdAt":"2013-01-30T23:43:40.679503-08:00", "status":"Closed", "title":"Regression: Test dbrep-largebin.xml is failing reporting \"Socket receive error\"", "category":"Replication", "severity":"Critical", "priority":{"level":"5", "title":""}, "submittedBy":{"username":"ksaxena", "name":"Kapil Saxena", "email":"kapil.saxena@marklogic.com"}, "assignTo":{"username":"nobody", "name":"nobody nobody", "email":"nobody@marklogic.com"}, "description":"Test Name: dbrep-largebin.xml\r\nML Version: 5.0-20130130\r\n\r\nLink to diff: \r\nhttps://regression-status.marklogic.com/new-app/space2/diff-archive/b5_0/2013-01-30/linux-64-rh54-cluster-RH5.4/diffs/MC-dbrep-largebin.xml\r\n\r\n\r\nXQuery:\r\nxquery version \"1.0-ml\";\r\nimport module namespace dbrepRemoteAdmin='http://marklogic.com/admin/dbrepRemoteAdmin' at \"dbrep-remote-admin.xqy\";\r\nlet $forest-names := (\"dbrepBinFor1\",\"dbrepBinFor2\",\"dbrepBinFor3\")\r\nlet $sec-hosts := xdmp:document-get(\"QA_HOME/replicationInfo.xml\")//*:remotehost/@names\r\nlet $httphost := fn:tokenize($sec-hosts, \",\")[1]\r\nreturn\r\ndbrepRemoteAdmin:wait-open-replica($httphost, $forest-names)\r\n\r\n\r\nHere's what I see in ErrorLog: \r\n\r\n2013-01-30 01:49:39.723 Debug: Retrying XDBCConnectionTask::handleEval 9900849087426252549 Update 1 because XDMP-JOURNALCONSUMERSHUTDOWN: Journal consumer has been shut down\r\n2013-01-30 01:49:39.897 Debug: BinaryManager::decrementBinaryRefCount  forest=dbrepBinFor1, path=/var/opt/MarkLogic/Forests/dbrepBinFor1/Large/04d/137a98f6b05f3cbd\r\n2013-01-30 01:49:39.897 Debug: Retrying XDBCConnectionTask::handleEval 9900849087426252549 Update 2 because XDMP-JOURNALCONSUMERSHUTDOWN: Journal consumer has been shut down\r\n2013-01-30 01:49:40.106 Debug: BinaryManager::decrementBinaryRefCount  forest=dbrepBinFor1, path=/var/opt/MarkLogic/Forests/dbrepBinFor1/Large/0f5/3d76d9fe3a27dd19\r\n2013-01-30 01:49:40.106 Debug: Retrying XDBCConnectionTask::handleEval 9900849087426252549 Update 3 because XDMP-JOURNALCONSUMERSHUTDOWN: Journal consumer has been shut down\r\n2013-01-30 01:49:40.557 Debug: BinaryManager::decrementBinaryRefCount  forest=dbrepBinFor1, path=/var/opt/MarkLogic/Forests/dbrepBinFor1/Large/136/4db8bc70623ee798\r\n2013-01-30 01:49:40.558 Debug: Retrying XDBCConnectionTask::handleEval 9900849087426252549 Update 4 because XDMP-JOURNALCONSUMERSHUTDOWN: Journal consumer has been shut down\r\n2013-01-30 01:49:40.574 Error: PooledThread::run: SVC-FILWRT: File write error: write '/var/opt/MarkLogic/Forests/dbrepBinFor2/Label': No space left on device\r\n2013-01-30 01:49:41.597 Info: Deleted 15 MB in 1 sec at 1970 MB/sec /var/opt/MarkLogic/Forests/dbrepBinFor1/00000000\r\n2013-01-30 01:49:41.602 Info: Deleted 15 MB in 1 sec at 3049 MB/sec /var/opt/MarkLogic/Forests/dbrepBinFor1/00000001\r\n2013-01-30 01:49:51.245 Error: ForestSynchronizeThread::run: dbrepBinFor3 Error: SVC-FILWRT: File write error: write '/var/opt/MarkLogic/Forests/dbrepBinFor3/Large/112/tmp-44b0807d0e6b0664': No space left on device\r\n....\r\n2013-01-30 01:50:32.264 Error: ForestSynchronizeThread::run: dbrepBinFor3 Error: SVC-FILWRT: File write error: write '/var/opt/MarkLogic/Forests/dbrepBinFor3/Large/112/tmp-44b0807d0e6b0664': No space left on device\r\n....\r\n2013-01-30 01:56:18.988 Notice: QAxdbcServer: SVC-SOCRECV: xdmp:http-get(\"http://rh54-intel64-43-test-1.marklogic.com:8050/dbrep-wait-open...\", <options xmlns=\"xdmp:http\"><authentication method=\"digest\"><username>admin</username><passw...</options>) -- Socket receive error: wait 172.18.10.101:11631-172.18.9.121:8050: Timeout\r\n2013-01-30 01:56:18.988 Notice: QAxdbcServer: in /dbrep-remote-admin.xqy, at 652:0,\r\n2013-01-30 01:56:18.988 Notice: QAxdbcServer: in dbrepRemoteAdmin:wait-open-replica(\"rh54-intel64-43-test-1.marklogic.com\", (\"dbrepBinFor1\", \"dbrepBinFor2\", \"dbrepBinFor3\")) [1.0-ml]\r\n2013-01-30 01:56:18.988 Notice: QAxdbcServer:   $host = \"rh54-intel64-43-test-1.marklogic.com\"\r\n2013-01-30 01:56:18.988 Notice: QAxdbcServer:   $forest-names = (\"dbrepBinFor1\", \"dbrepBinFor2\", \"dbrepBinFor3\")\r\n2013-01-30 01:56:18.988 Notice: QAxdbcServer: at 10:5 [1.0-ml]\r\n2013-01-30 01:56:18.988 Notice: QAxdbcServer:   $forest-names = (\"dbrepBinFor1\", \"dbrepBinFor2\", \"dbrepBinFor3\")\r\n2013-01-30 01:56:18.988 Notice: QAxdbcServer:   $sec-hosts = attribute{fn:QName(\"\", \"names\")}{\"rh54-intel64-43-test-1.marklogic.com,rh54-intel64-43-test-2.mark...\"}\r\n2013-01-30 01:56:18.988 Notice: QAxdbcServer:   $httphost = \"rh54-intel64-43-test-1.marklogic.com\"\r\n2013-01-30 01:56:20.210 Debug: InMemoryStand /var/opt/MarkLogic/Forests/dbrepBinFor2/00000001, disk=15MB, memory=655MB, list=512MB, tree=128MB, rangeIndex=16MB, reverseIndex=16MB\r\n2013-01-30 01:56:20.226 Debug: ForeignForest(rh54-intel64-43-test-1.marklogic.com-cluster,rh54-intel64-43-test-1.marklogic.com,dbrepBinFor2) finish failed: SVC-DIRCREAT: Directory creation error: mkdir '/var/opt/MarkLogic/Forests/dbrepBinFor2/00000001': No space left on device\r\n \r\nWhen I checked the disk space available, I saw all 3 nodes have sufficient space available. \r\n", "samplequery":"", "sampledata":"", "version":"5.0-nightly", "tofixin":"5.0-5", "fixedin":"N/A", "platform":"all", "memory":"", "processors":"", "note":"", "subscribers":[{"username":"ksaxena", "name":"Kapil Saxena", "email":"kapil.saxena@marklogic.com"}, {"username":"wfeick", "name":"Wayne Feick", "email":"wfeick@marklogic.com"}, {"username":"svempati", "name":"Sundeep Vempati", "email":"sundeep.vempati@marklogic.com"}], "attachments":[], "relationships":[{"type":"", "to":""}], "clones":[], "cloneOf":"", "support":{"headline":"", "supportDescription":"", "publishStatus":"Not Ready", "tickets":[], "customerImpact":{"level":"N/A", "title":""}, "workaround":""}, "tags":["Replication", "ksaxena"], "changeHistory":[{"time":"2013-01-30T23:43:40.679503-08:00", "updatedBy":{"username":"ksaxena", "name":"Kapil Saxena", "email":"kapil.saxena@marklogic.com"}, "change":{"assignTo":{"from":{"username":"ksaxena", "name":"Kapil Saxena", "email":"kapil.saxena@marklogic.com"}, "to":{"username":"wfeick", "name":"Wayne Feick", "email":"wfeick@marklogic.com"}}}, "files":[], "show":true}, {"time":"2013-01-31T16:41:01.662257-08:00", "updatedBy":{"username":"wfeick", "name":"Wayne Feick", "email":"wfeick@marklogic.com"}, "change":{}, "files":[], "show":true, "comment":"The log messages are complaining about no space left on device. That's likely the source of your problem."}, {"time":"2013-01-31T16:41:01.662257-08:00", "updatedBy":{"username":"wfeick", "name":"Wayne Feick", "email":"wfeick@marklogic.com"}, "change":{"assignTo":{"from":{"username":"wfeick", "name":"Wayne Feick", "email":"wfeick@marklogic.com"}, "to":{"username":"ksaxena", "name":"Kapil Saxena", "email":"kapil.saxena@marklogic.com"}}}, "files":[], "show":true}, {"time":"2013-02-01T10:52:09.372787-08:00", "updatedBy":{"username":"rpolasani", "name":"Raghu Polasani", "email":"raghu.polasani@marklogic.com"}, "change":{}, "files":[], "show":true, "comment":"Sundeep, Can you check if data directory is sym-linked to /space on all the d-nodes in the cluster. Also can you try to reproduce the problem by rerunning the test if disk space is not an issue?"}, {"time":"2013-02-01T10:52:09.372787-08:00", "updatedBy":{"username":"rpolasani", "name":"Raghu Polasani", "email":"raghu.polasani@marklogic.com"}, "change":{"assignTo":{"from":{"username":"rpolasani", "name":"Raghu Polasani", "email":"raghu.polasani@marklogic.com"}, "to":{"username":"svempati", "name":"Sundeep Vempati", "email":"sundeep.vempati@marklogic.com"}}}, "files":[], "show":true}, {"time":"2013-02-01T11:00:37.343257-08:00", "updatedBy":{"username":"svempati", "name":"Sundeep Vempati", "email":"sundeep.vempati@marklogic.com"}, "change":{}, "files":[], "show":true, "comment":"Data Directory is sym-linked to /space on all of these machines. may be we can change it to /space2 which has more disk space.\r\n\r\nbuilder@rh54-intel64-43-build$ ls -l /var/opt\r\ntotal 0\r\nlrwxrwxrwx 1 root root 16 May 11  2011 MarkLogic -> /space/MarkLogic/\r\nbuilder@rh54-intel64-43-build$ df -h \r\nFilesystem            Size  Used Avail Use% Mounted on\r\n/dev/cciss/c0d0p7     2.0G  597M  1.3G  32% /\r\n/dev/cciss/c0d0p8     178G   83G   86G  50% /space\r\n/dev/cciss/c0d0p6     3.9G  1.7G  2.1G  45% /var\r\n/dev/cciss/c0d0p5     3.9G  669M  3.1G  18% /opt\r\n/dev/cciss/c0d0p3      16G  8.9G  5.6G  62% /usr\r\n/dev/cciss/c0d0p1     487M   23M  439M   5% /boot\r\ntmpfs                  12G     0   12G   0% /dev/shm\r\ntmpfs                  12G  100M   12G   1% /tmp\r\n/dev/mapper/Data1-Vol1\r\n                      2.2T  8.8G  2.1T   1% /space2\r\nhomer2:/disk/d2/home/builder\r\n                      4.2T  3.7T  241G  95% /home/builder\r\nhomer2:/disk/d2/home/rpolasani\r\n                      4.2T  3.7T  241G  95% /home/rpolasani\r\nbuilder@rh54-intel64-43-build$ \r\n\r\n\r\nbuilder@rh54-intel64-43-test-1$ \r\nbuilder@rh54-intel64-43-test-1$ ls -l /var/opt\r\ntotal 0\r\nlrwxrwxrwx 1 root root 16 Jan 30 23:41 MarkLogic -> /space/MarkLogic/\r\nbuilder@rh54-intel64-43-test-1$ df -h\r\nFilesystem            Size  Used Avail Use% Mounted on\r\n/dev/cciss/c0d0p7     2.0G  570M  1.3G  31% /\r\n/dev/cciss/c0d0p8     178G   52G  117G  31% /space\r\n/dev/cciss/c0d0p6     3.9G  633M  3.1G  17% /var\r\n/dev/cciss/c0d0p5     3.9G  429M  3.3G  12% /opt\r\n/dev/cciss/c0d0p3      16G  8.9G  5.6G  62% /usr\r\n/dev/cciss/c0d0p1     487M   23M  439M   5% /boot\r\ntmpfs                  12G     0   12G   0% /dev/shm\r\ntmpfs                  12G  118M   12G   1% /tmp\r\n/dev/mapper/Data1-Vol1\r\n                      1.1T  199M  1.1T   1% /space2\r\nhomer2:/disk/d2/home/builder\r\n                      4.2T  3.7T  241G  95% /home/builder\r\nhomer2:/disk/d2/home/rpolasani\r\n                      4.2T  3.7T  241G  95% /home/rpolasani\r\nbuilder@rh54-intel64-43-test-1$ \r\n\r\n\r\n\r\nbuilder@rh54-intel64-43-test-2$ \r\nbuilder@rh54-intel64-43-test-2$ ls -l /var/opt\r\ntotal 0\r\nlrwxrwxrwx 1 root root 16 Jan 30 23:41 MarkLogic -> /space/MarkLogic/\r\nbuilder@rh54-intel64-43-test-2$ \r\nbuilder@rh54-intel64-43-test-2$ df -h\r\nFilesystem            Size  Used Avail Use% Mounted on\r\n/dev/cciss/c0d0p7     2.0G  570M  1.3G  31% /\r\n/dev/cciss/c0d0p8     178G   25G  144G  15% /space\r\n/dev/cciss/c0d0p6     3.9G  608M  3.1G  17% /var\r\n/dev/cciss/c0d0p5     3.9G  429M  3.3G  12% /opt\r\n/dev/cciss/c0d0p3      16G  8.9G  5.6G  62% /usr\r\n/dev/cciss/c0d0p1     487M   23M  439M   5% /boot\r\ntmpfs                  12G     0   12G   0% /dev/shm\r\ntmpfs                  12G  118M   12G   1% /tmp\r\n/dev/mapper/Data1-Vol1\r\n                      1.1T  199M  1.1T   1% /space2\r\nhomer2:/disk/d2/home/builder\r\n                      4.2T  3.7T  241G  95% /home/builder\r\nhomer2:/disk/d2/home/rpolasani\r\n                      4.2T  3.7T  241G  95% /home/rpolasani\r\nbuilder@rh54-intel64-43-test-2$ \r\n\r\n\r\n"}, {"time":"2013-02-03T23:02:52.65014-08:00", "updatedBy":{"username":"ksaxena", "name":"Kapil Saxena", "email":"kapil.saxena@marklogic.com"}, "change":{"status":{"from":"", "to":"Closed"}, "assignTo":{"from":{"username":"ksaxena", "name":"Kapil Saxena", "email":"kapil.saxena@marklogic.com"}, "to":{"username":"nobody", "name":"nobody nobody", "email":"nobody@marklogic.com"}}}, "files":[], "show":true, "comment":"We are not seeing this for past couple of days. Hence, closing.\r\n\r\nWill log a new bug if it occurs again!"}, {"time":"2013-02-03T23:02:52.65014-08:00", "updatedBy":{"username":"ksaxena", "name":"Kapil Saxena", "email":"kapil.saxena@marklogic.com"}, "change":{"assignTo":{"from":{"username":"ksaxena", "name":"Kapil Saxena", "email":"kapil.saxena@marklogic.com"}, "to":{"username":"nobody", "name":"nobody nobody", "email":"nobody@marklogic.com"}}}, "files":[], "show":true}], "updatedAt":"2013-02-03T23:02:52.65014-08:00", "closedAt":"2013-02-03T23:02:52.65014-08:00", "closedBy":{"username":"ksaxena", "name":"Kapil Saxena", "email":"kapil.saxena@marklogic.com"}, "renderDescriptionAs":"normal"}
{"id":2062, "kind":"Bug", "createdAt":"2005-08-05T12:04:17.630005-07:00", "status":"Closed", "title":"order by sort orders different (but each arguably correct) in certain situations", "category":"xdmp", "severity":"Functional", "priority":{"level":"5", "title":""}, "submittedBy":{"username":"ian", "name":"Ian Small", "email":"ian@cerisent.com"}, "assignTo":{"username":"nobody", "name":"nobody nobody", "email":"nobody@marklogic.com"}, "description":"In 3.0-2, during testing to evaluate the status of fast-order-by, I constructed two queries:\n\n(for $doc in input()\norder by xs:int($doc/tiny-1)\nreturn $doc/tiny-1)[1 to 10]\n\n(for $doc in input()\norder by xs:int($doc/tiny-1) + 0\nreturn $doc/tiny-1)[1 to 10]\n\ntiny-1 is densely packed - there are many documents with the same values of tiny-1.\n\nThe two queries returned the same results, ordered correctly.  However, if instead of returning $doc/tiny-1, I change them to return base-uri($doc), they return differently ordered results, because the order within the set of documents with tiny-1 = 0, for instance, is different between the two queries.\n\nEach is stable in its own right (ie. running them repeatedly returns the same results).  But the rules of stability appear to be different.", "samplequery":"", "sampledata":"", "version":"3.0-2", "tofixin":"3.0-4", "fixedin":"3.0-4", "platform":"linux", "memory":"", "processors":"", "note":"", "subscribers":[{"username":"ian", "name":"Ian Small", "email":"ian@cerisent.com"}], "attachments":[], "clones":[], "cloneOf":"", "support":{"headline":"Certain order by expressions do not perform stable sorts", "supportDescription":"Order by expressions that are not evaluated directly out of the indexes can return results in which \"equivalent\" items are out of order with respect to the input.  Note that the results are guaranteed to be ordered correctly on a gross basis according to the sort key, but items with equivalently-valued keys may be returned out of order with respect to the order in which those items occurred in the input to the order by expression.\n", "publishStatus":"Publish", "tickets":[], "customerImpact":{"level":"N/A", "title":""}, "workaround":""}, "tags":["xdmp", "ian"], "changeHistory":[{"time":"2005-08-06T10:04:32.743061-07:00", "updatedBy":{"username":"ian", "name":"Ian Small", "email":"ian@cerisent.com"}, "change":{}, "files":[], "show":true, "comment":"let's discuss so that we can:\n(a) understand what's going on\n(b) decide if, what and when to do something about it"}, {"time":"2005-08-10T15:44:46.487179-07:00", "updatedBy":{"username":"cjl", "name":"Christopher Lindblad", "email":"cjl@cerisent.com"}, "change":{"status":{"from":"", "to":"Fix"}, "assignTo":{"from":{"username":"cjl", "name":"Christopher Lindblad", "email":"cjl@cerisent.com"}, "to":{"username":"cjl", "name":"Christopher Lindblad", "email":"cjl@cerisent.com"}}}, "files":[], "show":true, "comment":"fix"}, {"time":"2005-10-28T14:19:23.87523-07:00", "updatedBy":{"username":"cjl", "name":"Christopher Lindblad", "email":"cjl@cerisent.com"}, "change":{"status":{"from":"", "to":"Test"}, "assignTo":{"from":{"username":"cjl", "name":"Christopher Lindblad", "email":"cjl@cerisent.com"}, "to":{"username":"rwang", "name":"Rachel Link", "email":"rwang@cerisent.com"}}}, "files":[], "show":true, "comment":"fixed in 3.0-20051029\nand in 3.1-20051029\n\nHere's a test case. \nResults should come out in alphabetic order.\nThey used to come out in random order.\n\n<foo>{\nfor $x in (<foo><a/><b/><c/><d/><e/><f/><g/><h/><i/><j/><k/><l/><m/><n/><o/><p/><q/><r/><s/><t/><u/><v/><w/><x/><y/><z/></foo>)/*\norder by $x\nreturn $x\n}</foo>\n\n"}, {"time":"2005-10-31T14:27:11.120759-08:00", "updatedBy":{"username":"rwang", "name":"Rachel Link", "email":"rwang@cerisent.com"}, "change":{"status":{"from":"", "to":"Ship"}, "assignTo":{"from":{"username":"rwang", "name":"Rachel Link", "email":"rwang@cerisent.com"}, "to":{"username":"nobody", "name":"nobody nobody", "email":"nobody@marklogic.com"}}}, "files":[], "show":true, "comment":"verified on build 1031. "}], "updatedAt":"2005-10-31T14:27:11.120759-08:00", "fixedAt":"2005-10-28T14:19:23.87523-07:00", "fixedBy":{"username":"cjl", "name":"Christopher Lindblad", "email":"cjl@cerisent.com"}, "shippedAt":"2005-10-31T14:27:11.120759-08:00", "shippedBy":{"username":"rwang", "name":"Rachel Link", "email":"rwang@cerisent.com"}, "renderDescriptionAs":"normal"}
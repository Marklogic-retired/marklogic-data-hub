{"id":20199, "kind":"Bug", "createdAt":"2012-10-23T09:37:08.230186-07:00", "status":"Closed", "title":"incorrect x509 version in generated certificates", "category":"security", "severity":"Major", "priority":{"level":"5", "title":""}, "submittedBy":{"username":"fsalonga", "name":"Frank Salonga", "email":"franklin.salonga@marklogic.com"}, "assignTo":{"username":"nobody", "name":"nobody nobody", "email":"nobody@marklogic.com"}, "description":"from this case: https://help.marklogic.com/staff/Tickets/Ticket/View/11919\r\n\r\nRFC2986 requires the x509 version to be 0. We generate certificates with version set to 2. It's possible to workaround the issue by creating/inserting a certificate with the fields set appropriately (see below), but we really should not be requiring customers to go through this exercise.\r\n\r\nxquery version \"1.0-ml\";\r\nimport module namespace pki = \"http://marklogic.com/xdmp/pki\"\r\nat \"/MarkLogic/pki.xqy\";\r\n\r\ndeclare namespace x509 = \"http://marklogic.com/xdmp/x509\";\r\ndeclare namespace ssl = \"http://marklogic.com/xdmp/ssl\";\r\n\r\nlet $x509 :=\r\n<x509:req>\r\n<x509:version>0</x509:version>\r\n<x509:subject>\r\n<x509:organizationName>UBS AG</x509:organizationName>\r\n<x509:organizationalUnitName>CDC RRR</x509:organizationalUnitName>\r\n</x509:subject>\r\n</x509:req>\r\n\r\nlet $options :=\r\n<pki:key-options xmlns=\"ssl:options\">\r\n<key-length>2048</key-length>\r\n</pki:key-options>\r\n\r\n\r\nreturn pki:insert-template(\r\npki:create-template(\r\n\"newTemplate\",\r\n\"Creating a new template\",\r\n\"rsa\",\r\n$options,\r\n$x509))", "samplequery":"", "sampledata":"", "version":"6.0-2", "tofixin":"6.0-3", "fixedin":"6.0-3", "platform":"linux(64-bit)", "memory":"", "processors":"", "note":"", "subscribers":[{"username":"fsalonga", "name":"Frank Salonga", "email":"franklin.salonga@marklogic.com"}, {"username":"rpolasani", "name":"Raghu Polasani", "email":"raghu.polasani@marklogic.com"}, {"username":"wfeick", "name":"Wayne Feick", "email":"wfeick@marklogic.com"}], "attachments":[], "relationships":[{"type":"", "to":""}], "clones":[], "cloneOf":19874, "support":{"headline":"Generated X509 certificate requests have incorrect version", "supportDescription":"X509 certificate requests are generated incorrectly with a version of 2 rather than 0.", "workaround":"", "publishStatus":"Publish", "tickets":["11919", "11212"], "customerImpact":{"level":"Medium", "title":"Requires significant or unnatural effort to work around issue or to prevent significant business impact"}}, "tags":["security", "fsalonga"], "changeHistory":[{"time":"2012-10-25T14:29:14.067747-07:00", "updatedBy":{"username":"rhu", "name":"Ron Hu", "email":"ron.hu@marklogic.com"}, "change":{"status":{"from":"", "to":"Verify"}, "assignTo":{"from":{"username":"rhu", "name":"Ron Hu", "email":"ron.hu@marklogic.com"}, "to":{"username":"wfeick", "name":"Wayne Feick", "email":"wfeick@marklogic.com"}}}, "files":[], "show":true}, {"time":"2012-10-25T14:29:14.067747-07:00", "updatedBy":{"username":"rhu", "name":"Ron Hu", "email":"ron.hu@marklogic.com"}, "change":{"assignTo":{"from":{"username":"rhu", "name":"Ron Hu", "email":"ron.hu@marklogic.com"}, "to":{"username":"wfeick", "name":"Wayne Feick", "email":"wfeick@marklogic.com"}}}, "files":[], "show":true}, {"time":"2012-10-25T14:29:14.067747-07:00", "updatedBy":{"username":"rhu", "name":"Ron Hu", "email":"ron.hu@marklogic.com"}, "change":{"tofixin":{"from":"", "to":"5.0-5"}}, "files":[], "show":true}, {"time":"2012-12-05T11:55:08.293426-08:00", "updatedBy":{"username":"rpelton", "name":"Rick Pelton", "email":"rick.pelton@marklogic.com"}, "change":{"tofixin":{"from":"", "to":"6.0-3"}}, "files":[], "show":true}, {"time":"2013-01-18T22:15:16.800605-08:00", "updatedBy":{"username":"wfeick", "name":"Wayne Feick", "email":"wfeick@marklogic.com"}, "change":{}, "files":[], "show":true, "svn":{"repository":"/project/engsvn", "revision":"128371", "paths":["xdmp/branches/b6_0/src/Messages/PKI-en.xml", "xdmp/branches/b6_0/src/Admin/lib/certificate-template-admin-form.xqy", "xdmp/branches/b6_0/src/Modules/MarkLogic/pki.xqy"], "affectedBugs":[]}, "comment":"bug:20199 CSR version must always be 0, but the certificate itself should be 2."}, {"time":"2013-01-18T22:27:40.284391-08:00", "updatedBy":{"username":"wfeick", "name":"Wayne Feick", "email":"wfeick@marklogic.com"}, "change":{"assignTo":{"from":{"username":"wfeick", "name":"Wayne Feick", "email":"wfeick@marklogic.com"}, "to":{"username":"rpolasani", "name":"Raghu Polasani", "email":"raghu.polasani@marklogic.com"}}}, "files":[], "show":true}, {"time":"2013-02-20T17:09:39.843553-08:00", "updatedBy":{"username":"vkorolev", "name":"Vitaly Korolev", "email":"vitaly.korolev@marklogic.com"}, "change":{}, "files":[], "show":true, "svn":{"repository":"/project/engsvn", "revision":"132739", "paths":["qa/branches/b6_0/scripts/tests/rest-client-api-security-01.xml"], "affectedBugs":[]}, "comment":"SSL version changed according to bug:20199."}, {"time":"2013-02-25T11:00:34.91573-08:00", "updatedBy":{"username":"rpelton", "name":"Rick Pelton", "email":"rick.pelton@marklogic.com"}, "change":{}, "files":[], "show":true, "comment":"SHould this be in test state?"}, {"time":"2013-02-25T11:02:14.061678-08:00", "updatedBy":{"username":"wfeick", "name":"Wayne Feick", "email":"wfeick@marklogic.com"}, "change":{"status":{"from":"", "to":"Test"}, "assignTo":{"from":{"username":"wfeick", "name":"Wayne Feick", "email":"wfeick@marklogic.com"}, "to":{"username":"rpolasani", "name":"Raghu Polasani", "email":"raghu.polasani@marklogic.com"}}}, "files":[], "show":true}, {"time":"2013-03-21T23:31:23.31768-07:00", "updatedBy":{"username":"rpolasani", "name":"Raghu Polasani", "email":"raghu.polasani@marklogic.com"}, "change":{"assignTo":{"from":{"username":"rpolasani", "name":"Raghu Polasani", "email":"raghu.polasani@marklogic.com"}, "to":{"username":"svempati", "name":"Sundeep Vempati", "email":"sundeep.vempati@marklogic.com"}}}, "files":[], "show":true}, {"time":"2013-03-29T14:18:33.141441-07:00", "updatedBy":{"username":"svempati", "name":"Sundeep Vempati", "email":"sundeep.vempati@marklogic.com"}, "change":{"status":{"from":"", "to":"Ship"}, "assignTo":{"from":{"username":"svempati", "name":"Sundeep Vempati", "email":"sundeep.vempati@marklogic.com"}, "to":{"username":"nobody", "name":"nobody nobody", "email":"nobody@marklogic.com"}}}, "files":[], "show":true, "comment":"Verified with MarkLogic-6.0-20130328\r\n\r\nTest in regression: bug20199.xml\r\ntest suite: bugs51"}, {"time":"2013-04-22T16:21:58.553114-07:00", "updatedBy":{"username":"rpelton", "name":"Rick Pelton", "email":"rick.pelton@marklogic.com"}, "change":{"status":{"from":"", "to":"Closed"}, "assignTo":{"from":{"username":"rpelton", "name":"Rick Pelton", "email":"rick.pelton@marklogic.com"}, "to":{"username":"nobody", "name":"nobody nobody", "email":"nobody@marklogic.com"}}}, "files":[], "show":true}], "updatedAt":"2013-04-22T16:21:58.553114-07:00", "fixedAt":"2013-02-25T11:02:14.061678-08:00", "fixedBy":{"username":"wfeick", "name":"Wayne Feick", "email":"wfeick@marklogic.com"}, "shippedAt":"2013-03-29T14:18:33.141441-07:00", "shippedBy":{"username":"svempati", "name":"Sundeep Vempati", "email":"sundeep.vempati@marklogic.com"}, "closedAt":"2013-04-22T16:21:58.553114-07:00", "closedBy":{"username":"rpelton", "name":"Rick Pelton", "email":"rick.pelton@marklogic.com"}, "renderDescriptionAs":"normal"}
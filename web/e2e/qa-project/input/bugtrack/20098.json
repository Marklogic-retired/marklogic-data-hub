{"id":20098, "kind":"Bug", "createdAt":"2012-11-14T20:53:08.524518-08:00", "status":"Closed", "title":"Issue with xsl:message", "category":"XSLT", "severity":"Major", "priority":{"level":"5", "title":""}, "submittedBy":{"username":"dchander", "name":"Dinesh Chander", "email":"dinesh.chander@globallogic.com"}, "assignTo":{"username":"nobody", "name":"nobody nobody", "email":"nobody@marklogic.com"}, "description":"Reported by user in case #12077\r\n\r\n------------------------------------------------------------------------------------------------------------------------------------\r\nI am running MarkLogic 6.0-1.1, and am able to reproduce it with QConsole with this code:\r\n\r\nlet $doc := xdmp:document-get(\"d:\\Projecten\\NDP Media\\Samples\\ftpusers\\fd\\HFD_20121026_0_017_088\\HFD_20121026_0_015_061.xml\")\r\nlet $log := xdmp:log('before')\r\nlet $xsl := xdmp:xslt-invoke(\"/NDP-Plugins/legacy_nd.xsl\", $doc)\r\nlet $log := xdmp:log('after')\r\nreturn $xsl\r\n\r\nAttached the entire xml and xsl. Note that I use an xslt-invoke above, so easiest if you drop the xsl under /Modules/ inside the MarkLogic installation directory.\r\n\r\nThe log ‘after’ line is not reached, but this is how my log looks like:\r\n\r\n2012-11-06 12:55:34.837 Info: App-Services: before\r\n2012-11-06 12:55:34.838 Info: App-Services: Unsupported root element newsItem\r\n2012-11-06 12:55:34.839 Info: App-Services: Unsupported root element newsItem\r\n\r\nError message:\r\nXSLT-MSGTERMINATE: (err:XTMM9000) <xsl:message terminate=\"yes\"><xsl:value-of select=\"fn:concat(\"Unsupported root element\", fn:name(.))\"/></xsl:message> -- xsl:message instruction called with terminate\r\n\r\nThe first (double log entries) is not a big issue, but the latter (unevaluated xsl:message in error) is awkward. I'd really like to use the\r\nxsl:message contents to generate a dynamic error message..\r\n\r\nKind regards,\r\nGeert", "samplequery":"Run this in QC.\r\n\r\nlet $doc := xdmp:document-get(\"d:\\Projecten\\NDP Media\\Samples\\ftpusers\\fd\\HFD_20121026_0_017_088\\HFD_20121026_0_015_061.xml\")\r\nlet $log := xdmp:log('before')\r\nlet $xsl := xdmp:xslt-invoke(\"/NDP-Plugins/legacy_nd.xsl\", $doc)\r\nlet $log := xdmp:log('after')\r\nreturn $xsl\r\n\r\nAttached the entire xml and xsl. Note that I use an xslt-invoke above, so easiest if you drop the xsl under /Modules/ inside the MarkLogic installation directory.", "sampledata":"", "version":"6.0-1", "tofixin":"6.0-3", "fixedin":"6.0-3", "platform":"all", "memory":"", "processors":"", "note":"", "subscribers":[{"username":"dchander", "name":"Dinesh Chander", "email":"dinesh.chander@globallogic.com"}, {"username":"jsnelson", "name":"John Snelson", "email":"jsnelson@marklogic.com"}, {"username":"rpolasani", "name":"Raghu Polasani", "email":"raghu.polasani@marklogic.com"}, {"username":"msrinivasan", "name":"Mahalakshmi Srinivasan", "email":"mahalakshmi.srinivasan@marklogic.com"}], "attachments":[{"name":"HFD_20121026_0_015_061.xml", "uri":"root/support/bugtracking/attachments/20098/HFD_20121026_0_015_061.xml"}, {"name":"legacy_nd.xsl", "uri":"root/support/bugtracking/attachments/20098/legacy_nd.xsl"}], "relationships":[{"type":"", "to":""}], "clones":[], "cloneOf":"", "support":{"headline":"Occasionally, XSLT instructions inside templates get executed twice ", "supportDescription":"Occasionally, XSLT instructions inside templates get executed twice ", "publishStatus":"Publish", "tickets":[], "customerImpact":{"level":"Low", "title":"Minimal business impact or reasonable workaround is available"}, "workaround":""}, "tags":["XSLT", "dchander"], "changeHistory":[{"time":"2012-11-14T20:53:08.524518-08:00", "updatedBy":{"username":"dchander", "name":"Dinesh Chander", "email":"dinesh.chander@globallogic.com"}, "change":{"assignTo":{"from":{"username":"dchander", "name":"Dinesh Chander", "email":"dinesh.chander@globallogic.com"}, "to":{"username":"jsnelson", "name":"John Snelson", "email":"jsnelson@marklogic.com"}}}, "files":[], "show":true}, {"time":"2012-11-15T07:23:46.567753-08:00", "updatedBy":{"username":"jsnelson", "name":"John Snelson", "email":"jsnelson@marklogic.com"}, "change":{"tofixin":{"from":"", "to":"6.0-3"}}, "files":[], "show":true}, {"time":"2012-11-15T08:00:55.80232-08:00", "updatedBy":{"username":"jsnelson", "name":"John Snelson", "email":"jsnelson@marklogic.com"}, "change":{}, "files":[], "show":true, "svn":{"repository":"/project/engsvn", "revision":"120509", "paths":["xdmp/trunk/src/XSLT.cpp"], "affectedBugs":[]}, "comment":"bug:20098 Fix static analysis of xsl:apply-templates etc."}, {"time":"2012-11-15T08:01:43.729351-08:00", "updatedBy":{"username":"jsnelson", "name":"John Snelson", "email":"jsnelson@marklogic.com"}, "change":{}, "files":[], "show":true, "comment":"I still have to commit the fix to b6_0 when the branch reopens after the 6.0-2 release."}, {"time":"2012-11-22T02:22:55.621505-08:00", "updatedBy":{"username":"jsnelson", "name":"John Snelson", "email":"jsnelson@marklogic.com"}, "change":{}, "files":[], "show":true, "svn":{"repository":"/project/engsvn", "revision":"121037", "paths":["xdmp/branches/b6_0/src/XSLT.cpp"], "affectedBugs":[]}, "comment":"bug:20098 Fix static analysis of xsl:apply-templates etc."}, {"time":"2012-11-22T02:24:59.309232-08:00", "updatedBy":{"username":"jsnelson", "name":"John Snelson", "email":"jsnelson@marklogic.com"}, "change":{"status":{"from":"", "to":"Test"}, "assignTo":{"from":{"username":"jsnelson", "name":"John Snelson", "email":"jsnelson@marklogic.com"}, "to":{"username":"rpolasani", "name":"Raghu Polasani", "email":"raghu.polasani@marklogic.com"}}}, "files":[], "show":true, "comment":"FIxed."}, {"time":"2012-11-22T02:24:59.309232-08:00", "updatedBy":{"username":"jsnelson", "name":"John Snelson", "email":"jsnelson@marklogic.com"}, "change":{"assignTo":{"from":{"username":"jsnelson", "name":"John Snelson", "email":"jsnelson@marklogic.com"}, "to":{"username":"rpolasani", "name":"Raghu Polasani", "email":"raghu.polasani@marklogic.com"}}}, "files":[], "show":true}, {"time":"2012-11-27T17:24:26.359566-08:00", "updatedBy":{"username":"rpolasani", "name":"Raghu Polasani", "email":"raghu.polasani@marklogic.com"}, "change":{"assignTo":{"from":{"username":"rpolasani", "name":"Raghu Polasani", "email":"raghu.polasani@marklogic.com"}, "to":{"username":"msrinivasan", "name":"Mahalakshmi Srinivasan", "email":"mahalakshmi.srinivasan@marklogic.com"}}}, "files":[], "show":true}, {"time":"2013-03-18T15:15:29.121827-07:00", "updatedBy":{"username":"msrinivasan", "name":"Mahalakshmi Srinivasan", "email":"mahalakshmi.srinivasan@marklogic.com"}, "change":{}, "files":[], "show":true, "comment":"Hi John,\r\nCan you please attach the stylesheet and the xml used to the bug?\r\nThanks!\r\n"}, {"time":"2013-03-18T15:15:29.121827-07:00", "updatedBy":{"username":"msrinivasan", "name":"Mahalakshmi Srinivasan", "email":"mahalakshmi.srinivasan@marklogic.com"}, "change":{"assignTo":{"from":{"username":"msrinivasan", "name":"Mahalakshmi Srinivasan", "email":"mahalakshmi.srinivasan@marklogic.com"}, "to":{"username":"jsnelson", "name":"John Snelson", "email":"jsnelson@marklogic.com"}}}, "files":[], "show":true}, {"time":"2013-04-02T09:46:57.874243-07:00", "updatedBy":{"username":"jsnelson", "name":"John Snelson", "email":"jsnelson@marklogic.com"}, "change":{}, "files":[], "show":true, "comment":"Attached as requested."}, {"time":"2013-04-02T09:46:57.874243-07:00", "updatedBy":{"username":"jsnelson", "name":"John Snelson", "email":"jsnelson@marklogic.com"}, "change":{"assignTo":{"from":{"username":"jsnelson", "name":"John Snelson", "email":"jsnelson@marklogic.com"}, "to":{"username":"msrinivasan", "name":"Mahalakshmi Srinivasan", "email":"mahalakshmi.srinivasan@marklogic.com"}}}, "files":[], "show":true}, {"time":"2013-04-02T16:29:28.000149-07:00", "updatedBy":{"username":"msrinivasan", "name":"Mahalakshmi Srinivasan", "email":"mahalakshmi.srinivasan@marklogic.com"}, "change":{"status":{"from":"", "to":"Verify"}, "assignTo":{"from":{"username":"msrinivasan", "name":"Mahalakshmi Srinivasan", "email":"mahalakshmi.srinivasan@marklogic.com"}, "to":{"username":"jsnelson", "name":"John Snelson", "email":"jsnelson@marklogic.com"}}}, "files":[], "show":true, "comment":"Thanks John!! So now I'm seeing only one \r\n2013-04-02 16:22:08.802 Info: App-Services: Unsupported root element newsItem\r\n\r\nmessage in ErrorLogs. Is that the fix?"}, {"time":"2013-04-02T16:29:28.000149-07:00", "updatedBy":{"username":"msrinivasan", "name":"Mahalakshmi Srinivasan", "email":"mahalakshmi.srinivasan@marklogic.com"}, "change":{"assignTo":{"from":{"username":"msrinivasan", "name":"Mahalakshmi Srinivasan", "email":"mahalakshmi.srinivasan@marklogic.com"}, "to":{"username":"jsnelson", "name":"John Snelson", "email":"jsnelson@marklogic.com"}}}, "files":[], "show":true}, {"time":"2013-04-03T06:27:18.250048-07:00", "updatedBy":{"username":"jsnelson", "name":"John Snelson", "email":"jsnelson@marklogic.com"}, "change":{}, "files":[], "show":true, "comment":"Yes, that's the fix."}, {"time":"2013-04-03T06:27:18.250048-07:00", "updatedBy":{"username":"jsnelson", "name":"John Snelson", "email":"jsnelson@marklogic.com"}, "change":{"assignTo":{"from":{"username":"jsnelson", "name":"John Snelson", "email":"jsnelson@marklogic.com"}, "to":{"username":"msrinivasan", "name":"Mahalakshmi Srinivasan", "email":"mahalakshmi.srinivasan@marklogic.com"}}}, "files":[], "show":true}, {"time":"2013-04-05T08:27:23.683548-07:00", "updatedBy":{"username":"rpelton", "name":"Rick Pelton", "email":"rick.pelton@marklogic.com"}, "change":{}, "files":[], "show":true, "comment":"If this bug is fixed, please change the status field as appropriate.\r\nThanks"}, {"time":"2013-04-05T08:35:12.714648-07:00", "updatedBy":{"username":"jsnelson", "name":"John Snelson", "email":"jsnelson@marklogic.com"}, "change":{"status":{"from":"", "to":"Test"}, "assignTo":{"from":{"username":"jsnelson", "name":"John Snelson", "email":"jsnelson@marklogic.com"}, "to":{"username":"msrinivasan", "name":"Mahalakshmi Srinivasan", "email":"mahalakshmi.srinivasan@marklogic.com"}}}, "files":[], "show":true}, {"time":"2013-04-07T23:30:57.928254-07:00", "updatedBy":{"username":"msrinivasan", "name":"Mahalakshmi Srinivasan", "email":"mahalakshmi.srinivasan@marklogic.com"}, "change":{"status":{"from":"", "to":"Ship"}, "assignTo":{"from":{"username":"msrinivasan", "name":"Mahalakshmi Srinivasan", "email":"mahalakshmi.srinivasan@marklogic.com"}, "to":{"username":"nobody", "name":"nobody nobody", "email":"nobody@marklogic.com"}}}, "files":[], "show":true, "comment":"Verified on build 6.0-2030331"}, {"time":"2013-04-22T16:31:48.226699-07:00", "updatedBy":{"username":"rpelton", "name":"Rick Pelton", "email":"rick.pelton@marklogic.com"}, "change":{"status":{"from":"", "to":"Closed"}, "assignTo":{"from":{"username":"rpelton", "name":"Rick Pelton", "email":"rick.pelton@marklogic.com"}, "to":{"username":"nobody", "name":"nobody nobody", "email":"nobody@marklogic.com"}}}, "files":[], "show":true}], "updatedAt":"2013-04-22T16:31:48.226699-07:00", "fixedAt":"2013-04-05T08:35:12.714648-07:00", "fixedBy":{"username":"jsnelson", "name":"John Snelson", "email":"jsnelson@marklogic.com"}, "shippedAt":"2013-04-07T23:30:57.928254-07:00", "shippedBy":{"username":"msrinivasan", "name":"Mahalakshmi Srinivasan", "email":"mahalakshmi.srinivasan@marklogic.com"}, "closedAt":"2013-04-22T16:31:48.226699-07:00", "closedBy":{"username":"rpelton", "name":"Rick Pelton", "email":"rick.pelton@marklogic.com"}, "renderDescriptionAs":"normal", "renderSampleQueryAs":"normal"}
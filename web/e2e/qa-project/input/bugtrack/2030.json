{"id":2030, "kind":"Bug", "createdAt":"2005-08-02T21:08:12.954443-07:00", "status":"Closed", "title":"cts:element-value-query fails across fragment boundary", "category":"search", "severity":"Critical", "priority":{"level":"5", "title":""}, "submittedBy":{"username":"michael", "name":"Michael Blakeley", "email":"michael.blakeley@marklogic.com"}, "assignTo":{"username":"nobody", "name":"nobody nobody", "email":"nobody@marklogic.com"}, "description":"* set up a fragment root on \"http://www.w3.org/1999/xhtml\",\"head\"\n\n* insert a test document\n\ndefault element namespace = \"http://www.w3.org/1999/xhtml\"\nlet $d :=<html><head><a>bb</a></head></html>\nreturn xdmp:document-insert(\"test.xml\", $d)\n\n* try to retrieve the test document\n\ndefault element namespace = \"http://www.w3.org/1999/xhtml\" \nlet $q :=   cts:element-value-query(xs:QName(\"a\"), \"bb\")\nreturn count(doc()/html[cts:contains(head, $q)])\n\nUnexpected behavior: count() returns 0\n\nExpected behavior: count() should return 1\n\nWorkaround: these two queries work as expected:\n\nlet $q :=   cts:element-value-query(xs:QName(\"a\"), \"bb\")\nreturn count(cts:search(/htm, $q))\n\nlet $q :=   cts:element-value-query(xs:QName(\"a\"), \"bb\")\nreturn count(cts:search(/htm/head, $q))", "samplequery":"", "sampledata":"", "version":"3.0-2", "tofixin":"3.0-3", "fixedin":"3.0-3", "platform":"linux", "memory":"", "processors":"", "note":"", "subscribers":[{"username":"michael", "name":"Michael Blakeley", "email":"michael.blakeley@marklogic.com"}], "attachments":[], "clones":[], "cloneOf":"", "support":{"headline":"cts:contains() of cts:element-value-query() incorrect across fragmentation boundary", "supportDescription":"Using cts:contains() with a cts:element-value-query() query will fail to find matches if the matches exist across a fragmentation boundary.  In this scenario, results can be omitted.", "publishStatus":"Publish", "tickets":[], "customerImpact":{"level":"N/A", "title":""}, "workaround":"Restructure the query to use cts:search() rather than cts:contains(), if possible."}, "tags":["search", "michael"], "changeHistory":[{"time":"2005-08-10T15:11:33.358429-07:00", "updatedBy":{"username":"cjl", "name":"Christopher Lindblad", "email":"cjl@cerisent.com"}, "change":{"status":{"from":"", "to":"Fix"}, "assignTo":{"from":{"username":"cjl", "name":"Christopher Lindblad", "email":"cjl@cerisent.com"}, "to":{"username":"cjl", "name":"Christopher Lindblad", "email":"cjl@cerisent.com"}}}, "files":[], "show":true, "comment":"fix"}, {"time":"2005-08-14T20:50:57.07481-07:00", "updatedBy":{"username":"cjl", "name":"Christopher Lindblad", "email":"cjl@cerisent.com"}, "change":{"status":{"from":"", "to":"Test"}, "assignTo":{"from":{"username":"cjl", "name":"Christopher Lindblad", "email":"cjl@cerisent.com"}, "to":{"username":"rwang", "name":"Rachel Link", "email":"rwang@cerisent.com"}}}, "files":[], "show":true, "comment":"Fixed in 3.0-20050815\nand in 3.1-20050815"}, {"time":"2005-08-16T12:04:45.516726-07:00", "updatedBy":{"username":"rwang", "name":"Rachel Link", "email":"rwang@cerisent.com"}, "change":{"status":{"from":"", "to":"Ship"}, "assignTo":{"from":{"username":"rwang", "name":"Rachel Link", "email":"rwang@cerisent.com"}, "to":{"username":"nobody", "name":"nobody nobody", "email":"nobody@marklogic.com"}}}, "files":[], "show":true, "comment":"verified on build 0816. "}], "updatedAt":"2005-08-16T12:04:45.516726-07:00", "fixedAt":"2005-08-14T20:50:57.07481-07:00", "fixedBy":{"username":"cjl", "name":"Christopher Lindblad", "email":"cjl@cerisent.com"}, "shippedAt":"2005-08-16T12:04:45.516726-07:00", "shippedBy":{"username":"rwang", "name":"Rachel Link", "email":"rwang@cerisent.com"}, "renderDescriptionAs":"normal"}
{"id":20011, "kind":"Bug", "createdAt":"2012-11-06T19:06:37.905224-08:00", "status":"Closed", "title":"element-word-query returns wrong results with multiple QNames", "category":"search", "severity":"Major", "priority":{"level":"5", "title":""}, "submittedBy":{"username":"sravotto", "name":"Silvano  Ravotto", "email":"sravotto@marklogic.com"}, "assignTo":{"username":"nobody", "name":"nobody nobody", "email":"nobody@marklogic.com"}, "description":"Create a new database set all the indexes to false except: word searches,  element word positions. Also, set stemming to \"off\".\r\n\r\nInsert the following documents:\r\n\r\nxdmp:document-insert(\"/tmp/a.xml\", <r><a>one</a><b>two</b></r>);\r\nxdmp:document-insert(\"/tmp/b.xml\", <r><a>three</a><b>four</b></r>);\r\nxdmp:document-insert(\"/tmp/c.xml\", <r><a>five</a><b>six</b></r>)\r\n\r\n\r\nRun the following queries:\r\n\r\nxdmp:estimate(cts:search(fn:doc(), cts:element-word-query((xs:QName(\"a\")), \"one\")))\r\n\r\n=> 1  (correct)\r\n\r\nxdmp:estimate(cts:search(fn:doc(), cts:element-word-query((xs:QName(\"a\"),xs:QName(\"b\")), \"one\")))\r\n\r\n=> 3  (returns all the documents)", "samplequery":"", "sampledata":"", "version":"5.0-4", "tofixin":"5.0-5", "fixedin":"5.0-5", "platform":"all", "memory":"", "processors":"", "note":"", "subscribers":[{"username":"sravotto", "name":"Silvano  Ravotto", "email":"sravotto@marklogic.com"}, {"username":"mary", "name":"Mary Holstege", "email":"mary@cerisent.com"}, {"username":"rpolasani", "name":"Raghu Polasani", "email":"raghu.polasani@marklogic.com"}], "attachments":[], "relationships":[{"type":"", "to":""}], "clones":[20361, 20362], "cloneOf":"", "support":{"headline":"cts:element-word-query with multiple elements returning too many false positives if fast-element-word-searches and word-positions are turned off", "supportDescription":"For example, cts:search(doc(), cts:element-word-query((xs:QName(\"a\"),xs:QName(\"b\")),\"one\"), \"unfiltered\") will incorrectly match the following document:\r\n<r><a>three</a><b>four</b></r>", "publishStatus":"Publish", "tickets":[], "customerImpact":{"level":"N/A", "title":""}, "workaround":"Enable fast-element-word-searches or word-positions."}, "tags":["search", "sravotto"], "changeHistory":[{"time":"2012-11-06T19:06:37.905224-08:00", "updatedBy":{"username":"sravotto", "name":"Silvano  Ravotto", "email":"sravotto@marklogic.com"}, "change":{"assignTo":{"from":{"username":"sravotto", "name":"Silvano  Ravotto", "email":"sravotto@marklogic.com"}, "to":{"username":"mary", "name":"Mary Holstege", "email":"mary@cerisent.com"}}}, "files":[], "show":true}, {"time":"2012-11-06T19:13:50.240119-08:00", "updatedBy":{"username":"sravotto", "name":"Silvano  Ravotto", "email":"sravotto@marklogic.com"}, "change":{}, "files":[], "show":true, "comment":"Also, this query is not correct:\r\n\r\nxdmp:estimate(cts:search(fn:doc(), cts:element-word-query((xs:QName(\"dummy\")), \"one\")))\r\n\r\n==> 1\r\n\r\nUsing fast-element-phrase-searches instead of element-word-positions returns the correct result."}, {"time":"2012-11-07T11:15:16.726206-08:00", "updatedBy":{"username":"rhu", "name":"Ron Hu", "email":"ron.hu@marklogic.com"}, "change":{"tofixin":{"from":"", "to":"5.0-5"}}, "files":[], "show":true}, {"time":"2012-12-10T13:21:39.431218-08:00", "updatedBy":{"username":"rhu", "name":"Ron Hu", "email":"ron.hu@marklogic.com"}, "change":{}, "files":[], "show":true, "comment":"Mary,\r\nPlease investigate this bug."}, {"time":"2013-01-02T11:13:23.015476-08:00", "updatedBy":{"username":"mary", "name":"Mary Holstege", "email":"mary@cerisent.com"}, "change":{}, "files":[], "show":true, "comment":"element-word-positions is meaningless without fast-element-word enabled: these are the positions associated with the element-word entries from fast-element-word. If you turn on fast-element-word or plain word-positions the query cts:element-word-query(xs:QName(\"dummy\"),\"one\")) will be accurate."}, {"time":"2013-01-02T14:53:10.490855-08:00", "updatedBy":{"username":"mary", "name":"Mary Holstege", "email":"mary@cerisent.com"}, "change":{"status":{"from":"", "to":"Test"}, "assignTo":{"from":{"username":"mary", "name":"Mary Holstege", "email":"mary@cerisent.com"}, "to":{"username":"rpolasani", "name":"Raghu Polasani", "email":"raghu.polasani@marklogic.com"}}}, "files":[], "show":true, "comment":"Fixed 5.0-20130103\r\n\r\nRevision 126280 SearchBuiltins.cpp\r\n\r\nIncorrectly leaving off necessary clauses when e-w-q has multiple elements, side-effect of avoiding duplicate clauses."}, {"time":"2013-01-02T14:53:10.490855-08:00", "updatedBy":{"username":"mary", "name":"Mary Holstege", "email":"mary@cerisent.com"}, "change":{"assignTo":{"from":{"username":"mary", "name":"Mary Holstege", "email":"mary@cerisent.com"}, "to":{"username":"rpolasani", "name":"Raghu Polasani", "email":"raghu.polasani@marklogic.com"}}}, "files":[], "show":true}, {"time":"2013-01-08T12:18:26.217769-08:00", "updatedBy":{"username":"jsolis", "name":"Julio Solis", "email":"Julio.Solis@marklogic.com"}, "change":{"assignTo":{"from":{"username":"jsolis", "name":"Julio Solis", "email":"Julio.Solis@marklogic.com"}, "to":{"username":"jsolis", "name":"Julio Solis", "email":"Julio.Solis@marklogic.com"}}}, "files":[], "show":true}, {"time":"2013-01-09T14:31:08.054052-08:00", "updatedBy":{"username":"mary", "name":"Mary Holstege", "email":"mary@cerisent.com"}, "change":{}, "files":[], "show":true, "svn":{"repository":"/project/engsvn", "revision":"127254", "paths":["xdmp/branches/b5_0/src/SearchBuiltins.cpp"], "affectedBugs":["20398"]}, "comment":"Bug:20398 multiple words in element-word-query wrongly handled due to fix for Bug:20011"}, {"time":"2013-01-09T14:59:21.644574-08:00", "updatedBy":{"username":"mary", "name":"Mary Holstege", "email":"mary@cerisent.com"}, "change":{}, "files":[], "show":true, "svn":{"repository":"/project/engsvn", "revision":"127258", "paths":["xdmp/branches/b6_0/src/SearchBuiltins.cpp"], "affectedBugs":["20414"]}, "comment":"Bug:20414 multiple words in element-word-query wrongly handled due to fix for Bug:20011"}, {"time":"2013-01-09T15:18:12.915687-08:00", "updatedBy":{"username":"mary", "name":"Mary Holstege", "email":"mary@cerisent.com"}, "change":{}, "files":[], "show":true, "svn":{"repository":"/project/engsvn", "revision":"127261", "paths":["xdmp/trunk/src/SearchBuiltins.cpp"], "affectedBugs":["20413"]}, "comment":"Bug:20413 multiple words in element-word-query wrongly handled due to fix for Bug:20011"}, {"time":"2013-01-15T15:46:25.391593-08:00", "updatedBy":{"username":"jsolis", "name":"Julio Solis", "email":"Julio.Solis@marklogic.com"}, "change":{"status":{"from":"", "to":"Ship"}, "assignTo":{"from":{"username":"jsolis", "name":"Julio Solis", "email":"Julio.Solis@marklogic.com"}, "to":{"username":"nobody", "name":"nobody nobody", "email":"nobody@marklogic.com"}}}, "files":[], "show":true, "comment":"Verified on build MarkLogic-5.0-20130115.x86_64 . New test case bug20011.xml added to bugs50.txt test suite.\r\n"}, {"time":"2013-01-31T07:41:22.566774-08:00", "updatedBy":{"username":"mary", "name":"Mary Holstege", "email":"mary@cerisent.com"}, "change":{}, "files":[], "show":true, "svn":{"repository":"/project/engsvn", "revision":"130138", "paths":["xdmp/branches/b5_0/src/SearchBuiltins.cpp"], "affectedBugs":["20600", "20398"]}, "comment":"Bug:20600 proper fix for Bug:20011 and Bug:20398 and clones"}, {"time":"2013-02-02T13:25:19.798331-08:00", "updatedBy":{"username":"mary", "name":"Mary Holstege", "email":"mary@cerisent.com"}, "change":{}, "files":[], "show":true, "svn":{"repository":"/project/engsvn", "revision":"130394", "paths":["xdmp/branches/b5_0/src/SearchBuiltins.cpp"], "affectedBugs":["20683"]}, "comment":"Bug:20683 more element-word-query fixes, damage from fix for bug:20011"}, {"time":"2013-02-07T12:28:18.033994-08:00", "updatedBy":{"username":"mary", "name":"Mary Holstege", "email":"mary@cerisent.com"}, "change":{}, "files":[], "show":true, "svn":{"repository":"/project/engsvn", "revision":"130921", "paths":["xdmp/branches/b5_0/src/SearchBuiltins.cpp"], "affectedBugs":["20721"]}, "comment":"Bug:20721 e-w-q again/still; Bug:20011 case was over-constrained"}, {"time":"2013-02-25T17:13:25.28837-08:00", "updatedBy":{"username":"rpelton", "name":"Rick Pelton", "email":"rick.pelton@marklogic.com"}, "change":{"status":{"from":"", "to":"Closed"}, "assignTo":{"from":{"username":"rpelton", "name":"Rick Pelton", "email":"rick.pelton@marklogic.com"}, "to":{"username":"nobody", "name":"nobody nobody", "email":"nobody@marklogic.com"}}}, "files":[], "show":true}], "updatedAt":"2013-02-25T17:13:25.28837-08:00", "fixedAt":"2013-01-02T14:53:10.490855-08:00", "fixedBy":{"username":"mary", "name":"Mary Holstege", "email":"mary@cerisent.com"}, "shippedAt":"2013-01-15T15:46:25.391593-08:00", "shippedBy":{"username":"jsolis", "name":"Julio Solis", "email":"Julio.Solis@marklogic.com"}, "closedAt":"2013-02-25T17:13:25.28837-08:00", "closedBy":{"username":"rpelton", "name":"Rick Pelton", "email":"rick.pelton@marklogic.com"}, "renderDescriptionAs":"normal"}
{"id":20005, "kind":"Bug", "createdAt":"2012-11-06T09:43:47.064496-08:00", "status":"Closed", "title":"java.net.BindException while running multi stmt tx performance test ", "category":"XCC/.Net", "severity":"Catastrophic", "priority":{"level":"5", "title":""}, "submittedBy":{"username":"lratcliff", "name":"Larry Ratcliff", "email":"lratcliff@marklogic.com"}, "assignTo":{"username":"nobody", "name":"nobody nobody", "email":"nobody@marklogic.com"}, "description":"2012-11-06 09:33:45.074 WARNING [14] (AbstractRequestController.runRequest): Cannot obtain connection: Cannot assign requested address\r\n java.net.BindException: Cannot assign requested address\r\n\tsun.nio.ch.Net.connect(Native Method)\r\n\tsun.nio.ch.SocketChannelImpl.connect(SocketChannelImpl.java:500)\r\n\tjava.nio.channels.SocketChannel.open(SocketChannel.java:146)\r\n\tcom.marklogic.xcc.impl.SocketPoolProvider.obtainConnection(SocketPoolProvider.java:93)\r\n\tcom.marklogic.xcc.impl.handlers.AbstractRequestController.runRequest(AbstractRequestController.java:81)\r\n\tcom.marklogic.xcc.impl.SessionImpl.submitRequestInternal(SessionImpl.java:373)\r\n\tcom.marklogic.xcc.impl.SessionImpl.rollback(SessionImpl.java:182)\r\n\ttest.stress.StressTester.rollbackTransaction(StressTester.java:195)\r\n\ttest.stress.LoadTester.loadContentFromDir(LoadTester.java:201)\r\n\ttest.stress.LoadTester.runTest(LoadTester.java:221)\r\n\ttest.stress.StressTest.run(StressTest.java:54)\r\n", "samplequery":"", "sampledata":"", "version":"6.0-nightly", "tofixin":"6.0-2", "fixedin":"6.0-2", "platform":"all", "memory":"", "processors":"", "note":"", "subscribers":[{"username":"lratcliff", "name":"Larry Ratcliff", "email":"lratcliff@marklogic.com"}, {"username":"jchen", "name":"Jane Chen", "email":"jane.chen@marklogic.com"}, {"username":"rpolasani", "name":"Raghu Polasani", "email":"raghu.polasani@marklogic.com"}], "attachments":[], "relationships":[{"type":"", "to":""}], "clones":[20034], "cloneOf":"", "support":{"headline":"XCC Session.insertContent in a multi-statement transaction closes a connection after each request.", "supportDescription":"XCC Session.insertContent in a multi-statement transaction closes a connection after each request.  Repeated calls to Session.insertContent() requires opening a new connection for each request, resulting in a high number of sockets in TIME_WAIT state, and eventually may lead to java.net.BindException.", "publishStatus":"Publish", "tickets":[], "customerImpact":{"level":"N/A", "title":""}, "workaround":""}, "tags":["XCC/.Net", "lratcliff"], "changeHistory":[{"time":"2012-11-06T09:43:47.064496-08:00", "updatedBy":{"username":"lratcliff", "name":"Larry Ratcliff", "email":"lratcliff@marklogic.com"}, "change":{"assignTo":{"from":{"username":"lratcliff", "name":"Larry Ratcliff", "email":"lratcliff@marklogic.com"}, "to":{"username":"jchen", "name":"Jane Chen", "email":"jane.chen@marklogic.com"}}}, "files":[], "show":true}, {"time":"2012-11-06T09:48:46.218909-08:00", "updatedBy":{"username":"jchen", "name":"Jane Chen", "email":"jane.chen@marklogic.com"}, "change":{}, "files":[], "show":true, "comment":"Please provide steps to reproduce."}, {"time":"2012-11-06T09:51:16.186939-08:00", "updatedBy":{"username":"lratcliff", "name":"Larry Ratcliff", "email":"lratcliff@marklogic.com"}, "change":{}, "files":[], "show":true, "comment":"1) log into rh55-intel64-43-test-4 as builder \r\n2) cd /space/builder/builds/linux64/b5_0/qa/stress/widowmaker/perfTest\r\n3) run script ./runTests.sh"}, {"time":"2012-11-06T09:54:17.280101-08:00", "updatedBy":{"username":"jchen", "name":"Jane Chen", "email":"jane.chen@marklogic.com"}, "change":{}, "files":[], "show":true, "comment":"Is that the only machine where this can be reproduced?"}, {"time":"2012-11-06T09:55:17.998146-08:00", "updatedBy":{"username":"lratcliff", "name":"Larry Ratcliff", "email":"lratcliff@marklogic.com"}, "change":{}, "files":[], "show":true, "comment":"I can see if I can reproduce it on my machine. "}, {"time":"2012-11-06T10:00:32.106016-08:00", "updatedBy":{"username":"lratcliff", "name":"Larry Ratcliff", "email":"lratcliff@marklogic.com"}, "change":{}, "files":[], "show":true, "comment":"I actually reproduced it on my desktop much quicker... so you could ammend the instructions to check out b5_0 qa \r\n\r\ncd QA_HOME/stress/widowmaker/perfTest\r\nmodify connectInfo.xml to point to your server \r\nrun test with ./runTests.sh\r\n"}, {"time":"2012-11-06T10:28:55.51659-08:00", "updatedBy":{"username":"jchen", "name":"Jane Chen", "email":"jane.chen@marklogic.com"}, "change":{}, "files":[], "show":true, "comment":"Followed the above and got this:\r\n\r\nCaused by: java.lang.ClassNotFoundException: com.marklogic.performance.PerformanceMeters\r\n\tat java.net.URLClassLoader$1.run(URLClassLoader.java:202)\r\n\tat java.security.AccessController.doPrivileged(Native Method)\r\n\tat java.net.URLClassLoader.findClass(URLClassLoader.java:190)\r\n\tat java.lang.ClassLoader.loadClass(ClassLoader.java:307)\r\n\tat sun.misc.Launcher$AppClassLoader.loadClass(Launcher.java:301)\r\n\tat java.lang.ClassLoader.loadClass(ClassLoader.java:248)\r\nCould not find the main class: com.marklogic.performance.PerformanceMeters.  Program will exit.\r\nmake: *** [ut] Error 1\r\n"}, {"time":"2012-11-06T10:31:06.898926-08:00", "updatedBy":{"username":"lratcliff", "name":"Larry Ratcliff", "email":"lratcliff@marklogic.com"}, "change":{}, "files":[], "show":true, "comment":"Sorry, on a fresh check out you need to type make in the QA_HOME directory in order for performance meters jar and utilities.jar to be built"}, {"time":"2012-11-06T10:32:42.472291-08:00", "updatedBy":{"username":"lratcliff", "name":"Larry Ratcliff", "email":"lratcliff@marklogic.com"}, "change":{}, "files":[], "show":true, "comment":"On my desktop I replaced the xcc.jar with the one built on 11-2 so far it is running fine. I hit the bind issue by this point in a previous run with xcc.jar from todays nightly. "}, {"time":"2012-11-06T10:50:02.765372-08:00", "updatedBy":{"username":"jchen", "name":"Jane Chen", "email":"jane.chen@marklogic.com"}, "change":{}, "files":[], "show":true, "comment":"Please run this periodically when you run the test:\r\n\r\nnetstat -anp | grep WAIT | grep 5275 | wc -l\r\n\r\nand collect the histogram.  The reported number should not keep growing.\r\n\r\nIn my case while running the test for 10 minutes, my reported WAIT stayed below 6000, and I'm not reproducing the bug so far."}, {"time":"2012-11-06T11:22:35.211524-08:00", "updatedBy":{"username":"lratcliff", "name":"Larry Ratcliff", "email":"lratcliff@marklogic.com"}, "change":{}, "files":[], "show":true, "comment":"Looks like this happens in conjunction with a FOREST-NOT error I copied the Error log to /home/lratcliff/20005"}, {"time":"2012-11-06T14:00:54.062325-08:00", "updatedBy":{"username":"jchen", "name":"Jane Chen", "email":"jane.chen@marklogic.com"}, "change":{}, "files":[], "show":true, "comment":"Larry R (11/6/2012 10:38:35 AM): the java code that runs this test is under QA_HOME/testscripts/regression/test/stress\r\nLarry R: when it is built it is in the utilities.jar"}, {"time":"2012-11-06T22:38:56.751-08:00", "updatedBy":{"username":"jchen", "name":"Jane Chen", "email":"jane.chen@marklogic.com"}, "change":{}, "files":[], "show":true, "comment":"I put in some debug info to XCC, and the test ran to completion with no errors."}, {"time":"2012-11-07T10:10:51.804023-08:00", "updatedBy":{"username":"jchen", "name":"Jane Chen", "email":"jane.chen@marklogic.com"}, "change":{}, "files":[], "show":true, "comment":"Found a bunch of broken pipes errors, some with XA in the stack.  The server log has already been removed.\r\n\r\ncom.marklogic.xcc.exceptions.ServerConnectionException: Broken pipe\r\n [Session: user=admin, cb={default} [ContentSource: user=admin, cb={none} [provider: address=rh55-intel64-43-test-4.marklogic.com/172.18.10.103:5275, pool=0/64]]]\r\n [Client: XCC/6.0-1, Server: XDBC/6.0-20121105]\r\n        at com.marklogic.xcc.impl.handlers.AbstractRequestController.runRequest(AbstractRequestController.java:123)\r\n        at com.marklogic.xcc.impl.SessionImpl.submitRequestInternal(SessionImpl.java:390)\r\n        at com.marklogic.xcc.impl.SessionImpl.setTransactionTimeout(SessionImpl.java:151)\r\n        at test.stress.StressTester.setTransactionTimeout(StressTester.java:205)\r\n        at test.stress.LoadTester.loadContentFromDir(LoadTester.java:127)\r\n        at test.stress.LoadTester.runTest(LoadTester.java:221)\r\n        at test.stress.StressTest.run(StressTest.java:54)\r\nCaused by: java.io.IOException: Broken pipe\r\n        at sun.nio.ch.FileDispatcher.write0(Native Method)\r\n        at sun.nio.ch.SocketDispatcher.write(SocketDispatcher.java:29)\r\n        at sun.nio.ch.IOUtil.writeFromNativeBuffer(IOUtil.java:72)\r\n        at sun.nio.ch.IOUtil.write(IOUtil.java:28)\r\n        at sun.nio.ch.SocketChannelImpl.write(SocketChannelImpl.java:334)\r\n        at com.marklogic.http.HttpChannel.writeBuffer(HttpChannel.java:371)\r\n        at com.marklogic.http.HttpChannel.writeBody(HttpChannel.java:353)\r\n        at com.marklogic.http.HttpChannel.flushRequest(HttpChannel.java:347)\r\n        at com.marklogic.http.HttpChannel.receiveMode(HttpChannel.java:275)\r\n        at com.marklogic.http.HttpChannel.getResponseCode(HttpChannel.java:182)\r\n        at com.marklogic.xcc.impl.handlers.EvalRequestController.serverDialog(EvalRequestController.java:72)\r\n        at com.marklogic.xcc.impl.handlers.AbstractRequestController.runRequest(AbstractRequestController.java:84)\r\n        ... 6 more\r\n\r\nNov 6, 2012 10:23:30 PM com.arjuna.ats.internal.jta.recovery.arjunacore.XARecoveryModule xaRecovery\r\nWARN: ARJUNA16027: Local XARecoveryModule.xaRecovery got XA exception XAException.XAER_RMFAIL\r\njavax.transaction.xa.XAException\r\n        at com.marklogic.xcc.impl.XAResourceImpl.handleException(XAResourceImpl.java:171)\r\n        at com.marklogic.xcc.impl.XAResourceImpl.recover(XAResourceImpl.java:342)\r\n        at com.arjuna.ats.internal.jta.recovery.arjunacore.XARecoveryModule.xaRecovery(XARecoveryModule.java:457)\r\n        at com.arjuna.ats.internal.jta.recovery.arjunacore.XARecoveryModule.resourceInitiatedRecoveryForRecoveryHelpers(XARecoveryModule.java:425)\r\n        at com.arjuna.ats.internal.jta.recovery.arjunacore.XARecoveryModule.periodicWorkSecondPass(XARecoveryModule.java:153)\r\n        at com.arjuna.ats.internal.arjuna.recovery.PeriodicRecovery.doWorkInternal(PeriodicRecovery.java:789)\r\n        at com.arjuna.ats.internal.arjuna.recovery.PeriodicRecovery.run(PeriodicRecovery.java:371)\r\nCaused by: com.marklogic.xcc.exceptions.ServerConnectionException: Broken pipe\r\n [Session: user=admin, cb={default} [ContentSource: user=admin, cb={none} [provider: address=rh55-intel64-43-test-4.marklogic.com/172.18.10.103:5275, pool=0/64]]]\r\n [Client: XCC/6.0-1]\r\n        at com.marklogic.xcc.impl.handlers.AbstractRequestController.runRequest(AbstractRequestController.java:123)\r\n        at com.marklogic.xcc.impl.SessionImpl.submitRequestInternal(SessionImpl.java:390)\r\n        at com.marklogic.xcc.impl.XAResourceImpl.recover(XAResourceImpl.java:320)\r\n        ... 5 more\r\nCaused by: java.io.IOException: Broken pipe\r\n        at sun.nio.ch.FileDispatcher.write0(Native Method)\r\n        at sun.nio.ch.SocketDispatcher.write(SocketDispatcher.java:29)\r\n        at sun.nio.ch.IOUtil.writeFromNativeBuffer(IOUtil.java:72)\r\n        at sun.nio.ch.IOUtil.write(IOUtil.java:28)\r\n        at sun.nio.ch.SocketChannelImpl.write(SocketChannelImpl.java:334)\r\n        at com.marklogic.http.HttpChannel.writeBuffer(HttpChannel.java:371)\r\n        at com.marklogic.http.HttpChannel.writeBody(HttpChannel.java:353)\r\n        at com.marklogic.http.HttpChannel.flushRequest(HttpChannel.java:347)\r\n        at com.marklogic.http.HttpChannel.receiveMode(HttpChannel.java:275)\r\n        at com.marklogic.http.HttpChannel.getResponseCode(HttpChannel.java:182)\r\n        at com.marklogic.xcc.impl.handlers.EvalRequestController.serverDialog(EvalRequestController.java:72)\r\n        at com.marklogic.xcc.impl.handlers.AbstractRequestController.runRequest(AbstractRequestController.java:84)\r\n        ... 7 more\r\n\r\nAlso an increase in checked out connections and open connections immediately after the error.\r\n\r\n\r\n"}, {"time":"2012-11-07T10:15:01.715229-08:00", "updatedBy":{"username":"jchen", "name":"Jane Chen", "email":"jane.chen@marklogic.com"}, "change":{}, "files":[], "show":true, "comment":"Here's a stack trace taken when the tests appeared to hang before the broken pipe:\r\n\r\nbuilder@rh55-intel64-43-test-4$ jstack 15226\r\n2012-11-06 22:22:02\r\nFull thread dump Java HotSpot(TM) 64-Bit Server VM (19.1-b02 mixed mode):\r\n\r\n\"Attach Listener\" daemon prio=10 tid=0x00002aaab5245800 nid=0x3ce6 waiting on condition [0x0000000000000000]\r\n   java.lang.Thread.State: RUNNABLE\r\n\r\n\"Thread-9\" prio=10 tid=0x00002aaab4968800 nid=0x3ba0 waiting for monitor entry [0x0000000043e21000]\r\n   java.lang.Thread.State: BLOCKED (on object monitor)\r\n\tat java.util.logging.StreamHandler.publish(StreamHandler.java:174)\r\n\t- waiting to lock <0x0000000687600110> (a java.util.logging.ConsoleHandler)\r\n\tat java.util.logging.ConsoleHandler.publish(ConsoleHandler.java:88)\r\n\tat java.util.logging.Logger.log(Logger.java:481)\r\n\tat java.util.logging.Logger.doLog(Logger.java:503)\r\n\tat java.util.logging.Logger.log(Logger.java:526)\r\n\tat java.util.logging.Logger.info(Logger.java:1045)\r\n\tat com.marklogic.xcc.impl.SocketPoolProvider.obtainConnection(SocketPoolProvider.java:119)\r\n\tat com.marklogic.xcc.impl.handlers.AbstractRequestController.runRequest(AbstractRequestController.java:81)\r\n\tat com.marklogic.xcc.impl.SessionImpl.submitRequestInternal(SessionImpl.java:390)\r\n\tat com.marklogic.xcc.impl.SessionImpl.setTransactionTimeout(SessionImpl.java:151)\r\n\tat test.stress.StressTester.setTransactionTimeout(StressTester.java:205)\r\n\tat test.stress.LoadTester.loadContentFromDir(LoadTester.java:127)\r\n\tat test.stress.LoadTester.runTest(LoadTester.java:221)\r\n\tat test.stress.StressTest.run(StressTest.java:54)\r\n\r\n\"Thread-8\" prio=10 tid=0x00002aaab4965800 nid=0x3b9f runnable [0x0000000043d20000]\r\n   java.lang.Thread.State: RUNNABLE\r\n\tat java.io.FileOutputStream.writeBytes(Native Method)\r\n\tat java.io.FileOutputStream.write(FileOutputStream.java:260)\r\n\tat java.io.BufferedOutputStream.write(BufferedOutputStream.java:105)\r\n\t- locked <0x00000006876f3148> (a java.io.BufferedOutputStream)\r\n\tat java.io.PrintStream.write(PrintStream.java:430)\r\n\t- locked <0x00000006876f3128> (a java.io.PrintStream)\r\n\tat sun.nio.cs.StreamEncoder.writeBytes(StreamEncoder.java:202)\r\n\tat sun.nio.cs.StreamEncoder.implFlushBuffer(StreamEncoder.java:272)\r\n\tat sun.nio.cs.StreamEncoder.implFlush(StreamEncoder.java:276)\r\n\tat sun.nio.cs.StreamEncoder.flush(StreamEncoder.java:122)\r\n\t- locked <0x00000006876dd0a8> (a java.io.OutputStreamWriter)\r\n\tat java.io.OutputStreamWriter.flush(OutputStreamWriter.java:212)\r\n\tat java.util.logging.StreamHandler.flush(StreamHandler.java:225)\r\n\t- locked <0x0000000687600110> (a java.util.logging.ConsoleHandler)\r\n\tat java.util.logging.ConsoleHandler.publish(ConsoleHandler.java:89)\r\n\tat java.util.logging.Logger.log(Logger.java:481)\r\n\tat java.util.logging.Logger.doLog(Logger.java:503)\r\n\tat java.util.logging.Logger.log(Logger.java:526)\r\n\tat java.util.logging.Logger.info(Logger.java:1045)\r\n\tat com.marklogic.xcc.impl.SocketPoolProvider.obtainConnection(SocketPoolProvider.java:125)\r\n\tat com.marklogic.xcc.impl.handlers.AbstractRequestController.runRequest(AbstractRequestController.java:81)\r\n\tat com.marklogic.xcc.impl.SessionImpl.submitRequestInternal(SessionImpl.java:390)\r\n\tat com.marklogic.xcc.impl.SessionImpl.setTransactionTimeout(SessionImpl.java:151)\r\n\tat test.stress.StressTester.setTransactionTimeout(StressTester.java:205)\r\n\tat test.stress.LoadTester.loadContentFromDir(LoadTester.java:127)\r\n\tat test.stress.LoadTester.runTest(LoadTester.java:221)\r\n\tat test.stress.StressTest.run(StressTest.java:54)\r\n\r\n\"Thread-7\" prio=10 tid=0x00002aaab4962800 nid=0x3b9e waiting for monitor entry [0x0000000043c1f000]\r\n   java.lang.Thread.State: BLOCKED (on object monitor)\r\n\tat java.util.logging.StreamHandler.publish(StreamHandler.java:174)\r\n\t- waiting to lock <0x0000000687600110> (a java.util.logging.ConsoleHandler)\r\n\tat java.util.logging.ConsoleHandler.publish(ConsoleHandler.java:88)\r\n\tat java.util.logging.Logger.log(Logger.java:481)\r\n\tat java.util.logging.Logger.doLog(Logger.java:503)\r\n\tat java.util.logging.Logger.log(Logger.java:526)\r\n\tat java.util.logging.Logger.info(Logger.java:1045)\r\n\tat com.marklogic.xcc.impl.SocketPoolProvider.obtainConnection(SocketPoolProvider.java:119)\r\n\tat com.marklogic.xcc.impl.handlers.AbstractRequestController.runRequest(AbstractRequestController.java:81)\r\n\tat com.marklogic.xcc.impl.SessionImpl.submitRequestInternal(SessionImpl.java:390)\r\n\tat com.marklogic.xcc.impl.SessionImpl.setTransactionTimeout(SessionImpl.java:151)\r\n\tat test.stress.StressTester.setTransactionTimeout(StressTester.java:205)\r\n\tat test.stress.LoadTester.loadContentFromDir(LoadTester.java:127)\r\n\tat test.stress.LoadTester.runTest(LoadTester.java:221)\r\n\tat test.stress.StressTest.run(StressTest.java:54)\r\n\r\n\"Thread-6\" prio=10 tid=0x00002aaab4516000 nid=0x3b9d waiting for monitor entry [0x0000000043b1e000]\r\n   java.lang.Thread.State: BLOCKED (on object monitor)\r\n\tat java.util.logging.StreamHandler.publish(StreamHandler.java:174)\r\n\t- waiting to lock <0x0000000687600110> (a java.util.logging.ConsoleHandler)\r\n\tat java.util.logging.ConsoleHandler.publish(ConsoleHandler.java:88)\r\n\tat java.util.logging.Logger.log(Logger.java:481)\r\n\tat java.util.logging.Logger.doLog(Logger.java:503)\r\n\tat java.util.logging.Logger.log(Logger.java:526)\r\n\tat java.util.logging.Logger.info(Logger.java:1045)\r\n\tat com.marklogic.xcc.impl.SocketPoolProvider.obtainConnection(SocketPoolProvider.java:125)\r\n\tat com.marklogic.xcc.impl.handlers.AbstractRequestController.runRequest(AbstractRequestController.java:81)\r\n\tat com.marklogic.xcc.impl.SessionImpl.insertContent(SessionImpl.java:309)\r\n\tat com.marklogic.xcc.impl.SessionImpl.insertContent(SessionImpl.java:274)\r\n\tat com.marklogic.xcc.impl.SessionImpl.insertContent(SessionImpl.java:338)\r\n\tat test.stress.LoadTester.loadContentFromDir(LoadTester.java:139)\r\n\tat test.stress.LoadTester.runTest(LoadTester.java:221)\r\n\tat test.stress.StressTest.run(StressTest.java:54)\r\n\r\n\"Thread-5\" prio=10 tid=0x0000000041cdc000 nid=0x3b9c waiting for monitor entry [0x0000000043a1d000]\r\n   java.lang.Thread.State: BLOCKED (on object monitor)\r\n\tat java.util.logging.StreamHandler.publish(StreamHandler.java:174)\r\n\t- waiting to lock <0x0000000687600110> (a java.util.logging.ConsoleHandler)\r\n\tat java.util.logging.ConsoleHandler.publish(ConsoleHandler.java:88)\r\n\tat java.util.logging.Logger.log(Logger.java:481)\r\n\tat java.util.logging.Logger.doLog(Logger.java:503)\r\n\tat java.util.logging.Logger.log(Logger.java:526)\r\n\tat java.util.logging.Logger.info(Logger.java:1045)\r\n\tat com.marklogic.xcc.impl.SocketPoolProvider.obtainConnection(SocketPoolProvider.java:119)\r\n\tat com.marklogic.xcc.impl.handlers.AbstractRequestController.runRequest(AbstractRequestController.java:81)\r\n\tat com.marklogic.xcc.impl.SessionImpl.submitRequestInternal(SessionImpl.java:390)\r\n\tat com.marklogic.xcc.impl.SessionImpl.setTransactionTimeout(SessionImpl.java:151)\r\n\tat test.stress.StressTester.setTransactionTimeout(StressTester.java:205)\r\n\tat test.stress.LoadTester.loadContentFromDir(LoadTester.java:127)\r\n\tat test.stress.LoadTester.runTest(LoadTester.java:221)\r\n\tat test.stress.StressTest.run(StressTest.java:54)\r\n\r\n\"Thread-4\" prio=10 tid=0x0000000041cdb000 nid=0x3b9b waiting for monitor entry [0x000000004391c000]\r\n   java.lang.Thread.State: BLOCKED (on object monitor)\r\n\tat java.util.logging.StreamHandler.publish(StreamHandler.java:174)\r\n\t- waiting to lock <0x0000000687600110> (a java.util.logging.ConsoleHandler)\r\n\tat java.util.logging.ConsoleHandler.publish(ConsoleHandler.java:88)\r\n\tat java.util.logging.Logger.log(Logger.java:481)\r\n\tat java.util.logging.Logger.doLog(Logger.java:503)\r\n\tat java.util.logging.Logger.log(Logger.java:526)\r\n\tat java.util.logging.Logger.info(Logger.java:1045)\r\n\tat com.marklogic.xcc.impl.SocketPoolProvider.obtainConnection(SocketPoolProvider.java:119)\r\n\tat com.marklogic.xcc.impl.handlers.AbstractRequestController.runRequest(AbstractRequestController.java:81)\r\n\tat com.marklogic.xcc.impl.SessionImpl.submitRequestInternal(SessionImpl.java:390)\r\n\tat com.marklogic.xcc.impl.SessionImpl.setTransactionTimeout(SessionImpl.java:151)\r\n\tat test.stress.StressTester.setTransactionTimeout(StressTester.java:205)\r\n\tat test.stress.LoadTester.loadContentFromDir(LoadTester.java:127)\r\n\tat test.stress.LoadTester.runTest(LoadTester.java:221)\r\n\tat test.stress.StressTest.run(StressTest.java:54)\r\n\r\n\"Thread-3\" prio=10 tid=0x0000000041c11800 nid=0x3b9a waiting for monitor entry [0x000000004381b000]\r\n   java.lang.Thread.State: BLOCKED (on object monitor)\r\n\tat java.util.logging.StreamHandler.publish(StreamHandler.java:174)\r\n\t- waiting to lock <0x0000000687600110> (a java.util.logging.ConsoleHandler)\r\n\tat java.util.logging.ConsoleHandler.publish(ConsoleHandler.java:88)\r\n\tat java.util.logging.Logger.log(Logger.java:481)\r\n\tat java.util.logging.Logger.doLog(Logger.java:503)\r\n\tat java.util.logging.Logger.log(Logger.java:526)\r\n\tat java.util.logging.Logger.info(Logger.java:1045)\r\n\tat com.marklogic.xcc.impl.SocketPoolProvider.obtainConnection(SocketPoolProvider.java:119)\r\n\tat com.marklogic.xcc.impl.handlers.AbstractRequestController.runRequest(AbstractRequestController.java:81)\r\n\tat com.marklogic.xcc.impl.SessionImpl.submitRequestInternal(SessionImpl.java:390)\r\n\tat com.marklogic.xcc.impl.SessionImpl.setTransactionTimeout(SessionImpl.java:151)\r\n\tat test.stress.StressTester.setTransactionTimeout(StressTester.java:205)\r\n\tat test.stress.LoadTester.loadContentFromDir(LoadTester.java:127)\r\n\tat test.stress.LoadTester.runTest(LoadTester.java:221)\r\n\tat test.stress.StressTest.run(StressTest.java:54)\r\n\r\n\"Thread-2\" prio=10 tid=0x0000000041be1800 nid=0x3b99 waiting for monitor entry [0x000000004371a000]\r\n   java.lang.Thread.State: BLOCKED (on object monitor)\r\n\tat java.util.logging.StreamHandler.publish(StreamHandler.java:174)\r\n\t- waiting to lock <0x0000000687600110> (a java.util.logging.ConsoleHandler)\r\n\tat java.util.logging.ConsoleHandler.publish(ConsoleHandler.java:88)\r\n\tat java.util.logging.Logger.log(Logger.java:481)\r\n\tat java.util.logging.Logger.doLog(Logger.java:503)\r\n\tat java.util.logging.Logger.log(Logger.java:526)\r\n\tat java.util.logging.Logger.info(Logger.java:1045)\r\n\tat com.marklogic.xcc.impl.SocketPoolProvider.obtainConnection(SocketPoolProvider.java:119)\r\n\tat com.marklogic.xcc.impl.handlers.AbstractRequestController.runRequest(AbstractRequestController.java:81)\r\n\tat com.marklogic.xcc.impl.SessionImpl.submitRequestInternal(SessionImpl.java:390)\r\n\tat com.marklogic.xcc.impl.SessionImpl.setTransactionTimeout(SessionImpl.java:151)\r\n\tat test.stress.StressTester.setTransactionTimeout(StressTester.java:205)\r\n\tat test.stress.LoadTester.loadContentFromDir(LoadTester.java:127)\r\n\tat test.stress.LoadTester.runTest(LoadTester.java:221)\r\n\tat test.stress.StressTest.run(StressTest.java:54)\r\n\r\n\"Listener:4712\" daemon prio=10 tid=0x0000000041c00000 nid=0x3b98 runnable [0x0000000043619000]\r\n   java.lang.Thread.State: RUNNABLE\r\n\tat java.net.PlainSocketImpl.socketAccept(Native Method)\r\n\tat java.net.PlainSocketImpl.accept(PlainSocketImpl.java:408)\r\n\t- locked <0x000000068760a400> (a java.net.SocksSocketImpl)\r\n\tat java.net.ServerSocket.implAccept(ServerSocket.java:462)\r\n\tat java.net.ServerSocket.accept(ServerSocket.java:430)\r\n\tat com.arjuna.ats.internal.arjuna.recovery.Listener.run(Listener.java:120)\r\n\r\n\"Periodic Recovery\" prio=10 tid=0x0000000041be6800 nid=0x3b97 waiting for monitor entry [0x0000000043518000]\r\n   java.lang.Thread.State: BLOCKED (on object monitor)\r\n\tat java.util.logging.StreamHandler.publish(StreamHandler.java:174)\r\n\t- waiting to lock <0x0000000687600110> (a java.util.logging.ConsoleHandler)\r\n\tat java.util.logging.ConsoleHandler.publish(ConsoleHandler.java:88)\r\n\tat java.util.logging.Logger.log(Logger.java:481)\r\n\tat java.util.logging.Logger.doLog(Logger.java:503)\r\n\tat java.util.logging.Logger.log(Logger.java:526)\r\n\tat java.util.logging.Logger.info(Logger.java:1045)\r\n\tat com.marklogic.xcc.impl.SocketPoolProvider.obtainConnection(SocketPoolProvider.java:119)\r\n\tat com.marklogic.xcc.impl.handlers.AbstractRequestController.runRequest(AbstractRequestController.java:81)\r\n\tat com.marklogic.xcc.impl.SessionImpl.submitRequestInternal(SessionImpl.java:390)\r\n\tat com.marklogic.xcc.impl.XAResourceImpl.recover(XAResourceImpl.java:320)\r\n\tat com.arjuna.ats.internal.jta.recovery.arjunacore.XARecoveryModule.xaRecovery(XARecoveryModule.java:457)\r\n\tat com.arjuna.ats.internal.jta.recovery.arjunacore.XARecoveryModule.resourceInitiatedRecoveryForRecoveryHelpers(XARecoveryModule.java:425)\r\n\t- locked <0x0000000687610620> (a java.util.LinkedList)\r\n\tat com.arjuna.ats.internal.jta.recovery.arjunacore.XARecoveryModule.periodicWorkSecondPass(XARecoveryModule.java:153)\r\n\tat com.arjuna.ats.internal.arjuna.recovery.PeriodicRecovery.doWorkInternal(PeriodicRecovery.java:789)\r\n\tat com.arjuna.ats.internal.arjuna.recovery.PeriodicRecovery.run(PeriodicRecovery.java:371)\r\n\r\n\"Transaction Expired Entry Monitor\" daemon prio=10 tid=0x0000000041bb9800 nid=0x3b96 in Object.wait() [0x00000000413b0000]\r\n   java.lang.Thread.State: TIMED_WAITING (on object monitor)\r\n\tat java.lang.Object.wait(Native Method)\r\n\t- waiting on <0x000000068760e158> (a com.arjuna.ats.internal.arjuna.recovery.ExpiredEntryMonitor)\r\n\tat com.arjuna.ats.internal.arjuna.recovery.ExpiredEntryMonitor.run(ExpiredEntryMonitor.java:191)\r\n\t- locked <0x000000068760e158> (a com.arjuna.ats.internal.arjuna.recovery.ExpiredEntryMonitor)\r\n\r\n\"Low Memory Detector\" daemon prio=10 tid=0x000000004196e800 nid=0x3b94 runnable [0x0000000000000000]\r\n   java.lang.Thread.State: RUNNABLE\r\n\r\n\"CompilerThread1\" daemon prio=10 tid=0x000000004196a800 nid=0x3b93 waiting on condition [0x0000000000000000]\r\n   java.lang.Thread.State: RUNNABLE\r\n\r\n\"CompilerThread0\" daemon prio=10 tid=0x0000000041967800 nid=0x3b92 waiting on condition [0x0000000000000000]\r\n   java.lang.Thread.State: RUNNABLE\r\n\r\n\"Signal Dispatcher\" daemon prio=10 tid=0x0000000041965800 nid=0x3b91 runnable [0x0000000000000000]\r\n   java.lang.Thread.State: RUNNABLE\r\n\r\n\"Finalizer\" daemon prio=10 tid=0x0000000041943000 nid=0x3b90 in Object.wait() [0x000000004109d000]\r\n   java.lang.Thread.State: WAITING (on object monitor)\r\n\tat java.lang.Object.wait(Native Method)\r\n\t- waiting on <0x000000068760ae40> (a java.lang.ref.ReferenceQueue$Lock)\r\n\tat java.lang.ref.ReferenceQueue.remove(ReferenceQueue.java:118)\r\n\t- locked <0x000000068760ae40> (a java.lang.ref.ReferenceQueue$Lock)\r\n\tat java.lang.ref.ReferenceQueue.remove(ReferenceQueue.java:134)\r\n\tat java.lang.ref.Finalizer$FinalizerThread.run(Finalizer.java:159)\r\n\r\n\"Reference Handler\" daemon prio=10 tid=0x0000000041941000 nid=0x3b8f in Object.wait() [0x0000000040f9c000]\r\n   java.lang.Thread.State: WAITING (on object monitor)\r\n\tat java.lang.Object.wait(Native Method)\r\n\t- waiting on <0x0000000687608080> (a java.lang.ref.Reference$Lock)\r\n\tat java.lang.Object.wait(Object.java:485)\r\n\tat java.lang.ref.Reference$ReferenceHandler.run(Reference.java:116)\r\n\t- locked <0x0000000687608080> (a java.lang.ref.Reference$Lock)\r\n\r\n\"main\" prio=10 tid=0x00000000418c0000 nid=0x3b7b runnable [0x0000000040e9b000]\r\n   java.lang.Thread.State: RUNNABLE\r\n\tat java.io.FileOutputStream.writeBytes(Native Method)\r\n\tat java.io.FileOutputStream.write(FileOutputStream.java:260)\r\n\tat java.io.BufferedOutputStream.flushBuffer(BufferedOutputStream.java:65)\r\n\tat java.io.BufferedOutputStream.flush(BufferedOutputStream.java:123)\r\n\t- locked <0x00000006876dcdc8> (a java.io.BufferedOutputStream)\r\n\tat java.io.PrintStream.write(PrintStream.java:432)\r\n\t- locked <0x00000006876dcda8> (a java.io.PrintStream)\r\n\tat sun.nio.cs.StreamEncoder.writeBytes(StreamEncoder.java:202)\r\n\tat sun.nio.cs.StreamEncoder.implFlushBuffer(StreamEncoder.java:272)\r\n\tat sun.nio.cs.StreamEncoder.flushBuffer(StreamEncoder.java:85)\r\n\t- locked <0x00000006876dceb8> (a java.io.OutputStreamWriter)\r\n\tat java.io.OutputStreamWriter.flushBuffer(OutputStreamWriter.java:168)\r\n\tat java.io.PrintStream.write(PrintStream.java:477)\r\n\t- locked <0x00000006876dcda8> (a java.io.PrintStream)\r\n\tat java.io.PrintStream.print(PrintStream.java:619)\r\n\tat java.io.PrintStream.println(PrintStream.java:756)\r\n\t- locked <0x00000006876dcda8> (a java.io.PrintStream)\r\n\tat test.stress.StressTest.runStress(StressTest.java:108)\r\n\tat test.stress.StressTest.main(StressTest.java:122)\r\n\r\n\"VM Thread\" prio=10 tid=0x000000004193a000 nid=0x3b8e runnable \r\n\r\n\"GC task thread#0 (ParallelGC)\" prio=10 tid=0x00000000418d3800 nid=0x3b7c runnable \r\n\r\n\"GC task thread#1 (ParallelGC)\" prio=10 tid=0x00000000418d5800 nid=0x3b7d runnable \r\n\r\n\"GC task thread#2 (ParallelGC)\" prio=10 tid=0x00000000418d7800 nid=0x3b7e runnable \r\n\r\n\"GC task thread#3 (ParallelGC)\" prio=10 tid=0x00000000418d9000 nid=0x3b7f runnable \r\n\r\n\"GC task thread#4 (ParallelGC)\" prio=10 tid=0x00000000418db000 nid=0x3b80 runnable \r\n\r\n\"GC task thread#5 (ParallelGC)\" prio=10 tid=0x00000000418dd000 nid=0x3b81 runnable \r\n\r\n\"GC task thread#6 (ParallelGC)\" prio=10 tid=0x00000000418df000 nid=0x3b82 runnable \r\n\r\n\"GC task thread#7 (ParallelGC)\" prio=10 tid=0x00000000418e0800 nid=0x3b83 runnable \r\n\r\n\"GC task thread#8 (ParallelGC)\" prio=10 tid=0x00000000418e2800 nid=0x3b84 runnable \r\n\r\n\"GC task thread#9 (ParallelGC)\" prio=10 tid=0x00000000418e4800 nid=0x3b85 runnable \r\n\r\n\"GC task thread#10 (ParallelGC)\" prio=10 tid=0x00000000418e6000 nid=0x3b86 runnable \r\n\r\n\"GC task thread#11 (ParallelGC)\" prio=10 tid=0x00000000418e8000 nid=0x3b87 runnable \r\n\r\n\"GC task thread#12 (ParallelGC)\" prio=10 tid=0x00000000418ea000 nid=0x3b88 runnable \r\n\r\n\"GC task thread#13 (ParallelGC)\" prio=10 tid=0x00000000418ec000 nid=0x3b89 runnable \r\n\r\n\"GC task thread#14 (ParallelGC)\" prio=10 tid=0x00000000418ed800 nid=0x3b8a runnable \r\n\r\n\"GC task thread#15 (ParallelGC)\" prio=10 tid=0x00000000418ef800 nid=0x3b8b runnable \r\n\r\n\"GC task thread#16 (ParallelGC)\" prio=10 tid=0x00000000418f1800 nid=0x3b8c runnable \r\n\r\n\"GC task thread#17 (ParallelGC)\" prio=10 tid=0x00000000418f3800 nid=0x3b8d runnable \r\n\r\n\"VM Periodic Task Thread\" prio=10 tid=0x000000004197a800 nid=0x3b95 waiting on condition \r\n\r\nJNI global references: 1618\r\n"}, {"time":"2012-11-07T10:29:35.910699-08:00", "updatedBy":{"username":"jchen", "name":"Jane Chen", "email":"jane.chen@marklogic.com"}, "change":{}, "files":[], "show":true, "comment":"I’m debugging 20005 on rh55-intel64-43-test-4.  I found that the MarkLogic server became 5.0 and the keep alive timeout has been set to 0.  The server log files are wiped out.  So I'm not sure whether I can still use it for debugging.\r\n\r\nI can’t reproduce the bug on my own dev box.\r\n"}, {"time":"2012-11-07T12:59:24.659372-08:00", "updatedBy":{"username":"jchen", "name":"Jane Chen", "email":"jane.chen@marklogic.com"}, "change":{}, "files":[], "show":true, "comment":"There's a xcc.jar with more targeted logging at /home/jchen/Projects/20005."}, {"time":"2012-11-07T15:25:21.976573-08:00", "updatedBy":{"username":"lratcliff", "name":"Larry Ratcliff", "email":"lratcliff@marklogic.com"}, "change":{}, "files":[], "show":true, "comment":"I captured the output from the harness with your debug jar file. It shows the connections spiking to over 6500 right before the error occurs. You can find that output at /home/lratcliff/20005/bug20005.log\r\n\r\nAfter the tweaks to the LoadTester.java I can reproduce the issue in less than a minute. "}, {"time":"2012-11-08T11:41:26.790691-08:00", "updatedBy":{"username":"rpolasani", "name":"Raghu Polasani", "email":"raghu.polasani@marklogic.com"}, "change":{}, "files":[], "show":true, "comment":"Larry,\r\n\r\nJane got a potential fix for this issue and  i made a build with her fix. Can you verify that this build resolves the problem.\r\n\r\n/home/rpolasani/tmp/MarkLogic-6.0-20121108.1.x86_64.rpm\r\n\r\nLooks like issue is server side not XCC.\r\n"}, {"time":"2012-11-08T11:42:41.477254-08:00", "updatedBy":{"username":"jchen", "name":"Jane Chen", "email":"jane.chen@marklogic.com"}, "change":{}, "files":[], "show":true, "comment":"I'm running the perf test on my box with the fix.  It is looking very good.  The patch has been submitted for review."}, {"time":"2012-11-08T13:00:44.623311-08:00", "updatedBy":{"username":"lratcliff", "name":"Larry Ratcliff", "email":"lratcliff@marklogic.com"}, "change":{}, "files":[], "show":true, "comment":"Test now Passes with Janes fix "}, {"time":"2012-11-08T13:53:22.312229-08:00", "updatedBy":{"username":"jchen", "name":"Jane Chen", "email":"jane.chen@marklogic.com"}, "change":{}, "files":[], "show":true, "comment":"Just created a new patch.  Larry and I are re-running the tests."}, {"time":"2012-11-08T14:51:47.79353-08:00", "updatedBy":{"username":"lratcliff", "name":"Larry Ratcliff", "email":"lratcliff@marklogic.com"}, "change":{}, "files":[], "show":true, "comment":"Reran the test passes with the xcc fix too"}, {"time":"2012-11-08T15:21:59.236362-08:00", "updatedBy":{"username":"jchen", "name":"Jane Chen", "email":"jane.chen@marklogic.com"}, "change":{}, "files":[], "show":true, "svn":{"repository":"/project/engsvn", "revision":"120029", "paths":["xcc/trunk/xcc/src/java/com/marklogic/xcc/impl/handlers/ContentInsertController.java"], "affectedBugs":[]}, "comment":"Bug:20005 - Set no commit flag only when doing a batch insert.\n"}, {"time":"2012-11-08T15:25:36.709536-08:00", "updatedBy":{"username":"jchen", "name":"Jane Chen", "email":"jane.chen@marklogic.com"}, "change":{}, "files":[], "show":true, "svn":{"repository":"/project/engsvn", "revision":"120030", "paths":["xcc/branches/b6_0/xcc/src/java/com/marklogic/xcc/impl/handlers/ContentInsertController.java"], "affectedBugs":[]}, "comment":"Bug:20005 - Set no commit flag only when doing a batch insert.\n"}, {"time":"2012-11-08T15:27:28.515497-08:00", "updatedBy":{"username":"jchen", "name":"Jane Chen", "email":"jane.chen@marklogic.com"}, "change":{"status":{"from":"", "to":"Test"}, "assignTo":{"from":{"username":"jchen", "name":"Jane Chen", "email":"jane.chen@marklogic.com"}, "to":{"username":"lratcliff", "name":"Larry Ratcliff", "email":"lratcliff@marklogic.com"}}}, "files":[], "show":true}, {"time":"2012-11-08T15:27:28.515497-08:00", "updatedBy":{"username":"jchen", "name":"Jane Chen", "email":"jane.chen@marklogic.com"}, "change":{"assignTo":{"from":{"username":"jchen", "name":"Jane Chen", "email":"jane.chen@marklogic.com"}, "to":{"username":"lratcliff", "name":"Larry Ratcliff", "email":"lratcliff@marklogic.com"}}}, "files":[], "show":true}, {"time":"2012-11-08T16:16:45.103263-08:00", "updatedBy":{"username":"jchen", "name":"Jane Chen", "email":"jane.chen@marklogic.com"}, "change":{}, "files":[], "show":true, "comment":"Larry, please modify the test so that the test will fail if $CON_COUNT in runTest.sh is greater than 100."}, {"time":"2012-11-09T13:15:49.155917-08:00", "updatedBy":{"username":"lratcliff", "name":"Larry Ratcliff", "email":"lratcliff@marklogic.com"}, "change":{"status":{"from":"", "to":"Ship"}, "assignTo":{"from":{"username":"lratcliff", "name":"Larry Ratcliff", "email":"lratcliff@marklogic.com"}, "to":{"username":"nobody", "name":"nobody nobody", "email":"nobody@marklogic.com"}}}, "files":[], "show":true, "comment":"Verified on build 6.0-20121109"}, {"time":"2012-11-21T09:57:01.565055-08:00", "updatedBy":{"username":"rpelton", "name":"Rick Pelton", "email":"rick.pelton@marklogic.com"}, "change":{"status":{"from":"", "to":"Closed"}, "assignTo":{"from":{"username":"rpelton", "name":"Rick Pelton", "email":"rick.pelton@marklogic.com"}, "to":{"username":"nobody", "name":"nobody nobody", "email":"nobody@marklogic.com"}}}, "files":[], "show":true}], "updatedAt":"2012-11-21T09:57:01.565055-08:00", "fixedAt":"2012-11-08T15:27:28.515497-08:00", "fixedBy":{"username":"jchen", "name":"Jane Chen", "email":"jane.chen@marklogic.com"}, "shippedAt":"2012-11-09T13:15:49.155917-08:00", "shippedBy":{"username":"lratcliff", "name":"Larry Ratcliff", "email":"lratcliff@marklogic.com"}, "closedAt":"2012-11-21T09:57:01.565055-08:00", "closedBy":{"username":"rpelton", "name":"Rick Pelton", "email":"rick.pelton@marklogic.com"}, "renderDescriptionAs":"normal"}
{"id":20701, "kind":"Bug", "createdAt":"2013-02-04T16:01:47.57545-08:00", "status":"Closed", "title":"Endless reindexing/refragmenting when creating a path-field and a field-range index", "category":"xdmp", "severity":"Major", "priority":{"level":"5", "title":""}, "submittedBy":{"username":"msrinivasan", "name":"Mahalakshmi Srinivasan", "email":"mahalakshmi.srinivasan@marklogic.com"}, "assignTo":{"username":"nobody", "name":"nobody nobody", "email":"nobody@marklogic.com"}, "description":"MarkLogic Version 7.0-20130204\r\n\r\n1. Create a field called ‘pname’ with ‘/a/name’ as the path and add the ‘root collation’ word-lexicon to it.\r\n2. Create a string field range index called ‘pname’. \r\n3. Insert a document:\r\n<a>\r\n   <name>\r\n      <fname>John</fname>\r\n      <mname>Von</mname>\r\n      <lname>Smith</lname>\r\n   </name>\r\n</a>\r\nThis seems to be causing some repeated refragmenting (looking at the ErrorLogs). The config file looks correct with the field and field-range-index elements. \r\n\r\n4. But running cts:field-values(“pname”) returns\r\n\r\n ‘XDMP-FIELDRIDXNOTFOUND’.  : cts:field-values(\"pname\") -- No field range index for pname http://marklogic.com/collation/\r\n\r\nStack Trace\r\nAt line 4 column 0:\r\n\r\nIn xdmp:eval(\"xquery version &quot;1.0-ml&quot;;&#10; (:declare defaul...\", (), <options xmlns=\"xdmp:eval\"><database>6342422147333108425</database><default-xquery-version>...</options>)\r\n\r\n2. (:declare default element namespace \"http://aaa.com/\";:)\r\n3.\r\n4. cts:field-values(\"pname\")\r\n5. (:\r\n6. cts:values(cts:path-reference('/a/name'))\r\nIn /MarkLogic/appservices/qconsole/qconsole-amped.xqy on line 180\r\nIn amped-qconsole:qconsole-eval(\"xquery version &quot;1.0-ml&quot;;&#10; (:declare defaul...\", (), <options xmlns=\"xdmp:eval\"><database>6342422147333108425</database><default-xquery-version>...</options>)\r\n\r\n$xquery := \"xquery version &quot;1.0-ml&quot;;&#10; (:declare defaul...\"\r\n$vars := ()\r\n$options := <options xmlns=\"xdmp:eval\"><database>6342422147333108425</database><default-xquery-version>...</options>", "samplequery":"", "sampledata":"", "version":"7.0-nightly", "tofixin":"7.0-ea1", "fixedin":"7.0-ea1", "platform":"all", "memory":"", "processors":"", "note":"", "subscribers":[{"username":"msrinivasan", "name":"Mahalakshmi Srinivasan", "email":"mahalakshmi.srinivasan@marklogic.com"}, {"username":"gchinchwadkar", "name":"Gajanan Chinchwadkar", "email":"Gajanan.Chinchwadkar@marklogic.com"}], "attachments":[], "relationships":[{"type":"", "to":""}], "clones":[], "cloneOf":"", "support":{"headline":"", "supportDescription":"", "publishStatus":"Not Ready", "tickets":[], "customerImpact":{"level":"N/A", "title":""}, "workaround":""}, "tags":["xdmp", "msrinivasan"], "changeHistory":[{"time":"2013-02-04T16:01:47.57545-08:00", "updatedBy":{"username":"msrinivasan", "name":"Mahalakshmi Srinivasan", "email":"mahalakshmi.srinivasan@marklogic.com"}, "change":{"assignTo":{"from":{"username":"msrinivasan", "name":"Mahalakshmi Srinivasan", "email":"mahalakshmi.srinivasan@marklogic.com"}, "to":{"username":"gchinchwadkar", "name":"Gajanan Chinchwadkar", "email":"Gajanan.Chinchwadkar@marklogic.com"}}}, "files":[], "show":true}, {"time":"2013-02-05T16:43:59.280724-08:00", "updatedBy":{"username":"gchinchwadkar", "name":"Gajanan Chinchwadkar", "email":"Gajanan.Chinchwadkar@marklogic.com"}, "change":{}, "files":[], "show":true, "comment":"We may have more than one bugs involved here.\r\n\r\nChecked-in a fix for the first bug I found from code inspection:\r\n\r\nr130691:\r\n-----------\r\n+++ PathIndexes.h\t(revision 130691)\r\n+++ PathIndexes.cpp\t(revision 130691)\r\n+++ PathConfig.cpp\t(revision 130691)\r\n+++ PathConfig.h\t(revision 130691)\r\n+++ Forest.cpp\t(revision 130691)"}, {"time":"2013-02-05T20:44:51.433699-08:00", "updatedBy":{"username":"gchinchwadkar", "name":"Gajanan Chinchwadkar", "email":"Gajanan.Chinchwadkar@marklogic.com"}, "change":{}, "files":[], "show":true, "svn":{"repository":"/project/engsvn", "revision":"130753", "paths":["xdmp/trunk/src/PathConfig.cpp", "xdmp/trunk/src/Indexer.cpp"], "affectedBugs":[]}, "comment":"Fix for endless reindexing, bug:20701.\n"}, {"time":"2013-02-07T09:44:31.428193-08:00", "updatedBy":{"username":"gchinchwadkar", "name":"Gajanan Chinchwadkar", "email":"Gajanan.Chinchwadkar@marklogic.com"}, "change":{"status":{"from":"", "to":"Test"}, "assignTo":{"from":{"username":"gchinchwadkar", "name":"Gajanan Chinchwadkar", "email":"Gajanan.Chinchwadkar@marklogic.com"}, "to":{"username":"msrinivasan", "name":"Mahalakshmi Srinivasan", "email":"mahalakshmi.srinivasan@marklogic.com"}}}, "files":[], "show":true}, {"time":"2013-02-07T09:44:31.428193-08:00", "updatedBy":{"username":"gchinchwadkar", "name":"Gajanan Chinchwadkar", "email":"Gajanan.Chinchwadkar@marklogic.com"}, "change":{"assignTo":{"from":{"username":"gchinchwadkar", "name":"Gajanan Chinchwadkar", "email":"Gajanan.Chinchwadkar@marklogic.com"}, "to":{"username":"msrinivasan", "name":"Mahalakshmi Srinivasan", "email":"mahalakshmi.srinivasan@marklogic.com"}}}, "files":[], "show":true}, {"time":"2013-02-12T13:15:22.209197-08:00", "updatedBy":{"username":"msrinivasan", "name":"Mahalakshmi Srinivasan", "email":"mahalakshmi.srinivasan@marklogic.com"}, "change":{"status":{"from":"", "to":"Ship"}, "assignTo":{"from":{"username":"msrinivasan", "name":"Mahalakshmi Srinivasan", "email":"mahalakshmi.srinivasan@marklogic.com"}, "to":{"username":"nobody", "name":"nobody nobody", "email":"nobody@marklogic.com"}}}, "files":[], "show":true, "comment":"Verified on build 7.0-20130212. Added first test path-field-test-1.xml."}], "updatedAt":"2013-02-12T13:15:22.209197-08:00", "fixedAt":"2013-02-07T09:44:31.428193-08:00", "fixedBy":{"username":"gchinchwadkar", "name":"Gajanan Chinchwadkar", "email":"Gajanan.Chinchwadkar@marklogic.com"}, "shippedAt":"2013-02-12T13:15:22.209197-08:00", "shippedBy":{"username":"msrinivasan", "name":"Mahalakshmi Srinivasan", "email":"mahalakshmi.srinivasan@marklogic.com"}, "renderDescriptionAs":"normal"}
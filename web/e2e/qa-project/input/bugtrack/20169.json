{"id":20169, "kind":"Bug", "createdAt":"2012-11-30T06:57:05.417258-08:00", "status":"Closed", "title":"mlcp.bat on windows system in a directory path containing a space produced NoClassDefFoundError", "category":"mlcp", "severity":"Major", "priority":{"level":"5", "title":""}, "submittedBy":{"username":"smazer", "name":"Sara  Mazer", "email":"Sara.Mazer@marklogic.com"}, "assignTo":{"username":"nobody", "name":"nobody nobody", "email":"nobody@marklogic.com"}, "description":"Either mlcp.bat should be updated to allow for Windows paths such as \"Program Files\" or the documentation should be more specific on where to install mlcp.  At the very least, a customer might install this in a poor location and the error of NoClassDefFoundError is misleading.  Instead of a Java path issue, it may be caused by the location of the installation of mlcp.\r\n\r\nHere's a simple example.  I just edited mlcp.bat to echo out how the environmental variables are being set.  My file is called sara.bat.  This is exactly the same as mlcp.bat except that we are not reading in any variables or executing any java, and the variables are being echoed out to the terminal.  You can copy and paste and try it for yourself, and compare it to mlcp.bat:\r\n\r\nsara.bat file:\r\nset cmdpath=%~dp0\r\necho Command Path:  %cmdpath%\r\nset cmdpath=%cmdpath:~0,-1%\r\nfor %%d in (%cmdpath%) do set cmdppath=%%~dpd\r\necho %cmdppath%\r\nset LIB_HOME=%cmdppath%lib\r\necho LIB_HOME: %LIB_HOME%\r\n\r\nWhen this test sara.bat (or mlcp.bat) is run in a directory without spaces, the variables get set correctly.  Here is a good output:\r\nc:\\marklogic-contentpump-1.0.2\\bin>sara.bat\r\n\r\nc:\\marklogic-contentpump-1.0.2\\bin>set cmdpath=c:\\marklogic-contentpump-1.0.2\\bin\\\r\n\r\nc:\\marklogic-contentpump-1.0.2\\bin>echo Command Path:  c:\\marklogic-contentpump-1.0.2\\bin\\\r\nCommand Path:  c:\\marklogic-contentpump-1.0.2\\bin\\\r\n\r\nc:\\marklogic-contentpump-1.0.2\\bin>set cmdpath=c:\\marklogic-contentpump-1.0.2\\bin\r\n\r\nc:\\marklogic-contentpump-1.0.2\\bin>for %d in (c:\\marklogic-contentpump-1.0.2\\bin) do set cmdppath=%~dpd\r\n\r\nc:\\marklogic-contentpump-1.0.2\\bin>set cmdppath=c:\\marklogic-contentpump-1.0.2\\\r\n\r\n\r\nc:\\marklogic-contentpump-1.0.2\\bin>echo c:\\marklogic-contentpump-1.0.2\\\r\nc:\\marklogic-contentpump-1.0.2\\\r\n\r\nc:\\marklogic-contentpump-1.0.2\\bin>set LIB_HOME=c:\\marklogic-contentpump-1.0.2\\lib\r\n\r\nc:\\marklogic-contentpump-1.0.2\\bin>echo LIB_HOME: c:\\marklogic-contentpump-1.0.2\\lib\r\nLIB_HOME: c:\\marklogic-contentpump-1.0.2\\lib\r\n\r\n---------------------------------------------------------------------------------------------------------------------------------------------\r\nWhen my sample sara.bat (or mlcp.bat) is run in a directory with spaces, see how the environment variables are being set now. Note it is looking for ...bin\\Files which doesn't exist in the mlcp directory, and then the LIB_HOME isn't being set correctly:\r\n\r\nc:\\Program Files\\MarkLogic\\marklogic-contentpump-1.0.2\\bin>sara.bat\r\n\r\nc:\\Program Files\\MarkLogic\\marklogic-contentpump-1.0.2\\bin>set cmdpath=c:\\Program Files\\MarkLogic\\marklogic-contentpump-1.0.2\\bin\\\r\n\r\nc:\\Program Files\\MarkLogic\\marklogic-contentpump-1.0.2\\bin>echo Command Path:  c:\\Program Files\\MarkLogic\\marklogic-contentpump-1.0.2\\bin\\\r\nCommand Path:  c:\\Program Files\\MarkLogic\\marklogic-contentpump-1.0.2\\bin\\\r\n\r\nc:\\Program Files\\MarkLogic\\marklogic-contentpump-1.0.2\\bin>set cmdpath=c:\\Program Files\\MarkLogic\\marklogic-contentpump-1.0.2\\bin\r\n\r\nc:\\Program Files\\MarkLogic\\marklogic-contentpump-1.0.2\\bin>for %d in (c:\\Program Files\\MarkLogic\\marklogic-contentpump-1.0.2\\bin) do set cmdppath=%~dpd\r\n\r\nc:\\Program Files\\MarkLogic\\marklogic-contentpump-1.0.2\\bin>set cmdppath=c:\\\r\n\r\nc:\\Program Files\\MarkLogic\\marklogic-contentpump-1.0.2\\bin>set cmdppath=c:\\Program Files\\MarkLogic\\marklogic-contentpump-1.0.2\\bin\\Files\\MarkLogic\\marklogic-contentpump-1.0.2\\\r\n\r\nc:\\Program Files\\MarkLogic\\marklogic-contentpump-1.0.2\\bin>echo c:\\Program Files\\MarkLogic\\marklogic-contentpump-1.0.2\\bin\\Files\\MarkLogic\\marklogic-contentpump-1.0.2\\\r\nc:\\Program Files\\MarkLogic\\marklogic-contentpump-1.0.2\\bin\\Files\\MarkLogic\\marklogic-contentpump-1.0.2\\\r\n\r\nc:\\Program Files\\MarkLogic\\marklogic-contentpump-1.0.2\\bin>set LIB_HOME=c:\\Program Files\\MarkLogic\\marklogic-contentpump-1.0.2\\bin\\Files\\MarkLogic\\marklogic-contentpump-1.0.2\\lib\r\n\r\nc:\\Program Files\\MarkLogic\\marklogic-contentpump-1.0.2\\bin>echo LIB_HOME: c:\\Program Files\\MarkLogic\\marklogic-contentpump-1.0.2\\bin\\Files\\MarkLogic\\marklogic-contentpump-1.0.2\\lib\r\nLIB_HOME: c:\\Program Files\\MarkLogic\\marklogic-contentpump-1.0.2\\bin\\Files\\MarkLogic\\marklogic-contentpump-1.0.2\\lib\r\n\r\n--------------------------------------------------------------------------------------------------------------------------------------------------\r\nNow, what you will see if you run mlcp.bat as opposed to sara.bat in this type of directory is the Java NoClassDefFoundError:\r\nc:\\Program Files\\MarkLogic\\marklogic-contentpump-1.0.2\\bin>mlcp.bat\r\nException in thread \"main\" java.lang.NoClassDefFoundError: Files\\MarkLogic\\marklogic-contentpump-1/0/2\\bin\\Files\\MarkLogic\\marklogic-contentpump-1/0/2\\conf;c:\\Program\r\nCaused by: java.lang.ClassNotFoundException: Files\\MarkLogic\\marklogic-contentpump-1.0.2\\bin\\Files\\MarkLogic\\marklogic-contentpump-1.0.2\\conf;c:\\Program\r\n        at java.net.URLClassLoader$1.run(URLClassLoader.java:202)\r\n        at java.security.AccessController.doPrivileged(Native Method)\r\n        at java.net.URLClassLoader.findClass(URLClassLoader.java:190)\r\n        at java.lang.ClassLoader.loadClass(ClassLoader.java:306)\r\n        at sun.misc.Launcher$AppClassLoader.loadClass(Launcher.java:301)\r\n        at java.lang.ClassLoader.loadClass(ClassLoader.java:247)\r\nCould not find the main class: Files\\MarkLogic\\marklogic-contentpump-1.0.2\\bin\\Files\\MarkLogic\\marklogic-contentpump-1.0.2\\conf;c:\\Program.  Program will exit.\r\n\r\n ", "samplequery":"see notes above on how to reproduce", "sampledata":"", "version":"6.0-2", "tofixin":"6.0-3", "fixedin":"6.0-3", "platform":"windows(64-bit)", "memory":"8 GB", "processors":"1", "note":"", "subscribers":[{"username":"smazer", "name":"Sara  Mazer", "email":"Sara.Mazer@marklogic.com"}, {"username":"jchen", "name":"Jane Chen", "email":"jane.chen@marklogic.com"}, {"username":"rhu", "name":"Ron Hu", "email":"ron.hu@marklogic.com"}], "attachments":[], "relationships":[{"type":"", "to":""}], "clones":[], "cloneOf":"", "support":{"headline":"NoClassDefFoundError is thrown on Windows when Content Pump path contains space.", "supportDescription":"NoClassDefFoundError is thrown on Windows when Content Pump path contains space.", "publishStatus":"Publish", "tickets":[], "customerImpact":{"level":"N/A", "title":""}, "workaround":""}, "tags":["mlcp", "smazer"], "changeHistory":[{"time":"2012-12-05T08:05:22.158481-08:00", "updatedBy":{"username":"rpelton", "name":"Rick Pelton", "email":"rick.pelton@marklogic.com"}, "change":{"assignTo":{"from":{"username":"rpelton", "name":"Rick Pelton", "email":"rick.pelton@marklogic.com"}, "to":{"username":"rhu", "name":"Ron Hu", "email":"ron.hu@marklogic.com"}}}, "files":[], "show":true}, {"time":"2012-12-05T08:05:22.158481-08:00", "updatedBy":{"username":"rpelton", "name":"Rick Pelton", "email":"rick.pelton@marklogic.com"}, "change":{"tofixin":{"from":"", "to":"6.0-3"}}, "files":[], "show":true}, {"time":"2012-12-17T12:25:46.733085-08:00", "updatedBy":{"username":"rhu", "name":"Ron Hu", "email":"ron.hu@marklogic.com"}, "change":{"assignTo":{"from":{"username":"rhu", "name":"Ron Hu", "email":"ron.hu@marklogic.com"}, "to":{"username":"jchen", "name":"Jane Chen", "email":"jane.chen@marklogic.com"}}}, "files":[], "show":true}, {"time":"2013-01-20T21:15:44.115773-08:00", "updatedBy":{"username":"jchen", "name":"Jane Chen", "email":"jane.chen@marklogic.com"}, "change":{}, "files":[], "show":true, "svn":{"repository":"/project/engsvn", "revision":"128534", "paths":["xcc/trunk/mlcp/src/main/mlcp.bat"], "affectedBugs":[]}, "comment":"Bug:20169 - Tolerate space in Content Pump paths.\n"}, {"time":"2013-01-20T21:22:12.002453-08:00", "updatedBy":{"username":"jchen", "name":"Jane Chen", "email":"jane.chen@marklogic.com"}, "change":{}, "files":[], "show":true, "svn":{"repository":"/project/engsvn", "revision":"128535", "paths":["xcc/branches/b6_0/mlcp/src/main/mlcp.bat"], "affectedBugs":[]}, "comment":"Bug:20169 - Tolerate space in Content Pump paths.\n"}, {"time":"2013-01-20T21:22:47.04586-08:00", "updatedBy":{"username":"jchen", "name":"Jane Chen", "email":"jane.chen@marklogic.com"}, "change":{"status":{"from":"", "to":"Fix"}, "assignTo":{"from":{"username":"jchen", "name":"Jane Chen", "email":"jane.chen@marklogic.com"}, "to":{"username":"jchen", "name":"Jane Chen", "email":"jane.chen@marklogic.com"}}}, "files":[], "show":true}, {"time":"2013-01-21T11:57:49.608582-08:00", "updatedBy":{"username":"jchen", "name":"Jane Chen", "email":"jane.chen@marklogic.com"}, "change":{"status":{"from":"", "to":"Test"}, "assignTo":{"from":{"username":"jchen", "name":"Jane Chen", "email":"jane.chen@marklogic.com"}, "to":{"username":"lratcliff", "name":"Larry Ratcliff", "email":"lratcliff@marklogic.com"}}}, "files":[], "show":true}, {"time":"2013-01-21T11:57:49.608582-08:00", "updatedBy":{"username":"jchen", "name":"Jane Chen", "email":"jane.chen@marklogic.com"}, "change":{"assignTo":{"from":{"username":"jchen", "name":"Jane Chen", "email":"jane.chen@marklogic.com"}, "to":{"username":"lratcliff", "name":"Larry Ratcliff", "email":"lratcliff@marklogic.com"}}}, "files":[], "show":true}, {"time":"2013-03-18T15:16:15.103382-07:00", "updatedBy":{"username":"lratcliff", "name":"Larry Ratcliff", "email":"lratcliff@marklogic.com"}, "change":{"status":{"from":"", "to":"Ship"}, "assignTo":{"from":{"username":"lratcliff", "name":"Larry Ratcliff", "email":"lratcliff@marklogic.com"}, "to":{"username":"nobody", "name":"nobody nobody", "email":"nobody@marklogic.com"}}}, "files":[], "show":true, "comment":"Verified on build 3/18/2013"}, {"time":"2013-04-22T16:31:59.019618-07:00", "updatedBy":{"username":"rpelton", "name":"Rick Pelton", "email":"rick.pelton@marklogic.com"}, "change":{"status":{"from":"", "to":"Closed"}, "assignTo":{"from":{"username":"rpelton", "name":"Rick Pelton", "email":"rick.pelton@marklogic.com"}, "to":{"username":"nobody", "name":"nobody nobody", "email":"nobody@marklogic.com"}}}, "files":[], "show":true}], "updatedAt":"2013-04-22T16:31:59.019618-07:00", "fixedAt":"2013-01-21T11:57:49.608582-08:00", "fixedBy":{"username":"jchen", "name":"Jane Chen", "email":"jane.chen@marklogic.com"}, "shippedAt":"2013-03-18T15:16:15.103382-07:00", "shippedBy":{"username":"lratcliff", "name":"Larry Ratcliff", "email":"lratcliff@marklogic.com"}, "closedAt":"2013-04-22T16:31:59.019618-07:00", "closedBy":{"username":"rpelton", "name":"Rick Pelton", "email":"rick.pelton@marklogic.com"}, "renderDescriptionAs":"normal", "renderSampleQueryAs":"normal"}
{"id":20168, "kind":"Bug", "createdAt":"2012-11-30T06:24:29.46858-08:00", "status":"Closed", "title":"mlcp error unexpected xs:string META", "category":"mlcp", "severity":"Major", "priority":{"level":"5", "title":""}, "submittedBy":{"username":"smazer", "name":"Sara  Mazer", "email":"Sara.Mazer@marklogic.com"}, "assignTo":{"username":"nobody", "name":"nobody nobody", "email":"nobody@marklogic.com"}, "description":"Could someone please help me understand why the error below occurs?  Is something not supported with mlcp or is this a bug?\r\n\r\nI am using MarkLogic Server 6.0-2 on the output system (my local machine)\r\nThe input system is at iacp.demo.marklogic.com using 6.0-1.1\r\nThe version of mlcp is 1.0.2 -running on a Windows system\r\n\r\nTo test internally, use the following command:\r\nC:\\marklogic-contentpump-1.0.2\\bin>mlcp.bat copy -mode local -input_host iacp.demo.marklogic.com -input_port 8035 -input_username admin -input_password Vhfwc -output_host localhost -output_username admin -output_password admin -output_port 8701\r\n\r\nThe following error occurs.\r\n12/11/27 14:37:35 INFO jvm.JvmMetrics: Initializing JVM Metrics with processName\r\n=JobTracker, sessionId=\r\n12/11/27 14:37:36 INFO mapreduce.MarkLogicInputFormat: Fetched 3 forest splits.\r\n12/11/27 14:37:36 INFO mapreduce.MarkLogicInputFormat: Made 3 splits.\r\n12/11/27 14:37:38 INFO contentpump.LocalJobRunner:  completed 0%\r\n12/11/27 14:37:39 INFO contentpump.LocalJobRunner:  completed 33%\r\n12/11/27 14:37:50 ERROR contentpump.LocalJobRunner: Error running task: attempt_\r\n_0000_m_000000_0\r\njava.io.IOException: unexpected xs:string META, expected xs:integer 0\r\n        at com.marklogic.contentpump.DatabaseContentReader.parseMetadata(Databas\r\neContentReader.java:334)\r\n        at com.marklogic.contentpump.DatabaseContentReader.initMetadataMap(Datab\r\naseContentReader.java:265)\r\n        at com.marklogic.contentpump.DatabaseContentReader.initialize(DatabaseCo\r\nntentReader.java:240)\r\n        at com.marklogic.contentpump.LocalJobRunner$TrackingRecordReader.initial\r\nize(LocalJobRunner.java:322)\r\n        at com.marklogic.contentpump.LocalJobRunner$LocalMapTask.call(LocalJobRu\r\nnner.java:268)\r\n        at java.util.concurrent.FutureTask$Sync.innerRun(FutureTask.java:303)\r\n        at java.util.concurrent.FutureTask.run(FutureTask.java:138)\r\n        at java.util.concurrent.ThreadPoolExecutor$Worker.runTask(ThreadPoolExec\r\nutor.java:886)\r\n        at java.util.concurrent.ThreadPoolExecutor$Worker.run(ThreadPoolExecutor\r\n.java:908)\r\n        at java.lang.Thread.run(Thread.java:662)\r\n12/11/27 14:37:51 ERROR contentpump.LocalJobRunner: Error running task: attempt_\r\n_0000_m_000001_0\r\njava.io.IOException: unexpected xs:string META, expected xs:integer 0\r\n        at com.marklogic.contentpump.DatabaseContentReader.parseMetadata(Databas\r\neContentReader.java:334)\r\n        at com.marklogic.contentpump.DatabaseContentReader.initMetadataMap(Datab\r\naseContentReader.java:265)\r\n        at com.marklogic.contentpump.DatabaseContentReader.initialize(DatabaseCo\r\nntentReader.java:240)\r\n        at com.marklogic.contentpump.LocalJobRunner$TrackingRecordReader.initial\r\nize(LocalJobRunner.java:322)\r\n        at com.marklogic.contentpump.LocalJobRunner$LocalMapTask.call(LocalJobRu\r\nnner.java:268)\r\n        at java.util.concurrent.FutureTask$Sync.innerRun(FutureTask.java:303)\r\n        at java.util.concurrent.FutureTask.run(FutureTask.java:138)\r\n        at java.util.concurrent.ThreadPoolExecutor$Worker.runTask(ThreadPoolExec\r\nutor.java:886)\r\n        at java.util.concurrent.ThreadPoolExecutor$Worker.run(ThreadPoolExecutor\r\n.java:908)\r\n        at java.lang.Thread.run(Thread.java:662)\r\n12/11/27 14:47:49 INFO contentpump.LocalJobRunner: com.marklogic.contentpump.Con\r\ntentPumpStats:\r\n12/11/27 14:47:49 INFO contentpump.LocalJobRunner: ATTEMPTED_INPUT_RECORD_COUNT:\r\n18\r\n12/11/27 14:47:49 INFO contentpump.LocalJobRunner: SKIPPED_INPUT_RECORD_COUNT: 0\r\n \r\n12/11/27 14:47:49 INFO contentpump.LocalJobRunner: Total execution time: 613 sec\r\n \r\n \r\n\r\n", "samplequery":"C:\\marklogic-contentpump-1.0.2\\bin>mlcp.bat copy -mode local -input_host iacp.demo.marklogic.com -input_port 8035 -input_username admin -input_password Vhfwc -output_host localhost -output_username admin -output_password admin -output_port 8701", "sampledata":"data at iacp.demo.marklogic.com  use XDBC port 8035  login/pword is admin/Vhfwc", "version":"6.0-2", "tofixin":"6.0-3", "fixedin":"6.0-3", "platform":"windows(64-bit)", "memory":"8 GB", "processors":"1", "note":"", "subscribers":[{"username":"smazer", "name":"Sara  Mazer", "email":"Sara.Mazer@marklogic.com"}, {"username":"ali", "name":"Aries Li", "email":"ali@marklogic.com"}, {"username":"jchen", "name":"Jane Chen", "email":"jane.chen@marklogic.com"}, {"username":"rhu", "name":"Ron Hu", "email":"ron.hu@marklogic.com"}], "attachments":[{"name":"empty_document.PNG", "uri":"root/support/bugtracking/attachments/20168/empty_document.PNG"}], "relationships":[{"type":"", "to":""}], "clones":[], "cloneOf":"", "support":{"headline":"mlcp copy error \"unexpected xs:string META\" occurs if source database contains empty documents", "supportDescription":"If the source database contains some document with no content, mlcp copy will fail with IOException \"unexpected xs:string META\".", "publishStatus":"Publish", "tickets":[], "customerImpact":{"level":"N/A", "title":""}, "workaround":"Delete empty documents"}, "tags":["mlcp", "smazer"], "changeHistory":[{"time":"2012-12-05T08:01:00.009823-08:00", "updatedBy":{"username":"rpelton", "name":"Rick Pelton", "email":"rick.pelton@marklogic.com"}, "change":{"assignTo":{"from":{"username":"rpelton", "name":"Rick Pelton", "email":"rick.pelton@marklogic.com"}, "to":{"username":"rhu", "name":"Ron Hu", "email":"ron.hu@marklogic.com"}}}, "files":[], "show":true}, {"time":"2012-12-05T08:01:00.009823-08:00", "updatedBy":{"username":"rpelton", "name":"Rick Pelton", "email":"rick.pelton@marklogic.com"}, "change":{"tofixin":{"from":"", "to":"6.0-3"}}, "files":[], "show":true}, {"time":"2012-12-05T11:02:35.980655-08:00", "updatedBy":{"username":"ableasdale", "name":"Alex Bleasdale", "email":"alex.bleasdale@marklogic.com"}, "change":{}, "files":[], "show":true, "comment":"Case reference: https://help.marklogic.com/staff/Tickets/Ticket/View/12206\r\n\r\nReproduced with both versions of mlcp (1.0 and 1.0.2)"}, {"time":"2012-12-05T11:05:46.355993-08:00", "updatedBy":{"username":"jchen", "name":"Jane Chen", "email":"jane.chen@marklogic.com"}, "change":{"status":{"from":"", "to":"Verify"}, "assignTo":{"from":{"username":"jchen", "name":"Jane Chen", "email":"jane.chen@marklogic.com"}, "to":{"username":"ali", "name":"Aries Li", "email":"ali@marklogic.com"}}}, "files":[], "show":true}, {"time":"2012-12-05T11:05:46.355993-08:00", "updatedBy":{"username":"jchen", "name":"Jane Chen", "email":"jane.chen@marklogic.com"}, "change":{"assignTo":{"from":{"username":"jchen", "name":"Jane Chen", "email":"jane.chen@marklogic.com"}, "to":{"username":"ali", "name":"Aries Li", "email":"ali@marklogic.com"}}}, "files":[], "show":true}, {"time":"2012-12-06T00:11:18.447809-08:00", "updatedBy":{"username":"ali", "name":"Aries Li", "email":"ali@marklogic.com"}, "change":{}, "files":[], "show":true, "comment":"Sara,\r\n\r\nDo you have any idea how the data was ingested on iacp.demo.marklogic.com? Did the ingestion specify collection, quality or permission? Can you show the mlcp command that was used to do import? \r\n\r\nAlso, is it possible to provide the dataset used in your test? Thanks.\r\n\r\nAries\r\n"}, {"time":"2012-12-11T06:47:10.321281-08:00", "updatedBy":{"username":"ableasdale", "name":"Alex Bleasdale", "email":"alex.bleasdale@marklogic.com"}, "change":{}, "files":[], "show":true, "comment":"Aries, \r\n\r\nFor the record, you can access all the data from the host (including access to port 8001):\r\niacp.demo.marklogic.com\r\n\r\nuname: admin\r\npass: Vhfwc\r\n\r\nIf you're connected on VPN you should be able to log into the host.\r\n\r\nHope that helps.\r\nBest,\r\nA"}, {"time":"2012-12-12T10:26:48.947091-08:00", "updatedBy":{"username":"ali", "name":"Aries Li", "email":"ali@marklogic.com"}, "change":{}, "files":[], "show":true, "comment":"Alex,\r\n\r\nI try to access iacp.demo.marklogic.com at port 8001 and find out the password is incorrect.\r\nDo you have an updated password? Thanks.\r\n\r\nAries"}, {"time":"2012-12-12T11:53:00.699696-08:00", "updatedBy":{"username":"ali", "name":"Aries Li", "email":"ali@marklogic.com"}, "change":{}, "files":[], "show":true, "comment":"I am able to reproduce this bug. Because the database contains some document with only uri but no content,  such document \"/converted/kevlar/Falle, J. J. C., 3058, OPP, application-ml-ocr_pdf_parts/toc.txt\". Without document content, mlcp copy is not able to figure out the node kind of this document, so the encoding of information for mlcp copy misses the node kind information."}, {"time":"2012-12-12T11:53:24.215849-08:00", "updatedBy":{"username":"ali", "name":"Aries Li", "email":"ali@marklogic.com"}, "change":{"status":{"from":"", "to":"Fix"}, "assignTo":{"from":{"username":"ali", "name":"Aries Li", "email":"ali@marklogic.com"}, "to":{"username":"ali", "name":"Aries Li", "email":"ali@marklogic.com"}}}, "files":[], "show":true}, {"time":"2012-12-12T14:00:37.087035-08:00", "updatedBy":{"username":"ali", "name":"Aries Li", "email":"ali@marklogic.com"}, "change":{}, "files":[], "show":true, "comment":"Hi Alex, Hi Sara,\r\n\r\nI ran the following query in QConsole,\r\nfor $uri in cts:uris()\r\nwhere fn:contains($uri, \"application-ml-ocr_pdf_parts/toc.txt\") and fn:contains($uri, \"/converted/kevlar/Falle\")\r\nreturn <item><uri>{$uri}</uri><doc>{fn:doc($uri)}</doc></item>\r\n\r\nand get the following query result:\r\n<item>\r\n  <uri>/converted/kevlar/Falle, J. J. C., 3058, OPP, application-ml-ocr_pdf_parts/toc.txt</uri>\r\n  <doc/>\r\n</item>\r\n\r\nIt is also confirmed in QConsole by browsing the entire set of documents. See attachment empty_document.png.\r\n\r\nI was wondering how this empty document was loaded. It seems xdmp:document-insert doesn't allow inserting empty document. \r\nIt turns out XCC allows us to do so. For example,\r\npublic class Insert {\r\n\tpublic static void main(String[] args) throws XccConfigException,\r\n\t\t\tURISyntaxException, RequestException {\r\n\t\tContentCreateOptions options = new ContentCreateOptions();\r\n\t\toptions.setFormatXml();\r\n\t\tContent content = ContentFactory.newContent(\"nocontent\", new byte[0],\r\n\t\t\t\t0, 0, options);\r\n\r\n\t\tContentSource cs = ContentSourceFactory.newContentSource(new URI(\r\n\t\t\t\t\"xcc://admin:admin@localhost:5275\"));\r\n\t\tSession session = cs.newSession();\r\n\r\n\t\tsession.setTransactionMode(TransactionMode.UPDATE);\r\n\t\tsession.insertContent(content);\r\n\t\tsession.commit();\r\n\t}\r\n}\r\n\r\nSo, I believe mlcp copy should allow copying empty documents (which only have uris).\r\n\r\nBefore fixing this, the only workaround is to remove the empty documents before running mlcp copy. Here is a query to find out all empty documents:\r\nxquery version \"1.0-ml\";\r\nfor $uri in cts:uris()\r\nwhere fn:empty(xdmp:node-kind(fn:doc($uri)/node()))\r\nreturn <uri>{$uri}</uri>\r\n\r\nIt give me a list of uris of empty documents.\r\n<results warning=\"more than one root item\">\r\n  <uri>/converted/kevlar/Anonymous, 3144, Hempstead NY PD, incident summary-ml-ocr_pdf_parts/toc.txt</uri>\r\n  <uri>/converted/kevlar/Cornett, M. T., 2965, Virginia Beach VA PD, application-ml-ocr_pdf_parts/toc.txt</uri>\r\n  <uri>/converted/kevlar/Donavan, R. J., 3054, Winnipeg MB PS, application-ml-ocr_pdf_parts/toc.txt</uri>\r\n  <uri>/converted/kevlar/Donovan, R. J., 3055, Winnipeg MB PS, applicaiton-ml-ocr_pdf_parts/toc.txt</uri>\r\n  <uri>/converted/kevlar/Falle, J. J. C., 3058, OPP, application-ml-ocr_pdf_parts/toc.txt</uri>\r\n  <uri>/converted/kevlar/Hedge, Theresa J., 1597, Indianapolis IN PD, application-ml-ocr_pdf_parts/toc.txt</uri>\r\n  <uri>/converted/kevlar/Hurley, W. E., 3068, Columbus OH PD, application-ml-ocr_pdf_parts/toc.txt</uri>\r\n  <uri>/converted/kevlar/Todd, W. R., 2576, Gillespie Co TX SO, application-ml-ocr_pdf_parts/toc.txt</uri>\r\n  <uri>/converted/kevlar/Warwar, Michael, 3094, Toronto, ON PD, application-ml-ocr_pdf_parts/toc.txt</uri>\r\n  <uri>/converted/kevlar/Young, Marcus, 1713, Ukiah CA PD, application-ml-ocr_pdf_parts/toc.txt</uri>\r\n  <uri>/converted/nleomf/Brian Etheridge-ml-ocr_pdf_parts/toc.txt</uri>\r\n</results>\r\n\r\n\r\nTo delete those empty documents, you can try the following query in QConsole:\r\n\r\nxquery version \"1.0-ml\";\r\nfor $uri in cts:uris()\r\nwhere fn:empty(xdmp:node-kind(fn:doc($uri)/node()))\r\nreturn xdmp:document-delete($uri)\r\n"}, {"time":"2012-12-12T14:38:44.001615-08:00", "updatedBy":{"username":"ali", "name":"Aries Li", "email":"ali@marklogic.com"}, "change":{}, "files":[], "show":true, "svn":{"repository":"/project/engsvn", "revision":"123805", "paths":["xcc/branches/b6_0/mlcp/src/test/java/com/marklogic/contentpump/TestCopy.java", "xcc/branches/b6_0/mlcp/src/main/java/com/marklogic/contentpump/DatabaseContentReader.java"], "affectedBugs":[]}, "comment":"Bug:20168\ncheck existence of node-kind before encoding"}, {"time":"2012-12-12T14:44:01.691353-08:00", "updatedBy":{"username":"ali", "name":"Aries Li", "email":"ali@marklogic.com"}, "change":{}, "files":[], "show":true, "svn":{"repository":"/project/engsvn", "revision":"123806", "paths":["xcc/trunk/mlcp/src/test/java/com/marklogic/contentpump/TestCopy.java", "xcc/trunk/mlcp/src/main/java/com/marklogic/contentpump/DatabaseContentReader.java"], "affectedBugs":[]}, "comment":"Bug:20168\ncheck existence of node-kind before encoding"}, {"time":"2012-12-12T14:46:00.869851-08:00", "updatedBy":{"username":"ali", "name":"Aries Li", "email":"ali@marklogic.com"}, "change":{"status":{"from":"", "to":"Test"}, "assignTo":{"from":{"username":"ali", "name":"Aries Li", "email":"ali@marklogic.com"}, "to":{"username":"lratcliff", "name":"Larry Ratcliff", "email":"lratcliff@marklogic.com"}}}, "files":[], "show":true, "comment":"Please first insert a mix of empty and non-empty documents into the source database then test mlcp copy."}, {"time":"2012-12-12T14:46:00.869851-08:00", "updatedBy":{"username":"ali", "name":"Aries Li", "email":"ali@marklogic.com"}, "change":{"assignTo":{"from":{"username":"ali", "name":"Aries Li", "email":"ali@marklogic.com"}, "to":{"username":"lratcliff", "name":"Larry Ratcliff", "email":"lratcliff@marklogic.com"}}}, "files":[], "show":true}, {"time":"2013-03-28T11:47:03.997003-07:00", "updatedBy":{"username":"lratcliff", "name":"Larry Ratcliff", "email":"lratcliff@marklogic.com"}, "change":{"status":{"from":"", "to":"Ship"}, "assignTo":{"from":{"username":"lratcliff", "name":"Larry Ratcliff", "email":"lratcliff@marklogic.com"}, "to":{"username":"nobody", "name":"nobody nobody", "email":"nobody@marklogic.com"}}}, "files":[], "show":true, "comment":"Verified on build 6.0-20130328"}, {"time":"2013-04-22T16:21:05.530555-07:00", "updatedBy":{"username":"rpelton", "name":"Rick Pelton", "email":"rick.pelton@marklogic.com"}, "change":{"status":{"from":"", "to":"Closed"}, "assignTo":{"from":{"username":"rpelton", "name":"Rick Pelton", "email":"rick.pelton@marklogic.com"}, "to":{"username":"nobody", "name":"nobody nobody", "email":"nobody@marklogic.com"}}}, "files":[], "show":true}], "updatedAt":"2013-04-22T16:21:05.530555-07:00", "fixedAt":"2012-12-12T14:46:00.869851-08:00", "fixedBy":{"username":"ali", "name":"Aries Li", "email":"ali@marklogic.com"}, "shippedAt":"2013-03-28T11:47:03.997003-07:00", "shippedBy":{"username":"lratcliff", "name":"Larry Ratcliff", "email":"lratcliff@marklogic.com"}, "closedAt":"2013-04-22T16:21:05.530555-07:00", "closedBy":{"username":"rpelton", "name":"Rick Pelton", "email":"rick.pelton@marklogic.com"}, "renderDescriptionAs":"normal", "renderSampleQueryAs":"normal", "renderSampleDataAs":"normal"}
{"id":20918, "kind":"Bug", "createdAt":"2013-02-25T03:32:09.665032-08:00", "status":"Closed", "title":"REGR:cts:uri-match is yielding incorrect results on wildcard search", "category":"search", "severity":"Critical", "priority":{"level":"5", "title":""}, "submittedBy":{"username":"iagrawal", "name":"Isha Agrawal", "email":"iagrawal@marklogic.com"}, "assignTo":{"username":"nobody", "name":"nobody nobody", "email":"nobody@marklogic.com"}, "description":"REGR:cts:uri-match is yielding incorrect results on wildcard search\r\n\r\nTest failing: uriLexicon.xml\r\nML version: 7.0-20130224\r\nLink to diff: https://regression-status.marklogic.com/new-app/space2/diff-archive/b7_0-ea1/2013-02-24/linux-64-rh5-cluster/diffs/uriLexicon.xml\r\n\r\nSteps to reproduce:\r\n\r\n1. Create Db say \"uriDB\" and associate db with triggers db.\r\n2. Create 2 forest say uriforestA,uriforestB and associate them with the db.\r\n3. add fragment root\r\nxquery version \"1.0-ml\";\r\n         import module namespace admin=\"http://marklogic.com/xdmp/admin\" at \"/MarkLogic/admin.xqy\";\r\n         let $config := admin:get-configuration()\r\n        let $names := (\"SPEECH\",\"content\")\r\n        let $dbid := admin:database-get-id($config, \"uriDB\")\r\n        let $elements := ( for $i in $names\r\n                return admin:database-fragment-root(\"\", $i) )\r\n        let $c := admin:database-add-fragment-root($config, $dbid, $elements)\r\n        return admin:save-configuration($c)\r\n4. enable uri and collection lexicons\r\n5. Load Data\r\ndefault element namespace=\"http://marklogic.com/xdmp/directory\"\r\nfor $a in data(xdmp:filesystem-directory(\"QA_HOME/testdata/1.2Scripts/Shakespeare\")//pathname)\r\nlet $name :=substring-after($a, \"QA_HOME/testdata/1.2Scripts/Shakespeare/\")\r\n  return\r\n   if (contains($name,\".xml\"))\r\n    then xdmp:document-load($a,\r\n    <options xmlns=\"xdmp:document-load\">\r\n     <uri>{$name[last()]}</uri>\r\n     <forests> <forest>{xdmp:forest(\"uriforestB\")}</forest> </forests>\r\n     <collections> <collection>http://marklogic.com/shakespeare.xml</collection> </collections>\r\n      </options>)\r\n     else ();\r\nxdmp:document-insert(\"espa&#241;ol.xml\",\r\n<content xml:lang='sp'>Como estas</content>\r\n,xdmp:default-permissions(),\"http://marklogic.com/espa&#241;ol.xml\",0,xdmp:forest(\"uriforestA\")),\r\nxdmp:document-insert(\"espanoles.xml\",\r\n<content xml:lang='sp'>Juan, Jose, Enrique</content>\r\n,xdmp:default-permissions(),\"http://marklogic.com/espanoles.xml\",0,xdmp:forest(\"uriforestA\")),\r\nxdmp:document-insert(\"espana.xml\",\r\n<content xml:lang='sp'>Madrid, Barcelona</content>\r\n,xdmp:default-permissions(),\"http://marklogic.com/espana.xml\",0,xdmp:forest(\"uriforestA\")),\r\nxdmp:document-insert(\"example.xml\",\r\n<content xml:lang='en'>This is an example doc</content>\r\n,xdmp:default-permissions(),\"http://marklogic.com/example.xml\",0,xdmp:forest(\"uriforestA\")),\r\nxdmp:document-insert(\"MARKLOGIC.xml\",\r\n<content xml:lang='en'>People's Choice</content>\r\n,xdmp:default-permissions(),\"http://MARKLOGIC.com/MARKLOGIC.xml\",0,xdmp:forest(\"uriforestA\"));\r\nxdmp:lock-acquire(\"example.xml\");\r\nxdmp:lock-acquire(\"MARKLOGIC.xml\")\r\n6. Run following queries:\r\n\r\nquery 1:\r\ncts:uri-match(\"p?r*\")\r\nActual result: blank\r\nExpected result: pericles.xml\r\n\r\nQuery 2:\r\ncts:uri-match(\"M*\",\"case-insensitive\")\r\n\r\nActual result:MARKLOGIC.xml\r\nExpected result: MARKLOGIC.xmlm_for_m.xmlm_wives.xmlmacbeth.xmlmerchant.xmlmuch_ado.xml\r\n", "samplequery":"", "sampledata":"", "version":"7.0-nightly", "tofixin":"7.0-ea1", "fixedin":"7.0-ea1", "platform":"all", "memory":"", "processors":"", "note":"", "subscribers":[{"username":"iagrawal", "name":"Isha Agrawal", "email":"iagrawal@marklogic.com"}, {"username":"fxue", "name":"Fei Xue", "email":"Fei.Xue@marklogic.com"}, {"username":"mary", "name":"Mary Holstege", "email":"mary@cerisent.com"}, {"username":"rhu", "name":"Ron Hu", "email":"ron.hu@marklogic.com"}, {"username":"sverma", "name":"Shiva Verma", "email":"shiva.verma@marklogic.com"}], "attachments":[], "relationships":[{"type":"", "to":""}], "clones":[], "cloneOf":"", "support":{"headline":"", "supportDescription":"", "publishStatus":"Not Ready", "tickets":[], "customerImpact":{"level":"N/A", "title":""}, "workaround":""}, "tags":["search", "iagrawal"], "changeHistory":[{"time":"2013-02-25T03:32:09.665032-08:00", "updatedBy":{"username":"iagrawal", "name":"Isha Agrawal", "email":"iagrawal@marklogic.com"}, "change":{"assignTo":{"from":{"username":"iagrawal", "name":"Isha Agrawal", "email":"iagrawal@marklogic.com"}, "to":{"username":"rhu", "name":"Ron Hu", "email":"ron.hu@marklogic.com"}}}, "files":[], "show":true}, {"time":"2013-02-25T10:50:28.831177-08:00", "updatedBy":{"username":"rhu", "name":"Ron Hu", "email":"ron.hu@marklogic.com"}, "change":{"assignTo":{"from":{"username":"rhu", "name":"Ron Hu", "email":"ron.hu@marklogic.com"}, "to":{"username":"mary", "name":"Mary Holstege", "email":"mary@cerisent.com"}}}, "files":[], "show":true}, {"time":"2013-02-25T11:09:01.115001-08:00", "updatedBy":{"username":"mary", "name":"Mary Holstege", "email":"mary@cerisent.com"}, "change":{}, "files":[], "show":true, "comment":"Suspect this is related to your other bug."}, {"time":"2013-02-25T11:09:01.115001-08:00", "updatedBy":{"username":"mary", "name":"Mary Holstege", "email":"mary@cerisent.com"}, "change":{"assignTo":{"from":{"username":"mary", "name":"Mary Holstege", "email":"mary@cerisent.com"}, "to":{"username":"fxue", "name":"Fei Xue", "email":"Fei.Xue@marklogic.com"}}}, "files":[], "show":true}, {"time":"2013-02-25T15:21:31.547696-08:00", "updatedBy":{"username":"fxue", "name":"Fei Xue", "email":"Fei.Xue@marklogic.com"}, "change":{}, "files":[], "show":true, "comment":"Fixed as part of 20899\r\n\r\nSubmitted By: Fei Xue\tFebruary 25, 2013 15:01 PT\r\nComment: \r\nBug:20899 fix lexicon optimization on small wc\r\nSVN Info: \r\nRevision: 133565\r\nModified Files:\r\nxdmp/trunk/src/Collation.cpp\r\nxdmp/trunk/src/OnDiskRangeIndexes.cpp\r\nOther Bugs Referenced by this Commit:\r\n"}, {"time":"2013-02-25T15:29:27.994496-08:00", "updatedBy":{"username":"fxue", "name":"Fei Xue", "email":"Fei.Xue@marklogic.com"}, "change":{}, "files":[], "show":true, "svn":{"repository":"/project/engsvn", "revision":"133577", "paths":["xdmp/branches/b7_0-ea1/src/OnDiskRangeIndexes.cpp", "xdmp/branches/b7_0-ea1/src/InMemoryRangeIndexes.cpp", "xdmp/branches/b7_0-ea1/src/Collation.cpp"], "affectedBugs":["20899", "20893"]}, "comment":"Bug:20918 Bug:20899 Bug:20893 port to b7.0-ea1"}, {"time":"2013-02-25T15:31:30.799396-08:00", "updatedBy":{"username":"fxue", "name":"Fei Xue", "email":"Fei.Xue@marklogic.com"}, "change":{"status":{"from":"", "to":"Test"}, "assignTo":{"from":{"username":"fxue", "name":"Fei Xue", "email":"Fei.Xue@marklogic.com"}, "to":{"username":"iagrawal", "name":"Isha Agrawal", "email":"iagrawal@marklogic.com"}}}, "files":[], "show":true, "comment":"Fixed on 20130226 both on trunk and 7.0ea1"}, {"time":"2013-02-25T15:31:30.799396-08:00", "updatedBy":{"username":"fxue", "name":"Fei Xue", "email":"Fei.Xue@marklogic.com"}, "change":{"assignTo":{"from":{"username":"fxue", "name":"Fei Xue", "email":"Fei.Xue@marklogic.com"}, "to":{"username":"iagrawal", "name":"Isha Agrawal", "email":"iagrawal@marklogic.com"}}}, "files":[], "show":true}, {"time":"2013-02-26T20:46:25.413516-08:00", "updatedBy":{"username":"iagrawal", "name":"Isha Agrawal", "email":"iagrawal@marklogic.com"}, "change":{"status":{"from":"", "to":"Ship"}, "assignTo":{"from":{"username":"iagrawal", "name":"Isha Agrawal", "email":"iagrawal@marklogic.com"}, "to":{"username":"nobody", "name":"nobody nobody", "email":"nobody@marklogic.com"}}}, "files":[], "show":true, "comment":"Verified on ML version 7.0-20130226. The test uriLexicon.xml  is passing now,hence shipping the bug."}, {"time":"2013-02-26T20:46:25.413516-08:00", "updatedBy":{"username":"iagrawal", "name":"Isha Agrawal", "email":"iagrawal@marklogic.com"}, "change":{"assignTo":{"from":{"username":"iagrawal", "name":"Isha Agrawal", "email":"iagrawal@marklogic.com"}, "to":{"username":"nobody", "name":"nobody nobody", "email":"nobody@marklogic.com"}}}, "files":[], "show":true}], "updatedAt":"2013-02-26T20:46:25.413516-08:00", "fixedAt":"2013-02-25T15:31:30.799396-08:00", "fixedBy":{"username":"fxue", "name":"Fei Xue", "email":"Fei.Xue@marklogic.com"}, "shippedAt":"2013-02-26T20:46:25.413516-08:00", "shippedBy":{"username":"iagrawal", "name":"Isha Agrawal", "email":"iagrawal@marklogic.com"}, "renderDescriptionAs":"normal"}
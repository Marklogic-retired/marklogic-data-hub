{"id":20752, "kind":"Bug", "createdAt":"2013-02-11T15:41:41.380148-08:00", "status":"Closed", "title":"XDMP-UNINDEXABLEPATH while trying to reindex a database with bunch of path-fields", "category":"xdmp", "severity":"Major", "priority":{"level":"5", "title":""}, "submittedBy":{"username":"msrinivasan", "name":"Mahalakshmi Srinivasan", "email":"mahalakshmi.srinivasan@marklogic.com"}, "assignTo":{"username":"nobody", "name":"nobody nobody", "email":"nobody@marklogic.com"}, "description":"MarkLogic Version 7.0-20130205\r\n\r\nI have many path-fields created on the 'Documents' database and enabled field-value searches on the field called 'nsfield'. Even after doing that, the cts:search(fn:doc(),cts:field-value-query(\"nsfield\",\"Jill Vill mill\")) threw an exception saying \"Searches not enabled\". Hence I tried to reindex the database and that returned the following exception on the UI:\r\n\t\r\nYou've encountered an error in the server. Please copy the text below, and email support (support@marklogic.com):\r\n\r\n500: Internal Server Error\r\nXDMP-UNINDEXABLEPATH: Invalid syntax for path index\r\nIn /lib/session.xqy on line 947\r\nIn write-cluster-and-restart(\"databases.xml\", <databases xsi:schemaLocation=\"http://marklogic.com/xdmp/database database.xsd\" xmlns:xsi=\"http://www.w3.org/2001/XMLSchema-instance\" xmlns=\"http://marklogic.com/xdmp/database\"><database><database-id>6342422147333108425</database-id><databas...</databases>, \"database\", (\"section\", \"database\"))\r\n\r\n    $filename = \"databases.xml\"\r\n    $output = <databases xsi:schemaLocation=\"http://marklogic.com/xdmp/database database.xsd\" xmlns:xsi=\"http://www.w3.org/2001/XMLSchema-instance\" xmlns=\"http://marklogic.com/xdmp/database\"><database><database-id>6342422147333108425</database-id><databas...</databases>\r\n    $target = \"database\"\r\n    $fields = (\"section\", \"database\")\r\n    $e = <error:error xsi:schemaLocation=\"http://marklogic.com/xdmp/error error.xsd\" xmlns:xsi=\"http://www.w3.org/2001/XMLSchema-instance\" xmlns:error=\"http://marklogic.com/xdmp/error\"><error:code>XDMP-UNINDEXABLEPATH</error:code><error:name/><error...</error:error>\r\n    $hid = ()\r\n    $code = \"XDMP-UNINDEXABLEPATH\"\r\n\r\nIn /reindex-database-go.xqy on line 112\r\n\r\n    $confirm = \"databases.xml\"\r\n    $cancel = <databases xsi:schemaLocation=\"http://marklogic.com/xdmp/database database.xsd\" xmlns:xsi=\"http://www.w3.org/2001/XMLSchema-instance\" xmlns=\"http://marklogic.com/xdmp/database\"><database><database-id>6342422147333108425</database-id><databas...</databases>\r\n    $schemaroot = \"database\"\r\n    $datanode = (\"section\", \"database\")\r\n\r\nI am attaching the config file in this bug.\r\n", "samplequery":"", "sampledata":"", "version":"7.0-nightly", "tofixin":"7.0-ea1", "fixedin":"7.0-ea1", "platform":"all", "memory":"", "processors":"", "note":"", "subscribers":[{"username":"msrinivasan", "name":"Mahalakshmi Srinivasan", "email":"mahalakshmi.srinivasan@marklogic.com"}, {"username":"gchinchwadkar", "name":"Gajanan Chinchwadkar", "email":"Gajanan.Chinchwadkar@marklogic.com"}], "attachments":[{"name":"databases.xml", "uri":"root/support/bugtracking/attachments/20752/databases.xml"}, {"name":"This is the correct databases.xml file", "uri":"root/support/bugtracking/attachments/20752/databases-20752.xml"}], "relationships":[{"type":"", "to":""}], "clones":[], "cloneOf":"", "support":{"headline":"", "supportDescription":"", "publishStatus":"Not Ready", "tickets":[], "customerImpact":{"level":"N/A", "title":""}, "workaround":""}, "tags":["xdmp", "msrinivasan"], "changeHistory":[{"time":"2013-02-11T15:41:41.380148-08:00", "updatedBy":{"username":"msrinivasan", "name":"Mahalakshmi Srinivasan", "email":"mahalakshmi.srinivasan@marklogic.com"}, "change":{"assignTo":{"from":{"username":"msrinivasan", "name":"Mahalakshmi Srinivasan", "email":"mahalakshmi.srinivasan@marklogic.com"}, "to":{"username":"gchinchwadkar", "name":"Gajanan Chinchwadkar", "email":"Gajanan.Chinchwadkar@marklogic.com"}}}, "files":[], "show":true}, {"time":"2013-02-12T12:31:15.89968-08:00", "updatedBy":{"username":"gchinchwadkar", "name":"Gajanan Chinchwadkar", "email":"Gajanan.Chinchwadkar@marklogic.com"}, "change":{}, "files":[], "show":true, "comment":"In the attached config file the Documents database has only one field:\r\n\r\n    <fields>\r\n      <field>\r\n\t<field-name/>\r\n\t<include-root>true</include-root>\r\n\t<included-elements/>\r\n\t<excluded-elements/>\r\n      </field>\r\n    </fields>\r\n\r\nI do not see any path field. I think there is something else wrong in the setup or an incorrect databases.xml has been attached to this bug.\r\n\r\nThis bug may have been possible in the past. But now the fix for bug: 20669 prohibits user from creating a field on unindexable path. The re-indexer will never see the path."}, {"time":"2013-02-12T12:31:15.89968-08:00", "updatedBy":{"username":"gchinchwadkar", "name":"Gajanan Chinchwadkar", "email":"Gajanan.Chinchwadkar@marklogic.com"}, "change":{"status":{"from":"", "to":"Test"}, "assignTo":{"from":{"username":"gchinchwadkar", "name":"Gajanan Chinchwadkar", "email":"Gajanan.Chinchwadkar@marklogic.com"}, "to":{"username":"msrinivasan", "name":"Mahalakshmi Srinivasan", "email":"mahalakshmi.srinivasan@marklogic.com"}}}, "files":[], "show":true}, {"time":"2013-02-12T12:31:15.89968-08:00", "updatedBy":{"username":"gchinchwadkar", "name":"Gajanan Chinchwadkar", "email":"Gajanan.Chinchwadkar@marklogic.com"}, "change":{"assignTo":{"from":{"username":"gchinchwadkar", "name":"Gajanan Chinchwadkar", "email":"Gajanan.Chinchwadkar@marklogic.com"}, "to":{"username":"msrinivasan", "name":"Mahalakshmi Srinivasan", "email":"mahalakshmi.srinivasan@marklogic.com"}}}, "files":[], "show":true}, {"time":"2013-02-12T12:51:49.664899-08:00", "updatedBy":{"username":"msrinivasan", "name":"Mahalakshmi Srinivasan", "email":"mahalakshmi.srinivasan@marklogic.com"}, "change":{"status":{"from":"", "to":"Ship"}, "assignTo":{"from":{"username":"msrinivasan", "name":"Mahalakshmi Srinivasan", "email":"mahalakshmi.srinivasan@marklogic.com"}, "to":{"username":"nobody", "name":"nobody nobody", "email":"nobody@marklogic.com"}}}, "files":[], "show":true, "comment":"Agree with Gajanan that the fix for 20669 seems to have fixed this bug too. But just for the record, I have attached the correct databases.xml file to this bug. Verified on build 7.0-20130212."}], "updatedAt":"2013-02-12T12:51:49.664899-08:00", "fixedAt":"2013-02-12T12:31:15.89968-08:00", "fixedBy":{"username":"gchinchwadkar", "name":"Gajanan Chinchwadkar", "email":"Gajanan.Chinchwadkar@marklogic.com"}, "shippedAt":"2013-02-12T12:51:49.664899-08:00", "shippedBy":{"username":"msrinivasan", "name":"Mahalakshmi Srinivasan", "email":"mahalakshmi.srinivasan@marklogic.com"}, "renderDescriptionAs":"normal"}
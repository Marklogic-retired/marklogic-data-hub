{"id":20649, "kind":"Bug", "createdAt":"2012-06-01T11:01:58.793694-07:00", "status":"Closed", "title":"Database status page extremely slow with over a billion documents in the db", "category":"adminGUI", "severity":"Performance", "priority":{"level":"5", "title":""}, "submittedBy":{"username":"lratcliff", "name":"Larry Ratcliff", "email":"lratcliff@marklogic.com"}, "assignTo":{"username":"nobody", "name":"nobody nobody", "email":"nobody@marklogic.com"}, "description":"Using 5.0-3.1 the following was observed : \r\n\r\nwith 60 forests 1,468,321,919 fragments it takes the database status page several minutes to render. \r\n\r\nTo see this behavior at least for the moment one can log into rh6-intel64-7:8001 and navigate to the database status page for the documents db. \r\n\r\n", "samplequery":"", "sampledata":"", "version":"6.0-1", "tofixin":"6.0-5", "fixedin":"6.0-5", "platform":"all", "memory":"", "processors":"", "note":"", "subscribers":[{"username":"lratcliff", "name":"Larry Ratcliff", "email":"lratcliff@marklogic.com"}, {"username":"arosenba", "name":"Aaron Rosenbaum", "email":"Aaron.Rosenbaum@marklogic.com"}, {"username":"rhu", "name":"Ron Hu", "email":"ron.hu@marklogic.com"}, {"username":"bmo", "name":"Brian Mo", "email":"brian.mo@marklogic.com"}, {"username":"dgorbet", "name":"David Gorbet", "email":"David.Gorbet@marklogic.com"}, {"username":"hwu", "name":"Haitao Wu", "email":"haitao.wu@marklogic.com"}, {"username":"gvaidees", "name":"Ganesh Vaideeswaran", "email":"Ganesh.Vaideeswaran@marklogic.com"}, {"username":"msarma", "name":"Meghalim Sarma", "email":"msarma@marklogic.com"}], "attachments":[], "relationships":[{"type":"", "to":""}], "clones":[], "cloneOf":17406, "support":{"headline":"", "supportDescription":"", "publishStatus":"Never Publish", "tickets":[], "customerImpact":{"level":"N/A", "title":""}, "workaround":""}, "tags":["adminGUI", "lratcliff"], "changeHistory":[{"time":"2012-06-01T11:01:58.793694-07:00", "updatedBy":{"username":"lratcliff", "name":"Larry Ratcliff", "email":"lratcliff@marklogic.com"}, "change":{"assignTo":{"from":{"username":"lratcliff", "name":"Larry Ratcliff", "email":"lratcliff@marklogic.com"}, "to":{"username":"rhu", "name":"Ron Hu", "email":"ron.hu@marklogic.com"}}}, "files":[], "show":true}, {"time":"2012-06-04T10:28:06.859948-07:00", "updatedBy":{"username":"wfeick", "name":"Wayne Feick", "email":"wfeick@marklogic.com"}, "change":{"assignTo":{"from":{"username":"wfeick", "name":"Wayne Feick", "email":"wfeick@marklogic.com"}, "to":{"username":"gvaidees", "name":"Ganesh Vaideeswaran", "email":"Ganesh.Vaideeswaran@marklogic.com"}}}, "files":[], "show":true}, {"time":"2012-06-20T15:37:33.001836-07:00", "updatedBy":{"username":"dsokolsky", "name":"Danny Sokolsky", "email":"dsokolsky@marklogic.com"}, "change":{}, "files":[], "show":true, "comment":"Can you be more specific about how long it took.  Maybe put an xdmp:elapsed-time() in the page.  Also, aren't you happy that it even renders at all?  This is expected to be slow."}, {"time":"2012-06-20T18:06:41.761915-07:00", "updatedBy":{"username":"lratcliff", "name":"Larry Ratcliff", "email":"lratcliff@marklogic.com"}, "change":{}, "files":[], "show":true, "comment":"It was ~ 5-7 minutes. long enough to fix a coffee come back and have the page still not render. "}, {"time":"2012-12-06T15:33:27.662663-08:00", "updatedBy":{"username":"gvaidees", "name":"Ganesh Vaideeswaran", "email":"Ganesh.Vaideeswaran@marklogic.com"}, "change":{}, "files":[], "show":true, "comment":"Brian,\r\n\r\nCan you see if there is anything low-hanging here. Please talk to Megha for the environment.\r\n\r\nThanks,\r\n\r\nGanesh  "}, {"time":"2012-12-06T15:33:27.662663-08:00", "updatedBy":{"username":"gvaidees", "name":"Ganesh Vaideeswaran", "email":"Ganesh.Vaideeswaran@marklogic.com"}, "change":{"assignTo":{"from":{"username":"gvaidees", "name":"Ganesh Vaideeswaran", "email":"Ganesh.Vaideeswaran@marklogic.com"}, "to":{"username":"bmo", "name":"Brian Mo", "email":"brian.mo@marklogic.com"}}}, "files":[], "show":true}, {"time":"2013-01-07T13:25:31.717184-08:00", "updatedBy":{"username":"rpelton", "name":"Rick Pelton", "email":"rick.pelton@marklogic.com"}, "change":{"tofixin":{"from":"5.0-5", "to":"N/A"}}, "files":[], "show":true}, {"time":"2013-01-30T16:30:18.896823-08:00", "updatedBy":{"username":"hwu", "name":"Haitao Wu", "email":"haitao.wu@marklogic.com"}, "change":{}, "files":[], "show":true, "svn":{"repository":"/project/engsvn", "revision":"130053", "paths":["xdmp/branches/b6_0/src/Stand.h", "xdmp/branches/b6_0/src/StatusBuiltins.cpp", "xdmp/branches/b6_0/src/Stand.cpp"], "affectedBugs":[]}, "comment":"bug:20649 in forest-counts, go through the timestamps file once to get all three fragment counts"}, {"time":"2013-01-30T16:43:25.524193-08:00", "updatedBy":{"username":"dsokolsky", "name":"Danny Sokolsky", "email":"dsokolsky@marklogic.com"}, "change":{}, "files":[], "show":true, "comment":"Haitao, I guess this is yours now?"}, {"time":"2013-01-30T16:43:25.524193-08:00", "updatedBy":{"username":"dsokolsky", "name":"Danny Sokolsky", "email":"dsokolsky@marklogic.com"}, "change":{"assignTo":{"from":{"username":"dsokolsky", "name":"Danny Sokolsky", "email":"dsokolsky@marklogic.com"}, "to":{"username":"hwu", "name":"Haitao Wu", "email":"haitao.wu@marklogic.com"}}}, "files":[], "show":true}, {"time":"2013-01-30T16:43:25.524193-08:00", "updatedBy":{"username":"dsokolsky", "name":"Danny Sokolsky", "email":"dsokolsky@marklogic.com"}, "change":{"tofixin":{"from":"", "to":"6.0-3"}}, "files":[], "show":true}, {"time":"2013-01-30T16:53:15.724892-08:00", "updatedBy":{"username":"hwu", "name":"Haitao Wu", "email":"haitao.wu@marklogic.com"}, "change":{}, "files":[], "show":true, "comment":"I optimized forest-counts a bit but this is still an AdminUi issue.  Please see my latest comment in Bug 20229."}, {"time":"2013-01-30T16:53:15.724892-08:00", "updatedBy":{"username":"hwu", "name":"Haitao Wu", "email":"haitao.wu@marklogic.com"}, "change":{"assignTo":{"from":{"username":"hwu", "name":"Haitao Wu", "email":"haitao.wu@marklogic.com"}, "to":{"username":"bmo", "name":"Brian Mo", "email":"brian.mo@marklogic.com"}}}, "files":[], "show":true}, {"time":"2013-02-28T15:32:08.382438-08:00", "updatedBy":{"username":"gvaidees", "name":"Ganesh Vaideeswaran", "email":"Ganesh.Vaideeswaran@marklogic.com"}, "change":{"tofixin":{"from":"6.0-3", "to":"6.0-4"}}, "files":[], "show":true}, {"time":"2013-07-02T14:02:23.976721-07:00", "updatedBy":{"username":"bmo", "name":"Brian Mo", "email":"brian.mo@marklogic.com"}, "change":{}, "files":[], "show":true, "comment":"Two frontend solutions for this problem:\r\n\r\n1)  Add a \"Show Details\" button for refreshing the page with additional info (\"Reindexing/Refragmenting State\", Documents, Fragments, Deleted Fragments counts).\r\n      Cons:  users need to click the Show Details button to see the info even for small counts (fast).  After clicking the Show Details button, the users still need to wait for the same amount of time for the page to refresh.\r\n2)   Web 2.0 way - after the page being loaded, starts prefetching the counts data (ajax) and do dynamic UI update when the data  arrives.\r\n      Cons:   more development cost and there may be unknown issues doing so for admin pages.\r\n\r\nMy cost estimates for solutions\r\n1) about 2 days\r\n2) about 4+ days.\r\n\r\nPersonally, I like solution 2 better."}, {"time":"2013-07-02T14:02:23.976721-07:00", "updatedBy":{"username":"bmo", "name":"Brian Mo", "email":"brian.mo@marklogic.com"}, "change":{"assignTo":{"from":{"username":"bmo", "name":"Brian Mo", "email":"brian.mo@marklogic.com"}, "to":{"username":"gvaidees", "name":"Ganesh Vaideeswaran", "email":"Ganesh.Vaideeswaran@marklogic.com"}}}, "files":[], "show":true}, {"time":"2013-07-11T15:46:40.125172-07:00", "updatedBy":{"username":"gvaidees", "name":"Ganesh Vaideeswaran", "email":"Ganesh.Vaideeswaran@marklogic.com"}, "change":{}, "files":[], "show":true, "comment":"Not in support's reuest list for 6.0-4"}, {"time":"2013-07-11T15:46:40.125172-07:00", "updatedBy":{"username":"gvaidees", "name":"Ganesh Vaideeswaran", "email":"Ganesh.Vaideeswaran@marklogic.com"}, "change":{"tofixin":{"from":"6.0-4", "to":"6.0-5"}}, "files":[], "show":true}, {"time":"2013-08-16T15:39:26.277283-07:00", "updatedBy":{"username":"hwu", "name":"Haitao Wu", "email":"haitao.wu@marklogic.com"}, "change":{}, "files":[], "show":true, "svn":{"repository":"/project/engsvn", "revision":"149408", "paths":["xdmp/branches/b6_0/src/StatusBuiltins.cpp"], "affectedBugs":[]}, "comment":"bug:20649 backported the change that addes concurrency to forest-counts"}, {"time":"2014-02-02T21:29:06.576563-08:00", "updatedBy":{"username":"gvaidees", "name":"Ganesh Vaideeswaran", "email":"Ganesh.Vaideeswaran@marklogic.com"}, "change":{"assignTo":{"from":{"username":"gvaidees", "name":"Ganesh Vaideeswaran", "email":"Ganesh.Vaideeswaran@marklogic.com"}, "to":{"username":"dgorbet", "name":"David Gorbet", "email":"David.Gorbet@marklogic.com"}}}, "files":[], "show":true}, {"time":"2014-02-03T11:34:40.487723-08:00", "updatedBy":{"username":"dgorbet", "name":"David Gorbet", "email":"David.Gorbet@marklogic.com"}, "change":{}, "files":[], "show":true, "comment":"Haitao, looks like you checked in for this bug. Is it fixed, or is there more work to do? Not sure why it's assigned to me. thx."}, {"time":"2014-02-03T11:34:40.487723-08:00", "updatedBy":{"username":"dgorbet", "name":"David Gorbet", "email":"David.Gorbet@marklogic.com"}, "change":{"assignTo":{"from":{"username":"dgorbet", "name":"David Gorbet", "email":"David.Gorbet@marklogic.com"}, "to":{"username":"hwu", "name":"Haitao Wu", "email":"haitao.wu@marklogic.com"}}}, "files":[], "show":true}, {"time":"2014-02-03T17:48:16.315256-08:00", "updatedBy":{"username":"hwu", "name":"Haitao Wu", "email":"haitao.wu@marklogic.com"}, "change":{}, "files":[], "show":true, "comment":"All C++ code changes have been backported from 7.0 to 6.0.   The XQuery layer change made by Ganesh in R149383 should also be backported.  What Brian left is a non-trivial change for the AdminGUI.  I think that should be in Stu's court now although it might also needs PM's input.\r\n\r\nGanesh, can you backport R149383 then assign the bug to Stu?"}, {"time":"2014-02-03T17:48:16.315256-08:00", "updatedBy":{"username":"hwu", "name":"Haitao Wu", "email":"haitao.wu@marklogic.com"}, "change":{"assignTo":{"from":{"username":"hwu", "name":"Haitao Wu", "email":"haitao.wu@marklogic.com"}, "to":{"username":"gvaidees", "name":"Ganesh Vaideeswaran", "email":"Ganesh.Vaideeswaran@marklogic.com"}}}, "files":[], "show":true}, {"time":"2014-02-03T20:52:37.556797-08:00", "updatedBy":{"username":"gvaidees", "name":"Ganesh Vaideeswaran", "email":"Ganesh.Vaideeswaran@marklogic.com"}, "change":{}, "files":[], "show":true, "comment":"Haitao,\r\n\r\nIs my change needed? I can leave the code as is I think"}, {"time":"2014-02-03T21:32:43.210975-08:00", "updatedBy":{"username":"hwu", "name":"Haitao Wu", "email":"haitao.wu@marklogic.com"}, "change":{}, "files":[], "show":true, "comment":"I think 149383 is still need: it changed a sequence of forest-counts calls to one forest-counts call with a sequence of forest ids as the input.  Only the latter will \"trigger\" parallelism in the server."}, {"time":"2014-02-03T21:37:23.004971-08:00", "updatedBy":{"username":"gvaidees", "name":"Ganesh Vaideeswaran", "email":"Ganesh.Vaideeswaran@marklogic.com"}, "change":{}, "files":[], "show":true, "comment":"ah OK .. this is the one where the builtin changed to accept a sequence, but the docs did not. I forgot that. The docs still take a single forest id. I will make the chanhe"}, {"time":"2014-02-03T21:41:21.220121-08:00", "updatedBy":{"username":"gvaidees", "name":"Ganesh Vaideeswaran", "email":"Ganesh.Vaideeswaran@marklogic.com"}, "change":{}, "files":[], "show":true, "comment":"In code review"}, {"time":"2014-02-03T21:59:12.223493-08:00", "updatedBy":{"username":"gvaidees", "name":"Ganesh Vaideeswaran", "email":"Ganesh.Vaideeswaran@marklogic.com"}, "change":{}, "files":[], "show":true, "comment":"Checked in via svnr 160433"}, {"time":"2014-02-03T21:59:12.223493-08:00", "updatedBy":{"username":"gvaidees", "name":"Ganesh Vaideeswaran", "email":"Ganesh.Vaideeswaran@marklogic.com"}, "change":{"status":{"from":"", "to":"Test"}, "assignTo":{"from":{"username":"gvaidees", "name":"Ganesh Vaideeswaran", "email":"Ganesh.Vaideeswaran@marklogic.com"}, "to":{"username":"msarma", "name":"Meghalim Sarma", "email":"msarma@marklogic.com"}}}, "files":[], "show":true, "comment":"Checked in via svnr 160433"}, {"time":"2014-02-03T21:59:12.223493-08:00", "updatedBy":{"username":"gvaidees", "name":"Ganesh Vaideeswaran", "email":"Ganesh.Vaideeswaran@marklogic.com"}, "change":{"assignTo":{"from":{"username":"gvaidees", "name":"Ganesh Vaideeswaran", "email":"Ganesh.Vaideeswaran@marklogic.com"}, "to":{"username":"msarma", "name":"Meghalim Sarma", "email":"msarma@marklogic.com"}}}, "files":[], "show":true}, {"time":"2014-02-07T21:01:51.042107-08:00", "updatedBy":{"username":"gvaidees", "name":"Ganesh Vaideeswaran", "email":"Ganesh.Vaideeswaran@marklogic.com"}, "change":{}, "files":[], "show":true, "svn":{"repository":"/project/engsvn", "revision":"160951", "paths":["xdmp/branches/b6_0/src/Admin/lib/database-status-form.xqy"], "affectedBugs":[]}, "comment":"Bug:20649 Fixed a bug that was due to a cut and paste error from 7.0 (forest-counts only takes 2 parameters in 6.0)"}, {"time":"2014-02-14T11:20:14.676108-08:00", "updatedBy":{"username":"msarma", "name":"Meghalim Sarma", "email":"msarma@marklogic.com"}, "change":{}, "files":[], "show":true, "comment":"Larry giving you this for verification not only because you logged the bug and verified the 7.0 clone, but because I believe you have a test that loads billion documents which you need to verify this fix."}, {"time":"2014-02-14T11:20:14.676108-08:00", "updatedBy":{"username":"msarma", "name":"Meghalim Sarma", "email":"msarma@marklogic.com"}, "change":{"assignTo":{"from":{"username":"msarma", "name":"Meghalim Sarma", "email":"msarma@marklogic.com"}, "to":{"username":"lratcliff", "name":"Larry Ratcliff", "email":"lratcliff@marklogic.com"}}}, "files":[], "show":true}, {"time":"2014-02-28T10:52:42.981105-08:00", "updatedBy":{"username":"lratcliff", "name":"Larry Ratcliff", "email":"lratcliff@marklogic.com"}, "change":{"status":{"from":"", "to":"Ship"}, "assignTo":{"from":{"username":"lratcliff", "name":"Larry Ratcliff", "email":"lratcliff@marklogic.com"}, "to":{"username":"nobody", "name":"nobody nobody", "email":"nobody@marklogic.com"}}}, "files":[], "show":true, "comment":"Verified on build 6.0-20140211"}], "updatedAt":"2014-02-28T10:52:42.981105-08:00", "fixedAt":"2014-02-03T21:59:12.223493-08:00", "fixedBy":{"username":"gvaidees", "name":"Ganesh Vaideeswaran", "email":"Ganesh.Vaideeswaran@marklogic.com"}, "shippedAt":"2014-02-28T10:52:42.981105-08:00", "shippedBy":{"username":"lratcliff", "name":"Larry Ratcliff", "email":"lratcliff@marklogic.com"}, "renderDescriptionAs":"normal"}
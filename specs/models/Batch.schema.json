{
  "$schema": "http://json-schema.org/schema#",
  "$id": "http://marklogic.com/data-hub/Batch.schema.json",
  "title": "Batch",
  "description": "Captures the results of processing a batch of items (often URIs, but not always) by a step",
  "type": "object",
  "properties": {
    "jobId": {
      "type": "string"
    },
    "batchId": {
      "type": "string",
      "description": "UUID generated by MarkLogic"
    },
    "flowName": {
      "type": "string",
      "description": "Added in 5.4.0; the name of the flow associated with the step executed for this batch"
    },
    "stepId": {
      "type": "string",
      "description": "Added in 5.4.0; the ID of the step, where ID = (stepName)-(stepDefinitionType)"
    },
    "step": {
      "type": "object",
      "description": "A copy of the step from its flow"
    },
    "stepNumber": {
      "type": "string"
    },
    "batchStatus": {
      "type": "string",
      "description": "The status is 'started' when processing begins on a batch and then is updated to be one of the other values when processing finishes",
      "enum": [
        "started",
        "failed",
        "finished",
        "finished_with_errors"
      ]
    },
    "timeStarted": {
      "type": "string",
      "description": "dateTime at which processing of the batch started"
    },
    "timeEnded": {
      "type": "string",
      "description": "dateTime at which processing of the batch ended"
    },
    "hostName": {
      "type": "string"
    },
    "reqTimeStamp": {
      "type": "string"
    },
    "reqTrnxID": {
      "type": "string"
    },
    "writeTimeStamp": {
      "type": "string",
      "description": "Captures date and time of the first write that occurs ('first' is only relevant when multiple steps are run)"
    },
    "writeTrnxID": {
      "type": "string",
      "description": "Captures transaction ID of the first write that occurs ('first' is only relevant when multiple steps are run)"
    },
    "writeTransactions": {
      "type": "object",
      "description": "Captures information about each transaction that writes documents outputted by a step",
      "additionalProperties": false,
      "patternProperties": {
        "^[0-9]+$": {
          "type": "object",
          "description": "Name of the database to which the transaction wrote",
          "properties": {
            "transactionId": {
              "type": "string",
              "description": "ID of the transaction, as returned by xdmp.transaction"
            },
            "transactionDateTime": {
              "type": "string",
              "description": "Date and time at which the transaction was written"
            }  
          }
        }
      }
    },
    "uris": {
      "type": "array",
      "description": "Starting in 5.3.0, this is not necessarily 'uris' and should be thought of as 'items', as other values besides URIs are possible",
      "items": {
        "type": "string"
      }
    },
    "processedItemHashes": {
      "type": "array",
      "description": "Added in 5.4.0; an array of 64-bit hashes for each item in the 'uris' array, combined with the flow name, step ID, and batch status; 'items' is used as these values are not always URIs",
      "items": {
        "type": "number"
      }
    },
    "fileName": {
      "type": "string",
      "description": "The URI of the module that an error occurred in"
    },
    "lineNumber": {
      "type": "string",
      "description": "The line number that an error occurred at"
    },
    "errorStack": {
      "type": "string",
      "description": "Error stacktrace serialized as a string"
    },
    "error": {
      "type": "string",
      "description": "Concatenation of an error's name, code, and message"
    },
    "completeError": {
      "type": "object",
      "description": "Contains several properties from the original error created by MarkLogic, along with 'uri' if available",
      "properties": {
        "name": {
          "type": "string"
        },
        "message": {
          "type": "string"
        },
        "stack": {
          "type": "string"
        }, 
        "uri": {
          "type": "string",
          "description": "Will be populated when the step configuration does not have 'acceptsBatch' set to 'true'"
        }
      }
    },
    "stepResults": {
      "description": "When steps are connected, an object will exist for each step that was run on the batch",
      "type": "array",
      "items": {
        "description": "In addition to below properties, contains each of the following top-level properties: stepId, step, stepNumber, uris, processedItemHashes, fileName, lineNumber, errorStack, error, completeError",
        "type": "object",
          "stepStartedDateTime": {
            "type": "string",
            "description": "dateTime at which processing of the step started"
          },
          "stepEndedDateTime": {
            "type": "string",
            "description": "dateTime at which processing of the step ended"
          },
          "stepDuration": {
            "type": "string",
            "description": "Difference, as a duration, between stepStartedDateTime and stepEndedDateTime"
          }
        }
      }
    }
  }
}
